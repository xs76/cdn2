var cr={plugins_:{},behaviors:{}};"function"!=typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"==typeof"test".__proto__?function(t){return t.__proto__}:function(t){return t.constructor.prototype}),function(){function t(t,e){this.x=t,this.y=e,cr.seal(this)}function e(t,e,i,o){this.set(t,e,i,o),cr.seal(this)}function i(){this.tlx=0,this.tly=0,this.trx=0,this.try_=0,this.brx=0,this.bry=0,this.blx=0,this.bly=0,cr.seal(this)}cr.logexport=function(t){window.console&&window.console.log&&window.console.log(t)},cr.logerror=function(t){window.console&&window.console.error&&window.console.error(t)},cr.seal=function(t){return t},cr.freeze=function(t){return t},cr.is_undefined=function(t){return void 0===t},cr.is_number=function(t){return"number"==typeof t},cr.is_string=function(t){return"string"==typeof t},cr.isPOT=function(t){return t>0&&0==(t-1&t)},cr.nextHighestPowerOfTwo=function(t){--t;for(var e=1;e<32;e<<=1)t|=t>>e;return t+1},cr.abs=function(t){return t<0?-t:t},cr.max=function(t,e){return t>e?t:e},cr.min=function(t,e){return t<e?t:e},cr.PI=Math.PI,cr.round=function(t){return t+.5|0},cr.floor=function(t){return t>=0?0|t:(0|t)-1},cr.ceil=function(t){var e=0|t;return e===t?e:e+1},t.prototype.offset=function(t,e){return this.x+=t,this.y+=e,this},t.prototype.mul=function(t,e){return this.x*=t,this.y*=e,this},cr.vector2=t,cr.segments_intersect=function(t,e,i,o,s,n,r,a){var h,c,l,m,u,p,d,y;if(t<i?(c=t,h=i):(c=i,h=t),s<r?(p=s,u=r):(p=r,u=s),h<p||c>u)return!1;if(e<o?(m=e,l=o):(m=o,l=e),n<a?(y=n,d=a):(y=a,d=n),l<y||m>d)return!1;var _=s-t+r-i,f=n-e+a-o,x=i-t,g=o-e,b=r-s,v=a-n,B=cr.abs(g*b-v*x),D=b*f-v*_;if(cr.abs(D)>B)return!1;var w=x*f-g*_;return cr.abs(w)<=B},e.prototype.set=function(t,e,i,o){this.left=t,this.top=e,this.right=i,this.bottom=o},e.prototype.copy=function(t){this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom},e.prototype.width=function(){return this.right-this.left},e.prototype.height=function(){return this.bottom-this.top},e.prototype.offset=function(t,e){return this.left+=t,this.top+=e,this.right+=t,this.bottom+=e,this},e.prototype.normalize=function(){var t=0;this.left>this.right&&(t=this.left,this.left=this.right,this.right=t),this.top>this.bottom&&(t=this.top,this.top=this.bottom,this.bottom=t)},e.prototype.intersects_rect=function(t){return!(t.right<this.left||t.bottom<this.top||t.left>this.right||t.top>this.bottom)},e.prototype.intersects_rect_off=function(t,e,i){return!(t.right+e<this.left||t.bottom+i<this.top||t.left+e>this.right||t.top+i>this.bottom)},e.prototype.contains_pt=function(t,e){return t>=this.left&&t<=this.right&&e>=this.top&&e<=this.bottom},e.prototype.equals=function(t){return this.left===t.left&&this.top===t.top&&this.right===t.right&&this.bottom===t.bottom},cr.rect=e,i.prototype.set_from_rect=function(t){this.tlx=t.left,this.tly=t.top,this.trx=t.right,this.try_=t.top,this.brx=t.right,this.bry=t.bottom,this.blx=t.left,this.bly=t.bottom},i.prototype.set_from_rotated_rect=function(t,e){if(0===e)this.set_from_rect(t);else{var i=Math.sin(e),o=Math.cos(e),s=t.left*i,n=t.top*i,r=t.right*i,a=t.bottom*i,h=t.left*o,c=t.top*o,l=t.right*o,m=t.bottom*o;this.tlx=h-n,this.tly=c+s,this.trx=l-n,this.try_=c+r,this.brx=l-a,this.bry=m+r,this.blx=h-a,this.bly=m+s}},i.prototype.offset=function(t,e){return this.tlx+=t,this.tly+=e,this.trx+=t,this.try_+=e,this.brx+=t,this.bry+=e,this.blx+=t,this.bly+=e,this};var o=0,s=0;function n(t,e,i,n){t<e?i<n?(o=t<i?t:i,s=e>n?e:n):(o=t<n?t:n,s=e>i?e:i):i<n?(o=e<i?e:i,s=t>n?t:n):(o=e<n?e:n,s=t>i?t:i)}i.prototype.bounding_box=function(t){n(this.tlx,this.trx,this.brx,this.blx),t.left=o,t.right=s,n(this.tly,this.try_,this.bry,this.bly),t.top=o,t.bottom=s},i.prototype.contains_pt=function(t,e){var i,o,s,n=this.tlx,r=this.tly,a=this.trx-n,h=this.try_-r,c=this.brx-n,l=this.bry-r,m=t-n,u=e-r,p=c*c+l*l,d=c*m+l*u,y=1/((i=a*a+h*h)*p-(o=a*c+h*l)*o),_=(p*(s=a*m+h*u)-o*d)*y,f=(i*d-o*s)*y;return _>=0&&f>0&&_+f<1||(f=((i=(a=this.blx-n)*a+(h=this.bly-r)*h)*d-(o=a*c+h*l)*(s=a*m+h*u))*(y=1/(i*p-o*o)),(_=(p*s-o*d)*y)>=0&&f>0&&_+f<1)},i.prototype.at=function(t,e){if(e)switch(t){case 0:return this.tlx;case 1:return this.trx;case 2:return this.brx;case 3:return this.blx;case 4:default:return this.tlx}else switch(t){case 0:return this.tly;case 1:return this.try_;case 2:return this.bry;case 3:return this.bly;case 4:default:return this.tly}},i.prototype.midX=function(){return(this.tlx+this.trx+this.brx+this.blx)/4},i.prototype.midY=function(){return(this.tly+this.try_+this.bry+this.bly)/4},i.prototype.intersects_segment=function(t,e,i,o){if(this.contains_pt(t,e)||this.contains_pt(i,o))return!0;var s,n,r,a,h;for(h=0;h<4;h++)if(s=this.at(h,!0),n=this.at(h,!1),r=this.at(h+1,!0),a=this.at(h+1,!1),cr.segments_intersect(t,e,i,o,s,n,r,a))return!0;return!1},i.prototype.intersects_quad=function(t){var e,i,o,s,n,r,a,h,c,l,m=t.midX(),u=t.midY();if(this.contains_pt(m,u))return!0;if(m=this.midX(),u=this.midY(),t.contains_pt(m,u))return!0;for(c=0;c<4;c++)for(l=0;l<4;l++)if(e=this.at(c,!0),i=this.at(c,!1),o=this.at(c+1,!0),s=this.at(c+1,!1),n=t.at(l,!0),r=t.at(l,!1),a=t.at(l+1,!0),h=t.at(l+1,!1),cr.segments_intersect(e,i,o,s,n,r,a,h))return!0;return!1},cr.quad=i,cr.RGB=function(t,e,i){return Math.max(Math.min(t,255),0)|Math.max(Math.min(e,255),0)<<8|Math.max(Math.min(i,255),0)<<16},cr.GetRValue=function(t){return 255&t},cr.GetGValue=function(t){return(65280&t)>>8},cr.GetBValue=function(t){return(16711680&t)>>16},cr.shallowCopy=function(t,e,i){var o;for(o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);return t},cr.arrayRemove=function(t,e){var i,o;if(!((e=cr.floor(e))<0||e>=t.length)){for(i=e,o=t.length-1;i<o;i++)t[i]=t[i+1];cr.truncateArray(t,o)}},cr.truncateArray=function(t,e){t.length=e},cr.clearArray=function(t){cr.truncateArray(t,0)},cr.shallowAssignArray=function(t,e){var i,o;for(cr.clearArray(t),i=0,o=e.length;i<o;++i)t[i]=e[i]},cr.appendArray=function(t,e){t.push.apply(t,e)},cr.fastIndexOf=function(t,e){var i,o;for(i=0,o=t.length;i<o;++i)if(t[i]===e)return i;return-1},cr.arrayFindRemove=function(t,e){var i=cr.fastIndexOf(t,e);-1!==i&&cr.arrayRemove(t,i)},cr.clamp=function(t,e,i){return t<e?e:t>i?i:t},cr.to_radians=function(t){return t/(180/cr.PI)},cr.to_degrees=function(t){return t*(180/cr.PI)},cr.clamp_angle_degrees=function(t){return(t%=360)<0&&(t+=360),t},cr.clamp_angle=function(t){return(t%=2*cr.PI)<0&&(t+=2*cr.PI),t},cr.to_clamped_degrees=function(t){return cr.clamp_angle_degrees(cr.to_degrees(t))},cr.to_clamped_radians=function(t){return cr.clamp_angle(cr.to_radians(t))},cr.angleTo=function(t,e,i,o){var s=i-t,n=o-e;return Math.atan2(n,s)},cr.angleDiff=function(t,e){if(t===e)return 0;var i=Math.sin(t),o=Math.cos(t),s=i*Math.sin(e)+o*Math.cos(e);return s>=1?0:s<=-1?cr.PI:Math.acos(s)},cr.angleRotate=function(t,e,i){var o=Math.sin(t),s=Math.cos(t),n=Math.sin(e),r=Math.cos(e);return Math.acos(o*n+s*r)>i?s*n-o*r>0?cr.clamp_angle(t+i):cr.clamp_angle(t-i):cr.clamp_angle(e)},cr.angleClockwise=function(t,e){var i=Math.sin(t);return Math.cos(t)*Math.sin(e)-i*Math.cos(e)<=0},cr.rotatePtAround=function(t,e,i,o,s,n){if(0===i)return n?t:e;var r=Math.sin(i),a=Math.cos(i),h=(t-=o)*r;return t=t*a-(e-=s)*r,e=e*a+h,t+=o,e+=s,n?t:e},cr.distanceTo=function(t,e,i,o){var s=i-t,n=o-e;return Math.sqrt(s*s+n*n)},cr.xor=function(t,e){return!t!=!e},cr.lerp=function(t,e,i){return t+(e-t)*i},cr.unlerp=function(t,e,i){return t===e?0:(i-t)/(e-t)},cr.anglelerp=function(t,e,i){var o=cr.angleDiff(t,e);return cr.angleClockwise(e,t)?t+o*i:t-o*i},cr.qarp=function(t,e,i,o){return cr.lerp(cr.lerp(t,e,o),cr.lerp(e,i,o),o)},cr.cubic=function(t,e,i,o,s){return cr.lerp(cr.qarp(t,e,i,s),cr.qarp(e,i,o,s),s)},cr.cosp=function(t,e,i){return(t+e+(t-e)*Math.cos(i*Math.PI))/2},cr.hasAnyOwnProperty=function(t){var e;for(e in t)if(t.hasOwnProperty(e))return!0;return!1},cr.wipe=function(t){var e;for(e in t)t.hasOwnProperty(e)&&delete t[e]};var r=+new Date;cr.performance_now=function(){if(void 0!==window.performance){var t=window.performance;if(void 0!==t.now)return t.now();if(void 0!==t.webkitNow)return t.webkitNow();if(void 0!==t.mozNow)return t.mozNow();if(void 0!==t.msNow)return t.msNow()}return Date.now()-r};var a=!1,h=!1,c=!1;"undefined"!=typeof window&&(a=!(/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent))&&/safari/i.test(navigator.userAgent),h=/(iphone|ipod|ipad)/i.test(navigator.userAgent),c=window.c2ejecta);var l=!a&&!c&&!h&&"undefined"!=typeof Set&&void 0!==Set.prototype.forEach;function m(){this.s=null,this.items=null,this.item_count=0,l&&(this.s=new Set),this.values_cache=[],this.cache_valid=!0,cr.seal(this)}m.prototype.contains=function(t){return!this.isEmpty()&&(l?this.s.has(t):this.items&&this.items.hasOwnProperty(t))},m.prototype.add=function(t){if(l)this.s.has(t)||(this.s.add(t),this.cache_valid=!1);else{var e=t.toString(),i=this.items;i?i.hasOwnProperty(e)||(i[e]=t,this.item_count++,this.cache_valid=!1):(this.items={},this.items[e]=t,this.item_count=1,this.cache_valid=!1)}},m.prototype.remove=function(t){if(!this.isEmpty())if(l)this.s.has(t)&&(this.s.delete(t),this.cache_valid=!1);else if(this.items){var e=t.toString(),i=this.items;i.hasOwnProperty(e)&&(delete i[e],this.item_count--,this.cache_valid=!1)}},m.prototype.clear=function(){this.isEmpty()||(l?this.s.clear():(this.items=null,this.item_count=0),cr.clearArray(this.values_cache),this.cache_valid=!0)},m.prototype.isEmpty=function(){return 0===this.count()},m.prototype.count=function(){return l?this.s.size:this.item_count};var u=null,p=0;function d(t){u[p++]=t}m.prototype.update_cache=function(){if(!this.cache_valid){if(l)cr.clearArray(this.values_cache),u=this.values_cache,p=0,this.s.forEach(d),u=null,p=0;else{var t=this.values_cache;cr.clearArray(t);var e,i=0,o=this.items;if(o)for(e in o)o.hasOwnProperty(e)&&(t[i++]=o[e])}this.cache_valid=!0}},m.prototype.valuesRef=function(){return this.update_cache(),this.values_cache},cr.ObjectSet=m;var y=new cr.ObjectSet;function _(){this.c=0,this.y=0,this.t=0,this.sum=0,cr.seal(this)}function f(t){this.pts_cache=[],this.bboxLeft=0,this.bboxTop=0,this.bboxRight=0,this.bboxBottom=0,this.convexpolys=null,this.set_pts(t),cr.seal(this)}function x(t,e){this.cellwidth=t,this.cellheight=e,this.cells={}}function g(t,e){this.cellwidth=t,this.cellheight=e,this.cells={}}cr.removeArrayDuplicates=function(t){var e,i;for(e=0,i=t.length;e<i;++e)y.add(t[e]);cr.shallowAssignArray(t,y.valuesRef()),y.clear()},cr.arrayRemoveAllFromObjectSet=function(t,e){l?cr.arrayRemoveAll_set(t,e.s):cr.arrayRemoveAll_arr(t,e.valuesRef())},cr.arrayRemoveAll_set=function(t,e){var i,o,s,n;for(i=0,o=0,s=t.length;i<s;++i)n=t[i],e.has(n)||(t[o++]=n);cr.truncateArray(t,o)},cr.arrayRemoveAll_arr=function(t,e){var i,o,s,n;for(i=0,o=0,s=t.length;i<s;++i)n=t[i],-1===cr.fastIndexOf(e,n)&&(t[o++]=n);cr.truncateArray(t,o)},_.prototype.add=function(t){this.y=t-this.c,this.t=this.sum+this.y,this.c=this.t-this.sum-this.y,this.sum=this.t},_.prototype.reset=function(){this.c=0,this.y=0,this.t=0,this.sum=0},cr.KahanAdder=_,cr.regexp_escape=function(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},f.prototype.set_pts=function(t){this.pts_array=t,this.pts_count=t.length/2,this.pts_cache.length=t.length,this.cache_width=-1,this.cache_height=-1,this.cache_angle=0},f.prototype.is_empty=function(){return!this.pts_array.length},f.prototype.update_bbox=function(){for(var t,e,i,o=this.pts_cache,s=o[0],n=s,r=o[1],a=r,h=1,c=this.pts_count;h<c;++h)(t=o[i=2*h])<s&&(s=t),t>n&&(n=t),(e=o[i+1])<r&&(r=e),e>a&&(a=e);this.bboxLeft=s,this.bboxRight=n,this.bboxTop=r,this.bboxBottom=a},f.prototype.set_from_rect=function(t,e,i){this.pts_cache.length=8,this.pts_count=4;var o=this.pts_cache;o[0]=t.left-e,o[1]=t.top-i,o[2]=t.right-e,o[3]=t.top-i,o[4]=t.right-e,o[5]=t.bottom-i,o[6]=t.left-e,o[7]=t.bottom-i,this.cache_width=t.right-t.left,this.cache_height=t.bottom-t.top,this.update_bbox()},f.prototype.set_from_quad=function(t,e,i,o,s){this.pts_cache.length=8,this.pts_count=4;var n=this.pts_cache;n[0]=t.tlx-e,n[1]=t.tly-i,n[2]=t.trx-e,n[3]=t.try_-i,n[4]=t.brx-e,n[5]=t.bry-i,n[6]=t.blx-e,n[7]=t.bly-i,this.cache_width=o,this.cache_height=s,this.update_bbox()},f.prototype.set_from_poly=function(t){this.pts_count=t.pts_count,cr.shallowAssignArray(this.pts_cache,t.pts_cache),this.bboxLeft=t.bboxLeft,this.bboxTop,t.bboxTop,this.bboxRight=t.bboxRight,this.bboxBottom=t.bboxBottom},f.prototype.cache_poly=function(t,e,i){if(this.cache_width!==t||this.cache_height!==e||this.cache_angle!==i){var o,s,n,r,a,h;this.cache_width=t,this.cache_height=e,this.cache_angle=i;var c=0,l=1,m=this.pts_array,u=this.pts_cache;for(0!==i&&(c=Math.sin(i),l=Math.cos(i)),o=0,r=this.pts_count;o<r;o++)n=(s=2*o)+1,a=m[s]*t,h=m[n]*e,u[s]=a*l-h*c,u[n]=h*l+a*c;this.update_bbox()}},f.prototype.contains_pt=function(t,e){var i=this.pts_cache;if(t===i[0]&&e===i[1])return!0;var o,s,n,r,a,h,c,l=this.pts_count,m=this.bboxLeft-110,u=this.bboxTop-101,p=this.bboxRight+131,d=this.bboxBottom+120,y=0,_=0;for(o=0;o<l;o++)n=(o+1)%l*2,r=i[s=2*o],a=i[s+1],h=i[n],c=i[n+1],cr.segments_intersect(m,u,t,e,r,a,h,c)&&y++,cr.segments_intersect(p,d,t,e,r,a,h,c)&&_++;return y%2==1||_%2==1},f.prototype.intersects_poly=function(t,e,i){var o,s,n,r,a,h,c,l,m,u,p,d,y,_,f,x,g=t.pts_cache,b=this.pts_cache;if(this.contains_pt(g[0]+e,g[1]+i))return!0;if(t.contains_pt(b[0]-e,b[1]-i))return!0;for(o=0,r=this.pts_count;o<r;o++)for(n=(o+1)%r*2,m=b[s=2*o],u=b[s+1],p=b[n],d=b[n+1],a=0,l=t.pts_count;a<l;a++)if(c=(a+1)%l*2,y=g[h=2*a]+e,_=g[h+1]+i,f=g[c]+e,x=g[c+1]+i,cr.segments_intersect(m,u,p,d,y,_,f,x))return!0;return!1},f.prototype.intersects_segment=function(t,e,i,o,s,n){var r,a,h,c,l,m,u,p,d=this.pts_cache;if(this.contains_pt(i-t,o-e))return!0;for(r=0,a=this.pts_count;r<a;r++)if(c=(r+1)%a*2,l=d[h=2*r]+t,m=d[h+1]+e,u=d[c]+t,p=d[c+1]+e,cr.segments_intersect(i,o,s,n,l,m,u,p))return!0;return!1},f.prototype.mirror=function(t){var e,i,o;for(e=0,i=this.pts_count;e<i;++e)o=2*e,this.pts_cache[o]=2*t-this.pts_cache[o]},f.prototype.flip=function(t){var e,i,o;for(e=0,i=this.pts_count;e<i;++e)o=2*e+1,this.pts_cache[o]=2*t-this.pts_cache[o]},f.prototype.diag=function(){var t,e,i,o,s;for(t=0,e=this.pts_count;t<e;++t)o=(i=2*t)+1,s=this.pts_cache[i],this.pts_cache[i]=this.pts_cache[o],this.pts_cache[o]=s},cr.CollisionPoly=f,x.prototype.totalCellCount=0,x.prototype.getCell=function(t,e,i){var o,s=this.cells[t];return s?(o=s[e])||(i?(o=v(this,t,e),this.cells[t][e]=o,o):null):i?(o=v(this,t,e),this.cells[t]={},this.cells[t][e]=o,o):null},x.prototype.XToCell=function(t){return cr.floor(t/this.cellwidth)},x.prototype.YToCell=function(t){return cr.floor(t/this.cellheight)},x.prototype.update=function(t,e,i){var o,s,n,r,a;if(e)for(o=e.left,s=e.right;o<=s;++o)for(n=e.top,r=e.bottom;n<=r;++n)i&&i.contains_pt(o,n)||(a=this.getCell(o,n,!1))&&(a.remove(t),a.isEmpty()&&(B(a),this.cells[o][n]=null));if(i)for(o=i.left,s=i.right;o<=s;++o)for(n=i.top,r=i.bottom;n<=r;++n)e&&e.contains_pt(o,n)||this.getCell(o,n,!0).insert(t)},x.prototype.queryRange=function(t,e){var i,o,s,n,r,a;for(i=this.XToCell(t.left),s=this.YToCell(t.top),o=this.XToCell(t.right),r=this.YToCell(t.bottom);i<=o;++i)for(n=s;n<=r;++n)(a=this.getCell(i,n,!1))&&a.dump(e)},cr.SparseGrid=x,g.prototype.totalCellCount=0,g.prototype.getCell=function(t,e,i){var o,s=this.cells[t];return s?(o=s[e])||(i?(o=C(this,t,e),this.cells[t][e]=o,o):null):i?(o=C(this,t,e),this.cells[t]={},this.cells[t][e]=o,o):null},g.prototype.XToCell=function(t){return cr.floor(t/this.cellwidth)},g.prototype.YToCell=function(t){return cr.floor(t/this.cellheight)},g.prototype.update=function(t,e,i){var o,s,n,r,a;if(e)for(o=e.left,s=e.right;o<=s;++o)for(n=e.top,r=e.bottom;n<=r;++n)i&&i.contains_pt(o,n)||(a=this.getCell(o,n,!1))&&(a.remove(t),a.isEmpty()&&(S(a),this.cells[o][n]=null));if(i)for(o=i.left,s=i.right;o<=s;++o)for(n=i.top,r=i.bottom;n<=r;++n)e&&e.contains_pt(o,n)||this.getCell(o,n,!0).insert(t)},g.prototype.queryRange=function(t,e,i,o,s){var n,r,a,h,c,l;for(n=this.XToCell(t),a=this.YToCell(e),r=this.XToCell(i),c=this.YToCell(o);n<=r;++n)for(h=a;h<=c;++h)(l=this.getCell(n,h,!1))&&l.dump(s)},g.prototype.markRangeChanged=function(t){var e,i,o,s,n,r;for(e=t.left,o=t.top,i=t.right,n=t.bottom;e<=i;++e)for(s=o;s<=n;++s)(r=this.getCell(e,s,!1))&&(r.is_sorted=!1)},cr.RenderGrid=g;var b=[];function v(t,e,i){var o;return x.prototype.totalCellCount++,b.length?((o=b.pop()).grid=t,o.x=e,o.y=i,o):new cr.GridCell(t,e,i)}function B(t){x.prototype.totalCellCount--,t.objects.clear(),b.length<1e3&&b.push(t)}function D(t,e,i){this.grid=t,this.x=e,this.y=i,this.objects=new cr.ObjectSet}D.prototype.isEmpty=function(){return this.objects.isEmpty()},D.prototype.insert=function(t){this.objects.add(t)},D.prototype.remove=function(t){this.objects.remove(t)},D.prototype.dump=function(t){cr.appendArray(t,this.objects.valuesRef())},cr.GridCell=D;var w=[];function C(t,e,i){var o;return g.prototype.totalCellCount++,w.length?((o=w.pop()).grid=t,o.x=e,o.y=i,o):new cr.RenderCell(t,e,i)}function S(t){g.prototype.totalCellCount--,t.reset(),w.length<1e3&&w.push(t)}function A(t,e,i){this.grid=t,this.x=e,this.y=i,this.objects=[],this.is_sorted=!0,this.pending_removal=new cr.ObjectSet,this.any_pending_removal=!1}function M(t,e){return t.zindex-e.zindex}A.prototype.isEmpty=function(){return!this.objects.length||!(this.objects.length>this.pending_removal.count())&&(this.flush_pending(),!0)},A.prototype.insert=function(t){if(this.pending_removal.contains(t))return this.pending_removal.remove(t),void(this.pending_removal.isEmpty()&&(this.any_pending_removal=!1));this.objects.length?(this.objects[this.objects.length-1].get_zindex()>t.get_zindex()&&(this.is_sorted=!1),this.objects.push(t)):(this.objects.push(t),this.is_sorted=!0)},A.prototype.remove=function(t){this.pending_removal.add(t),this.any_pending_removal=!0,this.pending_removal.count()>=30&&this.flush_pending()},A.prototype.flush_pending=function(){this.any_pending_removal&&(this.pending_removal.count()!==this.objects.length?(cr.arrayRemoveAllFromObjectSet(this.objects,this.pending_removal),this.pending_removal.clear(),this.any_pending_removal=!1):this.reset())},A.prototype.ensure_sorted=function(){this.is_sorted||(this.objects.sort(M),this.is_sorted=!0)},A.prototype.reset=function(){cr.clearArray(this.objects),this.is_sorted=!0,this.pending_removal.clear(),this.any_pending_removal=!1},A.prototype.dump=function(t){this.flush_pending(),this.ensure_sorted(),this.objects.length&&t.push(this.objects)},cr.RenderCell=A;var T=["lighter","xor","copy","destination-over","source-in","destination-in","source-out","destination-out","source-atop","destination-atop"];cr.effectToCompositeOp=function(t){return t<=0||t>=11?"source-over":T[t-1]},cr.setGLBlend=function(t,e,i){if(i)switch(t.srcBlend=i.ONE,t.destBlend=i.ONE_MINUS_SRC_ALPHA,e){case 1:t.srcBlend=i.ONE,t.destBlend=i.ONE;break;case 2:break;case 3:t.srcBlend=i.ONE,t.destBlend=i.ZERO;break;case 4:t.srcBlend=i.ONE_MINUS_DST_ALPHA,t.destBlend=i.ONE;break;case 5:t.srcBlend=i.DST_ALPHA,t.destBlend=i.ZERO;break;case 6:t.srcBlend=i.ZERO,t.destBlend=i.SRC_ALPHA;break;case 7:t.srcBlend=i.ONE_MINUS_DST_ALPHA,t.destBlend=i.ZERO;break;case 8:t.srcBlend=i.ZERO,t.destBlend=i.ONE_MINUS_SRC_ALPHA;break;case 9:t.srcBlend=i.DST_ALPHA,t.destBlend=i.ONE_MINUS_SRC_ALPHA;break;case 10:t.srcBlend=i.ONE_MINUS_DST_ALPHA,t.destBlend=i.SRC_ALPHA}},cr.round6dp=function(t){return Math.round(1e6*t)/1e6},cr.equals_nocase=function(t,e){return"string"==typeof t&&"string"==typeof e&&(t.length===e.length&&(t===e||t.toLowerCase()===e.toLowerCase()))},cr.isCanvasInputEvent=function(t){var e=t.target;return!e||(e===document||e===window||(!(!document||!document.body||e!==document.body)||!!cr.equals_nocase(e.tagName,"canvas")))}}();var MatrixArray="undefined"!=typeof Float32Array?Float32Array:Array,glMatrixArrayType=MatrixArray,vec3={},mat3={},mat4={},quat4={};vec3.create=function(t){var e=new MatrixArray(3);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2]),e},vec3.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},vec3.add=function(t,e,i){return i&&t!==i?(i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i):(t[0]+=e[0],t[1]+=e[1],t[2]+=e[2],t)},vec3.subtract=function(t,e,i){return i&&t!==i?(i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i):(t[0]-=e[0],t[1]-=e[1],t[2]-=e[2],t)},vec3.negate=function(t,e){return e||(e=t),e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},vec3.scale=function(t,e,i){return i&&t!==i?(i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i):(t[0]*=e,t[1]*=e,t[2]*=e,t)},vec3.normalize=function(t,e){e||(e=t);var i=t[0],o=t[1],s=t[2],n=Math.sqrt(i*i+o*o+s*s);return n?1===n?(e[0]=i,e[1]=o,e[2]=s,e):(n=1/n,e[0]=i*n,e[1]=o*n,e[2]=s*n,e):(e[0]=0,e[1]=0,e[2]=0,e)},vec3.cross=function(t,e,i){i||(i=t);var o=t[0],s=t[1],n=(t=t[2],e[0]),r=e[1];e=e[2];return i[0]=s*e-t*r,i[1]=t*n-o*e,i[2]=o*r-s*n,i},vec3.length=function(t){var e=t[0],i=t[1];t=t[2];return Math.sqrt(e*e+i*i+t*t)},vec3.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},vec3.direction=function(t,e,i){i||(i=t);var o=t[0]-e[0],s=t[1]-e[1];t=t[2]-e[2];return(e=Math.sqrt(o*o+s*s+t*t))?(e=1/e,i[0]=o*e,i[1]=s*e,i[2]=t*e,i):(i[0]=0,i[1]=0,i[2]=0,i)},vec3.lerp=function(t,e,i,o){return o||(o=t),o[0]=t[0]+i*(e[0]-t[0]),o[1]=t[1]+i*(e[1]-t[1]),o[2]=t[2]+i*(e[2]-t[2]),o},vec3.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+"]"},mat3.create=function(t){var e=new MatrixArray(9);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8]),e},mat3.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},mat3.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},mat3.transpose=function(t,e){if(!e||t===e){var i=t[1],o=t[2],s=t[5];return t[1]=t[3],t[2]=t[6],t[3]=i,t[5]=t[7],t[6]=o,t[7]=s,t}return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],e},mat3.toMat4=function(t,e){return e||(e=mat4.create()),e[15]=1,e[14]=0,e[13]=0,e[12]=0,e[11]=0,e[10]=t[8],e[9]=t[7],e[8]=t[6],e[7]=0,e[6]=t[5],e[5]=t[4],e[4]=t[3],e[3]=0,e[2]=t[2],e[1]=t[1],e[0]=t[0],e},mat3.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+"]"},mat4.create=function(t){var e=new MatrixArray(16);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e},mat4.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},mat4.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4.transpose=function(t,e){if(!e||t===e){var i=t[1],o=t[2],s=t[3],n=t[6],r=t[7],a=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=i,t[6]=t[9],t[7]=t[13],t[8]=o,t[9]=n,t[11]=t[14],t[12]=s,t[13]=r,t[14]=a,t}return e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15],e},mat4.determinant=function(t){var e=t[0],i=t[1],o=t[2],s=t[3],n=t[4],r=t[5],a=t[6],h=t[7],c=t[8],l=t[9],m=t[10],u=t[11],p=t[12],d=t[13],y=t[14];return p*l*a*s-c*d*a*s-p*r*m*s+n*d*m*s+c*r*y*s-n*l*y*s-p*l*o*h+c*d*o*h+p*i*m*h-e*d*m*h-c*i*y*h+e*l*y*h+p*r*o*u-n*d*o*u-p*i*a*u+e*d*a*u+n*i*y*u-e*r*y*u-c*r*o*(t=t[15])+n*l*o*t+c*i*a*t-e*l*a*t-n*i*m*t+e*r*m*t},mat4.inverse=function(t,e){e||(e=t);var i=t[0],o=t[1],s=t[2],n=t[3],r=t[4],a=t[5],h=t[6],c=t[7],l=t[8],m=t[9],u=t[10],p=t[11],d=t[12],y=t[13],_=t[14],f=t[15],x=i*a-o*r,g=i*h-s*r,b=i*c-n*r,v=o*h-s*a,B=o*c-n*a,D=s*c-n*h,w=l*y-m*d,C=l*_-u*d,S=l*f-p*d,A=m*_-u*y,M=m*f-p*y,T=u*f-p*_,I=1/(x*T-g*M+b*A+v*S-B*C+D*w);return e[0]=(a*T-h*M+c*A)*I,e[1]=(-o*T+s*M-n*A)*I,e[2]=(y*D-_*B+f*v)*I,e[3]=(-m*D+u*B-p*v)*I,e[4]=(-r*T+h*S-c*C)*I,e[5]=(i*T-s*S+n*C)*I,e[6]=(-d*D+_*b-f*g)*I,e[7]=(l*D-u*b+p*g)*I,e[8]=(r*M-a*S+c*w)*I,e[9]=(-i*M+o*S-n*w)*I,e[10]=(d*B-y*b+f*x)*I,e[11]=(-l*B+m*b-p*x)*I,e[12]=(-r*A+a*C-h*w)*I,e[13]=(i*A-o*C+s*w)*I,e[14]=(-d*v+y*g-_*x)*I,e[15]=(l*v-m*g+u*x)*I,e},mat4.toRotationMat=function(t,e){return e||(e=mat4.create()),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mat4.toMat3=function(t,e){return e||(e=mat3.create()),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},mat4.toInverseMat3=function(t,e){var i=t[0],o=t[1],s=t[2],n=t[4],r=t[5],a=t[6],h=t[8],c=t[9],l=t[10],m=l*r-a*c,u=-l*n+a*h,p=c*n-r*h,d=i*m+o*u+s*p;return d?(d=1/d,e||(e=mat3.create()),e[0]=m*d,e[1]=(-l*o+s*c)*d,e[2]=(a*o-s*r)*d,e[3]=u*d,e[4]=(l*i-s*h)*d,e[5]=(-a*i+s*n)*d,e[6]=p*d,e[7]=(-c*i+o*h)*d,e[8]=(r*i-o*n)*d,e):null},mat4.multiply=function(t,e,i){i||(i=t);var o=t[0],s=t[1],n=t[2],r=t[3],a=t[4],h=t[5],c=t[6],l=t[7],m=t[8],u=t[9],p=t[10],d=t[11],y=t[12],_=t[13],f=t[14],x=(t=t[15],e[0]),g=e[1],b=e[2],v=e[3],B=e[4],D=e[5],w=e[6],C=e[7],S=e[8],A=e[9],M=e[10],T=e[11],I=e[12],P=e[13],L=e[14];e=e[15];return i[0]=x*o+g*a+b*m+v*y,i[1]=x*s+g*h+b*u+v*_,i[2]=x*n+g*c+b*p+v*f,i[3]=x*r+g*l+b*d+v*t,i[4]=B*o+D*a+w*m+C*y,i[5]=B*s+D*h+w*u+C*_,i[6]=B*n+D*c+w*p+C*f,i[7]=B*r+D*l+w*d+C*t,i[8]=S*o+A*a+M*m+T*y,i[9]=S*s+A*h+M*u+T*_,i[10]=S*n+A*c+M*p+T*f,i[11]=S*r+A*l+M*d+T*t,i[12]=I*o+P*a+L*m+e*y,i[13]=I*s+P*h+L*u+e*_,i[14]=I*n+P*c+L*p+e*f,i[15]=I*r+P*l+L*d+e*t,i},mat4.multiplyVec3=function(t,e,i){i||(i=e);var o=e[0],s=e[1];e=e[2];return i[0]=t[0]*o+t[4]*s+t[8]*e+t[12],i[1]=t[1]*o+t[5]*s+t[9]*e+t[13],i[2]=t[2]*o+t[6]*s+t[10]*e+t[14],i},mat4.multiplyVec4=function(t,e,i){i||(i=e);var o=e[0],s=e[1],n=e[2];e=e[3];return i[0]=t[0]*o+t[4]*s+t[8]*n+t[12]*e,i[1]=t[1]*o+t[5]*s+t[9]*n+t[13]*e,i[2]=t[2]*o+t[6]*s+t[10]*n+t[14]*e,i[3]=t[3]*o+t[7]*s+t[11]*n+t[15]*e,i},mat4.translate=function(t,e,i){var o,s,n,r,a,h,c,l,m,u,p,d,y=e[0],_=e[1];e=e[2];return i&&t!==i?(o=t[0],s=t[1],n=t[2],r=t[3],a=t[4],h=t[5],c=t[6],l=t[7],m=t[8],u=t[9],p=t[10],d=t[11],i[0]=o,i[1]=s,i[2]=n,i[3]=r,i[4]=a,i[5]=h,i[6]=c,i[7]=l,i[8]=m,i[9]=u,i[10]=p,i[11]=d,i[12]=o*y+a*_+m*e+t[12],i[13]=s*y+h*_+u*e+t[13],i[14]=n*y+c*_+p*e+t[14],i[15]=r*y+l*_+d*e+t[15],i):(t[12]=t[0]*y+t[4]*_+t[8]*e+t[12],t[13]=t[1]*y+t[5]*_+t[9]*e+t[13],t[14]=t[2]*y+t[6]*_+t[10]*e+t[14],t[15]=t[3]*y+t[7]*_+t[11]*e+t[15],t)},mat4.scale=function(t,e,i){var o=e[0],s=e[1];e=e[2];return i&&t!==i?(i[0]=t[0]*o,i[1]=t[1]*o,i[2]=t[2]*o,i[3]=t[3]*o,i[4]=t[4]*s,i[5]=t[5]*s,i[6]=t[6]*s,i[7]=t[7]*s,i[8]=t[8]*e,i[9]=t[9]*e,i[10]=t[10]*e,i[11]=t[11]*e,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i):(t[0]*=o,t[1]*=o,t[2]*=o,t[3]*=o,t[4]*=s,t[5]*=s,t[6]*=s,t[7]*=s,t[8]*=e,t[9]*=e,t[10]*=e,t[11]*=e,t)},mat4.rotate=function(t,e,i,o){var s,n,r,a,h,c,l,m,u,p,d,y,_,f,x,g,b,v,B,D,w=i[0],C=i[1],S=(i=i[2],Math.sqrt(w*w+C*C+i*i));return S?(1!==S&&(w*=S=1/S,C*=S,i*=S),s=Math.sin(e),r=1-(n=Math.cos(e)),e=t[0],S=t[1],a=t[2],h=t[3],c=t[4],l=t[5],m=t[6],u=t[7],p=t[8],d=t[9],y=t[10],_=t[11],f=w*w*r+n,x=C*w*r+i*s,g=i*w*r-C*s,b=w*C*r-i*s,v=C*C*r+n,B=i*C*r+w*s,D=w*i*r+C*s,w=C*i*r-w*s,C=i*i*r+n,o?t!==o&&(o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]):o=t,o[0]=e*f+c*x+p*g,o[1]=S*f+l*x+d*g,o[2]=a*f+m*x+y*g,o[3]=h*f+u*x+_*g,o[4]=e*b+c*v+p*B,o[5]=S*b+l*v+d*B,o[6]=a*b+m*v+y*B,o[7]=h*b+u*v+_*B,o[8]=e*D+c*w+p*C,o[9]=S*D+l*w+d*C,o[10]=a*D+m*w+y*C,o[11]=h*D+u*w+_*C,o):null},mat4.rotateX=function(t,e,i){var o=Math.sin(e),s=(e=Math.cos(e),t[4]),n=t[5],r=t[6],a=t[7],h=t[8],c=t[9],l=t[10],m=t[11];return i?t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[4]=s*e+h*o,i[5]=n*e+c*o,i[6]=r*e+l*o,i[7]=a*e+m*o,i[8]=s*-o+h*e,i[9]=n*-o+c*e,i[10]=r*-o+l*e,i[11]=a*-o+m*e,i},mat4.rotateY=function(t,e,i){var o=Math.sin(e),s=(e=Math.cos(e),t[0]),n=t[1],r=t[2],a=t[3],h=t[8],c=t[9],l=t[10],m=t[11];return i?t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[0]=s*e+h*-o,i[1]=n*e+c*-o,i[2]=r*e+l*-o,i[3]=a*e+m*-o,i[8]=s*o+h*e,i[9]=n*o+c*e,i[10]=r*o+l*e,i[11]=a*o+m*e,i},mat4.rotateZ=function(t,e,i){var o=Math.sin(e),s=(e=Math.cos(e),t[0]),n=t[1],r=t[2],a=t[3],h=t[4],c=t[5],l=t[6],m=t[7];return i?t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[0]=s*e+h*o,i[1]=n*e+c*o,i[2]=r*e+l*o,i[3]=a*e+m*o,i[4]=s*-o+h*e,i[5]=n*-o+c*e,i[6]=r*-o+l*e,i[7]=a*-o+m*e,i},mat4.frustum=function(t,e,i,o,s,n,r){r||(r=mat4.create());var a=e-t,h=o-i,c=n-s;return r[0]=2*s/a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=2*s/h,r[6]=0,r[7]=0,r[8]=(e+t)/a,r[9]=(o+i)/h,r[10]=-(n+s)/c,r[11]=-1,r[12]=0,r[13]=0,r[14]=-n*s*2/c,r[15]=0,r},mat4.perspective=function(t,e,i,o,s){return e*=t=i*Math.tan(t*Math.PI/360),mat4.frustum(-e,e,-t,t,i,o,s)},mat4.ortho=function(t,e,i,o,s,n,r){r||(r=mat4.create());var a=e-t,h=o-i,c=n-s;return r[0]=2/a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=2/h,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=-2/c,r[11]=0,r[12]=-(t+e)/a,r[13]=-(o+i)/h,r[14]=-(n+s)/c,r[15]=1,r},mat4.lookAt=function(t,e,i,o){o||(o=mat4.create());var s,n,r,a,h,c,l,m,u=t[0],p=t[1];t=t[2];return n=i[0],r=i[1],s=i[2],i=e[1],c=e[2],u===e[0]&&p===i&&t===c?mat4.identity(o):(i=u-e[0],c=p-e[1],l=t-e[2],e=r*(l*=m=1/Math.sqrt(i*i+c*c+l*l))-s*(c*=m),s=s*(i*=m)-n*l,n=n*c-r*i,(m=Math.sqrt(e*e+s*s+n*n))?(e*=m=1/m,s*=m,n*=m):n=s=e=0,r=c*n-l*s,a=l*e-i*n,h=i*s-c*e,(m=Math.sqrt(r*r+a*a+h*h))?(r*=m=1/m,a*=m,h*=m):h=a=r=0,o[0]=e,o[1]=r,o[2]=i,o[3]=0,o[4]=s,o[5]=a,o[6]=c,o[7]=0,o[8]=n,o[9]=h,o[10]=l,o[11]=0,o[12]=-(e*u+s*p+n*t),o[13]=-(r*u+a*p+h*t),o[14]=-(i*u+c*p+l*t),o[15]=1,o)},mat4.fromRotationTranslation=function(t,e,i){i||(i=mat4.create());var o=t[0],s=t[1],n=t[2],r=t[3],a=o+o,h=s+s,c=n+n,l=(t=o*a,o*h);o*=c;var m=s*h;return s*=c,n*=c,a*=r,h*=r,r*=c,i[0]=1-(m+n),i[1]=l+r,i[2]=o-h,i[3]=0,i[4]=l-r,i[5]=1-(t+n),i[6]=s+a,i[7]=0,i[8]=o+h,i[9]=s-a,i[10]=1-(t+m),i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i},mat4.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+"]"},quat4.create=function(t){var e=new MatrixArray(4);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),e},quat4.set=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},quat4.calculateW=function(t,e){var i=t[0],o=t[1],s=t[2];return e&&t!==e?(e[0]=i,e[1]=o,e[2]=s,e[3]=-Math.sqrt(Math.abs(1-i*i-o*o-s*s)),e):(t[3]=-Math.sqrt(Math.abs(1-i*i-o*o-s*s)),t)},quat4.inverse=function(t,e){return e&&t!==e?(e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e):(t[0]*=-1,t[1]*=-1,t[2]*=-1,t)},quat4.length=function(t){var e=t[0],i=t[1],o=t[2];t=t[3];return Math.sqrt(e*e+i*i+o*o+t*t)},quat4.normalize=function(t,e){e||(e=t);var i=t[0],o=t[1],s=t[2],n=t[3],r=Math.sqrt(i*i+o*o+s*s+n*n);return 0===r?(e[0]=0,e[1]=0,e[2]=0,e[3]=0,e):(r=1/r,e[0]=i*r,e[1]=o*r,e[2]=s*r,e[3]=n*r,e)},quat4.multiply=function(t,e,i){i||(i=t);var o=t[0],s=t[1],n=t[2],r=(t=t[3],e[0]),a=e[1],h=e[2];e=e[3];return i[0]=o*e+t*r+s*h-n*a,i[1]=s*e+t*a+n*r-o*h,i[2]=n*e+t*h+o*a-s*r,i[3]=t*e-o*r-s*a-n*h,i},quat4.multiplyVec3=function(t,e,i){i||(i=e);var o=e[0],s=e[1],n=e[2],r=(e=t[0],t[1]),a=t[2],h=(t=t[3])*o+r*n-a*s,c=t*s+a*o-e*n,l=t*n+e*s-r*o;o=-e*o-r*s-a*n;return i[0]=h*t+o*-e+c*-a-l*-r,i[1]=c*t+o*-r+l*-e-h*-a,i[2]=l*t+o*-a+h*-r-c*-e,i},quat4.toMat3=function(t,e){e||(e=mat3.create());var i=t[0],o=t[1],s=t[2],n=t[3],r=i+i,a=o+o,h=s+s,c=i*r,l=i*a;i*=h;var m=o*a;return o*=h,s*=h,r*=n,a*=n,n*=h,e[0]=1-(m+s),e[1]=l+n,e[2]=i-a,e[3]=l-n,e[4]=1-(c+s),e[5]=o+r,e[6]=i+a,e[7]=o-r,e[8]=1-(c+m),e},quat4.toMat4=function(t,e){e||(e=mat4.create());var i=t[0],o=t[1],s=t[2],n=t[3],r=i+i,a=o+o,h=s+s,c=i*r,l=i*a;i*=h;var m=o*a;return o*=h,s*=h,r*=n,a*=n,n*=h,e[0]=1-(m+s),e[1]=l+n,e[2]=i-a,e[3]=0,e[4]=l-n,e[5]=1-(c+s),e[6]=o+r,e[7]=0,e[8]=i+a,e[9]=o-r,e[10]=1-(c+m),e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},quat4.slerp=function(t,e,i,o){o||(o=t);var s,n,r=t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3];return Math.abs(r)>=1?(o!==t&&(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3]),o):(s=Math.acos(r),n=Math.sqrt(1-r*r),Math.abs(n)<.001?(o[0]=.5*t[0]+.5*e[0],o[1]=.5*t[1]+.5*e[1],o[2]=.5*t[2]+.5*e[2],o[3]=.5*t[3]+.5*e[3],o):(r=Math.sin((1-i)*s)/n,i=Math.sin(i*s)/n,o[0]=t[0]*r+e[0]*i,o[1]=t[1]*r+e[1]*i,o[2]=t[2]*r+e[2]*i,o[3]=t[3]*r+e[3]*i,o))},quat4.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+"]"},function(){var t=mat4.create();function e(t,e,i){this.isIE=/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent),this.width=0,this.height=0,this.enableFrontToBack=!!i,this.isEarlyZPass=!1,this.isBatchInEarlyZPass=!1,this.currentZ=0,this.zNear=1,this.zFar=1e3,this.zIncrement=(this.zFar-this.zNear)/32768,this.zA=this.zFar/(this.zFar-this.zNear),this.zB=this.zFar*this.zNear/(this.zNear-this.zFar),this.kzA=65536*this.zA,this.kzB=65536*this.zB,this.cam=vec3.create([0,0,100]),this.look=vec3.create([0,0,0]),this.up=vec3.create([0,1,0]),this.worldScale=vec3.create([1,1,1]),this.enable_mipmaps=!0,this.matP=mat4.create(),this.matMV=mat4.create(),this.lastMV=mat4.create(),this.currentMV=mat4.create(),this.gl=t,this.version=0===this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2")?2:1,this.initState()}function i(t,e,i){this.gl=t,this.shaderProgram=e,this.name=i,this.locAPos=t.getAttribLocation(e,"aPos"),this.locATex=t.getAttribLocation(e,"aTex"),this.locMatP=t.getUniformLocation(e,"matP"),this.locMatMV=t.getUniformLocation(e,"matMV"),this.locOpacity=t.getUniformLocation(e,"opacity"),this.locColorFill=t.getUniformLocation(e,"colorFill"),this.locSamplerFront=t.getUniformLocation(e,"samplerFront"),this.locSamplerBack=t.getUniformLocation(e,"samplerBack"),this.locDestStart=t.getUniformLocation(e,"destStart"),this.locDestEnd=t.getUniformLocation(e,"destEnd"),this.locSeconds=t.getUniformLocation(e,"seconds"),this.locPixelWidth=t.getUniformLocation(e,"pixelWidth"),this.locPixelHeight=t.getUniformLocation(e,"pixelHeight"),this.locLayerScale=t.getUniformLocation(e,"layerScale"),this.locLayerAngle=t.getUniformLocation(e,"layerAngle"),this.locViewOrigin=t.getUniformLocation(e,"viewOrigin"),this.locScrollPos=t.getUniformLocation(e,"scrollPos"),this.hasAnyOptionalUniforms=!!(this.locPixelWidth||this.locPixelHeight||this.locSeconds||this.locSamplerBack||this.locDestStart||this.locDestEnd||this.locLayerScale||this.locLayerAngle||this.locViewOrigin||this.locScrollPos),this.lpPixelWidth=-999,this.lpPixelHeight=-999,this.lpOpacity=1,this.lpDestStartX=0,this.lpDestStartY=0,this.lpDestEndX=1,this.lpDestEndY=1,this.lpLayerScale=1,this.lpLayerAngle=0,this.lpViewOriginX=0,this.lpViewOriginY=0,this.lpScrollPosX=0,this.lpScrollPosY=0,this.lpSeconds=0,this.lastCustomParams=[],this.lpMatMV=mat4.create(),this.locOpacity&&t.uniform1f(this.locOpacity,1),this.locColorFill&&t.uniform4f(this.locColorFill,1,1,1,1),this.locSamplerFront&&t.uniform1i(this.locSamplerFront,0),this.locSamplerBack&&t.uniform1i(this.locSamplerBack,1),this.locDestStart&&t.uniform2f(this.locDestStart,0,0),this.locDestEnd&&t.uniform2f(this.locDestEnd,1,1),this.locLayerScale&&t.uniform1f(this.locLayerScale,1),this.locLayerAngle&&t.uniform1f(this.locLayerAngle,0),this.locViewOrigin&&t.uniform2f(this.locViewOrigin,0,0),this.locScrollPos&&t.uniform2f(this.locScrollPos,0,0),this.locSeconds&&t.uniform1f(this.locSeconds,0),this.hasCurrentMatMV=!1}function o(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function s(t,e){this.type=t,this.glwrap=e,this.gl=e.gl,this.opacityParam=0,this.startIndex=0,this.indexCount=0,this.texParam=null,this.mat4param=null,this.shaderParams=[],cr.seal(this)}e.prototype.initState=function(){var t,e=this.gl;for(this.lastOpacity=1,this.lastTexture0=null,this.lastTexture1=null,this.currentOpacity=1,e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),e.disable(e.CULL_FACE),e.disable(e.STENCIL_TEST),e.disable(e.DITHER),this.enableFrontToBack?(e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL)):e.disable(e.DEPTH_TEST),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.lastSrcBlend=e.ONE,this.lastDestBlend=e.ONE_MINUS_SRC_ALPHA,this.vertexData=new Float32Array(8e3*(this.enableFrontToBack?3:2)),this.texcoordData=new Float32Array(16e3),this.pointData=new Float32Array(32e3),this.pointBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.pointBuffer),e.bufferData(e.ARRAY_BUFFER,this.pointData.byteLength,e.DYNAMIC_DRAW),this.vertexBuffers=new Array(4),this.texcoordBuffers=new Array(4),t=0;t<4;t++)this.vertexBuffers[t]=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffers[t]),e.bufferData(e.ARRAY_BUFFER,this.vertexData.byteLength,e.DYNAMIC_DRAW),this.texcoordBuffers[t]=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.texcoordBuffers[t]),e.bufferData(e.ARRAY_BUFFER,this.texcoordData.byteLength,e.DYNAMIC_DRAW);this.curBuffer=0,this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var i=new Uint16Array(12e3);t=0;for(var o,s,n=0;t<12e3;)i[t++]=n,i[t++]=n+1,i[t++]=n+2,i[t++]=n,i[t++]=n+2,i[t++]=n+3,n+=4;e.bufferData(e.ELEMENT_ARRAY_BUFFER,i,e.STATIC_DRAW),this.vertexPtr=0,this.texPtr=0,this.pointPtr=0,this.shaderPrograms=[],o=["varying mediump vec2 vTex;","uniform lowp float opacity;","uniform lowp sampler2D samplerFront;","void main(void) {","\tgl_FragColor = texture2D(samplerFront, vTex);","\tgl_FragColor *= opacity;","}"].join("\n"),s=this.enableFrontToBack?["attribute highp vec3 aPos;","attribute mediump vec2 aTex;","varying mediump vec2 vTex;","uniform highp mat4 matP;","uniform highp mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, aPos.z, 1.0);","\tvTex = aTex;","}"].join("\n"):["attribute highp vec2 aPos;","attribute mediump vec2 aTex;","varying mediump vec2 vTex;","uniform highp mat4 matP;","uniform highp mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);","\tvTex = aTex;","}"].join("\n");var r=this.createShaderProgram({src:o},s,"<default>");this.shaderPrograms.push(r),o=["uniform mediump sampler2D samplerFront;","varying lowp float opacity;","void main(void) {","\tgl_FragColor = texture2D(samplerFront, gl_PointCoord);","\tgl_FragColor *= opacity;","}"].join("\n");var a=["attribute vec4 aPos;","varying float opacity;","uniform mat4 matP;","uniform mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);","\tgl_PointSize = aPos.z;","\topacity = aPos.w;","}"].join("\n");r=this.createShaderProgram({src:o},a,"<point>"),this.shaderPrograms.push(r),o=["varying mediump vec2 vTex;","uniform lowp sampler2D samplerFront;","void main(void) {","\tif (texture2D(samplerFront, vTex).a < 1.0)","\t\tdiscard;","}"].join("\n");r=this.createShaderProgram({src:o},s,"<earlyz>");this.shaderPrograms.push(r),o=["uniform lowp vec4 colorFill;","void main(void) {","\tgl_FragColor = colorFill;","}"].join("\n");r=this.createShaderProgram({src:o},s,"<fill>");for(var h in this.shaderPrograms.push(r),cr.shaders)cr.shaders.hasOwnProperty(h)&&this.shaderPrograms.push(this.createShaderProgram(cr.shaders[h],s,h));e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,null),this.batch=[],this.batchPtr=0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1,this.lastProgram=-1,this.currentProgram=-1,this.currentShader=null,this.fbo=e.createFramebuffer(),this.renderToTex=null,this.depthBuffer=null,this.attachedDepthBuffer=!1,this.enableFrontToBack&&(this.depthBuffer=e.createRenderbuffer()),this.tmpVec3=vec3.create([0,0,0]);var c=e.getParameter(e.ALIASED_POINT_SIZE_RANGE);this.minPointSize=c[0],this.maxPointSize=c[1],this.maxPointSize>2048&&(this.maxPointSize=2048),this.switchProgram(0),cr.seal(this)},i.prototype.updateMatMV=function(t){o(this.lpMatMV,t)||(mat4.set(t,this.lpMatMV),this.gl.uniformMatrix4fv(this.locMatMV,!1,t))},e.prototype.createShaderProgram=function(t,e,o){var s=this.gl,n=s.createShader(s.FRAGMENT_SHADER);if(s.shaderSource(n,t.src),s.compileShader(n),!s.getShaderParameter(n,s.COMPILE_STATUS)){var r=s.getShaderInfoLog(n);throw s.deleteShader(n),new Error("error compiling fragment shader: "+r)}var a=s.createShader(s.VERTEX_SHADER);if(s.shaderSource(a,e),s.compileShader(a),!s.getShaderParameter(a,s.COMPILE_STATUS)){r=s.getShaderInfoLog(a);throw s.deleteShader(n),s.deleteShader(a),new Error("error compiling vertex shader: "+r)}var h=s.createProgram();if(s.attachShader(h,n),s.attachShader(h,a),s.linkProgram(h),!s.getProgramParameter(h,s.LINK_STATUS)){r=s.getProgramInfoLog(h);throw s.deleteShader(n),s.deleteShader(a),s.deleteProgram(h),new Error("error linking shader program: "+r)}s.useProgram(h),s.deleteShader(n),s.deleteShader(a);var c,l,m=new i(s,h,o);for(m.extendBoxHorizontal=t.extendBoxHorizontal||0,m.extendBoxVertical=t.extendBoxVertical||0,m.crossSampling=!!t.crossSampling,m.preservesOpaqueness=!!t.preservesOpaqueness,m.animated=!!t.animated,m.parameters=t.parameters||[],c=0,l=m.parameters.length;c<l;c++)m.parameters[c][1]=s.getUniformLocation(h,m.parameters[c][0]),m.lastCustomParams.push(0),s.uniform1f(m.parameters[c][1],0);return cr.seal(m),m},e.prototype.getShaderIndex=function(t){var e,i;for(e=0,i=this.shaderPrograms.length;e<i;e++)if(this.shaderPrograms[e].name===t)return e;return-1},e.prototype.project=function(t,e,i){var o=this.matMV,s=this.matP,n=[0,0,0,0,0,0,0,0];n[0]=o[0]*t+o[4]*e+o[12],n[1]=o[1]*t+o[5]*e+o[13],n[2]=o[2]*t+o[6]*e+o[14],n[3]=o[3]*t+o[7]*e+o[15],n[4]=s[0]*n[0]+s[4]*n[1]+s[8]*n[2]+s[12]*n[3],n[5]=s[1]*n[0]+s[5]*n[1]+s[9]*n[2]+s[13]*n[3],n[6]=s[2]*n[0]+s[6]*n[1]+s[10]*n[2]+s[14]*n[3],n[7]=-n[2],0!==n[7]&&(n[7]=1/n[7],n[4]*=n[7],n[5]*=n[7],n[6]*=n[7],i[0]=(.5*n[4]+.5)*this.width,i[1]=(.5*n[5]+.5)*this.height)},e.prototype.setSize=function(t,e,i){if(this.width!==t||this.height!==e||i){this.endBatch();var o,s,n,r=this.gl;if(this.width=t,this.height=e,r.viewport(0,0,t,e),mat4.lookAt(this.cam,this.look,this.up,this.matMV),this.enableFrontToBack)mat4.ortho(-t/2,t/2,e/2,-e/2,this.zNear,this.zFar,this.matP),this.worldScale[0]=1,this.worldScale[1]=1;else{mat4.perspective(45,t/e,this.zNear,this.zFar,this.matP);var a=[0,0],h=[0,0];this.project(0,0,a),this.project(1,1,h),this.worldScale[0]=1/(h[0]-a[0]),this.worldScale[1]=-1/(h[1]-a[1])}for(o=0,s=this.shaderPrograms.length;o<s;o++)(n=this.shaderPrograms[o]).hasCurrentMatMV=!1,n.locMatP&&(r.useProgram(n.shaderProgram),r.uniformMatrix4fv(n.locMatP,!1,this.matP));r.useProgram(this.shaderPrograms[this.lastProgram].shaderProgram),r.bindTexture(r.TEXTURE_2D,null),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,null),r.activeTexture(r.TEXTURE0),this.lastTexture0=null,this.lastTexture1=null,this.depthBuffer&&(r.bindFramebuffer(r.FRAMEBUFFER,this.fbo),r.bindRenderbuffer(r.RENDERBUFFER,this.depthBuffer),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,this.width,this.height),this.attachedDepthBuffer||(r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,this.depthBuffer),this.attachedDepthBuffer=!0),r.bindRenderbuffer(r.RENDERBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,null),this.renderToTex=null)}},e.prototype.resetModelView=function(){mat4.lookAt(this.cam,this.look,this.up,this.matMV),mat4.scale(this.matMV,this.worldScale)},e.prototype.translate=function(t,e){0===t&&0===e||(this.tmpVec3[0]=t,this.tmpVec3[1]=e,this.tmpVec3[2]=0,mat4.translate(this.matMV,this.tmpVec3))},e.prototype.scale=function(t,e){1===t&&1===e||(this.tmpVec3[0]=t,this.tmpVec3[1]=e,this.tmpVec3[2]=1,mat4.scale(this.matMV,this.tmpVec3))},e.prototype.rotateZ=function(t){0!==t&&mat4.rotateZ(this.matMV,t)},e.prototype.updateModelView=function(){if(!o(this.lastMV,this.matMV)){var t=this.pushBatch();t.type=5,t.mat4param?mat4.set(this.matMV,t.mat4param):t.mat4param=mat4.create(this.matMV),mat4.set(this.matMV,this.lastMV),this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},e.prototype.setEarlyZIndex=function(t){this.enableFrontToBack&&(t>32760&&(t=32760),this.currentZ=this.cam[2]-this.zNear-t*this.zIncrement)},s.prototype.doSetEarlyZPass=function(){var t=this.gl,e=this.glwrap;0!==this.startIndex?(t.depthMask(!0),t.colorMask(!1,!1,!1,!1),t.disable(t.BLEND),t.bindFramebuffer(t.FRAMEBUFFER,e.fbo),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0),t.clear(t.DEPTH_BUFFER_BIT),t.bindFramebuffer(t.FRAMEBUFFER,null),e.isBatchInEarlyZPass=!0):(t.depthMask(!1),t.colorMask(!0,!0,!0,!0),t.enable(t.BLEND),e.isBatchInEarlyZPass=!1)},s.prototype.doSetTexture=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texParam)},s.prototype.doSetTexture1=function(){var t=this.gl;t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this.texParam),t.activeTexture(t.TEXTURE0)},s.prototype.doSetOpacity=function(){var t=this.opacityParam,e=this.glwrap;e.currentOpacity=t;var i=e.currentShader;i.locOpacity&&i.lpOpacity!==t&&(i.lpOpacity=t,this.gl.uniform1f(i.locOpacity,t))},s.prototype.doQuad=function(){this.gl.drawElements(this.gl.TRIANGLES,this.indexCount,this.gl.UNSIGNED_SHORT,this.startIndex)},s.prototype.doSetBlend=function(){this.gl.blendFunc(this.startIndex,this.indexCount)},s.prototype.doUpdateModelView=function(){var t,e,i,o=this.glwrap.shaderPrograms,s=this.glwrap.currentProgram;for(t=0,e=o.length;t<e;t++)i=o[t],t===s&&i.locMatMV?(i.updateMatMV(this.mat4param),i.hasCurrentMatMV=!0):i.hasCurrentMatMV=!1;mat4.set(this.mat4param,this.glwrap.currentMV)},s.prototype.doRenderToTexture=function(){var t=this.gl,e=this.glwrap;this.texParam?(e.lastTexture1===this.texParam&&(t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,null),e.lastTexture1=null,t.activeTexture(t.TEXTURE0)),t.bindFramebuffer(t.FRAMEBUFFER,e.fbo),e.isBatchInEarlyZPass||t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texParam,0)):(e.enableFrontToBack||t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0),t.bindFramebuffer(t.FRAMEBUFFER,null))},s.prototype.doClear=function(){var t=this.gl,e=this.startIndex;0===e?(t.clearColor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),t.clear(t.COLOR_BUFFER_BIT)):1===e?(t.enable(t.SCISSOR_TEST),t.scissor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.disable(t.SCISSOR_TEST)):t.clear(t.DEPTH_BUFFER_BIT)},s.prototype.doSetDepthTestEnabled=function(){var t=this.gl;0!==this.startIndex?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST)},s.prototype.doPoints=function(){var t=this.gl,e=this.glwrap;e.enableFrontToBack&&t.disable(t.DEPTH_TEST);var i=e.shaderPrograms[1];t.useProgram(i.shaderProgram),!i.hasCurrentMatMV&&i.locMatMV&&(i.updateMatMV(e.currentMV),i.hasCurrentMatMV=!0),t.enableVertexAttribArray(i.locAPos),t.bindBuffer(t.ARRAY_BUFFER,e.pointBuffer),t.vertexAttribPointer(i.locAPos,4,t.FLOAT,!1,0,0),t.drawArrays(t.POINTS,this.startIndex/4,this.indexCount),i=e.currentShader,t.useProgram(i.shaderProgram),i.locAPos>=0&&(t.enableVertexAttribArray(i.locAPos),t.bindBuffer(t.ARRAY_BUFFER,e.vertexBuffers[e.curBuffer]),t.vertexAttribPointer(i.locAPos,e.enableFrontToBack?3:2,t.FLOAT,!1,0,0)),i.locATex>=0&&(t.enableVertexAttribArray(i.locATex),t.bindBuffer(t.ARRAY_BUFFER,e.texcoordBuffers[e.curBuffer]),t.vertexAttribPointer(i.locATex,2,t.FLOAT,!1,0,0)),e.enableFrontToBack&&t.enable(t.DEPTH_TEST)},s.prototype.doSetProgram=function(){var t=this.gl,e=this.glwrap,i=e.shaderPrograms[this.startIndex];e.currentProgram=this.startIndex,e.currentShader=i,t.useProgram(i.shaderProgram),!i.hasCurrentMatMV&&i.locMatMV&&(i.updateMatMV(e.currentMV),i.hasCurrentMatMV=!0),i.locOpacity&&i.lpOpacity!==e.currentOpacity&&(i.lpOpacity=e.currentOpacity,t.uniform1f(i.locOpacity,e.currentOpacity)),i.locAPos>=0&&(t.enableVertexAttribArray(i.locAPos),t.bindBuffer(t.ARRAY_BUFFER,e.vertexBuffers[e.curBuffer]),t.vertexAttribPointer(i.locAPos,e.enableFrontToBack?3:2,t.FLOAT,!1,0,0)),i.locATex>=0&&(t.enableVertexAttribArray(i.locATex),t.bindBuffer(t.ARRAY_BUFFER,e.texcoordBuffers[e.curBuffer]),t.vertexAttribPointer(i.locATex,2,t.FLOAT,!1,0,0))},s.prototype.doSetColor=function(){var t=this.glwrap.currentShader,e=this.mat4param;this.gl.uniform4f(t.locColorFill,e[0],e[1],e[2],e[3])},s.prototype.doSetProgramParameters=function(){var t,e,i=this.glwrap.currentShader,o=this.gl,s=this.mat4param;i.locSamplerBack&&this.glwrap.lastTexture1!==this.texParam&&(o.activeTexture(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,this.texParam),this.glwrap.lastTexture1=this.texParam,o.activeTexture(o.TEXTURE0));var n,r=s[0];if(i.locPixelWidth&&r!==i.lpPixelWidth&&(i.lpPixelWidth=r,o.uniform1f(i.locPixelWidth,r)),r=s[1],i.locPixelHeight&&r!==i.lpPixelHeight&&(i.lpPixelHeight=r,o.uniform1f(i.locPixelHeight,r)),r=s[2],n=s[3],!i.locDestStart||r===i.lpDestStartX&&n===i.lpDestStartY||(i.lpDestStartX=r,i.lpDestStartY=n,o.uniform2f(i.locDestStart,r,n)),r=s[4],n=s[5],!i.locDestEnd||r===i.lpDestEndX&&n===i.lpDestEndY||(i.lpDestEndX=r,i.lpDestEndY=n,o.uniform2f(i.locDestEnd,r,n)),r=s[6],i.locLayerScale&&r!==i.lpLayerScale&&(i.lpLayerScale=r,o.uniform1f(i.locLayerScale,r)),r=s[7],i.locLayerAngle&&r!==i.lpLayerAngle&&(i.lpLayerAngle=r,o.uniform1f(i.locLayerAngle,r)),r=s[8],n=s[9],!i.locViewOrigin||r===i.lpViewOriginX&&n===i.lpViewOriginY||(i.lpViewOriginX=r,i.lpViewOriginY=n,o.uniform2f(i.locViewOrigin,r,n)),r=s[10],n=s[11],!i.locScrollPos||r===i.lpScrollPosX&&n===i.lpScrollPosY||(i.lpScrollPosX=r,i.lpScrollPosY=n,o.uniform2f(i.locScrollPos,r,n)),r=s[12],i.locSeconds&&r!==i.lpSeconds&&(i.lpSeconds=r,o.uniform1f(i.locSeconds,r)),i.parameters.length)for(t=0,e=i.parameters.length;t<e;t++)(r=this.shaderParams[t])!==i.lastCustomParams[t]&&(i.lastCustomParams[t]=r,o.uniform1f(i.parameters[t][1],r))},e.prototype.pushBatch=function(){return this.batchPtr===this.batch.length&&this.batch.push(new s(0,this)),this.batch[this.batchPtr++]},e.prototype.endBatch=function(){if(0!==this.batchPtr&&!this.gl.isContextLost()){var t,e,i,o=this.gl;if(this.pointPtr>0&&(o.bindBuffer(o.ARRAY_BUFFER,this.pointBuffer),o.bufferSubData(o.ARRAY_BUFFER,0,this.pointData.subarray(0,this.pointPtr)),s&&s.locAPos>=0&&"<point>"===s.name&&o.vertexAttribPointer(s.locAPos,4,o.FLOAT,!1,0,0)),this.vertexPtr>0){var s=this.currentShader;o.bindBuffer(o.ARRAY_BUFFER,this.vertexBuffers[this.curBuffer]),o.bufferSubData(o.ARRAY_BUFFER,0,this.vertexData.subarray(0,this.vertexPtr)),s&&s.locAPos>=0&&"<point>"!==s.name&&o.vertexAttribPointer(s.locAPos,this.enableFrontToBack?3:2,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this.texcoordBuffers[this.curBuffer]),o.bufferSubData(o.ARRAY_BUFFER,0,this.texcoordData.subarray(0,this.texPtr)),s&&s.locATex>=0&&"<point>"!==s.name&&o.vertexAttribPointer(s.locATex,2,o.FLOAT,!1,0,0)}for(t=0,e=this.batchPtr;t<e;t++)switch((i=this.batch[t]).type){case 1:i.doQuad();break;case 2:i.doSetTexture();break;case 3:i.doSetOpacity();break;case 4:i.doSetBlend();break;case 5:i.doUpdateModelView();break;case 6:i.doRenderToTexture();break;case 7:i.doClear();break;case 8:i.doPoints();break;case 9:i.doSetProgram();break;case 10:i.doSetProgramParameters();break;case 11:i.doSetTexture1();break;case 12:i.doSetColor();break;case 13:i.doSetDepthTestEnabled();break;case 14:i.doSetEarlyZPass()}this.batchPtr=0,this.vertexPtr=0,this.texPtr=0,this.pointPtr=0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1,this.isBatchInEarlyZPass=!1,this.curBuffer++,this.curBuffer>=4&&(this.curBuffer=0)}},e.prototype.setOpacity=function(t){if(t!==this.lastOpacity&&!this.isEarlyZPass){var e=this.pushBatch();e.type=3,e.opacityParam=t,this.lastOpacity=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},e.prototype.setTexture=function(t){if(t!==this.lastTexture0){var e=this.pushBatch();e.type=2,e.texParam=t,this.lastTexture0=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},e.prototype.setBlend=function(t,e){if((t!==this.lastSrcBlend||e!==this.lastDestBlend)&&!this.isEarlyZPass){var i=this.pushBatch();i.type=4,i.startIndex=t,i.indexCount=e,this.lastSrcBlend=t,this.lastDestBlend=e,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},e.prototype.isPremultipliedAlphaBlend=function(){return this.lastSrcBlend===this.gl.ONE&&this.lastDestBlend===this.gl.ONE_MINUS_SRC_ALPHA},e.prototype.setAlphaBlend=function(){this.setBlend(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA)},e.prototype.setNoPremultiplyAlphaBlend=function(){this.setBlend(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)};e.prototype.quad=function(t,e,i,o,s,n,r,a){this.vertexPtr>=15992&&this.endBatch();var h=this.vertexPtr,c=this.texPtr,l=this.vertexData,m=this.texcoordData,u=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var p=this.pushBatch();p.type=1,p.startIndex=this.enableFrontToBack?h:h/2*3,p.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1}this.enableFrontToBack?(l[h++]=t,l[h++]=e,l[h++]=u,l[h++]=i,l[h++]=o,l[h++]=u,l[h++]=s,l[h++]=n,l[h++]=u,l[h++]=r,l[h++]=a,l[h++]=u):(l[h++]=t,l[h++]=e,l[h++]=i,l[h++]=o,l[h++]=s,l[h++]=n,l[h++]=r,l[h++]=a),m[c++]=0,m[c++]=0,m[c++]=1,m[c++]=0,m[c++]=1,m[c++]=1,m[c++]=0,m[c++]=1,this.vertexPtr=h,this.texPtr=c},e.prototype.quadTex=function(t,e,i,o,s,n,r,a,h){this.vertexPtr>=15992&&this.endBatch();var c=this.vertexPtr,l=this.texPtr,m=this.vertexData,u=this.texcoordData,p=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var d=this.pushBatch();d.type=1,d.startIndex=this.enableFrontToBack?c:c/2*3,d.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1}var y=h.left,_=h.top,f=h.right,x=h.bottom;this.enableFrontToBack?(m[c++]=t,m[c++]=e,m[c++]=p,m[c++]=i,m[c++]=o,m[c++]=p,m[c++]=s,m[c++]=n,m[c++]=p,m[c++]=r,m[c++]=a,m[c++]=p):(m[c++]=t,m[c++]=e,m[c++]=i,m[c++]=o,m[c++]=s,m[c++]=n,m[c++]=r,m[c++]=a),u[l++]=y,u[l++]=_,u[l++]=f,u[l++]=_,u[l++]=f,u[l++]=x,u[l++]=y,u[l++]=x,this.vertexPtr=c,this.texPtr=l},e.prototype.quadTexUV=function(t,e,i,o,s,n,r,a,h,c,l,m,u,p,d,y){this.vertexPtr>=15992&&this.endBatch();var _=this.vertexPtr,f=this.texPtr,x=this.vertexData,g=this.texcoordData,b=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var v=this.pushBatch();v.type=1,v.startIndex=this.enableFrontToBack?_:_/2*3,v.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1}this.enableFrontToBack?(x[_++]=t,x[_++]=e,x[_++]=b,x[_++]=i,x[_++]=o,x[_++]=b,x[_++]=s,x[_++]=n,x[_++]=b,x[_++]=r,x[_++]=a,x[_++]=b):(x[_++]=t,x[_++]=e,x[_++]=i,x[_++]=o,x[_++]=s,x[_++]=n,x[_++]=r,x[_++]=a),g[f++]=h,g[f++]=c,g[f++]=l,g[f++]=m,g[f++]=u,g[f++]=p,g[f++]=d,g[f++]=y,this.vertexPtr=_,this.texPtr=f},e.prototype.convexPoly=function(t){var e,i,o,s,n,r,a,h,c=t.length/2-2,l=c-1,m=t[0],u=t[1];for(e=0;e<c;e+=2)o=t[(i=2*e)+2],s=t[i+3],n=t[i+4],r=t[i+5],e===l?this.quad(m,u,o,s,n,r,n,r):(a=t[i+6],h=t[i+7],this.quad(m,u,o,s,n,r,a,h))};e.prototype.point=function(t,e,i,o){this.pointPtr>=7996&&this.endBatch();var s=this.pointPtr,n=this.pointData;if(this.hasPointBatchTop)this.batch[this.batchPtr-1].indexCount++;else{var r=this.pushBatch();r.type=8,r.startIndex=s,r.indexCount=1,this.hasPointBatchTop=!0,this.hasQuadBatchTop=!1}n[s++]=t,n[s++]=e,n[s++]=i,n[s++]=o,this.pointPtr=s},e.prototype.switchProgram=function(t){if(this.lastProgram!==t){var e=this.shaderPrograms[t];if(!e){if(0===this.lastProgram)return;t=0,e=this.shaderPrograms[0]}var i=this.pushBatch();i.type=9,i.startIndex=t,this.lastProgram=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},e.prototype.programUsesDest=function(t){var e=this.shaderPrograms[t];return!(!e.locDestStart&&!e.locDestEnd)},e.prototype.programUsesCrossSampling=function(t){var e=this.shaderPrograms[t];return!!(e.locDestStart||e.locDestEnd||e.crossSampling)},e.prototype.programPreservesOpaqueness=function(t){return this.shaderPrograms[t].preservesOpaqueness},e.prototype.programExtendsBox=function(t){var e=this.shaderPrograms[t];return 0!==e.extendBoxHorizontal||0!==e.extendBoxVertical},e.prototype.getProgramBoxExtendHorizontal=function(t){return this.shaderPrograms[t].extendBoxHorizontal},e.prototype.getProgramBoxExtendVertical=function(t){return this.shaderPrograms[t].extendBoxVertical},e.prototype.getProgramParameterType=function(t,e){return this.shaderPrograms[t].parameters[e][2]},e.prototype.programIsAnimated=function(t){return this.shaderPrograms[t].animated},e.prototype.setProgramParameters=function(t,e,i,o,s,n,r,a,h,c,l,m,u,p,d){var y,_,f,x,g,b=this.shaderPrograms[this.lastProgram];if(b.hasAnyOptionalUniforms||d.length){if((f=this.pushBatch()).type=10,f.mat4param?mat4.set(this.matMV,f.mat4param):f.mat4param=mat4.create(),(x=f.mat4param)[0]=e,x[1]=i,x[2]=o,x[3]=s,x[4]=n,x[5]=r,x[6]=a,x[7]=h,x[8]=c,x[9]=l,x[10]=m,x[11]=u,x[12]=p,b.locSamplerBack?f.texParam=t:f.texParam=null,d.length)for((g=f.shaderParams).length=d.length,y=0,_=d.length;y<_;y++)g[y]=d[y];this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},e.prototype.clear=function(t,e,i,o){var s=this.pushBatch();s.type=7,s.startIndex=0,s.mat4param||(s.mat4param=mat4.create()),s.mat4param[0]=t,s.mat4param[1]=e,s.mat4param[2]=i,s.mat4param[3]=o,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1},e.prototype.clearRect=function(t,e,i,o){if(!(i<0||o<0)){var s=this.pushBatch();s.type=7,s.startIndex=1,s.mat4param||(s.mat4param=mat4.create()),s.mat4param[0]=t,s.mat4param[1]=e,s.mat4param[2]=i,s.mat4param[3]=o,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},e.prototype.clearDepth=function(){var t=this.pushBatch();t.type=7,t.startIndex=2,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1},e.prototype.setEarlyZPass=function(t){if(this.enableFrontToBack&&(t=!!t,this.isEarlyZPass!==t)){var e=this.pushBatch();e.type=14,e.startIndex=t?1:0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1,this.isEarlyZPass=t,this.renderToTex=null,this.isEarlyZPass?this.switchProgram(2):this.switchProgram(0)}},e.prototype.setDepthTestEnabled=function(t){if(this.enableFrontToBack){var e=this.pushBatch();e.type=13,e.startIndex=t?1:0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},e.prototype.fullscreenQuad=function(){mat4.set(this.lastMV,t),this.resetModelView(),this.updateModelView();var e=this.width/2,i=this.height/2;this.quad(-e,i,e,i,e,-i,-e,-i),mat4.set(t,this.matMV),this.updateModelView()},e.prototype.setColorFillMode=function(t,e,i,o){this.switchProgram(3);var s=this.pushBatch();s.type=12,s.mat4param||(s.mat4param=mat4.create()),s.mat4param[0]=t,s.mat4param[1]=e,s.mat4param[2]=i,s.mat4param[3]=o,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1},e.prototype.setTextureFillMode=function(){this.switchProgram(0)},e.prototype.restoreEarlyZMode=function(){this.switchProgram(2)},e.prototype.present=function(){this.endBatch(),this.gl.flush()};var n=[],r={};e.prototype.contextLost=function(){cr.clearArray(n),r={}};e.prototype.loadTexture=function(t,e,i,o,s,a){e=!!e,i=!!i;var h=t.src+","+e+","+i+(e?","+s:""),c=null;if(void 0!==t.src&&r.hasOwnProperty(h))return(c=r[h]).c2refcount++,c;this.endBatch();var l=this.gl,m=cr.isPOT(t.width)&&cr.isPOT(t.height);c=l.createTexture(),l.bindTexture(l.TEXTURE_2D,c),l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);var u=l.RGBA,p=l.RGBA,d=l.UNSIGNED_BYTE;if(o&&!this.isIE)switch(o){case 1:u=l.RGB,p=l.RGB;break;case 2:d=l.UNSIGNED_SHORT_4_4_4_4;break;case 3:d=l.UNSIGNED_SHORT_5_5_5_1;break;case 4:u=l.RGB,p=l.RGB,d=l.UNSIGNED_SHORT_5_6_5}if(1===this.version&&!m&&e){var y=document.createElement("canvas");y.width=cr.nextHighestPowerOfTwo(t.width),y.height=cr.nextHighestPowerOfTwo(t.height);var _=y.getContext("2d");void 0!==_.imageSmoothingEnabled?_.imageSmoothingEnabled=i:(_.webkitImageSmoothingEnabled=i,_.mozImageSmoothingEnabled=i,_.msImageSmoothingEnabled=i),_.drawImage(t,0,0,t.width,t.height,0,0,y.width,y.height),l.texImage2D(l.TEXTURE_2D,0,u,p,d,y)}else l.texImage2D(l.TEXTURE_2D,0,u,p,d,t);return e?"repeat-x"===s?(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE)):"repeat-y"===s?(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.REPEAT)):(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.REPEAT)):(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE)),i?(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.LINEAR),(m||this.version>=2)&&this.enable_mipmaps&&!a?(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR_MIPMAP_LINEAR),l.generateMipmap(l.TEXTURE_2D)):l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR)):(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST)),l.bindTexture(l.TEXTURE_2D,null),this.lastTexture0=null,c.c2width=t.width,c.c2height=t.height,c.c2refcount=1,c.c2texkey=h,n.push(c),r[h]=c,c},e.prototype.createEmptyTexture=function(t,e,i,o,s){this.endBatch();var r=this.gl;this.isIE&&(o=!1);var a=r.createTexture();return r.bindTexture(r.TEXTURE_2D,a),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t,e,0,r.RGBA,o?r.UNSIGNED_SHORT_4_4_4_4:r.UNSIGNED_BYTE,null),s?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT)):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,i?r.LINEAR:r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,i?r.LINEAR:r.NEAREST),r.bindTexture(r.TEXTURE_2D,null),this.lastTexture0=null,a.c2width=t,a.c2height=e,n.push(a),a},e.prototype.videoToTexture=function(t,e,i){this.endBatch();var o=this.gl;this.isIE&&(i=!1),o.bindTexture(o.TEXTURE_2D,e),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);try{o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,i?o.UNSIGNED_SHORT_4_4_4_4:o.UNSIGNED_BYTE,t)}catch(t){console&&console.error&&console.error("Error updating WebGL texture: ",t)}o.bindTexture(o.TEXTURE_2D,null),this.lastTexture0=null},e.prototype.deleteTexture=function(t){t&&(void 0!==t.c2refcount&&t.c2refcount>1?t.c2refcount--:(this.endBatch(),t===this.lastTexture0&&(this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.lastTexture0=null),t===this.lastTexture1&&(this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.activeTexture(this.gl.TEXTURE0),this.lastTexture1=null),cr.arrayFindRemove(n,t),void 0!==t.c2texkey&&delete r[t.c2texkey],this.gl.deleteTexture(t)))},e.prototype.estimateVRAM=function(){var t,e,i,o=this.width*this.height*4*2;for(t=0,e=n.length;t<e;t++)o+=(i=n[t]).c2width*i.c2height*4;return o},e.prototype.textureCount=function(){return n.length},e.prototype.setRenderingToTexture=function(t){if(t!==this.renderToTex){var e=this.pushBatch();e.type=6,e.texParam=t,this.renderToTex=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},cr.GLWrap=e}(),function(){var t=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame;function e(t){if(t&&(t.getContext||t.dc)&&!t.c2runtime){t.c2runtime=this;var e=this;this.isCrosswalk=/crosswalk/i.test(navigator.userAgent)||/xwalk/i.test(navigator.userAgent)||!(void 0===window.c2isCrosswalk||!window.c2isCrosswalk),this.isCordova=this.isCrosswalk||void 0!==window.device&&(void 0!==window.device.cordova||void 0!==window.device.phonegap)||void 0!==window.c2iscordova&&window.c2iscordova,this.isPhoneGap=this.isCordova,this.isDirectCanvas=!!t.dc,this.isAppMobi=void 0!==window.AppMobi||this.isDirectCanvas,this.isCocoonJs=!!window.c2cocoonjs,this.isEjecta=!!window.c2ejecta,this.isCocoonJs&&(CocoonJS.App.onSuspended.addEventListener(function(){e.setSuspended(!0)}),CocoonJS.App.onActivated.addEventListener(function(){e.setSuspended(!1)})),this.isEjecta&&(document.addEventListener("pagehide",function(){e.setSuspended(!0)}),document.addEventListener("pageshow",function(){e.setSuspended(!1)}),document.addEventListener("resize",function(){e.setSize(window.innerWidth,window.innerHeight)})),this.isDomFree=this.isDirectCanvas||this.isCocoonJs||this.isEjecta,this.isMicrosoftEdge=/edge\//i.test(navigator.userAgent),this.isIE=(/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent)||/iemobile/i.test(navigator.userAgent))&&!this.isMicrosoftEdge,this.isTizen=/tizen/i.test(navigator.userAgent),this.isAndroid=/android/i.test(navigator.userAgent)&&!this.isTizen&&!this.isIE&&!this.isMicrosoftEdge,this.isiPhone=(/iphone/i.test(navigator.userAgent)||/ipod/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge,this.isiPad=/ipad/i.test(navigator.userAgent),this.isiOS=this.isiPhone||this.isiPad||this.isEjecta,this.isiPhoneiOS6=this.isiPhone&&/os\s6/i.test(navigator.userAgent),this.isChrome=(/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge,this.isAmazonWebApp=/amazonwebappplatform/i.test(navigator.userAgent),this.isFirefox=/firefox/i.test(navigator.userAgent),this.isSafari=/safari/i.test(navigator.userAgent)&&!this.isChrome&&!this.isIE&&!this.isMicrosoftEdge,this.isWindows=/windows/i.test(navigator.userAgent),this.isNWjs=void 0!==window.c2nodewebkit||void 0!==window.c2nwjs||/nodewebkit/i.test(navigator.userAgent)||/nwjs/i.test(navigator.userAgent),this.isNodeWebkit=this.isNWjs,this.isArcade=void 0!==window.is_scirra_arcade,this.isWindows8App=!(void 0===window.c2isWindows8||!window.c2isWindows8),this.isWindows8Capable=!(void 0===window.c2isWindows8Capable||!window.c2isWindows8Capable),this.isWindowsPhone8=!(void 0===window.c2isWindowsPhone8||!window.c2isWindowsPhone8),this.isWindowsPhone81=!(void 0===window.c2isWindowsPhone81||!window.c2isWindowsPhone81),this.isWindows10=!!window.cr_windows10,this.isWinJS=this.isWindows8App||this.isWindows8Capable||this.isWindowsPhone81||this.isWindows10,this.isBlackberry10=!(void 0===window.c2isBlackberry10||!window.c2isBlackberry10),this.isAndroidStockBrowser=this.isAndroid&&!this.isChrome&&!this.isCrosswalk&&!this.isFirefox&&!this.isAmazonWebApp&&!this.isDomFree,this.devicePixelRatio=1,this.isMobile=this.isCordova||this.isCrosswalk||this.isAppMobi||this.isCocoonJs||this.isAndroid||this.isiOS||this.isWindowsPhone8||this.isWindowsPhone81||this.isBlackberry10||this.isTizen||this.isEjecta,this.isMobile||(this.isMobile=/(blackberry|bb10|playbook|palm|symbian|nokia|windows\s+ce|phone|mobile|tablet|kindle|silk)/i.test(navigator.userAgent)),this.isWKWebView=!!(this.isiOS&&this.isCordova&&window.webkit),"undefined"==typeof cr_is_preview||this.isNWjs||"?nw"!==window.location.search&&!/nodewebkit/i.test(navigator.userAgent)&&!/nwjs/i.test(navigator.userAgent)||(this.isNWjs=!0),this.isDebug="undefined"!=typeof cr_is_preview&&window.location.search.indexOf("debug")>-1,this.canvas=t,this.canvasdiv=document.getElementById("c2canvasdiv"),this.gl=null,this.glwrap=null,this.glUnmaskedRenderer="(unavailable)",this.enableFrontToBack=!1,this.earlyz_index=0,this.ctx=null,this.firstInFullscreen=!1,this.oldWidth=0,this.oldHeight=0,this.canvas.oncontextmenu=function(t){return t.preventDefault&&t.preventDefault(),!1},this.canvas.onselectstart=function(t){return t.preventDefault&&t.preventDefault(),!1},this.canvas.ontouchstart=function(t){return t.preventDefault&&t.preventDefault(),!1},this.isDirectCanvas&&(window.c2runtime=this),this.isNWjs&&(window.ondragover=function(t){return t.preventDefault(),!1},window.ondrop=function(t){return t.preventDefault(),!1},window.nwgui&&window.nwgui.App.clearCache&&window.nwgui.App.clearCache()),this.isAndroidStockBrowser&&"undefined"!=typeof jQuery&&jQuery("canvas").parents("*").css("overflow","visible"),this.width=t.width,this.height=t.height,this.draw_width=this.width,this.draw_height=this.height,this.cssWidth=this.width,this.cssHeight=this.height,this.lastWindowWidth=window.innerWidth,this.lastWindowHeight=window.innerHeight,this.forceCanvasAlpha=!1,this.redraw=!0,this.isSuspended=!1,Date.now||(Date.now=function(){return+new Date}),this.plugins=[],this.types={},this.types_by_index=[],this.behaviors=[],this.layouts={},this.layouts_by_index=[],this.eventsheets={},this.eventsheets_by_index=[],this.wait_for_textures=[],this.triggers_to_postinit=[],this.all_global_vars=[],this.all_local_vars=[],this.solidBehavior=null,this.jumpthruBehavior=null,this.shadowcasterBehavior=null,this.deathRow={},this.hasPendingInstances=!1,this.isInClearDeathRow=!1,this.isInOnDestroy=0,this.isRunningEvents=!1,this.isEndingLayout=!1,this.createRow=[],this.isLoadingState=!1,this.saveToSlot="",this.loadFromSlot="",this.loadFromJson=null,this.lastSaveJson="",this.signalledContinuousPreview=!1,this.suspendDrawing=!1,this.fireOnCreateAfterLoad=[],this.dt=0,this.dt1=0,this.minimumFramerate=30,this.logictime=0,this.cpuutilisation=0,this.timescale=1,this.kahanTime=new cr.KahanAdder,this.wallTime=new cr.KahanAdder,this.last_tick_time=0,this.fps=0,this.last_fps_time=0,this.tickcount=0,this.tickcount_nosave=0,this.execcount=0,this.framecount=0,this.objectcount=0,this.changelayout=null,this.destroycallbacks=[],this.event_stack=[],this.event_stack_index=-1,this.localvar_stack=[[]],this.localvar_stack_index=0,this.trigger_depth=0,this.pushEventStack(null),this.loop_stack=[],this.loop_stack_index=-1,this.next_uid=0,this.next_puid=0,this.layout_first_tick=!0,this.family_count=0,this.suspend_events=[],this.raf_id=-1,this.timeout_id=-1,this.isloading=!0,this.loadingprogress=0,this.isNodeFullscreen=!1,this.stackLocalCount=0,this.audioInstance=null,this.had_a_click=!1,this.isInUserInputEvent=!1,this.objects_to_pretick=new cr.ObjectSet,this.objects_to_tick=new cr.ObjectSet,this.objects_to_tick2=new cr.ObjectSet,this.registered_collisions=[],this.temp_poly=new cr.CollisionPoly([]),this.temp_poly2=new cr.CollisionPoly([]),this.allGroups=[],this.groups_by_name={},this.cndsBySid={},this.actsBySid={},this.varsBySid={},this.blocksBySid={},this.running_layout=null,this.layer_canvas=null,this.layer_ctx=null,this.layer_tex=null,this.layout_tex=null,this.layout_canvas=null,this.layout_ctx=null,this.is_WebGL_context_lost=!1,this.uses_background_blending=!1,this.fx_tex=[null,null],this.fullscreen_scaling=0,this.files_subfolder="",this.objectsByUid={},this.loaderlogos=null,this.snapshotCanvas=null,this.snapshotData="",this.objectRefTable=[],this.requestProjectData()}}e.prototype.requestProjectData=function(){var t=this;if(this.isWKWebView)this.fetchLocalFileViaCordovaAsText("data.js",function(e){t.loadProject(JSON.parse(e))},function(t){alert("Error fetching data.js")});else{var e;e=this.isWindowsPhone8?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;var i="data.js";(this.isWindows8App||this.isWindowsPhone8||this.isWindowsPhone81||this.isWindows10)&&(i="data.json"),e.open("GET",i,!0);var o=!1;if(!this.isDomFree&&"response"in e&&"responseType"in e)try{e.responseType="json",o="json"===e.responseType}catch(t){o=!1}if(!o&&"responseType"in e)try{e.responseType="text"}catch(t){}if("overrideMimeType"in e)try{e.overrideMimeType("application/json; charset=utf-8")}catch(t){}this.isWindowsPhone8?e.onreadystatechange=function(){4===e.readyState&&t.loadProject(JSON.parse(e.responseText))}:(e.onload=function(){if(o)t.loadProject(e.response);else if(t.isEjecta){var i=e.responseText;i=i.substr(i.indexOf("{")),t.loadProject(JSON.parse(i))}else t.loadProject(JSON.parse(e.responseText))},e.onerror=function(t){cr.logerror("Error requesting "+i+":"),cr.logerror(t)}),e.send()}},e.prototype.initRendererAndLoader=function(){var t,e,i,o,s,n,r,a,h,c,l,m=this;this.isRetina=(!this.isDomFree||this.isEjecta||this.isCordova)&&this.useHighDpi&&!this.isAndroidStockBrowser,0===this.fullscreen_mode&&this.isiOS&&(this.isRetina=!1),this.devicePixelRatio=this.isRetina&&(window.devicePixelRatio||window.webkitDevicePixelRatio||window.mozDevicePixelRatio||window.msDevicePixelRatio)||1,"object"==typeof window.StatusBar&&window.StatusBar.hide(),this.ClearDeathRow(),this.fullscreen_mode>0&&this.setSize(window.innerWidth,window.innerHeight,!0),this.canvas.addEventListener("webglcontextlost",function(t){t.preventDefault(),m.onContextLost(),cr.logexport("[Construct 2] WebGL context lost"),window.cr_setSuspended(!0)},!1),this.canvas.addEventListener("webglcontextrestored",function(t){m.glwrap.initState(),m.glwrap.setSize(m.glwrap.width,m.glwrap.height,!0),m.layer_tex=null,m.layout_tex=null,m.fx_tex[0]=null,m.fx_tex[1]=null,m.onContextRestored(),m.redraw=!0,cr.logexport("[Construct 2] WebGL context restored"),window.cr_setSuspended(!1)},!1);try{this.enableWebGL&&(this.isCocoonJs||this.isEjecta||!this.isDomFree)&&(l={alpha:!0,depth:!1,antialias:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!0},this.isAndroid||(this.gl=this.canvas.getContext("webgl2",l)),this.gl||(this.gl=this.canvas.getContext("webgl",l)||this.canvas.getContext("experimental-webgl",l)))}catch(t){}if(this.gl){this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2");var u=this.gl.getExtension("WEBGL_debug_renderer_info");if(u){var p=this.gl.getParameter(u.UNMASKED_VENDOR_WEBGL),d=this.gl.getParameter(u.UNMASKED_RENDERER_WEBGL);this.glUnmaskedRenderer=d+" ["+p+"]"}for(this.enableFrontToBack&&(this.glUnmaskedRenderer+=" [front-to-back enabled]"),this.isDomFree||(this.overlay_canvas=document.createElement("canvas"),jQuery(this.overlay_canvas).appendTo(this.canvas.parentNode),this.overlay_canvas.oncontextmenu=function(t){return!1},this.overlay_canvas.onselectstart=function(t){return!1},this.overlay_canvas.width=Math.round(this.cssWidth*this.devicePixelRatio),this.overlay_canvas.height=Math.round(this.cssHeight*this.devicePixelRatio),jQuery(this.overlay_canvas).css({width:this.cssWidth+"px",height:this.cssHeight+"px"}),this.positionOverlayCanvas(),this.overlay_ctx=this.overlay_canvas.getContext("2d")),this.glwrap=new cr.GLWrap(this.gl,this.isMobile,this.enableFrontToBack),this.glwrap.setSize(this.canvas.width,this.canvas.height),this.glwrap.enable_mipmaps=0!==this.downscalingQuality,this.ctx=null,t=0,e=this.types_by_index.length;t<e;t++)for(i=0,o=(r=this.types_by_index[t]).effect_types.length;i<o;i++)(a=r.effect_types[i]).shaderindex=this.glwrap.getShaderIndex(a.id),a.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(a.shaderindex),this.uses_background_blending=this.uses_background_blending||this.glwrap.programUsesDest(a.shaderindex);for(t=0,e=this.layouts_by_index.length;t<e;t++){for(i=0,o=(h=this.layouts_by_index[t]).effect_types.length;i<o;i++)(a=h.effect_types[i]).shaderindex=this.glwrap.getShaderIndex(a.id),a.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(a.shaderindex);for(h.updateActiveEffects(),i=0,o=h.layers.length;i<o;i++){for(s=0,n=(c=h.layers[i]).effect_types.length;s<n;s++)(a=c.effect_types[s]).shaderindex=this.glwrap.getShaderIndex(a.id),a.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(a.shaderindex),this.uses_background_blending=this.uses_background_blending||this.glwrap.programUsesDest(a.shaderindex);c.updateActiveEffects()}}}else{if(this.fullscreen_mode>0&&this.isDirectCanvas){this.canvas=null,document.oncontextmenu=function(t){return!1},document.onselectstart=function(t){return!1},this.ctx=AppMobi.canvas.getContext("2d");try{this.ctx.samplingMode=this.linearSampling?"smooth":"sharp",this.ctx.globalScale=1,this.ctx.HTML5CompatibilityMode=!0,this.ctx.imageSmoothingEnabled=this.linearSampling}catch(t){}0!==this.width&&0!==this.height&&(this.ctx.width=this.width,this.ctx.height=this.height)}this.ctx||(this.isCocoonJs?(l={antialias:!!this.linearSampling,alpha:!0},this.ctx=this.canvas.getContext("2d",l)):(l={alpha:!0},this.ctx=this.canvas.getContext("2d",l)),this.setCtxImageSmoothingEnabled(this.ctx,this.linearSampling)),this.overlay_canvas=null,this.overlay_ctx=null}if(this.tickFunc=function(t){m.tick(!1,t)},window==window.top||this.isDomFree||this.isWinJS||this.isWindowsPhone8||(document.addEventListener("mousedown",function(){window.focus()},!0),document.addEventListener("touchstart",function(){window.focus()},!0)),"undefined"!=typeof cr_is_preview&&(this.isCocoonJs&&console.log("[Construct 2] In preview-over-wifi via CocoonJS mode"),window.location.search.indexOf("continuous")>-1&&(cr.logexport("Reloading for continuous preview"),this.loadFromSlot="__c2_continuouspreview",this.suspendDrawing=!0),this.pauseOnBlur&&!this.isMobile&&(jQuery(window).focus(function(){m.setSuspended(!1)}),jQuery(window).blur(function(){var t=window.parent;t&&t.document.hasFocus()||m.setSuspended(!0)}))),window.addEventListener("blur",function(){m.onWindowBlur()}),!this.isDomFree){var y=function(t){if(cr.isCanvasInputEvent(t)&&document.activeElement&&document.activeElement!==document.getElementsByTagName("body")[0]&&document.activeElement.blur)try{document.activeElement.blur()}catch(t){}};"undefined"!=typeof PointerEvent?document.addEventListener("pointerdown",y):window.navigator.msPointerEnabled?document.addEventListener("MSPointerDown",y):document.addEventListener("touchstart",y),document.addEventListener("mousedown",y)}0===this.fullscreen_mode&&this.isRetina&&this.devicePixelRatio>1&&this.setSize(this.original_width,this.original_height,!0),this.tryLockOrientation(),this.getready(),this.go(),this.extra={},cr.seal(this)};e.prototype.setSize=function(t,e,i){var o=0,s=0,n=0,r=0,a=0;if(this.lastWindowWidth!==t||this.lastWindowHeight!==e||i){this.lastWindowWidth=t,this.lastWindowHeight=e;var h,c,l=this.fullscreen_mode,m=(document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen||this.isNodeFullscreen)&&!this.isCordova;if(m||0!==this.fullscreen_mode||i){m&&(l=this.fullscreen_scaling);var u=this.devicePixelRatio;l>=4?(5===l&&1!==u&&(t+=1,e+=1),(c=t/e)>(h=this.original_width/this.original_height)?(n=e*h,5===l?((a=n*u/this.original_width)>1?a=Math.floor(a):a<1&&(a=1/Math.ceil(1/a)),o=(t-(n=this.original_width*a/u))/2,s=(e-(r=this.original_height*a/u))/2,t=n,e=r):(o=(t-n)/2,t=n)):(r=t/h,5===l?((a=r*u/this.original_height)>1?a=Math.floor(a):a<1&&(a=1/Math.ceil(1/a)),o=(t-(n=this.original_width*a/u))/2,s=(e-(r=this.original_height*a/u))/2,t=n,e=r):(s=(e-r)/2,e=r))):m&&0===l&&(o=Math.floor((t-this.original_width)/2),s=Math.floor((e-this.original_height)/2),t=this.original_width,e=this.original_height),l<2&&(this.aspect_scale=u),this.cssWidth=Math.round(t),this.cssHeight=Math.round(e),this.width=Math.round(t*u),this.height=Math.round(e*u),this.redraw=!0,this.wantFullscreenScalingQuality?(this.draw_width=this.width,this.draw_height=this.height,this.fullscreenScalingQuality=!0):this.width<this.original_width&&this.height<this.original_height||1===l?(this.draw_width=this.width,this.draw_height=this.height,this.fullscreenScalingQuality=!0):(this.draw_width=this.original_width,this.draw_height=this.original_height,this.fullscreenScalingQuality=!1,2===l?(h=this.original_width/this.original_height,(c=this.lastWindowWidth/this.lastWindowHeight)<h?this.draw_width=this.draw_height*c:c>h&&(this.draw_height=this.draw_width/c)):3===l&&(h=this.original_width/this.original_height,(c=this.lastWindowWidth/this.lastWindowHeight)>h?this.draw_width=this.draw_height*c:c<h&&(this.draw_height=this.draw_width/c))),this.canvasdiv&&!this.isDomFree&&(jQuery(this.canvasdiv).css({width:Math.round(t)+"px",height:Math.round(e)+"px","margin-left":Math.floor(o)+"px","margin-top":Math.floor(s)+"px"}),"undefined"!=typeof cr_is_preview&&jQuery("#borderwrap").css({width:Math.round(t)+"px",height:Math.round(e)+"px"})),this.canvas&&(this.canvas.width=Math.round(t*u),this.canvas.height=Math.round(e*u),this.isEjecta?(this.canvas.style.left=Math.floor(o)+"px",this.canvas.style.top=Math.floor(s)+"px",this.canvas.style.width=Math.round(t)+"px",this.canvas.style.height=Math.round(e)+"px"):this.isRetina&&!this.isDomFree&&(this.canvas.style.width=Math.round(t)+"px",this.canvas.style.height=Math.round(e)+"px")),this.overlay_canvas&&(this.overlay_canvas.width=Math.round(t*u),this.overlay_canvas.height=Math.round(e*u),this.overlay_canvas.style.width=this.cssWidth+"px",this.overlay_canvas.style.height=this.cssHeight+"px"),this.glwrap&&this.glwrap.setSize(Math.round(t*u),Math.round(e*u)),this.isDirectCanvas&&this.ctx&&(this.ctx.width=Math.round(t),this.ctx.height=Math.round(e)),this.ctx&&this.setCtxImageSmoothingEnabled(this.ctx,this.linearSampling),this.tryLockOrientation(),this.isiPhone&&!this.isCordova&&window.scrollTo(0,0)}}},e.prototype.tryLockOrientation=function(){if(this.autoLockOrientation&&0!==this.orientations){var t="portrait";2===this.orientations&&(t="landscape");try{screen.orientation&&screen.orientation.lock?screen.orientation.lock(t).catch(function(){}):screen.lockOrientation?screen.lockOrientation(t):screen.webkitLockOrientation?screen.webkitLockOrientation(t):screen.mozLockOrientation?screen.mozLockOrientation(t):screen.msLockOrientation&&screen.msLockOrientation(t)}catch(t){console&&console.warn&&console.warn("Failed to lock orientation: ",t)}}},e.prototype.onContextLost=function(){var t,e,i;for(this.glwrap.contextLost(),this.is_WebGL_context_lost=!0,t=0,e=this.types_by_index.length;t<e;t++)(i=this.types_by_index[t]).onLostWebGLContext&&i.onLostWebGLContext()},e.prototype.onContextRestored=function(){var t,e,i;for(this.is_WebGL_context_lost=!1,t=0,e=this.types_by_index.length;t<e;t++)(i=this.types_by_index[t]).onRestoreWebGLContext&&i.onRestoreWebGLContext()},e.prototype.positionOverlayCanvas=function(){if(!this.isDomFree){var t=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement||this.isNodeFullscreen)&&!this.isCordova?jQuery(this.canvas).offset():jQuery(this.canvas).position();t.position="absolute",jQuery(this.overlay_canvas).css(t)}};var i=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame;e.prototype.setSuspended=function(t){var e,o;if(t&&!this.isSuspended)for(cr.logexport("[Construct 2] Suspending"),this.isSuspended=!0,-1!==this.raf_id&&i&&i(this.raf_id),-1!==this.timeout_id&&clearTimeout(this.timeout_id),e=0,o=this.suspend_events.length;e<o;e++)this.suspend_events[e](!0);else if(!t&&this.isSuspended){for(cr.logexport("[Construct 2] Resuming"),this.isSuspended=!1,this.last_tick_time=cr.performance_now(),this.last_fps_time=cr.performance_now(),this.framecount=0,this.logictime=0,e=0,o=this.suspend_events.length;e<o;e++)this.suspend_events[e](!1);this.tick(!1)}},e.prototype.addSuspendCallback=function(t){this.suspend_events.push(t)},e.prototype.GetObjectReference=function(t){return this.objectRefTable[t]},e.prototype.loadProject=function(t){t&&t.project||cr.logerror("Project model unavailable");var e,i,o,s,n,r,a,h,c,l,m,u,p,d=t.project;if(this.name=d[0],this.first_layout=d[1],this.fullscreen_mode=d[12],this.fullscreen_mode_set=d[12],this.original_width=d[10],this.original_height=d[11],this.parallax_x_origin=this.original_width/2,this.parallax_y_origin=this.original_height/2,this.isDomFree&&!this.isEjecta&&(d[12]>=4||0===d[12])&&(cr.logexport("[Construct 2] Letterbox scale fullscreen modes are not supported on this platform - falling back to 'Scale outer'"),this.fullscreen_mode=3,this.fullscreen_mode_set=3),this.uses_loader_layout=d[18],this.loaderstyle=d[19],0===this.loaderstyle){var y=new Image;y.crossOrigin="anonymous",this.setImageSrc(y,"loading-logo.png"),this.loaderlogos={logo:y}}else if(4===this.loaderstyle){var _=new Image;_.src="";var f=new Image;f.src="";var x=new Image;x.src="";var g=new Image;g.src="";var b=new Image;b.src="";var v=new Image;v.src="";var B=new Image;B.src="";var D=new Image;D.src="";var w=new Image;w.src="";var C=new Image;C.src="";var S=new Image;S.src="";var A=new Image;A.src="",this.loaderlogos={logo:[_,f,x,g],powered:[b,v,B,D],website:[w,C,S,A]}}for(this.next_uid=d[21],this.objectRefTable=cr.getObjectRefTable(),this.system=new cr.system_object(this),e=0,i=d[2].length;e<i;e++)a=d[2][e],m=this.GetObjectReference(a[0]),cr.add_common_aces(a,m.prototype),(u=new m(this)).singleglobal=a[1],u.is_world=a[2],u.is_rotatable=a[5],u.must_predraw=a[9],u.onCreate&&u.onCreate(),cr.seal(u),this.plugins.push(u);for(this.objectRefTable=cr.getObjectRefTable(),e=0,i=d[3].length;e<i;e++){for(a=d[3][e],p=this.GetObjectReference(a[1]),u=null,o=0,s=this.plugins.length;o<s;o++)if(this.plugins[o]instanceof p){u=this.plugins[o];break}var M=new u.Type(u);for(M.name=a[0],M.is_family=a[2],M.instvar_sids=a[3].slice(0),M.vars_count=a[3].length,M.behs_count=a[4],M.fx_count=a[5],M.sid=a[11],M.is_family?(M.members=[],M.family_index=this.family_count++,M.families=null):(M.members=null,M.family_index=-1,M.families=[]),M.family_var_map=null,M.family_beh_map=null,M.family_fx_map=null,M.is_contained=!1,M.container=null,a[6]?(M.texture_file=a[6][0],M.texture_filesize=a[6][1],M.texture_pixelformat=a[6][2]):(M.texture_file=null,M.texture_filesize=0,M.texture_pixelformat=0),a[7]?M.animations=a[7]:M.animations=null,M.index=e,M.instances=[],M.deadCache=[],M.solstack=[new cr.selection(M)],M.cur_sol=0,M.default_instance=null,M.default_layerindex=0,M.stale_iids=!0,M.updateIIDs=cr.type_updateIIDs,M.getFirstPicked=cr.type_getFirstPicked,M.getPairedInstance=cr.type_getPairedInstance,M.getCurrentSol=cr.type_getCurrentSol,M.pushCleanSol=cr.type_pushCleanSol,M.pushCopySol=cr.type_pushCopySol,M.popSol=cr.type_popSol,M.getBehaviorByName=cr.type_getBehaviorByName,M.getBehaviorIndexByName=cr.type_getBehaviorIndexByName,M.getEffectIndexByName=cr.type_getEffectIndexByName,M.applySolToContainer=cr.type_applySolToContainer,M.getInstanceByIID=cr.type_getInstanceByIID,M.collision_grid=new cr.SparseGrid(this.original_width,this.original_height),M.any_cell_changed=!0,M.any_instance_parallaxed=!1,M.extra={},M.toString=cr.type_toString,M.behaviors=[],o=0,s=a[8].length;o<s;o++){h=a[8][o];var T=this.GetObjectReference(h[1]),I=null;for(n=0,r=this.behaviors.length;n<r;n++)if(this.behaviors[n]instanceof T){I=this.behaviors[n];break}I||((I=new T(this)).my_types=[],I.my_instances=new cr.ObjectSet,I.onCreate&&I.onCreate(),cr.seal(I),this.behaviors.push(I),cr.behaviors.solid&&I instanceof cr.behaviors.solid&&(this.solidBehavior=I),cr.behaviors.jumpthru&&I instanceof cr.behaviors.jumpthru&&(this.jumpthruBehavior=I),cr.behaviors.shadowcaster&&I instanceof cr.behaviors.shadowcaster&&(this.shadowcasterBehavior=I)),-1===I.my_types.indexOf(M)&&I.my_types.push(M);var P=new I.Type(I,M);P.name=h[0],P.sid=h[2],P.onCreate(),cr.seal(P),M.behaviors.push(P)}for(M.global=a[9],M.isOnLoaderLayout=a[10],M.effect_types=[],o=0,s=a[12].length;o<s;o++)M.effect_types.push({id:a[12][o][0],name:a[12][o][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:o});if(M.tile_poly_data=a[13],this.uses_loader_layout&&!M.is_family&&!M.isOnLoaderLayout&&u.is_world||(M.onCreate(),cr.seal(M)),M.name&&(this.types[M.name]=M),this.types_by_index.push(M),u.singleglobal){var L=new u.Instance(M);L.uid=this.next_uid++,L.puid=this.next_puid++,L.iid=0,L.get_iid=cr.inst_get_iid,L.toString=cr.inst_toString,L.properties=a[14],L.onCreate(),cr.seal(L),M.instances.push(L),this.objectsByUid[L.uid.toString()]=L}}for(e=0,i=d[4].length;e<i;e++){var V,R=d[4][e],O=this.types_by_index[R[0]];for(o=1,s=R.length;o<s;o++)(V=this.types_by_index[R[o]]).families.push(O),O.members.push(V)}for(e=0,i=d[28].length;e<i;e++){var k=d[28][e],E=[];for(o=0,s=k.length;o<s;o++)E.push(this.types_by_index[k[o]]);for(o=0,s=E.length;o<s;o++)E[o].is_contained=!0,E[o].container=E}if(this.family_count>0)for(e=0,i=this.types_by_index.length;e<i;e++)if(!(c=this.types_by_index[e]).is_family&&c.families.length){c.family_var_map=new Array(this.family_count),c.family_beh_map=new Array(this.family_count),c.family_fx_map=new Array(this.family_count);var N=[],F=0,G=0,J=0;for(o=0,s=c.families.length;o<s;o++)for(l=c.families[o],c.family_var_map[l.family_index]=F,F+=l.vars_count,c.family_beh_map[l.family_index]=G,G+=l.behs_count,c.family_fx_map[l.family_index]=J,J+=l.fx_count,n=0,r=l.effect_types.length;n<r;n++)N.push(cr.shallowCopy({},l.effect_types[n]));for(c.effect_types=N.concat(c.effect_types),o=0,s=c.effect_types.length;o<s;o++)c.effect_types[o].index=o}for(e=0,i=d[5].length;e<i;e++){a=d[5][e];var j=new cr.layout(this,a);cr.seal(j),this.layouts[j.name]=j,this.layouts_by_index.push(j)}for(e=0,i=d[6].length;e<i;e++){a=d[6][e];var z=new cr.eventsheet(this,a);cr.seal(z),this.eventsheets[z.name]=z,this.eventsheets_by_index.push(z)}for(e=0,i=this.eventsheets_by_index.length;e<i;e++)this.eventsheets_by_index[e].postInit();for(e=0,i=this.eventsheets_by_index.length;e<i;e++)this.eventsheets_by_index[e].updateDeepIncludes();for(e=0,i=this.triggers_to_postinit.length;e<i;e++)this.triggers_to_postinit[e].postInit();cr.clearArray(this.triggers_to_postinit),this.audio_to_preload=d[7],this.files_subfolder=d[8],this.pixel_rounding=d[9],this.aspect_scale=1,this.enableWebGL=d[13],this.linearSampling=d[14],this.clearBackground=d[15],this.versionstr=d[16],this.useHighDpi=d[17],this.orientations=d[20],this.autoLockOrientation=this.orientations>0,this.pauseOnBlur=d[22],this.wantFullscreenScalingQuality=d[23],this.fullscreenScalingQuality=this.wantFullscreenScalingQuality,this.downscalingQuality=d[24],this.preloadSounds=d[25],this.projectName=d[26],this.enableFrontToBack=d[27]&&!this.isIE,this.start_time=Date.now(),cr.clearArray(this.objectRefTable),this.initRendererAndLoader()};var o=!1,s=0,n=[];e.prototype.queueImageLoad=function(t,e){var i=this,o=function(){s--,i.maybeLoadNextImages()};t.addEventListener("load",o),t.addEventListener("error",o),n.push([t,e]),this.maybeLoadNextImages()},e.prototype.maybeLoadNextImages=function(){for(var t;n.length&&s<100;)s++,t=n.shift(),this.setImageSrc(t[0],t[1])},e.prototype.waitForImageLoad=function(t,e){t.cocoonLazyLoad=!0,t.onerror=function(e){t.c2error=!0,o=!0,console&&console.error&&console.error("Error loading image '"+t.src+"': ",e)},this.isEjecta?t.src=e:t.src||("undefined"!=typeof XAPKReader?XAPKReader.get(e,function(e){t.src=e},function(i){t.c2error=!0,o=!0,console&&console.error&&console.error("Error extracting image '"+e+"' from expansion file: ",i)}):(t.crossOrigin="anonymous",this.queueImageLoad(t,e))),this.wait_for_textures.push(t)},e.prototype.findWaitingTexture=function(t){var e,i;for(e=0,i=this.wait_for_textures.length;e<i;e++)if(this.wait_for_textures[e].cr_src===t)return this.wait_for_textures[e];return null};var r=0,a=!1;e.prototype.getready=function(){this.audioInstance&&(r=this.audioInstance.setPreloadList(this.audio_to_preload))},e.prototype.areAllTexturesAndSoundsLoaded=function(){var t,e,i,o=r,s=0,n=0,h=!0;for(t=0,e=this.wait_for_textures.length;t<e;t++){var c=(i=this.wait_for_textures[t]).cr_filesize;(!c||c<=0)&&(c=5e4),o+=c,i.src&&(i.complete||i.loaded)&&!i.c2error?s+=c:h=!1}return h&&this.preloadSounds&&this.audioInstance&&(a||(this.audioInstance.startPreloads(),a=!0),s+=n=this.audioInstance.getPreloadedSize(),n<r&&(h=!1)),this.progress=0==o?1:s/o,h};var h=!1;e.prototype.go=function(){if(this.ctx||this.glwrap){var e=this.ctx||this.overlay_ctx;this.overlay_canvas&&this.positionOverlayCanvas();var i=window.innerWidth,s=window.innerHeight;this.lastWindowWidth===i&&this.lastWindowHeight===s||this.setSize(i,s),this.progress=0,this.last_progress=-1;var n=this;if(this.areAllTexturesAndSoundsLoaded()&&(4!==this.loaderstyle||h))this.go_loading_finished();else{var r=Date.now()-this.start_time;if(e){var a=this.width,c=this.height,l=this.devicePixelRatio;if(this.loaderstyle<3&&(this.isCocoonJs||r>=500&&this.last_progress!=this.progress)){e.clearRect(0,0,a,c);var m,u=a/2,p=c/2,d=0===this.loaderstyle&&this.loaderlogos.logo.complete,y=40*l,_=0,f=80*l;if(d){var x=this.loaderlogos.logo;y=(f=x.width*l)/2,_=(m=x.height*l)/2,e.drawImage(x,cr.floor(u-y),cr.floor(p-_),f,m)}if(this.loaderstyle<=1)p+=_+(d?12*l:0),u-=y,u=cr.floor(u)+.5,p=cr.floor(p)+.5,e.fillStyle=o?"red":"DodgerBlue",e.fillRect(u,p,Math.floor(f*this.progress),6*l),e.strokeStyle="black",e.strokeRect(u,p,f,6*l),e.strokeStyle="white",e.strokeRect(u-1*l,p-1*l,f+2*l,8*l);else if(2===this.loaderstyle){e.font=this.isEjecta?"12pt ArialMT":"12pt Arial",e.fillStyle=o?"#f00":"#999",e.textBaseLine="middle";var g=Math.round(100*this.progress)+"%",b=e.measureText?e.measureText(g):null,v=b?b.width:0;e.fillText(g,u-v/2,p)}this.last_progress=this.progress}else if(4===this.loaderstyle)return this.draw_c2_splash_loader(e),void(t?t(function(){n.go()}):setTimeout(function(){n.go()},16))}setTimeout(function(){n.go()},this.isCocoonJs?10:100)}}};var c=-1,l="undefined"==typeof cr_is_preview?200:0,m=!0,u=!1,p=0,d=0,y="undefined"==typeof cr_is_preview?3e3:0,_=null,f=null,x=0;function g(t,e){return e<=128?t[3]:e<=256?t[2]:e<=512?t[1]:t[0]}e.prototype.draw_c2_splash_loader=function(t){if(!h){for(var e=Math.ceil(this.width),i=Math.ceil(this.height),s=(this.devicePixelRatio,this.loaderlogos.logo),n=this.loaderlogos.powered,r=this.loaderlogos.website,a=0;a<4;++a)if(!s[a].complete||!n[a].complete||!r[a].complete)return;0===x&&(c=Date.now());var b,v,B=Date.now(),D=!1,w=t;m||u?(t.clearRect(0,0,e,i),function(t,e){_&&_.width===t&&_.height===e||((_=document.createElement("canvas")).width=t,_.height=e,f=_.getContext("2d"))}(e,i),w=f,D=!0,m&&1===x&&(c=Date.now())):t.globalAlpha=1,w.fillStyle="#333333",w.fillRect(0,0,e,i),this.cssHeight>256?(v=.25*(b=cr.clamp(.22*i,105,.6*e)),w.drawImage(g(n,b),.5*e-b/2,.2*i-v/2,b,v),v=b=Math.min(.395*i,.95*e),w.drawImage(g(s,b),.5*e-b/2,.485*i-v/2,b,v),v=.25*(b=cr.clamp(.22*i,105,.6*e)),w.drawImage(g(r,b),.5*e-b/2,.868*i-v/2,b,v),w.fillStyle="#3C3C3C",b=e,v=Math.max(.005*i,2),w.fillRect(0,.8*i-v/2,b,v),w.fillStyle=o?"red":"#E0FF65",b=e*this.progress,w.fillRect(.5*e-b/2,.8*i-v/2,b,v)):(v=b=.55*i,w.drawImage(g(s,b),.5*e-b/2,.45*i-v/2,b,v),w.fillStyle="#3C3C3C",b=e,v=Math.max(.005*i,2),w.fillRect(0,.85*i-v/2,b,v),w.fillStyle=o?"red":"#E0FF65",b=e*this.progress,w.fillRect(.5*e-b/2,.85*i-v/2,b,v)),D&&(m?t.globalAlpha=0===x?0:Math.min((B-c)/300,1):u&&(t.globalAlpha=Math.max(1-(B-d)/300,0)),t.drawImage(_,0,0,e,i)),m&&B-c>=300&&x>=2&&(m=!1,p=B),!m&&B-p>=y&&!u&&this.progress>=1&&(u=!0,d=B),(u&&B-d>=300+l||"undefined"!=typeof cr_is_preview&&this.progress>=1&&Date.now()-c<500)&&(h=!0,m=!1,u=!1,_=null,f=null,this.loaderlogos=null),++x}},e.prototype.go_loading_finished=function(){var t,e,i;if(this.overlay_canvas&&(this.canvas.parentNode.removeChild(this.overlay_canvas),this.overlay_ctx=null,this.overlay_canvas=null),this.start_time=Date.now(),this.last_fps_time=cr.performance_now(),this.uses_loader_layout)for(t=0,e=this.types_by_index.length;t<e;t++)(i=this.types_by_index[t]).is_family||i.isOnLoaderLayout||!i.plugin.is_world||(i.onCreate(),cr.seal(i));else this.isloading=!1;for(t=0,e=this.layouts_by_index.length;t<e;t++)this.layouts_by_index[t].createGlobalNonWorlds();if(this.fullscreen_mode>=2){var o=this.original_width/this.original_height,s=this.width/this.height;2!==this.fullscreen_mode&&s>o||2===this.fullscreen_mode&&s<o?this.aspect_scale=this.height/this.original_height:this.aspect_scale=this.width/this.original_width}for(this.first_layout?this.layouts[this.first_layout].startRunning():this.layouts_by_index[0].startRunning(),this.uses_loader_layout||(this.loadingprogress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null),window.C2_RegisterSW&&window.C2_RegisterSW()),navigator.splashscreen&&navigator.splashscreen.hide&&navigator.splashscreen.hide(),t=0,e=this.types_by_index.length;t<e;t++)(i=this.types_by_index[t]).onAppBegin&&i.onAppBegin();document.hidden||document.webkitHidden||document.mozHidden||document.msHidden?window.cr_setSuspended(!0):this.tick(!1),this.isDirectCanvas&&AppMobi.webview.execute("onGameReady();")},e.prototype.tick=function(e,i,o){if(this.running_layout){var s=cr.performance_now(),n=s;if(o||!this.isSuspended||e){e||(t?this.raf_id=t(this.tickFunc):this.timeout_id=setTimeout(this.tickFunc,this.isMobile?1:16));var r=i||s,a=this.fullscreen_mode,h=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement)&&!this.isCordova;if((h||this.isNodeFullscreen)&&this.fullscreen_scaling>0&&(a=this.fullscreen_scaling),a>0){var c=window.innerWidth,l=window.innerHeight;this.lastWindowWidth===c&&this.lastWindowHeight===l||this.setSize(c,l)}if(this.isDomFree||(h?this.firstInFullscreen||(this.firstInFullscreen=!0):this.firstInFullscreen?(this.firstInFullscreen=!1,0===this.fullscreen_mode&&this.setSize(Math.round(this.oldWidth/this.devicePixelRatio),Math.round(this.oldHeight/this.devicePixelRatio),!0)):(this.oldWidth=this.width,this.oldHeight=this.height)),this.isloading){var m=this.areAllTexturesAndSoundsLoaded();this.loadingprogress=this.progress,m&&(this.isloading=!1,this.progress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null),window.C2_RegisterSW&&window.C2_RegisterSW())}this.logic(r),!this.redraw&&!this.isCocoonJs||this.is_WebGL_context_lost||this.suspendDrawing||e||(this.redraw=!1,this.glwrap?this.drawGL():this.draw(),this.snapshotCanvas&&(this.canvas&&this.canvas.toDataURL&&(this.snapshotData=this.canvas.toDataURL(this.snapshotCanvas[0],this.snapshotCanvas[1]),window.cr_onSnapshot&&window.cr_onSnapshot(this.snapshotData),this.trigger(cr.system_object.prototype.cnds.OnCanvasSnapshot,null)),this.snapshotCanvas=null)),this.hit_breakpoint||(this.tickcount++,this.tickcount_nosave++,this.execcount++,this.framecount++),this.logictime+=cr.performance_now()-n}}},e.prototype.logic=function(t){var e,i,o,s,n,r,a,h;t-this.last_fps_time>=1e3&&(this.last_fps_time+=1e3,t-this.last_fps_time>=1e3&&(this.last_fps_time=t),this.fps=this.framecount,this.framecount=0,this.cpuutilisation=this.logictime,this.logictime=0);var c=0;if(0!==this.last_tick_time){var l=t-this.last_tick_time;l<0&&(l=0),c=l/1e3,this.dt1=c,this.dt1>.5?this.dt1=0:this.dt1>1/this.minimumFramerate&&(this.dt1=1/this.minimumFramerate)}this.last_tick_time=t,this.dt=this.dt1*this.timescale,this.kahanTime.add(this.dt),this.wallTime.add(c);var m=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement||this.isNodeFullscreen)&&!this.isCordova;if(this.fullscreen_mode>=2||m&&this.fullscreen_scaling>0){var u=this.original_width/this.original_height,p=this.width/this.height,d=this.fullscreen_mode;m&&this.fullscreen_scaling>0&&(d=this.fullscreen_scaling),this.aspect_scale=2!==d&&p>u||2===d&&p<u?this.height/this.original_height:this.width/this.original_width,this.running_layout&&(this.running_layout.scrollToX(this.running_layout.scrollX),this.running_layout.scrollToY(this.running_layout.scrollY))}else this.aspect_scale=this.isRetina?this.devicePixelRatio:1;this.ClearDeathRow(),this.isInOnDestroy++,this.system.runWaits(),this.isInOnDestroy--,this.ClearDeathRow(),this.isInOnDestroy++;var y=this.objects_to_pretick.valuesRef();for(e=0,i=y.length;e<i;e++)y[e].pretick();for(e=0,i=this.types_by_index.length;e<i;e++)if(!(a=this.types_by_index[e]).is_family&&(a.behaviors.length||a.families.length))for(o=0,s=a.instances.length;o<s;o++)for(n=0,r=(_=a.instances[o]).behavior_insts.length;n<r;n++)_.behavior_insts[n].tick();for(e=0,i=this.types_by_index.length;e<i;e++)if(!(a=this.types_by_index[e]).is_family&&(a.behaviors.length||a.families.length))for(o=0,s=a.instances.length;o<s;o++)for(n=0,r=(_=a.instances[o]).behavior_insts.length;n<r;n++)(h=_.behavior_insts[n]).posttick&&h.posttick();for(e=0,i=(y=this.objects_to_tick.valuesRef()).length;e<i;e++)y[e].tick();for(this.isInOnDestroy--,this.handleSaveLoad(),e=0;this.changelayout&&e++<10;)this.doChangeLayout(this.changelayout);for(e=0,i=this.eventsheets_by_index.length;e<i;e++)this.eventsheets_by_index[e].hasRun=!1;for(this.running_layout.event_sheet&&this.running_layout.event_sheet.run(),cr.clearArray(this.registered_collisions),this.layout_first_tick=!1,this.isInOnDestroy++,e=0,i=this.types_by_index.length;e<i;e++)if(!(a=this.types_by_index[e]).is_family&&(a.behaviors.length||a.families.length))for(o=0,s=a.instances.length;o<s;o++){var _;for(n=0,r=(_=a.instances[o]).behavior_insts.length;n<r;n++)(h=_.behavior_insts[n]).tick2&&h.tick2()}for(e=0,i=(y=this.objects_to_tick2.valuesRef()).length;e<i;e++)y[e].tick2();this.isInOnDestroy--},e.prototype.onWindowBlur=function(){var t,e,i,o,s,n,r,a,h;for(t=0,e=this.types_by_index.length;t<e;t++)if(!(r=this.types_by_index[t]).is_family)for(i=0,o=r.instances.length;i<o;i++)if((a=r.instances[i]).onWindowBlur&&a.onWindowBlur(),a.behavior_insts)for(s=0,n=a.behavior_insts.length;s<n;s++)(h=a.behavior_insts[s]).onWindowBlur&&h.onWindowBlur()},e.prototype.doChangeLayout=function(t){var e,i,o,s=this.running_layout;if(this.running_layout.stopRunning(),this.glwrap)for(e=0,i=this.types_by_index.length;e<i;e++)(o=this.types_by_index[e]).is_family||!o.unloadTextures||o.global&&0!==o.instances.length||-1!==t.initial_types.indexOf(o)||o.unloadTextures();s==t&&cr.clearArray(this.system.waits),cr.clearArray(this.registered_collisions),this.runLayoutChangeMethods(!0),t.startRunning(),this.runLayoutChangeMethods(!1),this.redraw=!0,this.layout_first_tick=!0,this.ClearDeathRow()},e.prototype.runLayoutChangeMethods=function(t){var e,i,o,s,n,r,a,h,c,l;for(e=0,i=this.behaviors.length;e<i;e++)o=this.behaviors[e],t?o.onBeforeLayoutChange&&o.onBeforeLayoutChange():o.onLayoutChange&&o.onLayoutChange();for(e=0,i=this.types_by_index.length;e<i;e++)if((s=this.types_by_index[e]).global||s.plugin.singleglobal)for(n=0,r=s.instances.length;n<r;n++)if(a=s.instances[n],t?a.onBeforeLayoutChange&&a.onBeforeLayoutChange():a.onLayoutChange&&a.onLayoutChange(),a.behavior_insts)for(h=0,c=a.behavior_insts.length;h<c;h++)l=a.behavior_insts[h],t?l.onBeforeLayoutChange&&l.onBeforeLayoutChange():l.onLayoutChange&&l.onLayoutChange()},e.prototype.pretickMe=function(t){this.objects_to_pretick.add(t)},e.prototype.unpretickMe=function(t){this.objects_to_pretick.remove(t)},e.prototype.tickMe=function(t){this.objects_to_tick.add(t)},e.prototype.untickMe=function(t){this.objects_to_tick.remove(t)},e.prototype.tick2Me=function(t){this.objects_to_tick2.add(t)},e.prototype.untick2Me=function(t){this.objects_to_tick2.remove(t)},e.prototype.getDt=function(t){return t&&-1!==t.my_timescale?this.dt1*t.my_timescale:this.dt},e.prototype.draw=function(){this.running_layout.draw(this.ctx),this.isDirectCanvas&&this.ctx.present()},e.prototype.drawGL=function(){this.enableFrontToBack&&(this.earlyz_index=1,this.running_layout.drawGL_earlyZPass(this.glwrap)),this.running_layout.drawGL(this.glwrap),this.glwrap.present()},e.prototype.addDestroyCallback=function(t){t&&this.destroycallbacks.push(t)},e.prototype.removeDestroyCallback=function(t){cr.arrayFindRemove(this.destroycallbacks,t)},e.prototype.getObjectByUID=function(t){var e=t.toString();return this.objectsByUid.hasOwnProperty(e)?this.objectsByUid[e]:null};var b=[];e.prototype.DestroyInstance=function(t){var e,i,o=t.type.name,s=null;if(this.deathRow.hasOwnProperty(o)){if((s=this.deathRow[o]).contains(t))return}else s=b.length?b.pop():new cr.ObjectSet,this.deathRow[o]=s;if(s.add(t),this.hasPendingInstances=!0,t.is_contained)for(e=0,i=t.siblings.length;e<i;e++)this.DestroyInstance(t.siblings[e]);this.isInClearDeathRow&&s.values_cache.push(t),this.isEndingLayout||(this.isInOnDestroy++,this.trigger(Object.getPrototypeOf(t.type.plugin).cnds.OnDestroyed,t),this.isInOnDestroy--)},e.prototype.ClearDeathRow=function(){if(this.hasPendingInstances){var t,e,i,o,s,n;for(this.isInClearDeathRow=!0,i=0,s=this.createRow.length;i<s;++i)for((e=(t=this.createRow[i]).type).instances.push(t),o=0,n=e.families.length;o<n;++o)e.families[o].instances.push(t),e.families[o].stale_iids=!0;cr.clearArray(this.createRow),this.IterateDeathRow(),cr.wipe(this.deathRow),this.isInClearDeathRow=!1,this.hasPendingInstances=!1}},e.prototype.IterateDeathRow=function(){for(var t in this.deathRow)this.deathRow.hasOwnProperty(t)&&this.ClearDeathRowForType(this.deathRow[t])},e.prototype.ClearDeathRowForType=function(t){var e,i,o,s,n,r,a,h,c=t.valuesRef(),l=c[0].type;for(cr.arrayRemoveAllFromObjectSet(l.instances,t),l.stale_iids=!0,0===l.instances.length&&(l.any_instance_parallaxed=!1),e=0,i=l.families.length;e<i;++e)r=l.families[e],cr.arrayRemoveAllFromObjectSet(r.instances,t),r.stale_iids=!0;for(e=0,i=this.system.waits.length;e<i;++e)if((n=this.system.waits[e]).sols.hasOwnProperty(l.index)&&cr.arrayRemoveAllFromObjectSet(n.sols[l.index].insts,t),!l.is_family)for(o=0,s=l.families.length;o<s;++o)r=l.families[o],n.sols.hasOwnProperty(r.index)&&cr.arrayRemoveAllFromObjectSet(n.sols[r.index].insts,t);var m,u=c[0].layer;if(u){if(u.useRenderCells)for(e=0,i=(a=u.instances).length;e<i;++e)h=a[e],t.contains(h)&&(h.update_bbox(),u.render_grid.update(h,h.rendercells,null),h.rendercells.set(0,0,-1,-1));cr.arrayRemoveAllFromObjectSet(u.instances,t),u.setZIndicesStaleFrom(0)}for(e=0;e<c.length;++e)this.ClearDeathRowForSingleInstance(c[e],l);(m=t).clear(),b.push(m),this.redraw=!0},e.prototype.ClearDeathRowForSingleInstance=function(t,e){var i,o,s;for(i=0,o=this.destroycallbacks.length;i<o;++i)this.destroycallbacks[i](t);t.collcells&&e.collision_grid.update(t,t.collcells,null);var n=t.layer;if(n&&n.removeFromInstanceList(t,!0),t.behavior_insts)for(i=0,o=t.behavior_insts.length;i<o;++i)(s=t.behavior_insts[i]).onDestroy&&s.onDestroy(),s.behavior.my_instances.remove(t);this.objects_to_pretick.remove(t),this.objects_to_tick.remove(t),this.objects_to_tick2.remove(t),t.onDestroy&&t.onDestroy(),this.objectsByUid.hasOwnProperty(t.uid.toString())&&delete this.objectsByUid[t.uid.toString()],this.objectcount--,e.deadCache.length<100&&e.deadCache.push(t)},e.prototype.createInstance=function(t,e,i,o){if(t.is_family){var s=cr.floor(Math.random()*t.members.length);return this.createInstance(t.members[s],e,i,o)}return t.default_instance?this.createInstanceFromInit(t.default_instance,e,!1,i,o,!1):null};var v=[];e.prototype.createInstanceFromInit=function(t,e,i,o,s,n){var r,a,h,c,l;if(!t)return null;var m=this.types_by_index[t[1]],u=m.plugin.is_world;if(this.isloading&&u&&!m.isOnLoaderLayout)return null;if(u&&!this.glwrap&&11===t[0][11])return null;var p,d=e;for(u||(e=null),m.deadCache.length?((p=m.deadCache.pop()).recycled=!0,m.plugin.Instance.call(p,m)):(p=new m.plugin.Instance(m)).recycled=!1,!i||n||this.objectsByUid.hasOwnProperty(t[2].toString())?p.uid=this.next_uid++:p.uid=t[2],this.objectsByUid[p.uid.toString()]=p,p.puid=this.next_puid++,p.iid=m.instances.length,r=0,a=this.createRow.length;r<a;++r)this.createRow[r].type===m&&p.iid++;p.get_iid=cr.inst_get_iid,p.toString=cr.inst_toString;var y,_=t[3];if(p.recycled)cr.wipe(p.extra);else{if(p.extra={},"undefined"!=typeof cr_is_preview)for(p.instance_var_names=[],p.instance_var_names.length=_.length,r=0,a=_.length;r<a;r++)p.instance_var_names[r]=_[r][1];p.instance_vars=[],p.instance_vars.length=_.length}for(r=0,a=_.length;r<a;r++)p.instance_vars[r]=_[r][0];if(u){var f=t[0];if(p.x=cr.is_undefined(o)?f[0]:o,p.y=cr.is_undefined(s)?f[1]:s,p.z=f[2],p.width=f[3],p.height=f[4],p.depth=f[5],p.angle=f[6],p.opacity=f[7],p.hotspotX=f[8],p.hotspotY=f[9],p.blend_mode=f[10],l=f[11],!this.glwrap&&m.effect_types.length&&(p.blend_mode=l),p.compositeOp=cr.effectToCompositeOp(p.blend_mode),this.gl&&cr.setGLBlend(p,p.blend_mode,this.gl),p.recycled){for(r=0,a=f[12].length;r<a;r++)for(h=0,c=f[12][r].length;h<c;h++)p.effect_params[r][h]=f[12][r][h];p.bbox.set(0,0,0,0),p.collcells.set(0,0,-1,-1),p.rendercells.set(0,0,-1,-1),p.bquad.set_from_rect(p.bbox),cr.clearArray(p.bbox_changed_callbacks)}else{for(p.effect_params=f[12].slice(0),r=0,a=p.effect_params.length;r<a;r++)p.effect_params[r]=f[12][r].slice(0);p.active_effect_types=[],p.active_effect_flags=[],p.active_effect_flags.length=m.effect_types.length,p.bbox=new cr.rect(0,0,0,0),p.collcells=new cr.rect(0,0,-1,-1),p.rendercells=new cr.rect(0,0,-1,-1),p.bquad=new cr.quad,p.bbox_changed_callbacks=[],p.set_bbox_changed=cr.set_bbox_changed,p.add_bbox_changed_callback=cr.add_bbox_changed_callback,p.contains_pt=cr.inst_contains_pt,p.update_bbox=cr.update_bbox,p.update_render_cell=cr.update_render_cell,p.update_collision_cell=cr.update_collision_cell,p.get_zindex=cr.inst_get_zindex}for(p.tilemap_exists=!1,p.tilemap_width=0,p.tilemap_height=0,p.tilemap_data=null,14===f.length&&(p.tilemap_exists=!0,p.tilemap_width=f[13][0],p.tilemap_height=f[13][1],p.tilemap_data=f[13][2]),r=0,a=m.effect_types.length;r<a;r++)p.active_effect_flags[r]=!0;p.shaders_preserve_opaqueness=!0,p.updateActiveEffects=cr.inst_updateActiveEffects,p.updateActiveEffects(),p.uses_shaders=!!p.active_effect_types.length,p.bbox_changed=!0,p.cell_changed=!0,m.any_cell_changed=!0,p.visible=!0,p.my_timescale=-1,p.layer=e,p.zindex=e.instances.length,p.earlyz_index=0,void 0===p.collision_poly&&(p.collision_poly=null),p.collisionsEnabled=!0,this.redraw=!0}for(cr.clearArray(v),r=0,a=m.families.length;r<a;r++)v.push.apply(v,m.families[r].behaviors);if(v.push.apply(v,m.behaviors),p.recycled)for(r=0,a=v.length;r<a;r++){var x=v[r];for((g=p.behavior_insts[r]).recycled=!0,x.behavior.Instance.call(g,x,p),h=0,c=(y=t[4][r]).length;h<c;h++)g.properties[h]=y[h];g.onCreate(),x.behavior.my_instances.add(p)}else for(p.behavior_insts=[],r=0,a=v.length;r<a;r++){var g;(g=new(x=v[r]).behavior.Instance(x,p)).recycled=!1,g.properties=t[4][r].slice(0),g.onCreate(),cr.seal(g),p.behavior_insts.push(g),x.behavior.my_instances.add(p)}if(y=t[5],p.recycled)for(r=0,a=y.length;r<a;r++)p.properties[r]=y[r];else p.properties=y.slice(0);if(this.createRow.push(p),this.hasPendingInstances=!0,e&&(e.appendToInstanceList(p,!0),1===e.parallaxX&&1===e.parallaxY||(m.any_instance_parallaxed=!0)),this.objectcount++,m.is_contained){if(p.is_contained=!0,p.recycled?cr.clearArray(p.siblings):p.siblings=[],!i&&!n){for(r=0,a=m.container.length;r<a;r++)if(m.container[r]!==m){if(!m.container[r].default_instance)return null;p.siblings.push(this.createInstanceFromInit(m.container[r].default_instance,d,!1,u?p.x:o,u?p.y:s,!0))}for(r=0,a=p.siblings.length;r<a;r++)for(p.siblings[r].siblings.push(p),h=0;h<a;h++)r!==h&&p.siblings[r].siblings.push(p.siblings[h])}}else p.is_contained=!1,p.siblings=null;for(p.onCreate(),p.recycled||cr.seal(p),r=0,a=p.behavior_insts.length;r<a;r++)p.behavior_insts[r].postCreate&&p.behavior_insts[r].postCreate();return p},e.prototype.getLayerByName=function(t){var e,i;for(e=0,i=this.running_layout.layers.length;e<i;e++){var o=this.running_layout.layers[e];if(cr.equals_nocase(o.name,t))return o}return null},e.prototype.getLayerByNumber=function(t){return(t=cr.floor(t))<0&&(t=0),t>=this.running_layout.layers.length&&(t=this.running_layout.layers.length-1),this.running_layout.layers[t]},e.prototype.getLayer=function(t){return cr.is_number(t)?this.getLayerByNumber(t):this.getLayerByName(t.toString())},e.prototype.clearSol=function(t){var e,i;for(e=0,i=t.length;e<i;e++)t[e].getCurrentSol().select_all=!0},e.prototype.pushCleanSol=function(t){var e,i;for(e=0,i=t.length;e<i;e++)t[e].pushCleanSol()},e.prototype.pushCopySol=function(t){var e,i;for(e=0,i=t.length;e<i;e++)t[e].pushCopySol()},e.prototype.popSol=function(t){var e,i;for(e=0,i=t.length;e<i;e++)t[e].popSol()},e.prototype.updateAllCells=function(t){if(t.any_cell_changed){var e,i,o=t.instances;for(e=0,i=o.length;e<i;++e)o[e].update_collision_cell();var s=this.createRow;for(e=0,i=s.length;e<i;++e)s[e].type===t&&s[e].update_collision_cell();t.any_cell_changed=!1}},e.prototype.getCollisionCandidates=function(t,e,i,o){var s,n,r,a=!!t&&(1!==t.parallaxX||1!==t.parallaxY);if(e.is_family)for(s=0,n=e.members.length;s<n;++s)r=e.members[s],a||r.any_instance_parallaxed?cr.appendArray(o,r.instances):(this.updateAllCells(r),r.collision_grid.queryRange(i,o));else a||e.any_instance_parallaxed?cr.appendArray(o,e.instances):(this.updateAllCells(e),e.collision_grid.queryRange(i,o))},e.prototype.getTypesCollisionCandidates=function(t,e,i,o){var s,n;for(s=0,n=e.length;s<n;++s)this.getCollisionCandidates(t,e[s],i,o)},e.prototype.getSolidCollisionCandidates=function(t,e,i){var o=this.getSolidBehavior();if(!o)return null;this.getTypesCollisionCandidates(t,o.my_types,e,i)},e.prototype.getJumpthruCollisionCandidates=function(t,e,i){var o=this.getJumpthruBehavior();if(!o)return null;this.getTypesCollisionCandidates(t,o.my_types,e,i)},e.prototype.testAndSelectCanvasPointOverlap=function(t,e,i,o){var s,n,r,a,h,c,l,m=t.getCurrentSol(),u=this.getCurrentEventStack().current_event.orblock;if(m.select_all)for(o||(m.select_all=!1,cr.clearArray(m.instances)),s=0,a=t.instances.length;s<a;s++)if((r=t.instances[s]).update_bbox(),h=r.layer.canvasToLayer(e,i,!0),c=r.layer.canvasToLayer(e,i,!1),r.contains_pt(h,c)){if(o)return!1;m.instances.push(r)}else u&&m.else_instances.push(r);else{for(n=0,s=0,a=(l=u?m.else_instances:m.instances).length;s<a;s++)if((r=l[s]).update_bbox(),h=r.layer.canvasToLayer(e,i,!0),c=r.layer.canvasToLayer(e,i,!1),r.contains_pt(h,c)){if(o)return!1;u?m.instances.push(r):(m.instances[n]=m.instances[s],n++)}o||(l.length=n)}return t.applySolToContainer(),!!o||m.hasObjects()},e.prototype.testOverlap=function(t,e){if(!(t&&e&&t!==e&&t.collisionsEnabled&&e.collisionsEnabled))return!1;t.update_bbox(),e.update_bbox();var i,o,s,n,r,a,h,c,l,m,u=t.layer,p=e.layer;if(u!==p&&(u.parallaxX!==p.parallaxX||p.parallaxY!=p.parallaxY||u.scale!==p.scale||u.angle!==p.angle||u.zoomRate!==p.zoomRate)){for(h=t.collision_poly&&!t.collision_poly.is_empty(),c=e.collision_poly&&!e.collision_poly.is_empty(),h?(t.collision_poly.cache_poly(t.width,t.height,t.angle),this.temp_poly.set_from_poly(t.collision_poly)):this.temp_poly.set_from_quad(t.bquad,t.x,t.y,t.width,t.height),l=this.temp_poly,c?(e.collision_poly.cache_poly(e.width,e.height,e.angle),this.temp_poly2.set_from_poly(e.collision_poly)):this.temp_poly2.set_from_quad(e.bquad,e.x,e.y,e.width,e.height),m=this.temp_poly2,i=0,o=l.pts_count;i<o;i++)n=(s=2*i)+1,r=l.pts_cache[s],a=l.pts_cache[n],l.pts_cache[s]=u.layerToCanvas(r+t.x,a+t.y,!0),l.pts_cache[n]=u.layerToCanvas(r+t.x,a+t.y,!1);for(l.update_bbox(),i=0,o=m.pts_count;i<o;i++)n=(s=2*i)+1,r=m.pts_cache[s],a=m.pts_cache[n],m.pts_cache[s]=p.layerToCanvas(r+e.x,a+e.y,!0),m.pts_cache[n]=p.layerToCanvas(r+e.x,a+e.y,!1);return m.update_bbox(),l.intersects_poly(m,0,0)}return!!t.bbox.intersects_rect(e.bbox)&&(!!t.bquad.intersects_quad(e.bquad)&&((!t.tilemap_exists||!e.tilemap_exists)&&(t.tilemap_exists?this.testTilemapOverlap(t,e):e.tilemap_exists?this.testTilemapOverlap(e,t):(h=t.collision_poly&&!t.collision_poly.is_empty(),c=e.collision_poly&&!e.collision_poly.is_empty(),!h&&!c||(h?(t.collision_poly.cache_poly(t.width,t.height,t.angle),l=t.collision_poly):(this.temp_poly.set_from_quad(t.bquad,t.x,t.y,t.width,t.height),l=this.temp_poly),c?(e.collision_poly.cache_poly(e.width,e.height,e.angle),m=e.collision_poly):(this.temp_poly.set_from_quad(e.bquad,e.x,e.y,e.width,e.height),m=this.temp_poly),l.intersects_poly(m,e.x-t.x,e.y-t.y))))))};var B=new cr.quad,D=new cr.rect(0,0,0,0),w=[];e.prototype.testTilemapOverlap=function(t,e){var i,o,s,n,r=e.bbox,a=t.x,h=t.y;t.getCollisionRectCandidates(r,w);var c=w,l=e.collision_poly&&!e.collision_poly.is_empty();for(i=0,o=c.length;i<o;++i)if(n=(s=c[i]).rc,r.intersects_rect_off(n,a,h)&&(B.set_from_rect(n),B.offset(a,h),B.intersects_quad(e.bquad)))if(l){if(e.collision_poly.cache_poly(e.width,e.height,e.angle),s.poly){if(s.poly.intersects_poly(e.collision_poly,e.x-(a+n.left),e.y-(h+n.top)))return cr.clearArray(w),!0}else if(this.temp_poly.set_from_quad(B,0,0,n.right-n.left,n.bottom-n.top),this.temp_poly.intersects_poly(e.collision_poly,e.x,e.y))return cr.clearArray(w),!0}else{if(!s.poly)return cr.clearArray(w),!0;if(this.temp_poly.set_from_quad(e.bquad,0,0,e.width,e.height),s.poly.intersects_poly(this.temp_poly,-(a+n.left),-(h+n.top)))return cr.clearArray(w),!0}return cr.clearArray(w),!1},e.prototype.testRectOverlap=function(t,e){if(!e||!e.collisionsEnabled)return!1;e.update_bbox();e.layer;if(!e.bbox.intersects_rect(t))return!1;if(e.tilemap_exists){e.getCollisionRectCandidates(t,w);var i,o,s,n,r=w,a=e.x,h=e.y;for(i=0,o=r.length;i<o;++i)if(n=(s=r[i]).rc,t.intersects_rect_off(n,a,h)){if(!s.poly)return cr.clearArray(w),!0;if(this.temp_poly.set_from_rect(t,0,0),s.poly.intersects_poly(this.temp_poly,-(a+n.left),-(h+n.top)))return cr.clearArray(w),!0}return cr.clearArray(w),!1}return B.set_from_rect(t),!!e.bquad.intersects_quad(B)&&(!(e.collision_poly&&!e.collision_poly.is_empty())||(e.collision_poly.cache_poly(e.width,e.height,e.angle),B.offset(-t.left,-t.top),this.temp_poly.set_from_quad(B,0,0,1,1),e.collision_poly.intersects_poly(this.temp_poly,t.left-e.x,t.top-e.y)))},e.prototype.testSegmentOverlap=function(t,e,i,o,s){if(!s||!s.collisionsEnabled)return!1;s.update_bbox();s.layer;if(D.set(cr.min(t,i),cr.min(e,o),cr.max(t,i),cr.max(e,o)),!s.bbox.intersects_rect(D))return!1;if(s.tilemap_exists){s.getCollisionRectCandidates(D,w);var n,r,a,h,c=w,l=s.x,m=s.y;for(n=0,r=c.length;n<r;++n)if(h=(a=c[n]).rc,D.intersects_rect_off(h,l,m)&&(B.set_from_rect(h),B.offset(l,m),B.intersects_segment(t,e,i,o))){if(!a.poly)return cr.clearArray(w),!0;if(a.poly.intersects_segment(l+h.left,m+h.top,t,e,i,o))return cr.clearArray(w),!0}return cr.clearArray(w),!1}return!!s.bquad.intersects_segment(t,e,i,o)&&(!(s.collision_poly&&!s.collision_poly.is_empty())||(s.collision_poly.cache_poly(s.width,s.height,s.angle),s.collision_poly.intersects_segment(s.x,s.y,t,e,i,o)))},e.prototype.typeHasBehavior=function(t,e){if(!e)return!1;var i,o,s,n,r;for(i=0,o=t.behaviors.length;i<o;i++)if(t.behaviors[i].behavior instanceof e)return!0;if(!t.is_family)for(i=0,o=t.families.length;i<o;i++)for(s=0,n=(r=t.families[i]).behaviors.length;s<n;s++)if(r.behaviors[s].behavior instanceof e)return!0;return!1},e.prototype.typeHasNoSaveBehavior=function(t){return this.typeHasBehavior(t,cr.behaviors.NoSave)},e.prototype.typeHasPersistBehavior=function(t){return this.typeHasBehavior(t,cr.behaviors.Persist)},e.prototype.getSolidBehavior=function(){return this.solidBehavior},e.prototype.getJumpthruBehavior=function(){return this.jumpthruBehavior};var C=[];e.prototype.testOverlapSolid=function(t){var e,i,o;for(t.update_bbox(),this.getSolidCollisionCandidates(t.layer,t.bbox,C),e=0,i=C.length;e<i;++e)if((o=C[e]).extra.solidEnabled&&this.testOverlap(t,o))return cr.clearArray(C),o;return cr.clearArray(C),null},e.prototype.testRectOverlapSolid=function(t){var e,i,o;for(this.getSolidCollisionCandidates(null,t,C),e=0,i=C.length;e<i;++e)if((o=C[e]).extra.solidEnabled&&this.testRectOverlap(t,o))return cr.clearArray(C),o;return cr.clearArray(C),null};var S=[];e.prototype.testOverlapJumpThru=function(t,e){var i,o,s,n=null;for(e&&(n=S,cr.clearArray(n)),t.update_bbox(),this.getJumpthruCollisionCandidates(t.layer,t.bbox,C),i=0,o=C.length;i<o;++i)if((s=C[i]).extra.jumpthruEnabled&&this.testOverlap(t,s)){if(!e)return cr.clearArray(C),s;n.push(s)}return cr.clearArray(C),n},e.prototype.pushOutSolid=function(t,e,i,o,s,n){var r,a=o||50,h=t.x,c=t.y,l=null,m=null;for(r=0;r<a;r++)if(t.x=h+e*r,t.y=c+i*r,t.set_bbox_changed(),!this.testOverlap(t,l)&&((l=this.testOverlapSolid(t))&&(m=l),!l&&(s&&(l=n?this.testOverlap(t,n)?n:null:this.testOverlapJumpThru(t))&&(m=l),!l)))return m&&this.pushInFractional(t,e,i,m,16),!0;return t.x=h,t.y=c,t.set_bbox_changed(),!1},e.prototype.pushOutSolidAxis=function(t,e,i,o){o=o||50;var s,n,r,a=t.x,h=t.y,c=null,l=null;for(s=0;s<o;++s)for(n=0;n<2;++n)if(r=2*n-1,t.x=a+e*s*r,t.y=h+i*s*r,t.set_bbox_changed(),!this.testOverlap(t,c)){if(!(c=this.testOverlapSolid(t)))return l&&this.pushInFractional(t,e*r,i*r,l,16),!0;l=c}return t.x=a,t.y=h,t.set_bbox_changed(),!1},e.prototype.pushOut=function(t,e,i,o,s){var n,r=o||50,a=t.x,h=t.y;for(n=0;n<r;n++)if(t.x=a+e*n,t.y=h+i*n,t.set_bbox_changed(),!this.testOverlap(t,s))return!0;return t.x=a,t.y=h,t.set_bbox_changed(),!1},e.prototype.pushInFractional=function(t,e,i,o,s){for(var n,r=2,a=!1,h=!1,c=t.x,l=t.y;r<=s;)n=1/r,r*=2,t.x+=e*n*(a?1:-1),t.y+=i*n*(a?1:-1),t.set_bbox_changed(),this.testOverlap(t,o)?(a=!0,h=!0):(a=!1,h=!1,c=t.x,l=t.y);h&&(t.x=c,t.y=l,t.set_bbox_changed())},e.prototype.pushOutSolidNearest=function(t,e){var i=cr.is_undefined(e)?100:e,o=0,s=t.x,n=t.y,r=0,a=0,h=0,c=this.testOverlapSolid(t);if(!c)return!0;for(;o<=i;){switch(r){case 0:a=0,h=-1,o++;break;case 1:a=1,h=-1;break;case 2:a=1,h=0;break;case 3:a=1,h=1;break;case 4:a=0,h=1;break;case 5:a=-1,h=1;break;case 6:a=-1,h=0;break;case 7:a=-1,h=-1}if(r=(r+1)%8,t.x=cr.floor(s+a*o),t.y=cr.floor(n+h*o),t.set_bbox_changed(),!this.testOverlap(t,c)&&!(c=this.testOverlapSolid(t)))return!0}return t.x=s,t.y=n,t.set_bbox_changed(),!1},e.prototype.registerCollision=function(t,e){t.collisionsEnabled&&e.collisionsEnabled&&this.registered_collisions.push([t,e])},e.prototype.addRegisteredCollisionCandidates=function(t,e,i){var o,s,n,r;for(o=0,s=this.registered_collisions.length;o<s;++o){if((n=this.registered_collisions[o])[0]===t)r=n[1];else{if(n[1]!==t)continue;r=n[0]}if(e.is_family){if(-1===e.members.indexOf(e))continue}else if(r.type!==e)continue;-1===i.indexOf(r)&&i.push(r)}},e.prototype.checkRegisteredCollision=function(t,e){var i,o,s;for(i=0,o=this.registered_collisions.length;i<o;i++)if((s=this.registered_collisions[i])[0]===t&&s[1]===e||s[0]===e&&s[1]===t)return!0;return!1},e.prototype.calculateSolidBounceAngle=function(t,e,i,o){var s=t.x,n=t.y,r=cr.max(10,cr.distanceTo(e,i,s,n)),a=cr.angleTo(e,i,s,n),h=o||this.testOverlapSolid(t);if(!h)return cr.clamp_angle(a+cr.PI);var c,l,m,u,p=h,d=cr.to_radians(5);for(c=1;c<36;c++)if(l=a-c*d,t.x=e+Math.cos(l)*r,t.y=i+Math.sin(l)*r,t.set_bbox_changed(),!this.testOverlap(t,p)&&!(p=o?null:this.testOverlapSolid(t))){m=l;break}36===c&&(m=cr.clamp_angle(a+cr.PI));p=h;for(c=1;c<36;c++)if(l=a+c*d,t.x=e+Math.cos(l)*r,t.y=i+Math.sin(l)*r,t.set_bbox_changed(),!this.testOverlap(t,p)&&!(p=o?null:this.testOverlapSolid(t))){u=l;break}if(36===c&&(u=cr.clamp_angle(a+cr.PI)),t.x=s,t.y=n,t.set_bbox_changed(),u===m)return u;var y,_=cr.angleDiff(u,m)/2;y=cr.angleClockwise(u,m)?cr.clamp_angle(m+_+cr.PI):cr.clamp_angle(u+_);var f=Math.cos(a),x=Math.sin(a),g=Math.cos(y),b=Math.sin(y),v=f*g+x*b,B=f-2*v*g,D=x-2*v*b;return cr.angleTo(0,0,B,D)};var A=-1;function M(){try{return!!window.indexedDB}catch(t){return!1}}function T(t){t.target.result.createObjectStore("saves",{keyPath:"slot"})}function I(){cr.logexport("Reloading for continuous preview"),window.c2cocoonjs?CocoonJS.App.reload():window.location.search.indexOf("continuous")>-1?window.location.reload(!0):window.location=window.location+"?continuous"}function P(t){var e,i={};for(e in t)if(t.hasOwnProperty(e)){if(t[e]instanceof cr.ObjectSet)continue;if(t[e]&&void 0!==t[e].c2userdata)continue;if("spriteCreatedDestroyCallback"===e)continue;i[e]=t[e]}return i}e.prototype.trigger=function(t,e,i){if(!this.running_layout)return!1;var o=this.running_layout.event_sheet;if(!o)return!1;var s,n,r,a=!1;A++;var h=o.deep_includes;for(n=0,r=h.length;n<r;++n)s=this.triggerOnSheet(t,e,h[n],i),a=a||s;return s=this.triggerOnSheet(t,e,o,i),A--,a=a||s},e.prototype.triggerOnSheet=function(t,e,i,o){var s,n,r,a,h=!1;if(e)for(r=this.triggerOnSheetForTypeName(t,e,e.type.name,i,o),h=h||r,s=0,n=(a=e.type.families).length;s<n;++s)r=this.triggerOnSheetForTypeName(t,e,a[s].name,i,o),h=h||r;else r=this.triggerOnSheetForTypeName(t,e,"system",i,o),h=h||r;return h},e.prototype.triggerOnSheetForTypeName=function(t,e,i,o,s){var n,r,a,h,c=!1,l=!1,m=void 0!==s,u=(m?o.fasttriggers:o.triggers)[i];if(!u)return c;var p,d=null;for(n=0,r=u.length;n<r;++n)if(u[n].method==t){d=u[n].evs;break}if(!d)return c;if(!(p=m?d[s]:d))return null;for(n=0,r=p.length;n<r;n++)a=p[n][0],h=p[n][1],l=this.executeSingleTrigger(e,i,a,h),c=c||l;return c},e.prototype.executeSingleTrigger=function(t,e,i,o){var s,n,r=!1;this.trigger_depth++;var a=this.getCurrentEventStack().current_event;a&&this.pushCleanSol(a.solModifiersIncludingParents);var h=this.trigger_depth>1;this.pushCleanSol(i.solModifiersIncludingParents),h&&this.pushLocalVarStack();var c=this.pushEventStack(i);if(c.current_event=i,t){var l=this.types[e].getCurrentSol();l.select_all=!1,cr.clearArray(l.instances),l.instances[0]=t,this.types[e].applySolToContainer()}var m=!0;if(i.parent){for(var u=c.temp_parents_arr,p=i.parent;p;)u.push(p),p=p.parent;for(u.reverse(),s=0,n=u.length;s<n;s++)if(!u[s].run_pretrigger()){m=!1;break}}return m&&(this.execcount++,i.orblock?i.run_orblocktrigger(o):i.run(),r=r||c.last_event_true),this.popEventStack(),h&&this.popLocalVarStack(),this.popSol(i.solModifiersIncludingParents),a&&this.popSol(a.solModifiersIncludingParents),this.hasPendingInstances&&0===this.isInOnDestroy&&0===A&&!this.isRunningEvents&&this.ClearDeathRow(),this.trigger_depth--,r},e.prototype.getCurrentCondition=function(){var t=this.getCurrentEventStack();return t.current_event.conditions[t.cndindex]},e.prototype.getCurrentConditionObjectType=function(){return this.getCurrentCondition().type},e.prototype.isCurrentConditionFirst=function(){return 0===this.getCurrentEventStack().cndindex},e.prototype.getCurrentAction=function(){var t=this.getCurrentEventStack();return t.current_event.actions[t.actindex]},e.prototype.pushLocalVarStack=function(){this.localvar_stack_index++,this.localvar_stack_index>=this.localvar_stack.length&&this.localvar_stack.push([])},e.prototype.popLocalVarStack=function(){this.localvar_stack_index--},e.prototype.getCurrentLocalVarStack=function(){return this.localvar_stack[this.localvar_stack_index]},e.prototype.pushEventStack=function(t){this.event_stack_index++,this.event_stack_index>=this.event_stack.length&&this.event_stack.push(new cr.eventStackFrame);var e=this.getCurrentEventStack();return e.reset(t),e},e.prototype.popEventStack=function(){this.event_stack_index--},e.prototype.getCurrentEventStack=function(){return this.event_stack[this.event_stack_index]},e.prototype.pushLoopStack=function(t){this.loop_stack_index++,this.loop_stack_index>=this.loop_stack.length&&this.loop_stack.push(cr.seal({name:t,index:0,stopped:!1}));var e=this.getCurrentLoop();return e.name=t,e.index=0,e.stopped=!1,e},e.prototype.popLoopStack=function(){this.loop_stack_index--},e.prototype.getCurrentLoop=function(){return this.loop_stack[this.loop_stack_index]},e.prototype.getEventVariableByName=function(t,e){for(var i,o,s,n,r,a;e;){for(i=0,o=e.subevents.length;i<o;i++)if((a=e.subevents[i])instanceof cr.eventvariable&&cr.equals_nocase(t,a.name))return a;e=e.parent}for(i=0,o=this.eventsheets_by_index.length;i<o;i++)for(s=0,n=(r=this.eventsheets_by_index[i]).events.length;s<n;s++)if((a=r.events[s])instanceof cr.eventvariable&&cr.equals_nocase(t,a.name))return a;return null},e.prototype.getLayoutBySid=function(t){var e,i;for(e=0,i=this.layouts_by_index.length;e<i;e++)if(this.layouts_by_index[e].sid===t)return this.layouts_by_index[e];return null},e.prototype.getObjectTypeBySid=function(t){var e,i;for(e=0,i=this.types_by_index.length;e<i;e++)if(this.types_by_index[e].sid===t)return this.types_by_index[e];return null},e.prototype.getGroupBySid=function(t){var e,i;for(e=0,i=this.allGroups.length;e<i;e++)if(this.allGroups[e].sid===t)return this.allGroups[e];return null},e.prototype.doCanvasSnapshot=function(t,e){this.snapshotCanvas=[t,e],this.redraw=!0},e.prototype.signalContinuousPreview=function(){this.signalledContinuousPreview=!0},e.prototype.handleSaveLoad=function(){var t=this,e=this.saveToSlot,i=this.lastSaveJson,o=this.loadFromSlot,s=!1;if(this.signalledContinuousPreview&&(s=!0,e="__c2_continuouspreview",this.signalledContinuousPreview=!1),e.length){if(this.ClearDeathRow(),i=this.saveToJSONString(),M()&&!this.isCocoonJs)!function(t,e,i,o){try{var s=indexedDB.open("_C2SaveStates");s.onupgradeneeded=T,s.onerror=o,s.onsuccess=function(s){var n=s.target.result;n.onerror=o,n.transaction(["saves"],"readwrite").objectStore("saves").put({slot:t,data:e}).onsuccess=i}}catch(t){o(t)}}(e,i,function(){cr.logexport("Saved state to IndexedDB storage ("+i.length+" bytes)"),t.lastSaveJson=i,t.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),t.lastSaveJson="",s&&I()},function(o){try{localStorage.setItem("__c2save_"+e,i),cr.logexport("Saved state to WebStorage ("+i.length+" bytes)"),t.lastSaveJson=i,t.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),t.lastSaveJson="",s&&I()}catch(e){cr.logexport("Failed to save game state: "+o+"; "+e),t.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}});else try{localStorage.setItem("__c2save_"+e,i),cr.logexport("Saved state to WebStorage ("+i.length+" bytes)"),t.lastSaveJson=i,this.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),t.lastSaveJson="",s&&I()}catch(e){cr.logexport("Error saving to WebStorage: "+e),t.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}this.saveToSlot="",this.loadFromSlot="",this.loadFromJson=null}if(o.length){if(M()&&!this.isCocoonJs)!function(t,e,i){try{var o=indexedDB.open("_C2SaveStates");o.onupgradeneeded=T,o.onerror=i,o.onsuccess=function(o){var s=o.target.result;s.onerror=i;var n=s.transaction(["saves"]).objectStore("saves").get(t);n.onsuccess=function(t){n.result?e(n.result.data):e(null)}}}catch(t){i(t)}}(o,function(e){e?(t.loadFromJson=e,cr.logexport("Loaded state from IndexedDB storage ("+t.loadFromJson.length+" bytes)")):(t.loadFromJson=localStorage.getItem("__c2save_"+o)||"",cr.logexport("Loaded state from WebStorage ("+t.loadFromJson.length+" bytes)")),t.suspendDrawing=!1,t.loadFromJson||(t.loadFromJson=null,t.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))},function(e){t.loadFromJson=localStorage.getItem("__c2save_"+o)||"",cr.logexport("Loaded state from WebStorage ("+t.loadFromJson.length+" bytes)"),t.suspendDrawing=!1,t.loadFromJson||(t.loadFromJson=null,t.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))});else{try{this.loadFromJson=localStorage.getItem("__c2save_"+o)||"",cr.logexport("Loaded state from WebStorage ("+this.loadFromJson.length+" bytes)")}catch(t){this.loadFromJson=null}this.suspendDrawing=!1,t.loadFromJson||(t.loadFromJson=null,t.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))}this.loadFromSlot="",this.saveToSlot=""}null!==this.loadFromJson&&(this.ClearDeathRow(),this.loadFromJSONString(this.loadFromJson)?(this.lastSaveJson=this.loadFromJson,this.trigger(cr.system_object.prototype.cnds.OnLoadComplete,null),this.lastSaveJson=""):t.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null),this.loadFromJson=null)},e.prototype.saveToJSONString=function(){var t,e,i,o,s,n,r,a,h,c,l,m,u={c2save:!0,version:1,rt:{time:this.kahanTime.sum,walltime:this.wallTime.sum,timescale:this.timescale,tickcount:this.tickcount,execcount:this.execcount,next_uid:this.next_uid,running_layout:this.running_layout.sid,start_time_offset:Date.now()-this.start_time},types:{},layouts:{},events:{groups:{},cnds:{},acts:{},vars:{}}};for(t=0,e=this.types_by_index.length;t<e;t++)if(!(s=this.types_by_index[t]).is_family&&!this.typeHasNoSaveBehavior(s)){for(r={instances:[]},cr.hasAnyOwnProperty(s.extra)&&(r.ex=P(s.extra)),i=0,o=s.instances.length;i<o;i++)r.instances.push(this.saveInstanceToJSON(s.instances[i]));u.types[s.sid.toString()]=r}for(t=0,e=this.layouts_by_index.length;t<e;t++)n=this.layouts_by_index[t],u.layouts[n.sid.toString()]=n.saveToJSON();var p=u.events.groups;for(t=0,e=this.allGroups.length;t<e;t++)p[(a=this.allGroups[t]).sid.toString()]=this.groups_by_name[a.group_name].group_active;var d=u.events.cnds;for(m in this.cndsBySid)this.cndsBySid.hasOwnProperty(m)&&(h=this.cndsBySid[m],cr.hasAnyOwnProperty(h.extra)&&(d[m]={ex:P(h.extra)}));var y=u.events.acts;for(m in this.actsBySid)this.actsBySid.hasOwnProperty(m)&&(c=this.actsBySid[m],cr.hasAnyOwnProperty(c.extra)&&(y[m]={ex:P(c.extra)}));var _=u.events.vars;for(m in this.varsBySid)this.varsBySid.hasOwnProperty(m)&&((l=this.varsBySid[m]).is_constant||l.parent&&!l.is_static||(_[m]=l.data));return u.system=this.system.saveToJSON(),JSON.stringify(u)},e.prototype.refreshUidMap=function(){var t,e,i,o,s,n;for(this.objectsByUid={},t=0,e=this.types_by_index.length;t<e;t++)if(!(i=this.types_by_index[t]).is_family)for(o=0,s=i.instances.length;o<s;o++)n=i.instances[o],this.objectsByUid[n.uid.toString()]=n},e.prototype.loadFromJSONString=function(t){var e;try{e=JSON.parse(t)}catch(t){return!1}if(!e.c2save)return!1;if(e.version>1)return!1;this.isLoadingState=!0;var i=e.rt;this.kahanTime.reset(),this.kahanTime.sum=i.time,this.wallTime.reset(),this.wallTime.sum=i.walltime||0,this.timescale=i.timescale,this.tickcount=i.tickcount,this.execcount=i.execcount,this.start_time=Date.now()-i.start_time_offset;var o,s,n,r,a,h,c,l,m,u,p,d,y,_,f,x,g,b=i.running_layout;if(b!==this.running_layout.sid){var v=this.getLayoutBySid(b);if(!v)return;this.doChangeLayout(v)}var B=e.types;for(c in B)if(B.hasOwnProperty(c)){if(!(l=this.getObjectTypeBySid(parseInt(c,10)))||l.is_family||this.typeHasNoSaveBehavior(l))continue;for(B[c].ex?l.extra=B[c].ex:cr.wipe(l.extra),m=l.instances,u=B[c].instances,o=0,s=cr.min(m.length,u.length);o<s;o++)this.loadInstanceFromJSON(m[o],u[o]);for(o=u.length,s=m.length;o<s;o++)this.DestroyInstance(m[o]);for(o=m.length,s=u.length;o<s;o++)_=null,l.plugin.is_world&&!(_=this.running_layout.getLayerBySid(u[o].w.l))||(p=this.createInstanceFromInit(l.default_instance,_,!1,0,0,!0),this.loadInstanceFromJSON(p,u[o]));l.stale_iids=!0}this.ClearDeathRow(),this.refreshUidMap();var D=e.layouts;for(c in D)if(D.hasOwnProperty(c)){if(!(y=this.getLayoutBySid(parseInt(c,10))))continue;y.loadFromJSON(D[c])}var w=e.events.groups;for(c in w)w.hasOwnProperty(c)&&(f=this.getGroupBySid(parseInt(c,10)))&&this.groups_by_name[f.group_name]&&this.groups_by_name[f.group_name].setGroupActive(w[c]);var C=e.events.cnds;for(c in this.cndsBySid)this.cndsBySid.hasOwnProperty(c)&&(C.hasOwnProperty(c)?this.cndsBySid[c].extra=C[c].ex:this.cndsBySid[c].extra={});var S=e.events.acts;for(c in this.actsBySid)this.actsBySid.hasOwnProperty(c)&&(S.hasOwnProperty(c)?this.actsBySid[c].extra=S[c].ex:this.actsBySid[c].extra={});var A=e.events.vars;for(c in A)A.hasOwnProperty(c)&&this.varsBySid.hasOwnProperty(c)&&(this.varsBySid[c].data=A[c]);for(this.next_uid=i.next_uid,this.isLoadingState=!1,o=0,s=this.fireOnCreateAfterLoad.length;o<s;++o)p=this.fireOnCreateAfterLoad[o],this.trigger(Object.getPrototypeOf(p.type.plugin).cnds.OnCreated,p);for(cr.clearArray(this.fireOnCreateAfterLoad),this.system.loadFromJSON(e.system),o=0,s=this.types_by_index.length;o<s;o++)if(!(l=this.types_by_index[o]).is_family&&!this.typeHasNoSaveBehavior(l))for(n=0,r=l.instances.length;n<r;n++){if(p=l.instances[n],l.is_contained)for(x=p.get_iid(),cr.clearArray(p.siblings),a=0,h=l.container.length;a<h;a++)l!==(g=l.container[a])&&p.siblings.push(g.instances[x]);if(p.afterLoad&&p.afterLoad(),p.behavior_insts)for(a=0,h=p.behavior_insts.length;a<h;a++)(d=p.behavior_insts[a]).afterLoad&&d.afterLoad()}return this.redraw=!0,!0},e.prototype.saveInstanceToJSON=function(t,e){var i,o,s,n,r,a=t.type,h=a.plugin,c={};if(e?c.c2=!0:c.uid=t.uid,cr.hasAnyOwnProperty(t.extra)&&(c.ex=P(t.extra)),t.instance_vars&&t.instance_vars.length)for(c.ivs={},i=0,o=t.instance_vars.length;i<o;i++)c.ivs[t.type.instvar_sids[i].toString()]=t.instance_vars[i];if(h.is_world){if(s={x:t.x,y:t.y,w:t.width,h:t.height,l:t.layer.sid,zi:t.get_zindex()},0!==t.angle&&(s.a=t.angle),1!==t.opacity&&(s.o=t.opacity),.5!==t.hotspotX&&(s.hX=t.hotspotX),.5!==t.hotspotY&&(s.hY=t.hotspotY),0!==t.blend_mode&&(s.bm=t.blend_mode),t.visible||(s.v=t.visible),t.collisionsEnabled||(s.ce=t.collisionsEnabled),-1!==t.my_timescale&&(s.mts=t.my_timescale),a.effect_types.length)for(s.fx=[],i=0,o=a.effect_types.length;i<o;i++)r=a.effect_types[i],s.fx.push({name:r.name,active:t.active_effect_flags[r.index],params:t.effect_params[r.index]});c.w=s}if(t.behavior_insts&&t.behavior_insts.length)for(c.behs={},i=0,o=t.behavior_insts.length;i<o;i++)(n=t.behavior_insts[i]).saveToJSON&&(c.behs[n.type.sid.toString()]=n.saveToJSON());return t.saveToJSON&&(c.data=t.saveToJSON()),c},e.prototype.getInstanceVarIndexBySid=function(t,e){var i,o;for(i=0,o=t.instvar_sids.length;i<o;i++)if(t.instvar_sids[i]===e)return i;return-1},e.prototype.getBehaviorIndexBySid=function(t,e){var i,o;for(i=0,o=t.behavior_insts.length;i<o;i++)if(t.behavior_insts[i].type.sid===e)return i;return-1},e.prototype.loadInstanceFromJSON=function(t,e,i){var o,s,n,r,a,h,c,l,m,u,p,d=t.type,y=d.plugin;if(i){if(!e.c2)return}else t.uid=e.uid;if(e.ex?t.extra=e.ex:cr.wipe(t.extra),a=e.ivs)for(o in a)if(a.hasOwnProperty(o)){if((r=this.getInstanceVarIndexBySid(d,parseInt(o,10)))<0||r>=t.instance_vars.length)continue;null===(u=a[o])&&(u=NaN),t.instance_vars[r]=u}if(y.is_world){if(h=e.w,t.layer.sid!==h.l&&(p=t.layer,t.layer=this.running_layout.getLayerBySid(h.l),t.layer?(p.removeFromInstanceList(t,!0),t.layer.appendToInstanceList(t,!0),t.set_bbox_changed(),t.layer.setZIndicesStaleFrom(0)):(t.layer=p,i||this.DestroyInstance(t))),t.x=h.x,t.y=h.y,t.width=h.w,t.height=h.h,t.zindex=h.zi,t.angle=h.hasOwnProperty("a")?h.a:0,t.opacity=h.hasOwnProperty("o")?h.o:1,t.hotspotX=h.hasOwnProperty("hX")?h.hX:.5,t.hotspotY=h.hasOwnProperty("hY")?h.hY:.5,t.visible=!h.hasOwnProperty("v")||h.v,t.collisionsEnabled=!h.hasOwnProperty("ce")||h.ce,t.my_timescale=h.hasOwnProperty("mts")?h.mts:-1,t.blend_mode=h.hasOwnProperty("bm")?h.bm:0,t.compositeOp=cr.effectToCompositeOp(t.blend_mode),this.gl&&cr.setGLBlend(t,t.blend_mode,this.gl),t.set_bbox_changed(),h.hasOwnProperty("fx"))for(s=0,n=h.fx.length;s<n;s++)(c=d.getEffectIndexByName(h.fx[s].name))<0||(t.active_effect_flags[c]=h.fx[s].active,t.effect_params[c]=h.fx[s].params);t.updateActiveEffects()}if(l=e.behs)for(o in l)if(l.hasOwnProperty(o)){if((m=this.getBehaviorIndexBySid(t,parseInt(o,10)))<0)continue;t.behavior_insts[m].loadFromJSON(l[o])}e.data&&t.loadFromJSON(e.data)},e.prototype.fetchLocalFileViaCordova=function(t,e,i){var o=cordova.file.applicationDirectory+"www/"+t;window.resolveLocalFileSystemURL(o,function(t){t.file(e,i)},i)},e.prototype.fetchLocalFileViaCordovaAsText=function(t,e,i){this.fetchLocalFileViaCordova(t,function(t){var o=new FileReader;o.onload=function(t){e(t.target.result)},o.onerror=i,o.readAsText(t)},i)};var L=[],V=0;e.prototype.maybeStartNextArrayBufferRead=function(){if(L.length&&!(V>=8)){V++;var t=L.shift();this.doFetchLocalFileViaCordovaAsArrayBuffer(t.filename,t.successCallback,t.errorCallback)}},e.prototype.fetchLocalFileViaCordovaAsArrayBuffer=function(t,e,i){var o=this;L.push({filename:t,successCallback:function(t){V--,o.maybeStartNextArrayBufferRead(),e(t)},errorCallback:function(t){V--,o.maybeStartNextArrayBufferRead(),i(t)}}),this.maybeStartNextArrayBufferRead()},e.prototype.doFetchLocalFileViaCordovaAsArrayBuffer=function(t,e,i){this.fetchLocalFileViaCordova(t,function(t){var i=new FileReader;i.onload=function(t){e(t.target.result)},i.readAsArrayBuffer(t)},i)},e.prototype.fetchLocalFileViaCordovaAsURL=function(t,e,i){var o="",s=t.toLowerCase(),n=s.substr(s.length-4),r=s.substr(s.length-5);".mp4"===n?o="video/mp4":".webm"===r?o="video/webm":".m4a"===n?o="audio/mp4":".mp3"===n&&(o="audio/mpeg"),this.fetchLocalFileViaCordovaAsArrayBuffer(t,function(t){var i=new Blob([t],{type:o}),s=URL.createObjectURL(i);e(s)},i)},e.prototype.isAbsoluteUrl=function(t){return/^(?:[a-z]+:)?\/\//.test(t)||"data:"===t.substr(0,5)||"blob:"===t.substr(0,5)},e.prototype.setImageSrc=function(t,e){this.isWKWebView&&!this.isAbsoluteUrl(e)?this.fetchLocalFileViaCordovaAsURL(e,function(e){t.src=e},function(t){alert("Failed to load image: "+t)}):t.src=e},e.prototype.setCtxImageSmoothingEnabled=function(t,e){void 0!==t.imageSmoothingEnabled?t.imageSmoothingEnabled=e:(t.webkitImageSmoothingEnabled=e,t.mozImageSmoothingEnabled=e,t.msImageSmoothingEnabled=e)},cr.runtime=e,cr.createRuntime=function(t){return new e(document.getElementById(t))},cr.createDCRuntime=function(t,i){return new e({dc:!0,width:t,height:i})},window.cr_createRuntime=cr.createRuntime,window.cr_createDCRuntime=cr.createDCRuntime,window.createCocoonJSRuntime=function(){window.c2cocoonjs=!0;var t=document.createElement("screencanvas")||document.createElement("canvas");t.screencanvas=!0,document.body.appendChild(t);var i=new e(t);return window.c2runtime=i,window.addEventListener("orientationchange",function(){window.c2runtime.setSize(window.innerWidth,window.innerHeight)}),window.c2runtime.setSize(window.innerWidth,window.innerHeight),i},window.createEjectaRuntime=function(){var t=new e(document.getElementById("canvas"));return window.c2runtime=t,window.c2runtime.setSize(window.innerWidth,window.innerHeight),t}}(),window.cr_getC2Runtime=function(){var t=document.getElementById("c2canvas");return t?t.c2runtime:window.c2runtime?window.c2runtime:null},window.cr_getSnapshot=function(t,e){var i=window.cr_getC2Runtime();i&&i.doCanvasSnapshot(t,e)},window.cr_sizeCanvas=function(t,e){if(0!==t&&0!==e){var i=window.cr_getC2Runtime();i&&i.setSize(t,e)}},window.cr_setSuspended=function(t){var e=window.cr_getC2Runtime();e&&e.setSuspended(t)},function(){function t(t,e){this.runtime=t,this.event_sheet=null,this.scrollX=this.runtime.original_width/2,this.scrollY=this.runtime.original_height/2,this.scale=1,this.angle=0,this.first_visit=!0,this.name=e[0],this.originalWidth=e[1],this.originalHeight=e[2],this.width=e[1],this.height=e[2],this.unbounded_scrolling=e[3],this.sheetname=e[4],this.sid=e[5];var i,o,s=e[6];for(this.layers=[],this.initial_types=[],i=0,o=s.length;i<o;i++){var n=new cr.layer(this,s[i]);n.number=i,cr.seal(n),this.layers.push(n)}var r=e[7];for(this.initial_nonworld=[],i=0,o=r.length;i<o;i++){var a=r[i],h=this.runtime.types_by_index[a[1]];h.default_instance||(h.default_instance=a),this.initial_nonworld.push(a),-1===this.initial_types.indexOf(h)&&this.initial_types.push(h)}for(this.effect_types=[],this.active_effect_types=[],this.shaders_preserve_opaqueness=!0,this.effect_params=[],i=0,o=e[8].length;i<o;i++)this.effect_types.push({id:e[8][i][0],name:e[8][i][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:i}),this.effect_params.push(e[8][i][2].slice(0));this.updateActiveEffects(),this.rcTex=new cr.rect(0,0,1,1),this.rcTex2=new cr.rect(0,0,1,1),this.persist_data={}}t.prototype.saveObjectToPersist=function(t){var e=t.type.sid.toString();this.persist_data.hasOwnProperty(e)||(this.persist_data[e]=[]),this.persist_data[e].push(this.runtime.saveInstanceToJSON(t))},t.prototype.hasOpaqueBottomLayer=function(){var t=this.layers[0];return!t.transparent&&1===t.opacity&&!t.forceOwnTexture&&t.visible},t.prototype.updateActiveEffects=function(){var t,e,i;for(cr.clearArray(this.active_effect_types),this.shaders_preserve_opaqueness=!0,t=0,e=this.effect_types.length;t<e;t++)(i=this.effect_types[t]).active&&(this.active_effect_types.push(i),i.preservesOpaqueness||(this.shaders_preserve_opaqueness=!1))},t.prototype.getEffectByName=function(t){var e,i,o;for(e=0,i=this.effect_types.length;e<i;e++)if((o=this.effect_types[e]).name===t)return o;return null};var e=[];function i(t,e){return t.zindex-e.zindex}var o=!0;t.prototype.startRunning=function(){var t,s,n,r,a,h,c,l,m,u,p,d,y,_;for(this.sheetname&&(this.event_sheet=this.runtime.eventsheets[this.sheetname],this.event_sheet.updateDeepIncludes()),this.runtime.running_layout=this,this.width=this.originalWidth,this.height=this.originalHeight,this.scrollX=this.runtime.original_width/2,this.scrollY=this.runtime.original_height/2,t=0,n=this.runtime.types_by_index.length;t<n;t++)if(!(a=this.runtime.types_by_index[t]).is_family)for(s=0,r=(h=a.instances).length;s<r;s++)if((l=h[s]).layer){var f=l.layer.number;f>=this.layers.length&&(f=this.layers.length-1),l.layer=this.layers[f],-1===l.layer.instances.indexOf(l)&&l.layer.instances.push(l),l.layer.zindices_stale=!0}if(!o)for(t=0,n=this.layers.length;t<n;++t)this.layers[t].instances.sort(i);for(cr.clearArray(e),this.boundScrolling(),t=0,n=this.layers.length;t<n;t++)(_=this.layers[t]).createInitialInstances(),_.updateViewport(null);var x=!1;if(!this.first_visit){for(d in this.persist_data)if(this.persist_data.hasOwnProperty(d)){if(!(a=this.runtime.getObjectTypeBySid(parseInt(d,10)))||a.is_family||!this.runtime.typeHasPersistBehavior(a))continue;for(t=0,n=(y=this.persist_data[d]).length;t<n;t++)_=null,a.plugin.is_world&&!(_=this.getLayerBySid(y[t].w.l))||(l=this.runtime.createInstanceFromInit(a.default_instance,_,!1,0,0,!0),this.runtime.loadInstanceFromJSON(l,y[t]),x=!0,e.push(l));cr.clearArray(y)}for(t=0,n=this.layers.length;t<n;t++)this.layers[t].instances.sort(i),this.layers[t].zindices_stale=!0}for(x&&(this.runtime.ClearDeathRow(),this.runtime.refreshUidMap()),t=0;t<e.length;t++)if((l=e[t]).type.is_contained)for(m=l.get_iid(),s=0,r=l.type.container.length;s<r;s++)u=l.type.container[s],l.type!==u&&(u.instances.length>m?l.siblings.push(u.instances[m]):u.default_instance&&(p=this.runtime.createInstanceFromInit(u.default_instance,l.layer,!0,l.x,l.y,!0),this.runtime.ClearDeathRow(),u.updateIIDs(),l.siblings.push(p),e.push(p)));for(t=0,n=this.initial_nonworld.length;t<n;t++)c=this.initial_nonworld[t],(a=this.runtime.types_by_index[c[1]]).is_contained||(l=this.runtime.createInstanceFromInit(this.initial_nonworld[t],null,!0));if(this.runtime.changelayout=null,this.runtime.ClearDeathRow(),this.runtime.ctx&&!this.runtime.isDomFree)for(t=0,n=this.runtime.types_by_index.length;t<n;t++)!(u=this.runtime.types_by_index[t]).is_family&&u.instances.length&&u.preloadCanvas2D&&u.preloadCanvas2D(this.runtime.ctx);if(this.runtime.isLoadingState)cr.shallowAssignArray(this.runtime.fireOnCreateAfterLoad,e);else for(t=0,n=e.length;t<n;t++)l=e[t],this.runtime.trigger(Object.getPrototypeOf(l.type.plugin).cnds.OnCreated,l);cr.clearArray(e),this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutStart,null),this.first_visit=!1},t.prototype.createGlobalNonWorlds=function(){var t,e,i,o,s;for(t=0,e=0,i=this.initial_nonworld.length;t<i;t++)o=this.initial_nonworld[t],(s=this.runtime.types_by_index[o[1]]).global?s.is_contained||this.runtime.createInstanceFromInit(o,null,!0):(this.initial_nonworld[e]=o,e++);cr.truncateArray(this.initial_nonworld,e)},t.prototype.stopRunning=function(){var t,e,i,s,n,r,a;if(this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutEnd,null),this.runtime.isEndingLayout=!0,cr.clearArray(this.runtime.system.waits),!this.first_visit)for(t=0,e=this.layers.length;t<e;t++)for(this.layers[t].updateZIndices(),i=0,s=(n=this.layers[t].instances).length;i<s;i++)(r=n[i]).type.global||this.runtime.typeHasPersistBehavior(r.type)&&this.saveObjectToPersist(r);for(t=0,e=this.layers.length;t<e;t++){for(i=0,s=(n=this.layers[t].instances).length;i<s;i++)(r=n[i]).type.global||this.runtime.DestroyInstance(r);this.runtime.ClearDeathRow(),cr.clearArray(n),this.layers[t].zindices_stale=!0}for(t=0,e=this.runtime.types_by_index.length;t<e;t++)if(!((a=this.runtime.types_by_index[t]).global||a.plugin.is_world||a.plugin.singleglobal||a.is_family)){for(i=0,s=a.instances.length;i<s;i++)this.runtime.DestroyInstance(a.instances[i]);this.runtime.ClearDeathRow()}o=!1,this.runtime.isEndingLayout=!1};var s=new cr.rect(0,0,0,0);function n(t,e){this.layout=t,this.runtime=t.runtime,this.instances=[],this.scale=1,this.angle=0,this.disableAngle=!1,this.tmprect=new cr.rect(0,0,0,0),this.tmpquad=new cr.quad,this.viewLeft=0,this.viewRight=0,this.viewTop=0,this.viewBottom=0,this.zindices_stale=!1,this.zindices_stale_from=-1,this.clear_earlyz_index=0,this.name=e[0],this.index=e[1],this.sid=e[2],this.visible=e[3],this.background_color=e[4],this.transparent=e[5],this.parallaxX=e[6],this.parallaxY=e[7],this.opacity=e[8],this.forceOwnTexture=e[9],this.useRenderCells=e[10],this.zoomRate=e[11],this.blend_mode=e[12],this.effect_fallback=e[13],this.compositeOp="source-over",this.srcBlend=0,this.destBlend=0,this.render_grid=null,this.last_render_list=a(),this.render_list_stale=!0,this.last_render_cells=new cr.rect(0,0,-1,-1),this.cur_render_cells=new cr.rect(0,0,-1,-1),this.useRenderCells&&(this.render_grid=new cr.RenderGrid(this.runtime.original_width,this.runtime.original_height)),this.render_offscreen=!1;var i,o,s=e[14];for(this.startup_initial_instances=[],this.initial_instances=[],this.created_globals=[],i=0,o=s.length;i<o;i++){var n=s[i],r=this.runtime.types_by_index[n[1]];r.default_instance||(r.default_instance=n,r.default_layerindex=this.index),this.initial_instances.push(n),-1===this.layout.initial_types.indexOf(r)&&this.layout.initial_types.push(r)}for(cr.shallowAssignArray(this.startup_initial_instances,this.initial_instances),this.effect_types=[],this.active_effect_types=[],this.shaders_preserve_opaqueness=!0,this.effect_params=[],i=0,o=e[15].length;i<o;i++)this.effect_types.push({id:e[15][i][0],name:e[15][i][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:i}),this.effect_params.push(e[15][i][2].slice(0));this.updateActiveEffects(),this.rcTex=new cr.rect(0,0,1,1),this.rcTex2=new cr.rect(0,0,1,1)}t.prototype.recreateInitialObjects=function(t,e,i,o,n){var r,a;for(s.set(e,i,o,n),r=0,a=this.layers.length;r<a;r++)this.layers[r].recreateInitialObjects(t,s)},t.prototype.draw=function(t){var e,i,o,s,n=t,r=!1,a=!this.runtime.fullscreenScalingQuality;for(a&&(this.runtime.layout_canvas||(this.runtime.layout_canvas=document.createElement("canvas"),(e=this.runtime.layout_canvas).width=this.runtime.draw_width,e.height=this.runtime.draw_height,this.runtime.layout_ctx=e.getContext("2d"),r=!0),e=this.runtime.layout_canvas,n=this.runtime.layout_ctx,e.width!==this.runtime.draw_width&&(e.width=this.runtime.draw_width,r=!0),e.height!==this.runtime.draw_height&&(e.height=this.runtime.draw_height,r=!0),r&&this.runtime.setCtxImageSmoothingEnabled(n,this.runtime.linearSampling)),n.globalAlpha=1,n.globalCompositeOperation="source-over",this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&n.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height),i=0,o=this.layers.length;i<o;i++)(s=this.layers[i]).visible&&s.opacity>0&&11!==s.blend_mode&&(s.instances.length||!s.transparent)?s.draw(n):s.updateViewport(null);a&&t.drawImage(e,0,0,this.runtime.width,this.runtime.height)},t.prototype.drawGL_earlyZPass=function(t){var e,i;for(t.setEarlyZPass(!0),this.runtime.layout_tex||(this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layout_tex.c2width===this.runtime.draw_width&&this.runtime.layout_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layout_tex),this.runtime.fullscreenScalingQuality||t.setSize(this.runtime.draw_width,this.runtime.draw_height),e=this.layers.length-1;e>=0;--e)(i=this.layers[e]).visible&&1===i.opacity&&i.shaders_preserve_opaqueness&&0===i.blend_mode&&(i.instances.length||!i.transparent)?i.drawGL_earlyZPass(t):i.updateViewport(null);t.setEarlyZPass(!1)},t.prototype.drawGL=function(t){var e,i,o,s=this.active_effect_types.length>0||this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack;for(s?(this.runtime.layout_tex||(this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layout_tex.c2width===this.runtime.draw_width&&this.runtime.layout_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layout_tex),this.runtime.fullscreenScalingQuality||t.setSize(this.runtime.draw_width,this.runtime.draw_height)):this.runtime.layout_tex&&(t.setRenderingToTexture(null),t.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=null),this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&t.clear(0,0,0,0),e=0,i=this.layers.length;e<i;e++)(o=this.layers[e]).visible&&o.opacity>0&&(o.instances.length||!o.transparent)?o.drawGL(t):o.updateViewport(null);if(s)if(0===this.active_effect_types.length||1===this.active_effect_types.length&&this.runtime.fullscreenScalingQuality){if(1===this.active_effect_types.length){var n=this.active_effect_types[0].index;t.switchProgram(this.active_effect_types[0].shaderindex),t.setProgramParameters(null,1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,this.scale,this.angle,0,0,this.runtime.draw_width/2,this.runtime.draw_height/2,this.runtime.kahanTime.sum,this.effect_params[n]),t.programIsAnimated(this.active_effect_types[0].shaderindex)&&(this.runtime.redraw=!0)}else t.switchProgram(0);this.runtime.fullscreenScalingQuality||t.setSize(this.runtime.width,this.runtime.height),t.setRenderingToTexture(null),t.setDepthTestEnabled(!1),t.setOpacity(1),t.setTexture(this.runtime.layout_tex),t.setAlphaBlend(),t.resetModelView(),t.updateModelView();var r=this.runtime.width/2,a=this.runtime.height/2;t.quad(-r,a,r,a,r,-a,-r,-a),t.setTexture(null),t.setDepthTestEnabled(!0)}else this.renderEffectChain(t,null,null,null)},t.prototype.getRenderTarget=function(){return this.active_effect_types.length>0||this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack?this.runtime.layout_tex:null},t.prototype.getMinLayerScale=function(){var t,e,i,o=this.layers[0].getScale();for(t=1,e=this.layers.length;t<e;t++)0===(i=this.layers[t]).parallaxX&&0===i.parallaxY||i.getScale()<o&&(o=i.getScale());return o},t.prototype.scrollToX=function(t){if(!this.unbounded_scrolling){var e=this.runtime.draw_width*(1/this.getMinLayerScale())/2;t>this.width-e&&(t=this.width-e),t<e&&(t=e)}this.scrollX!==t&&(this.scrollX=t,this.runtime.redraw=!0)},t.prototype.scrollToY=function(t){if(!this.unbounded_scrolling){var e=this.runtime.draw_height*(1/this.getMinLayerScale())/2;t>this.height-e&&(t=this.height-e),t<e&&(t=e)}this.scrollY!==t&&(this.scrollY=t,this.runtime.redraw=!0)},t.prototype.boundScrolling=function(){this.scrollToX(this.scrollX),this.scrollToY(this.scrollY)},t.prototype.renderEffectChain=function(t,e,i,o){var s=i?i.active_effect_types:e?e.active_effect_types:this.active_effect_types,n=1,r=0,a=0,h=0,c=this.runtime.draw_width,l=this.runtime.draw_height;i?(n=i.layer.getScale(),r=i.layer.getAngle(),a=i.layer.viewLeft,h=i.layer.viewTop,c=i.layer.viewRight,l=i.layer.viewBottom):e&&(n=e.getScale(),r=e.getAngle(),a=e.viewLeft,h=e.viewTop,c=e.viewRight,l=e.viewBottom);var m,u,p,d,y,_=this.runtime.fx_tex,f=0,x=1,g=this.runtime.draw_width,b=this.runtime.draw_height,v=g/2,B=b/2,D=e?e.rcTex:this.rcTex,w=e?e.rcTex2:this.rcTex2,C=0,S=0,A=0,M=0,T=g,I=g,P=b,L=b,V=0,R=0,O=i?i.layer.getAngle():0;if(i){for(m=0,u=s.length;m<u;m++)V+=t.getProgramBoxExtendHorizontal(s[m].shaderindex),R+=t.getProgramBoxExtendVertical(s[m].shaderindex);var k=i.bbox;if(C=e.layerToCanvas(k.left,k.top,!0,!0),A=e.layerToCanvas(k.left,k.top,!1,!0),T=e.layerToCanvas(k.right,k.bottom,!0,!0),P=e.layerToCanvas(k.right,k.bottom,!1,!0),0!==O){var E=e.layerToCanvas(k.right,k.top,!0,!0),N=e.layerToCanvas(k.right,k.top,!1,!0),F=e.layerToCanvas(k.left,k.bottom,!0,!0),G=e.layerToCanvas(k.left,k.bottom,!1,!0);p=Math.min(C,T,E,F),T=Math.max(C,T,E,F),C=p,p=Math.min(A,P,N,G),P=Math.max(A,P,N,G),A=p}C-=V,A-=R,T+=V,P+=R,w.left=C/g,w.top=1-A/b,w.right=T/g,w.bottom=1-P/b,S=C=cr.floor(C),M=A=cr.floor(A),I=T=cr.ceil(T),L=P=cr.ceil(P),C<0&&(C=0),A<0&&(A=0),T>g&&(T=g),P>b&&(P=b),(S-=V)<0&&(S=0),(M-=R)<0&&(M=0),(I+=V)>g&&(I=g),(L+=R)>b&&(L=b),D.left=C/g,D.top=1-A/b,D.right=T/g,D.bottom=1-P/b}else D.left=w.left=0,D.top=w.top=0,D.right=w.right=1,D.bottom=w.bottom=1;var J=i&&(t.programUsesDest(s[0].shaderindex)||0!==V||0!==R||1!==i.opacity||i.type.plugin.must_predraw)||e&&!i&&1!==e.opacity;t.setAlphaBlend(),J&&(_[f]||(_[f]=t.createEmptyTexture(g,b,this.runtime.linearSampling)),_[f].c2width===g&&_[f].c2height===b||(t.deleteTexture(_[f]),_[f]=t.createEmptyTexture(g,b,this.runtime.linearSampling)),t.switchProgram(0),t.setRenderingToTexture(_[f]),d=b-M-(y=L-M),t.clearRect(S,d,I-S,y),i?i.drawGL(t):(t.setTexture(this.runtime.layer_tex),t.setOpacity(e.opacity),t.resetModelView(),t.translate(-v,-B),t.updateModelView(),t.quadTex(C,P,T,P,T,A,C,A,D)),w.left=w.top=0,w.right=w.bottom=1,i&&(p=D.top,D.top=D.bottom,D.bottom=p),f=1,x=0),t.setOpacity(1);var j=s.length-1,z=t.programUsesCrossSampling(s[j].shaderindex)||!e&&!i&&!this.runtime.fullscreenScalingQuality,W=0;for(m=0,u=s.length;m<u;m++){if(_[f]||(_[f]=t.createEmptyTexture(g,b,this.runtime.linearSampling)),_[f].c2width===g&&_[f].c2height===b||(t.deleteTexture(_[f]),_[f]=t.createEmptyTexture(g,b,this.runtime.linearSampling)),t.switchProgram(s[m].shaderindex),W=s[m].index,t.programIsAnimated(s[m].shaderindex)&&(this.runtime.redraw=!0),0!=m||J)t.setProgramParameters(o,1/g,1/b,w.left,w.top,w.right,w.bottom,n,r,a,h,(a+c)/2,(h+l)/2,this.runtime.kahanTime.sum,i?i.effect_params[W]:e?e.effect_params[W]:this.effect_params[W]),t.setTexture(null),m!==j||z?(t.setRenderingToTexture(_[f]),d=b-M-(y=L-M),t.clearRect(S,d,I-S,y)):(i?t.setBlend(i.srcBlend,i.destBlend):e&&t.setBlend(e.srcBlend,e.destBlend),t.setRenderingToTexture(o)),t.setTexture(_[x]),t.resetModelView(),t.translate(-v,-B),t.updateModelView(),t.quadTex(C,P,T,P,T,A,C,A,D),m!==j||z||t.setTexture(null);else{if(t.setRenderingToTexture(_[f]),d=b-M-(y=L-M),t.clearRect(S,d,I-S,y),i){var U,q;if(i.curFrame&&i.curFrame.texture_img){var X=i.curFrame.texture_img;U=1/X.width,q=1/X.height}else U=1/i.width,q=1/i.height;t.setProgramParameters(o,U,q,w.left,w.top,w.right,w.bottom,n,r,a,h,(a+c)/2,(h+l)/2,this.runtime.kahanTime.sum,i.effect_params[W]),i.drawGL(t)}else t.setProgramParameters(o,1/g,1/b,0,0,1,1,n,r,a,h,(a+c)/2,(h+l)/2,this.runtime.kahanTime.sum,e?e.effect_params[W]:this.effect_params[W]),t.setTexture(e?this.runtime.layer_tex:this.runtime.layout_tex),t.resetModelView(),t.translate(-v,-B),t.updateModelView(),t.quadTex(C,P,T,P,T,A,C,A,D);w.left=w.top=0,w.right=w.bottom=1,i&&!z&&(p=P,P=A,A=p)}x=0===(f=0===f?1:0)?1:0}z&&(t.switchProgram(0),i?t.setBlend(i.srcBlend,i.destBlend):e?t.setBlend(e.srcBlend,e.destBlend):this.runtime.fullscreenScalingQuality||(t.setSize(this.runtime.width,this.runtime.height),v=this.runtime.width/2,B=this.runtime.height/2,C=0,A=0,T=this.runtime.width,P=this.runtime.height),t.setRenderingToTexture(o),t.setTexture(_[x]),t.resetModelView(),t.translate(-v,-B),t.updateModelView(),i&&1===s.length&&!J?t.quadTex(C,A,T,A,T,P,C,P,D):t.quadTex(C,P,T,P,T,A,C,A,D),t.setTexture(null))},t.prototype.getLayerBySid=function(t){var e,i;for(e=0,i=this.layers.length;e<i;e++)if(this.layers[e].sid===t)return this.layers[e];return null},t.prototype.saveToJSON=function(){var t,e,i,o,s={sx:this.scrollX,sy:this.scrollY,s:this.scale,a:this.angle,w:this.width,h:this.height,fv:this.first_visit,persist:this.persist_data,fx:[],layers:{}};for(t=0,e=this.effect_types.length;t<e;t++)o=this.effect_types[t],s.fx.push({name:o.name,active:o.active,params:this.effect_params[o.index]});for(t=0,e=this.layers.length;t<e;t++)i=this.layers[t],s.layers[i.sid.toString()]=i.saveToJSON();return s},t.prototype.loadFromJSON=function(t){var e,i,o,s,n;this.scrollX=t.sx,this.scrollY=t.sy,this.scale=t.s,this.angle=t.a,this.width=t.w,this.height=t.h,this.persist_data=t.persist,void 0!==t.fv&&(this.first_visit=t.fv);var r=t.fx;for(e=0,i=r.length;e<i;e++)(o=this.getEffectByName(r[e].name))&&(o.active=r[e].active,this.effect_params[o.index]=r[e].params);this.updateActiveEffects();var a=t.layers;for(s in a)if(a.hasOwnProperty(s)){if(!(n=this.getLayerBySid(parseInt(s,10))))continue;n.loadFromJSON(a[s])}},cr.layout=t,n.prototype.updateActiveEffects=function(){var t,e,i;for(cr.clearArray(this.active_effect_types),this.shaders_preserve_opaqueness=!0,t=0,e=this.effect_types.length;t<e;t++)(i=this.effect_types[t]).active&&(this.active_effect_types.push(i),i.preservesOpaqueness||(this.shaders_preserve_opaqueness=!1))},n.prototype.getEffectByName=function(t){var e,i,o;for(e=0,i=this.effect_types.length;e<i;e++)if((o=this.effect_types[e]).name===t)return o;return null},n.prototype.createInitialInstances=function(){var t,i,o,s,n,r,a;for(t=0,i=0,o=this.initial_instances.length;t<o;t++){if(n=this.initial_instances[t],r=this.runtime.types_by_index[n[1]],a=!0,!this.runtime.typeHasPersistBehavior(r)||this.layout.first_visit){if(!(s=this.runtime.createInstanceFromInit(n,this,!0)))continue;e.push(s),s.type.global&&(a=!1,this.created_globals.push(s.uid))}a&&(this.initial_instances[i]=this.initial_instances[t],i++)}this.initial_instances.length=i,this.runtime.ClearDeathRow(),!this.runtime.glwrap&&this.effect_types.length&&(this.blend_mode=this.effect_fallback),this.compositeOp=cr.effectToCompositeOp(this.blend_mode),this.runtime.gl&&cr.setGLBlend(this,this.blend_mode,this.runtime.gl),this.render_list_stale=!0},n.prototype.recreateInitialObjects=function(t,e){var i,o,s,n,r,a,h,c,l,m,u,p=this.runtime.types_by_index,d=t.is_family,y=t.members;for(i=0,o=this.initial_instances.length;i<o;++i)if(a=(r=(s=this.initial_instances[i])[0])[0],h=r[1],e.contains_pt(a,h)){if((n=p[s[1]])!==t){if(!d)continue;if(y.indexOf(n)<0)continue}if(c=this.runtime.createInstanceFromInit(s,this,!1),this.runtime.isInOnDestroy++,this.runtime.trigger(Object.getPrototypeOf(n.plugin).cnds.OnCreated,c),c.is_contained)for(l=0,m=c.siblings.length;l<m;l++)u=c.siblings[i],this.runtime.trigger(Object.getPrototypeOf(u.type.plugin).cnds.OnCreated,u);this.runtime.isInOnDestroy--}},n.prototype.removeFromInstanceList=function(t,e){var i=cr.fastIndexOf(this.instances,t);i<0||(e&&this.useRenderCells&&t.rendercells&&t.rendercells.right>=t.rendercells.left&&(t.update_bbox(),this.render_grid.update(t,t.rendercells,null),t.rendercells.set(0,0,-1,-1)),i===this.instances.length-1?this.instances.pop():(cr.arrayRemove(this.instances,i),this.setZIndicesStaleFrom(i)),this.render_list_stale=!0)},n.prototype.appendToInstanceList=function(t,e){t.zindex=this.instances.length,this.instances.push(t),e&&this.useRenderCells&&t.rendercells&&t.set_bbox_changed(),this.render_list_stale=!0},n.prototype.prependToInstanceList=function(t,e){this.instances.unshift(t),this.setZIndicesStaleFrom(0),e&&this.useRenderCells&&t.rendercells&&t.set_bbox_changed()},n.prototype.moveInstanceAdjacent=function(t,e,i){var o=t.get_zindex(),s=e.get_zindex();cr.arrayRemove(this.instances,o),o<s&&s--,i&&s++,s===this.instances.length?this.instances.push(t):this.instances.splice(s,0,t),this.setZIndicesStaleFrom(o<s?o:s)},n.prototype.setZIndicesStaleFrom=function(t){-1===this.zindices_stale_from?this.zindices_stale_from=t:t<this.zindices_stale_from&&(this.zindices_stale_from=t),this.zindices_stale=!0,this.render_list_stale=!0},n.prototype.updateZIndices=function(){if(this.zindices_stale){var t,e,i;if(-1===this.zindices_stale_from&&(this.zindices_stale_from=0),this.useRenderCells)for(t=this.zindices_stale_from,e=this.instances.length;t<e;++t)(i=this.instances[t]).zindex=t,this.render_grid.markRangeChanged(i.rendercells);else for(t=this.zindices_stale_from,e=this.instances.length;t<e;++t)this.instances[t].zindex=t;this.zindices_stale=!1,this.zindices_stale_from=-1}},n.prototype.getScale=function(t){return this.getNormalScale()*(this.runtime.fullscreenScalingQuality||t?this.runtime.aspect_scale:1)},n.prototype.getNormalScale=function(){return(this.scale*this.layout.scale-1)*this.zoomRate+1},n.prototype.getAngle=function(){return this.disableAngle?0:cr.clamp_angle(this.layout.angle+this.angle)};var r=[];function a(){return r.length?r.pop():[]}function h(t){cr.clearArray(t),r.push(t)}function c(t,e,i){var o,s,n=0,r=0,a=0,h=t.length,c=e.length;for(i.length=h+c;n<h&&r<c;++a)o=t[n],s=e[r],o.zindex<s.zindex?(i[a]=o,++n):(i[a]=s,++r);for(;n<h;++n,++a)i[a]=t[n];for(;r<c;++r,++a)i[a]=e[r]}var l=[];function m(t,e){var i,o,s,n,r;for(i=0,o=t.length;i<o-1;i+=2)c(s=t[i],n=t[i+1],r=a()),e||(h(s),h(n)),l.push(r);o%2==1&&(e?(s=a(),cr.shallowAssignArray(s,t[o-1]),l.push(s)):l.push(t[o-1])),cr.shallowAssignArray(t,l),cr.clearArray(l)}var u=[];n.prototype.getRenderCellInstancesToDraw=function(){if(this.updateZIndices(),this.render_grid.queryRange(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom,u),!u.length)return a();if(1===u.length){var t=a();return cr.shallowAssignArray(t,u[0]),cr.clearArray(u),t}var e=function(t){for(var e=!0;t.length>1;)m(t,e),e=!1;return t[0]}(u);return cr.clearArray(u),e},n.prototype.draw=function(t){this.render_offscreen=this.forceOwnTexture||1!==this.opacity||0!==this.blend_mode;var e=this.runtime.canvas,i=t,o=!1;this.render_offscreen&&(this.runtime.layer_canvas||(this.runtime.layer_canvas=document.createElement("canvas"),(e=this.runtime.layer_canvas).width=this.runtime.draw_width,e.height=this.runtime.draw_height,this.runtime.layer_ctx=e.getContext("2d"),o=!0),e=this.runtime.layer_canvas,i=this.runtime.layer_ctx,e.width!==this.runtime.draw_width&&(e.width=this.runtime.draw_width,o=!0),e.height!==this.runtime.draw_height&&(e.height=this.runtime.draw_height,o=!0),o&&this.runtime.setCtxImageSmoothingEnabled(i,this.runtime.linearSampling),this.transparent&&i.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height)),i.globalAlpha=1,i.globalCompositeOperation="source-over",this.transparent||(i.fillStyle="rgb("+this.background_color[0]+","+this.background_color[1]+","+this.background_color[2]+")",i.fillRect(0,0,this.runtime.draw_width,this.runtime.draw_height)),i.save(),this.disableAngle=!0;var s=this.canvasToLayer(0,0,!0,!0),n=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(s=Math.round(s),n=Math.round(n)),this.rotateViewport(s,n,i);var r,a=this.getScale();i.scale(a,a),i.translate(-s,-n),this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(h(this.last_render_list),r=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):r=this.last_render_list):r=this.instances;var c,l,m,u=null;for(c=0,l=r.length;c<l;++c)(m=r[c])!==u&&(this.drawInstance(m,i),u=m);this.useRenderCells&&(this.last_render_list=r),i.restore(),this.render_offscreen&&(t.globalCompositeOperation=this.compositeOp,t.globalAlpha=this.opacity,t.drawImage(e,0,0))},n.prototype.drawInstance=function(t,e){if(t.visible&&0!==t.width&&0!==t.height){t.update_bbox();var i=t.bbox;i.right<this.viewLeft||i.bottom<this.viewTop||i.left>this.viewRight||i.top>this.viewBottom||(e.globalCompositeOperation=t.compositeOp,t.draw(e))}},n.prototype.updateViewport=function(t){this.disableAngle=!0;var e=this.canvasToLayer(0,0,!0,!0),i=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(e=Math.round(e),i=Math.round(i)),this.rotateViewport(e,i,t)},n.prototype.rotateViewport=function(t,e,i){var o,s=this.getScale();this.viewLeft=t,this.viewTop=e,this.viewRight=t+this.runtime.draw_width*(1/s),this.viewBottom=e+this.runtime.draw_height*(1/s),this.viewLeft>this.viewRight&&(o=this.viewLeft,this.viewLeft=this.viewRight,this.viewRight=o),this.viewTop>this.viewBottom&&(o=this.viewTop,this.viewTop=this.viewBottom,this.viewBottom=o);var n=this.getAngle();0!==n&&(i&&(i.translate(this.runtime.draw_width/2,this.runtime.draw_height/2),i.rotate(-n),i.translate(this.runtime.draw_width/-2,this.runtime.draw_height/-2)),this.tmprect.set(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom),this.tmprect.offset((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),this.tmpquad.set_from_rotated_rect(this.tmprect,n),this.tmpquad.bounding_box(this.tmprect),this.tmprect.offset((this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2),this.viewLeft=this.tmprect.left,this.viewTop=this.tmprect.top,this.viewRight=this.tmprect.right,this.viewBottom=this.tmprect.bottom)},n.prototype.drawGL_earlyZPass=function(t){this.runtime.draw_width,this.runtime.draw_height;this.render_offscreen=this.forceOwnTexture,this.render_offscreen&&(this.runtime.layer_tex||(this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layer_tex.c2width===this.runtime.draw_width&&this.runtime.layer_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layer_tex),this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layer_tex)),this.disableAngle=!0;var e=this.canvasToLayer(0,0,!0,!0),i=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(e=Math.round(e),i=Math.round(i)),this.rotateViewport(e,i,null);var o,s=this.getScale();t.resetModelView(),t.scale(s,s),t.rotateZ(-this.getAngle()),t.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),t.updateModelView(),this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(h(this.last_render_list),o=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):o=this.last_render_list):o=this.instances;var n,r,a=null;for(n=o.length-1;n>=0;--n)(r=o[n])!==a&&(this.drawInstanceGL_earlyZPass(o[n],t),a=r);this.useRenderCells&&(this.last_render_list=o),this.transparent||(this.clear_earlyz_index=this.runtime.earlyz_index++,t.setEarlyZIndex(this.clear_earlyz_index),t.setColorFillMode(1,1,1,1),t.fullscreenQuad(),t.restoreEarlyZMode())},n.prototype.drawGL=function(t){this.runtime.draw_width,this.runtime.draw_height;var e=0,i=0;this.render_offscreen=this.forceOwnTexture||1!==this.opacity||this.active_effect_types.length>0||0!==this.blend_mode,this.render_offscreen&&(this.runtime.layer_tex||(this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),this.runtime.layer_tex.c2width===this.runtime.draw_width&&this.runtime.layer_tex.c2height===this.runtime.draw_height||(t.deleteTexture(this.runtime.layer_tex),this.runtime.layer_tex=t.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),t.setRenderingToTexture(this.runtime.layer_tex),this.transparent&&t.clear(0,0,0,0)),this.transparent||(this.runtime.enableFrontToBack?(t.setEarlyZIndex(this.clear_earlyz_index),t.setColorFillMode(this.background_color[0]/255,this.background_color[1]/255,this.background_color[2]/255,1),t.fullscreenQuad(),t.setTextureFillMode()):t.clear(this.background_color[0]/255,this.background_color[1]/255,this.background_color[2]/255,1)),this.disableAngle=!0;var o=this.canvasToLayer(0,0,!0,!0),s=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(o=Math.round(o),s=Math.round(s)),this.rotateViewport(o,s,null);var n,r=this.getScale();t.resetModelView(),t.scale(r,r),t.rotateZ(-this.getAngle()),t.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),t.updateModelView(),this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(h(this.last_render_list),n=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):n=this.last_render_list):n=this.instances;var a,c,l,m=null;for(a=0,c=n.length;a<c;++a)(l=n[a])!==m&&(this.drawInstanceGL(n[a],t),m=l);if(this.useRenderCells&&(this.last_render_list=n),this.render_offscreen)if(e=this.active_effect_types.length?this.active_effect_types[0].shaderindex:0,i=this.active_effect_types.length?this.active_effect_types[0].index:0,0===this.active_effect_types.length||1===this.active_effect_types.length&&!t.programUsesCrossSampling(e)&&1===this.opacity){1===this.active_effect_types.length?(t.switchProgram(e),t.setProgramParameters(this.layout.getRenderTarget(),1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,r,this.getAngle(),this.viewLeft,this.viewTop,(this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2,this.runtime.kahanTime.sum,this.effect_params[i]),t.programIsAnimated(e)&&(this.runtime.redraw=!0)):t.switchProgram(0),t.setRenderingToTexture(this.layout.getRenderTarget()),t.setOpacity(this.opacity),t.setTexture(this.runtime.layer_tex),t.setBlend(this.srcBlend,this.destBlend),t.resetModelView(),t.updateModelView();var u=this.runtime.draw_width/2,p=this.runtime.draw_height/2;t.quad(-u,p,u,p,u,-p,-u,-p),t.setTexture(null)}else this.layout.renderEffectChain(t,this,null,this.layout.getRenderTarget())},n.prototype.drawInstanceGL=function(t,e){if(t.visible&&0!==t.width&&0!==t.height){t.update_bbox();var i=t.bbox;i.right<this.viewLeft||i.bottom<this.viewTop||i.left>this.viewRight||i.top>this.viewBottom||(e.setEarlyZIndex(t.earlyz_index),t.uses_shaders?this.drawInstanceWithShadersGL(t,e):(e.switchProgram(0),e.setBlend(t.srcBlend,t.destBlend),t.drawGL(e)))}},n.prototype.drawInstanceGL_earlyZPass=function(t,e){if(t.visible&&0!==t.width&&0!==t.height){t.update_bbox();var i=t.bbox;i.right<this.viewLeft||i.bottom<this.viewTop||i.left>this.viewRight||i.top>this.viewBottom||(t.earlyz_index=this.runtime.earlyz_index++,0===t.blend_mode&&1===t.opacity&&t.shaders_preserve_opaqueness&&t.drawGL_earlyZPass&&(e.setEarlyZIndex(t.earlyz_index),t.drawGL_earlyZPass(e)))}},n.prototype.drawInstanceWithShadersGL=function(t,e){var i=t.active_effect_types[0].shaderindex,o=t.active_effect_types[0].index,s=this.getScale();if(1!==t.active_effect_types.length||e.programUsesCrossSampling(i)||e.programExtendsBox(i)||(t.angle||t.layer.getAngle())&&e.programUsesDest(i)||1!==t.opacity||t.type.plugin.must_predraw)this.layout.renderEffectChain(e,this,t,this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget()),e.resetModelView(),e.scale(s,s),e.rotateZ(-this.getAngle()),e.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),e.updateModelView();else{e.switchProgram(i),e.setBlend(t.srcBlend,t.destBlend),e.programIsAnimated(i)&&(this.runtime.redraw=!0);var n,r,a=0,h=0,c=0,l=0;if(e.programUsesDest(i)){var m=t.bbox,u=this.layerToCanvas(m.left,m.top,!0,!0),p=this.layerToCanvas(m.left,m.top,!1,!0),d=this.layerToCanvas(m.right,m.bottom,!0,!0),y=this.layerToCanvas(m.right,m.bottom,!1,!0);a=u/windowWidth,h=1-p/windowHeight,c=d/windowWidth,l=1-y/windowHeight}if(t.curFrame&&t.curFrame.texture_img){var _=t.curFrame.texture_img;n=1/_.width,r=1/_.height}else n=1/t.width,r=1/t.height;e.setProgramParameters(this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget(),n,r,a,h,c,l,s,this.getAngle(),this.viewLeft,this.viewTop,(this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2,this.runtime.kahanTime.sum,t.effect_params[o]),t.drawGL(e)}},n.prototype.canvasToLayer=function(t,e,i,o){var s=this.runtime.devicePixelRatio;this.runtime.isRetina&&(t*=s,e*=s);var n=this.runtime.parallax_x_origin,r=this.runtime.parallax_y_origin,a=(this.layout.scrollX-n)*this.parallaxX+n,h=(this.layout.scrollY-r)*this.parallaxY+r,c=a,l=h,m=1/this.getScale(!o);o?(c-=this.runtime.draw_width*m/2,l-=this.runtime.draw_height*m/2):(c-=this.runtime.width*m/2,l-=this.runtime.height*m/2),c+=t*m,l+=e*m;var u=this.getAngle();if(0!==u){c-=a,l-=h;var p=Math.cos(u),d=Math.sin(u),y=c*p-l*d;l=l*p+c*d,c=y,c+=a,l+=h}return i?c:l},n.prototype.layerToCanvas=function(t,e,i,o){var s=this.runtime.parallax_x_origin,n=this.runtime.parallax_y_origin,r=(this.layout.scrollX-s)*this.parallaxX+s,a=(this.layout.scrollY-n)*this.parallaxY+n,h=r,c=a,l=this.getAngle();if(0!==l){t-=r,e-=a;var m=Math.cos(-l),u=Math.sin(-l),p=t*m-e*u;e=e*m+t*u,t=p,t+=r,e+=a}var d=1/this.getScale(!o);o?(h-=this.runtime.draw_width*d/2,c-=this.runtime.draw_height*d/2):(h-=this.runtime.width*d/2,c-=this.runtime.height*d/2),h=(t-h)/d,c=(e-c)/d;var y=this.runtime.devicePixelRatio;return this.runtime.isRetina&&!o&&(h/=y,c/=y),i?h:c},n.prototype.rotatePt=function(t,e,i){if(0===this.getAngle())return i?t:e;var o=this.layerToCanvas(t,e,!0),s=this.layerToCanvas(t,e,!1);this.disableAngle=!0;var n=this.canvasToLayer(o,s,!0),r=this.canvasToLayer(o,s,!0);return this.disableAngle=!1,i?n:r},n.prototype.saveToJSON=function(){var t,e,i,o={s:this.scale,a:this.angle,vl:this.viewLeft,vt:this.viewTop,vr:this.viewRight,vb:this.viewBottom,v:this.visible,bc:this.background_color,t:this.transparent,px:this.parallaxX,py:this.parallaxY,o:this.opacity,zr:this.zoomRate,fx:[],cg:this.created_globals,instances:[]};for(t=0,e=this.effect_types.length;t<e;t++)i=this.effect_types[t],o.fx.push({name:i.name,active:i.active,params:this.effect_params[i.index]});return o},n.prototype.loadFromJSON=function(t){var e,o,s,n;this.scale=t.s,this.angle=t.a,this.viewLeft=t.vl,this.viewTop=t.vt,this.viewRight=t.vr,this.viewBottom=t.vb,this.visible=t.v,this.background_color=t.bc,this.transparent=t.t,this.parallaxX=t.px,this.parallaxY=t.py,this.opacity=t.o,this.zoomRate=t.zr,this.created_globals=t.cg||[],cr.shallowAssignArray(this.initial_instances,this.startup_initial_instances);var r=new cr.ObjectSet;for(e=0,s=this.created_globals.length;e<s;++e)r.add(this.created_globals[e]);for(e=0,o=0,s=this.initial_instances.length;e<s;++e)r.contains(this.initial_instances[e][2])||(this.initial_instances[o]=this.initial_instances[e],++o);cr.truncateArray(this.initial_instances,o);var a=t.fx;for(e=0,s=a.length;e<s;e++)(n=this.getEffectByName(a[e].name))&&(n.active=a[e].active,this.effect_params[n.index]=a[e].params);this.updateActiveEffects(),this.instances.sort(i),this.zindices_stale=!0},cr.layer=n}(),function(){var t=[];function e(t,e){var i,o=t.length;switch(o){case 0:return!0;case 1:return t[0]===e[0];case 2:return t[0]===e[0]&&t[1]===e[1];default:for(i=0;i<o;i++)if(t[i]!==e[i])return!1;return!0}}function i(t,e){return t.index-e.index}function o(o){var s,n,r,a,h;for(2===o.length?o[0].index>o[1].index&&(a=o[0],o[0]=o[1],o[1]=a):o.length>2&&o.sort(i),o.length>=t.length&&(t.length=o.length+1),t[o.length]||(t[o.length]=[]),s=0,n=(h=t[o.length]).length;s<n;s++)if(e(o,r=h[s]))return r;return h.push(o),o}function s(t,e){this.runtime=t,this.triggers={},this.fasttriggers={},this.hasRun=!1,this.includes=new cr.ObjectSet,this.deep_includes=[],this.already_included_sheets=[],this.name=e[0];var i,o,s=e[1];for(this.events=[],i=0,o=s.length;i<o;i++)this.init_event(s[i],null,this.events)}function n(t){this.type=t,this.instances=[],this.else_instances=[],this.select_all=!0}function r(t,e,i){var o,s;this.sheet=t,this.parent=e,this.runtime=t.runtime,this.solModifiers=[],this.solModifiersIncludingParents=[],this.solWriterAfterCnds=!1,this.group=!1,this.initially_activated=!1,this.toplevelevent=!1,this.toplevelgroup=!1,this.has_else_block=!1,this.conditions=[],this.actions=[],this.subevents=[],this.group_name="",this.group=!1,this.initially_activated=!1,this.group_active=!1,this.contained_includes=null,i[1]&&(this.group_name=i[1][1].toLowerCase(),this.group=!0,this.initially_activated=!!i[1][0],this.contained_includes=[],this.group_active=this.initially_activated,this.runtime.allGroups.push(this),this.runtime.groups_by_name[this.group_name]=this),this.orblock=i[2],this.sid=i[4],this.group||(this.runtime.blocksBySid[this.sid.toString()]=this);var n=i[5];for(o=0,s=n.length;o<s;o++){var r=new cr.condition(this,n[o]);r.index=o,cr.seal(r),this.conditions.push(r),this.addSolModifier(r.type)}var a=i[6];for(o=0,s=a.length;o<s;o++){var h=new cr.action(this,a[o]);h.index=o,cr.seal(h),this.actions.push(h)}if(8===i.length){var c=i[7];for(o=0,s=c.length;o<s;o++)this.sheet.init_event(c[o],this,this.subevents)}this.is_else_block=!1,this.conditions.length&&(this.is_else_block=null==this.conditions[0].type&&this.conditions[0].func==cr.system_object.prototype.cnds.Else)}function a(t,e){var i,o,s;if(t&&(-1===e.indexOf(t)&&e.push(t),t.is_contained))for(i=0,o=t.container.length;i<o;i++)t!==(s=t.container[i])&&-1===e.indexOf(s)&&e.push(s)}function h(t,e){if(this.block=t,this.sheet=t.sheet,this.runtime=t.runtime,this.parameters=[],this.results=[],this.extra={},this.index=-1,this.anyParamVariesPerInstance=!1,this.func=this.runtime.GetObjectReference(e[1]),this.trigger=e[3]>0,this.fasttrigger=2===e[3],this.looping=e[4],this.inverted=e[5],this.isstatic=e[6],this.sid=e[7],this.runtime.cndsBySid[this.sid.toString()]=this,-1===e[0]?(this.type=null,this.run=this.run_system,this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[e[0]],this.isstatic?this.run=this.run_static:this.run=this.run_object,e[2]?(this.behaviortype=this.type.getBehaviorByName(e[2]),this.beh_index=this.type.getBehaviorIndexByName(e[2])):(this.behaviortype=null,this.beh_index=-1),this.block.parent&&this.block.parent.setSolWriterAfterCnds()),this.fasttrigger&&(this.run=this.run_true),10===e.length){var i,o,s=e[9];for(i=0,o=s.length;i<o;i++){var n=new cr.parameter(this,s[i]);cr.seal(n),this.parameters.push(n)}this.results.length=s.length}}function c(t,e){if(this.block=t,this.sheet=t.sheet,this.runtime=t.runtime,this.parameters=[],this.results=[],this.extra={},this.index=-1,this.anyParamVariesPerInstance=!1,this.func=this.runtime.GetObjectReference(e[1]),-1===e[0]?(this.type=null,this.run=this.run_system,this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[e[0]],this.run=this.run_object,e[2]?(this.behaviortype=this.type.getBehaviorByName(e[2]),this.beh_index=this.type.getBehaviorIndexByName(e[2])):(this.behaviortype=null,this.beh_index=-1)),this.sid=e[3],this.runtime.actsBySid[this.sid.toString()]=this,6===e.length){var i,o,s=e[5];for(i=0,o=s.length;i<o;i++){var n=new cr.parameter(this,s[i]);cr.seal(n),this.parameters.push(n)}this.results.length=s.length}}s.prototype.toString=function(){return this.name},s.prototype.init_event=function(t,e,i){switch(t[0]){case 0:var o,s,n=new cr.eventblock(this,e,t);if(cr.seal(n),n.orblock)for(i.push(n),o=0,s=n.conditions.length;o<s;o++)n.conditions[o].trigger&&this.init_trigger(n,o);else n.is_trigger()?this.init_trigger(n,0):i.push(n);break;case 1:var r=new cr.eventvariable(this,e,t);cr.seal(r),i.push(r);break;case 2:var a=new cr.eventinclude(this,e,t);cr.seal(a),i.push(a)}},s.prototype.postInit=function(){var t,e;for(t=0,e=this.events.length;t<e;t++)this.events[t].postInit(t<e-1&&this.events[t+1].is_else_block)},s.prototype.updateDeepIncludes=function(){cr.clearArray(this.deep_includes),cr.clearArray(this.already_included_sheets),this.addDeepIncludes(this),cr.clearArray(this.already_included_sheets)},s.prototype.addDeepIncludes=function(t){var e,i,o,s,n=t.deep_includes,r=t.already_included_sheets,a=this.includes.valuesRef();for(e=0,i=a.length;e<i;++e)s=(o=a[e]).include_sheet,!o.isActive()||t===s||r.indexOf(s)>-1||(r.push(s),s.addDeepIncludes(t),n.push(s))},s.prototype.run=function(t){var e,i;for(this.runtime.resuming_breakpoint||(this.hasRun=!0,t||(this.runtime.isRunningEvents=!0)),e=0,i=this.events.length;e<i;e++){var o=this.events[e];o.run(),this.runtime.clearSol(o.solModifiers),this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow()}t||(this.runtime.isRunningEvents=!1)},s.prototype.init_trigger=function(t,e){t.orblock||this.runtime.triggers_to_postinit.push(t);var i,o=t.conditions[e];i=o.type?o.type.name:"system";var s=o.fasttrigger,n=s?this.fasttriggers:this.triggers;n[i]||(n[i]=[]);var r=n[i],a=o.func;if(s){if(!o.parameters.length)return;var h,c=o.parameters[0];if(1!==c.type||2!==c.expression.type)return;var l,m,u=c.expression.value.toLowerCase();for(l=0,m=r.length;l<m;l++)if(r[l].method==a)return void((h=r[l].evs)[u]?h[u].push([t,e]):h[u]=[[t,e]]);(h={})[u]=[[t,e]],r.push({method:a,evs:h})}else{for(l=0,m=r.length;l<m;l++)if(r[l].method==a)return void r[l].evs.push([t,e]);!function(t){return!(!cr.plugins_.Sprite||t!==cr.plugins_.Sprite.prototype.cnds.OnFrameChanged)}(a)?r.push({method:a,evs:[[t,e]]}):r.unshift({method:a,evs:[[t,e]]})}},cr.eventsheet=s,n.prototype.hasObjects=function(){return this.select_all?this.type.instances.length:this.instances.length},n.prototype.getObjects=function(){return this.select_all?this.type.instances:this.instances},n.prototype.pick_one=function(t){if(t)if(t.runtime.getCurrentEventStack().current_event.orblock){this.select_all&&(cr.clearArray(this.instances),cr.shallowAssignArray(this.else_instances,t.type.instances),this.select_all=!1);var e=this.else_instances.indexOf(t);-1!==e&&(this.instances.push(this.else_instances[e]),this.else_instances.splice(e,1))}else this.select_all=!1,cr.clearArray(this.instances),this.instances[0]=t},cr.selection=n,window._c2hh_="F8FCA6DE065E5FC5931757F53FCFCAF65DA20C23",r.prototype.postInit=function(t){var e,i,s=this.parent;if(this.group)for(this.toplevelgroup=!0;s;){if(!s.group){this.toplevelgroup=!1;break}s=s.parent}for(this.toplevelevent=!this.is_trigger()&&(!this.parent||this.parent.group&&this.parent.toplevelgroup),this.has_else_block=!!t,this.solModifiersIncludingParents=this.solModifiers.slice(0),s=this.parent;s;){for(e=0,i=s.solModifiers.length;e<i;e++)this.addParentSolModifier(s.solModifiers[e]);s=s.parent}for(this.solModifiers=o(this.solModifiers),this.solModifiersIncludingParents=o(this.solModifiersIncludingParents),e=0,i=this.conditions.length;e<i;e++)this.conditions[e].postInit();for(e=0,i=this.actions.length;e<i;e++)this.actions[e].postInit();for(e=0,i=this.subevents.length;e<i;e++)this.subevents[e].postInit(e<i-1&&this.subevents[e+1].is_else_block)},r.prototype.setGroupActive=function(t){if(this.group_active!==!!t){var e,i;for(this.group_active=!!t,e=0,i=this.contained_includes.length;e<i;++e)this.contained_includes[e].updateActive();i>0&&this.runtime.running_layout.event_sheet&&this.runtime.running_layout.event_sheet.updateDeepIncludes()}},r.prototype.addSolModifier=function(t){a(t,this.solModifiers)},r.prototype.addParentSolModifier=function(t){a(t,this.solModifiersIncludingParents)},r.prototype.setSolWriterAfterCnds=function(){this.solWriterAfterCnds=!0,this.parent&&this.parent.setSolWriterAfterCnds()},r.prototype.is_trigger=function(){return!!this.conditions.length&&this.conditions[0].trigger},r.prototype.run=function(){var t,e,i=!1,o=this.runtime,s=this.runtime.getCurrentEventStack();s.current_event=this;var n=this.conditions;if(this.is_else_block||(s.else_branch_ran=!1),this.orblock){for(0===n.length&&(i=!0),s.cndindex=0,t=n.length;s.cndindex<t;s.cndindex++)(e=n[s.cndindex]).trigger||e.run()&&(i=!0);s.last_event_true=i,i&&this.run_actions_and_subevents()}else{for(s.cndindex=0,t=n.length;s.cndindex<t;s.cndindex++)if(!n[s.cndindex].run())return s.last_event_true=!1,void(this.toplevelevent&&o.hasPendingInstances&&o.ClearDeathRow());s.last_event_true=!0,this.run_actions_and_subevents()}this.end_run(s)},r.prototype.end_run=function(t){t.last_event_true&&this.has_else_block&&(t.else_branch_ran=!0),this.toplevelevent&&this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow()},r.prototype.run_orblocktrigger=function(t){this.runtime.getCurrentEventStack().current_event=this,this.conditions[t].run()&&(this.run_actions_and_subevents(),this.runtime.getCurrentEventStack().last_event_true=!0)},r.prototype.run_actions_and_subevents=function(){var t,e=this.runtime.getCurrentEventStack();for(e.actindex=0,t=this.actions.length;e.actindex<t;e.actindex++)if(this.actions[e.actindex].run())return;this.run_subevents()},r.prototype.resume_actions_and_subevents=function(){var t,e=this.runtime.getCurrentEventStack();for(t=this.actions.length;e.actindex<t;e.actindex++)if(this.actions[e.actindex].run())return;this.run_subevents()},r.prototype.run_subevents=function(){if(this.subevents.length){var t,e,i,o,s=this.subevents.length-1;if(this.runtime.pushEventStack(this),this.solWriterAfterCnds)for(t=0,e=this.subevents.length;t<e;t++)i=this.subevents[t],(o=!this.toplevelgroup||!this.group&&t<s)&&this.runtime.pushCopySol(i.solModifiers),i.run(),o?this.runtime.popSol(i.solModifiers):this.runtime.clearSol(i.solModifiers);else for(t=0,e=this.subevents.length;t<e;t++)this.subevents[t].run();this.runtime.popEventStack()}},r.prototype.run_pretrigger=function(){var t=this.runtime.getCurrentEventStack();t.current_event=this;var e,i=!1;for(t.cndindex=0,e=this.conditions.length;t.cndindex<e;t.cndindex++)if(this.conditions[t.cndindex].run())i=!0;else if(!this.orblock)return!1;return!this.orblock||i},r.prototype.retrigger=function(){this.runtime.execcount++;var t,e=this.runtime.getCurrentEventStack().cndindex,i=this.runtime.pushEventStack(this);if(!this.orblock)for(i.cndindex=e+1,t=this.conditions.length;i.cndindex<t;i.cndindex++)if(!this.conditions[i.cndindex].run())return this.runtime.popEventStack(),!1;return this.run_actions_and_subevents(),this.runtime.popEventStack(),!0},r.prototype.isFirstConditionOfType=function(t){var e=t.index;if(0===e)return!0;for(--e;e>=0;--e)if(this.conditions[e].type===t.type)return!1;return!0},cr.eventblock=r,h.prototype.postInit=function(){var t,e,i;for(t=0,e=this.parameters.length;t<e;t++)(i=this.parameters[t]).postInit(),i.variesPerInstance&&(this.anyParamVariesPerInstance=!0)},h.prototype.run_true=function(){return!0},h.prototype.run_system=function(){var t,e;for(t=0,e=this.parameters.length;t<e;t++)this.results[t]=this.parameters[t].get();return cr.xor(this.func.apply(this.runtime.system,this.results),this.inverted)},h.prototype.run_static=function(){var t,e;for(t=0,e=this.parameters.length;t<e;t++)this.results[t]=this.parameters[t].get();var i=this.func.apply(this.behaviortype?this.behaviortype:this.type,this.results);return this.type.applySolToContainer(),i},h.prototype.run_object=function(){var t,e,i,o,s,n,r,a,h,c,l,m,u=this.type,p=u.getCurrentSol(),d=this.block.orblock&&!this.trigger,y=0,_=u.is_contained,f=u.is_family,x=u.family_index,g=this.beh_index,b=g>-1,v=this.anyParamVariesPerInstance,B=this.parameters,D=this.results,w=this.inverted,C=this.func;if(v)for(e=0,s=B.length;e<s;++e)(n=B[e]).variesPerInstance||(D[e]=n.get(0));else for(e=0,s=B.length;e<s;++e)D[e]=B[e].get(0);if(p.select_all){for(cr.clearArray(p.instances),cr.clearArray(p.else_instances),t=0,o=(l=u.instances).length;t<o;++t){if(a=l[t],v)for(e=0,s=B.length;e<s;++e)(n=B[e]).variesPerInstance&&(D[e]=n.get(t));b?(y=0,f&&(y=a.type.family_beh_map[x]),r=C.apply(a.behavior_insts[g+y],D)):r=C.apply(a,D),cr.xor(r,w)?p.instances.push(a):d&&p.else_instances.push(a)}return u.finish&&u.finish(!0),p.select_all=!1,u.applySolToContainer(),p.hasObjects()}i=0;var S=d&&!this.block.isFirstConditionOfType(this),A=!1;for(t=0,o=(l=S?p.else_instances:p.instances).length;t<o;++t){if(a=l[t],v)for(e=0,s=B.length;e<s;++e)(n=B[e]).variesPerInstance&&(D[e]=n.get(t));if(b?(y=0,f&&(y=a.type.family_beh_map[x]),r=C.apply(a.behavior_insts[g+y],D)):r=C.apply(a,D),cr.xor(r,w))if(A=!0,S){if(p.instances.push(a),_)for(e=0,s=a.siblings.length;e<s;e++)(h=a.siblings[e]).type.getCurrentSol().instances.push(h)}else{if(l[i]=a,_)for(e=0,s=a.siblings.length;e<s;e++)(h=a.siblings[e]).type.getCurrentSol().instances[i]=h;i++}else if(S){if(l[i]=a,_)for(e=0,s=a.siblings.length;e<s;e++)(h=a.siblings[e]).type.getCurrentSol().else_instances[i]=h;i++}else if(d&&(p.else_instances.push(a),_))for(e=0,s=a.siblings.length;e<s;e++)(h=a.siblings[e]).type.getCurrentSol().else_instances.push(h)}if(cr.truncateArray(l,i),_)for(t=0,o=(m=u.container).length;t<o;t++)c=m[t].getCurrentSol(),S?cr.truncateArray(c.else_instances,i):cr.truncateArray(c.instances,i);var M=A;if(S&&!A)for(t=0,o=p.instances.length;t<o;t++){if(a=p.instances[t],v)for(e=0,s=B.length;e<s;e++)(n=B[e]).variesPerInstance&&(D[e]=n.get(t));if(r=b?C.apply(a.behavior_insts[g],D):C.apply(a,D),cr.xor(r,w)){A=!0;break}}return u.finish&&u.finish(M||d),d?A:p.hasObjects()},cr.condition=h,c.prototype.postInit=function(){var t,e,i;for(t=0,e=this.parameters.length;t<e;t++)(i=this.parameters[t]).postInit(),i.variesPerInstance&&(this.anyParamVariesPerInstance=!0)},c.prototype.run_system=function(){var t,e,i=this.runtime,o=this.parameters,s=this.results;for(t=0,e=o.length;t<e;++t)s[t]=o[t].get();return this.func.apply(i.system,s)},c.prototype.run_object=function(){var t,e,i,o,s,n,r,a=this.type,h=this.beh_index,c=a.family_index,l=this.anyParamVariesPerInstance,m=this.parameters,u=this.results,p=this.func,d=a.getCurrentSol().getObjects(),y=a.is_family,_=h>-1;if(l)for(e=0,o=m.length;e<o;++e)(s=m[e]).variesPerInstance||(u[e]=s.get(0));else for(e=0,o=m.length;e<o;++e)u[e]=m[e].get(0);for(t=0,i=d.length;t<i;++t){if(n=d[t],l)for(e=0,o=m.length;e<o;++e)(s=m[e]).variesPerInstance&&(u[e]=s.get(t));_?(r=0,y&&(r=n.type.family_beh_map[c]),p.apply(n.behavior_insts[h+r],u)):p.apply(n,u)}return!1},cr.action=c;var l=[],m=-1;function u(){return m++,l.length===m&&l.push(new cr.expvalue),l[m]}function p(){m--}function d(t,e){var i,o,s;switch(this.owner=t,this.block=t.block,this.sheet=t.sheet,this.runtime=t.runtime,this.type=e[0],this.expression=null,this.solindex=0,this.get=null,this.combosel=0,this.layout=null,this.key=0,this.object=null,this.index=0,this.varname=null,this.eventvar=null,this.fileinfo=null,this.subparams=null,this.variadicret=null,this.subparams=null,this.variadicret=null,this.variesPerInstance=!1,e[0]){case 0:case 7:this.expression=new cr.expNode(this,e[1]),this.solindex=0,this.get=this.get_exp;break;case 1:this.expression=new cr.expNode(this,e[1]),this.solindex=0,this.get=this.get_exp_str;break;case 5:this.expression=new cr.expNode(this,e[1]),this.solindex=0,this.get=this.get_layer;break;case 3:case 8:this.combosel=e[1],this.get=this.get_combosel;break;case 6:this.layout=this.runtime.layouts[e[1]],this.get=this.get_layout;break;case 9:this.key=e[1],this.get=this.get_key;break;case 4:this.object=this.runtime.types_by_index[e[1]],this.get=this.get_object,this.block.addSolModifier(this.object),this.owner instanceof cr.action?this.block.setSolWriterAfterCnds():this.block.parent&&this.block.parent.setSolWriterAfterCnds();break;case 10:this.index=e[1],t.type&&t.type.is_family?(this.get=this.get_familyvar,this.variesPerInstance=!0):this.get=this.get_instvar;break;case 11:this.varname=e[1],this.eventvar=null,this.get=this.get_eventvar;break;case 2:case 12:this.fileinfo=e[1],this.get=this.get_audiofile;break;case 13:for(this.get=this.get_variadic,this.subparams=[],this.variadicret=[],i=1,o=e.length;i<o;i++)s=new cr.parameter(this.owner,e[i]),cr.seal(s),this.subparams.push(s),this.variadicret.push(0)}}function y(t,e,i){this.sheet=t,this.parent=e,this.runtime=t.runtime,this.solModifiers=[],this.name=i[1],this.vartype=i[2],this.initial=i[3],this.is_static=!!i[4],this.is_constant=!!i[5],this.sid=i[6],this.runtime.varsBySid[this.sid.toString()]=this,this.data=this.initial,this.parent?(this.is_static||this.is_constant?this.localIndex=-1:this.localIndex=this.runtime.stackLocalCount++,this.runtime.all_local_vars.push(this)):(this.localIndex=-1,this.runtime.all_global_vars.push(this))}function _(t,e,i){this.sheet=t,this.parent=e,this.runtime=t.runtime,this.solModifiers=[],this.include_sheet=null,this.include_sheet_name=i[1],this.active=!0}function f(){this.temp_parents_arr=[],this.reset(null),cr.seal(this)}d.prototype.postInit=function(){var t,e;if(11===this.type)this.eventvar=this.runtime.getEventVariableByName(this.varname,this.block.parent);else if(13===this.type)for(t=0,e=this.subparams.length;t<e;t++)this.subparams[t].postInit();this.expression&&this.expression.postInit()},d.prototype.maybeVaryForType=function(t){this.variesPerInstance||t&&(t.plugin.singleglobal||(this.variesPerInstance=!0))},d.prototype.setVaries=function(){this.variesPerInstance=!0},d.prototype.get_exp=function(t){this.solindex=t||0;var e=u();return this.expression.get(e),p(),e.data},d.prototype.get_exp_str=function(t){this.solindex=t||0;var e=u();return this.expression.get(e),p(),cr.is_string(e.data)?e.data:""},d.prototype.get_object=function(){return this.object},d.prototype.get_combosel=function(){return this.combosel},d.prototype.get_layer=function(t){this.solindex=t||0;var e=u();return this.expression.get(e),p(),e.is_number()?this.runtime.getLayerByNumber(e.data):this.runtime.getLayerByName(e.data)},d.prototype.get_layout=function(){return this.layout},d.prototype.get_key=function(){return this.key},d.prototype.get_instvar=function(){return this.index},d.prototype.get_familyvar=function(t){var e=t||0,i=this.owner.type,o=null,s=i.getCurrentSol(),n=s.getObjects();if(n.length)o=n[e%n.length].type;else if(s.else_instances.length)o=s.else_instances[e%s.else_instances.length].type;else{if(!i.instances.length)return 0;o=i.instances[e%i.instances.length].type}return this.index+o.family_var_map[i.family_index]},d.prototype.get_eventvar=function(){return this.eventvar},d.prototype.get_audiofile=function(){return this.fileinfo},d.prototype.get_variadic=function(){var t,e;for(t=0,e=this.subparams.length;t<e;t++)this.variadicret[t]=this.subparams[t].get();return this.variadicret},cr.parameter=d,y.prototype.postInit=function(){this.solModifiers=o(this.solModifiers)},y.prototype.setValue=function(t){var e=this.runtime.getCurrentLocalVarStack();this.parent&&!this.is_static&&e?(this.localIndex>=e.length&&(e.length=this.localIndex+1),e[this.localIndex]=t):this.data=t},y.prototype.getValue=function(){var t=this.runtime.getCurrentLocalVarStack();return!this.parent||this.is_static||!t||this.is_constant?this.data:this.localIndex>=t.length?this.initial:void 0===t[this.localIndex]?this.initial:t[this.localIndex]},y.prototype.run=function(){!this.parent||this.is_static||this.is_constant||this.setValue(this.initial)},cr.eventvariable=y,_.prototype.toString=function(){return"include:"+this.include_sheet.toString()},_.prototype.postInit=function(){this.include_sheet=this.runtime.eventsheets[this.include_sheet_name],this.sheet.includes.add(this),this.solModifiers=o(this.solModifiers);for(var t=this.parent;t;)t.group&&t.contained_includes.push(this),t=t.parent;this.updateActive()},_.prototype.run=function(){this.parent&&this.runtime.pushCleanSol(this.runtime.types_by_index),this.include_sheet.hasRun||this.include_sheet.run(!0),this.parent&&this.runtime.popSol(this.runtime.types_by_index)},_.prototype.updateActive=function(){for(var t=this.parent;t;){if(t.group&&!t.group_active)return void(this.active=!1);t=t.parent}this.active=!0},_.prototype.isActive=function(){return this.active},cr.eventinclude=_,f.prototype.reset=function(t){this.current_event=t,this.cndindex=0,this.actindex=0,cr.clearArray(this.temp_parents_arr),this.last_event_true=!1,this.else_branch_ran=!1,this.any_true_state=!1},f.prototype.isModifierAfterCnds=function(){return!!this.current_event.solWriterAfterCnds||this.cndindex<this.current_event.conditions.length-1&&!!this.current_event.solModifiers.length},cr.eventStackFrame=f}(),function(){function t(t,e){this.owner=t,this.runtime=t.runtime,this.type=e[0],this.get=[this.eval_int,this.eval_float,this.eval_string,this.eval_unaryminus,this.eval_add,this.eval_subtract,this.eval_multiply,this.eval_divide,this.eval_mod,this.eval_power,this.eval_and,this.eval_or,this.eval_equal,this.eval_notequal,this.eval_less,this.eval_lessequal,this.eval_greater,this.eval_greaterequal,this.eval_conditional,this.eval_system_exp,this.eval_object_exp,this.eval_instvar_exp,this.eval_behavior_exp,this.eval_eventvar_exp][this.type];var i,o,s=null;switch(this.value=null,this.first=null,this.second=null,this.third=null,this.func=null,this.results=null,this.parameters=null,this.object_type=null,this.beh_index=-1,this.instance_expr=null,this.varindex=-1,this.behavior_type=null,this.varname=null,this.eventvar=null,this.return_string=!1,this.type){case 0:case 1:case 2:this.value=e[1];break;case 3:this.first=new cr.expNode(t,e[1]);break;case 18:this.first=new cr.expNode(t,e[1]),this.second=new cr.expNode(t,e[2]),this.third=new cr.expNode(t,e[3]);break;case 19:this.func=this.runtime.GetObjectReference(e[1]),this.func!==cr.system_object.prototype.exps.random&&this.func!==cr.system_object.prototype.exps.choose||this.owner.setVaries(),this.results=[],this.parameters=[],3===e.length?(s=e[2],this.results.length=s.length+1):this.results.length=1;break;case 20:this.object_type=this.runtime.types_by_index[e[1]],this.beh_index=-1,this.func=this.runtime.GetObjectReference(e[2]),this.return_string=e[3],cr.plugins_.Function&&this.func===cr.plugins_.Function.prototype.exps.Call&&this.owner.setVaries(),e[4]?this.instance_expr=new cr.expNode(t,e[4]):this.instance_expr=null,this.results=[],this.parameters=[],6===e.length?(s=e[5],this.results.length=s.length+1):this.results.length=1;break;case 21:this.object_type=this.runtime.types_by_index[e[1]],this.return_string=e[2],e[3]?this.instance_expr=new cr.expNode(t,e[3]):this.instance_expr=null,this.varindex=e[4];break;case 22:this.object_type=this.runtime.types_by_index[e[1]],this.behavior_type=this.object_type.getBehaviorByName(e[2]),this.beh_index=this.object_type.getBehaviorIndexByName(e[2]),this.func=this.runtime.GetObjectReference(e[3]),this.return_string=e[4],e[5]?this.instance_expr=new cr.expNode(t,e[5]):this.instance_expr=null,this.results=[],this.parameters=[],7===e.length?(s=e[6],this.results.length=s.length+1):this.results.length=1;break;case 23:this.varname=e[1],this.eventvar=null}if(this.owner.maybeVaryForType(this.object_type),this.type>=4&&this.type<=17&&(this.first=new cr.expNode(t,e[1]),this.second=new cr.expNode(t,e[2])),s)for(i=0,o=s.length;i<o;i++)this.parameters.push(new cr.expNode(t,s[i]));cr.seal(this)}t.prototype.postInit=function(){var t,e;if(23===this.type&&(this.eventvar=this.owner.runtime.getEventVariableByName(this.varname,this.owner.block.parent)),this.first&&this.first.postInit(),this.second&&this.second.postInit(),this.third&&this.third.postInit(),this.instance_expr&&this.instance_expr.postInit(),this.parameters)for(t=0,e=this.parameters.length;t<e;t++)this.parameters[t].postInit()};var e=[],i=-1;function o(){return++i,e.length===i&&e.push(new cr.expvalue),e[i]}function s(){--i}function n(t,e,i){var o,s;for(o=0,s=t.length;o<s;++o)t[o].get(i),e[o+1]=i.data}function r(t,e){this.type=t||cr.exptype.Integer,this.data=e||0,this.object_class=null,this.type==cr.exptype.Integer&&(this.data=Math.floor(this.data)),cr.seal(this)}t.prototype.eval_system_exp=function(t){var e=this.parameters,i=this.results;i[0]=t,n(e,i,o()),s(),this.func.apply(this.runtime.system,i)},t.prototype.eval_object_exp=function(t){var e=this.object_type,i=this.results,r=this.parameters,a=this.instance_expr,h=this.func,c=this.owner.solindex,l=e.getCurrentSol(),m=l.getObjects();if(!m.length){if(!l.else_instances.length)return void(this.return_string?t.set_string(""):t.set_int(0));m=l.else_instances}i[0]=t,t.object_class=e;var u=o();n(r,i,u),a&&(a.get(u),u.is_number()&&(c=u.data,m=e.instances)),s();var p=m.length;(c>=p||c<=-p)&&(c%=p),c<0&&(c+=p);h.apply(m[c],i)},t.prototype.eval_behavior_exp=function(t){var e=this.object_type,i=this.results,r=this.parameters,a=this.instance_expr,h=this.beh_index,c=this.func,l=this.owner.solindex,m=e.getCurrentSol(),u=m.getObjects();if(!u.length){if(!m.else_instances.length)return void(this.return_string?t.set_string(""):t.set_int(0));u=m.else_instances}i[0]=t,t.object_class=e;var p=o();n(r,i,p),a&&(a.get(p),p.is_number()&&(l=p.data,u=e.instances)),s();var d=u.length;(l>=d||l<=-d)&&(l%=d),l<0&&(l+=d);var y=u[l],_=0;e.is_family&&(_=y.type.family_beh_map[e.family_index]);c.apply(y.behavior_insts[h+_],i)},t.prototype.eval_instvar_exp=function(t){var e,i=this.instance_expr,n=this.object_type,r=this.varindex,a=this.owner.solindex,h=n.getCurrentSol(),c=h.getObjects();if(!c.length){if(!h.else_instances.length)return void(this.return_string?t.set_string(""):t.set_int(0));c=h.else_instances}if(i){var l=o();if(i.get(l),l.is_number()){a=l.data;var m=n.instances;0!==m.length&&(a%=m.length)<0&&(a+=m.length);var u=(e=n.getInstanceByIID(a)).instance_vars[r];return cr.is_string(u)?t.set_string(u):t.set_float(u),void s()}s()}var p=c.length;(a>=p||a<=-p)&&(a%=p),a<0&&(a+=p),e=c[a];var d=0;n.is_family&&(d=e.type.family_var_map[n.family_index]);u=e.instance_vars[r+d];cr.is_string(u)?t.set_string(u):t.set_float(u)},t.prototype.eval_int=function(t){t.type=cr.exptype.Integer,t.data=this.value},t.prototype.eval_float=function(t){t.type=cr.exptype.Float,t.data=this.value},t.prototype.eval_string=function(t){t.type=cr.exptype.String,t.data=this.value},t.prototype.eval_unaryminus=function(t){this.first.get(t),t.is_number()&&(t.data=-t.data)},t.prototype.eval_add=function(t){this.first.get(t);var e=o();this.second.get(e),t.is_number()&&e.is_number()&&(t.data+=e.data,e.is_float()&&t.make_float()),s()},t.prototype.eval_subtract=function(t){this.first.get(t);var e=o();this.second.get(e),t.is_number()&&e.is_number()&&(t.data-=e.data,e.is_float()&&t.make_float()),s()},t.prototype.eval_multiply=function(t){this.first.get(t);var e=o();this.second.get(e),t.is_number()&&e.is_number()&&(t.data*=e.data,e.is_float()&&t.make_float()),s()},t.prototype.eval_divide=function(t){this.first.get(t);var e=o();this.second.get(e),t.is_number()&&e.is_number()&&(t.data/=e.data,t.make_float()),s()},t.prototype.eval_mod=function(t){this.first.get(t);var e=o();this.second.get(e),t.is_number()&&e.is_number()&&(t.data%=e.data,e.is_float()&&t.make_float()),s()},t.prototype.eval_power=function(t){this.first.get(t);var e=o();this.second.get(e),t.is_number()&&e.is_number()&&(t.data=Math.pow(t.data,e.data),e.is_float()&&t.make_float()),s()},t.prototype.eval_and=function(t){this.first.get(t);var e=o();this.second.get(e),e.is_string()||t.is_string()?this.eval_and_stringconcat(t,e):this.eval_and_logical(t,e),s()},t.prototype.eval_and_stringconcat=function(t,e){t.is_string()&&e.is_string()?this.eval_and_stringconcat_str_str(t,e):this.eval_and_stringconcat_num(t,e)},t.prototype.eval_and_stringconcat_str_str=function(t,e){t.data+=e.data},t.prototype.eval_and_stringconcat_num=function(t,e){t.is_string()?t.data+=(Math.round(1e10*e.data)/1e10).toString():t.set_string(t.data.toString()+e.data)},t.prototype.eval_and_logical=function(t,e){t.set_int(t.data&&e.data?1:0)},t.prototype.eval_or=function(t){this.first.get(t);var e=o();this.second.get(e),t.is_number()&&e.is_number()&&(t.data||e.data?t.set_int(1):t.set_int(0)),s()},t.prototype.eval_conditional=function(t){this.first.get(t),t.data?this.second.get(t):this.third.get(t)},t.prototype.eval_equal=function(t){this.first.get(t);var e=o();this.second.get(e),t.set_int(t.data===e.data?1:0),s()},t.prototype.eval_notequal=function(t){this.first.get(t);var e=o();this.second.get(e),t.set_int(t.data!==e.data?1:0),s()},t.prototype.eval_less=function(t){this.first.get(t);var e=o();this.second.get(e),t.set_int(t.data<e.data?1:0),s()},t.prototype.eval_lessequal=function(t){this.first.get(t);var e=o();this.second.get(e),t.set_int(t.data<=e.data?1:0),s()},t.prototype.eval_greater=function(t){this.first.get(t);var e=o();this.second.get(e),t.set_int(t.data>e.data?1:0),s()},t.prototype.eval_greaterequal=function(t){this.first.get(t);var e=o();this.second.get(e),t.set_int(t.data>=e.data?1:0),s()},t.prototype.eval_eventvar_exp=function(t){var e=this.eventvar.getValue();cr.is_number(e)?t.set_float(e):t.set_string(e)},cr.expNode=t,r.prototype.is_int=function(){return this.type===cr.exptype.Integer},r.prototype.is_float=function(){return this.type===cr.exptype.Float},r.prototype.is_number=function(){return this.type===cr.exptype.Integer||this.type===cr.exptype.Float},r.prototype.is_string=function(){return this.type===cr.exptype.String},r.prototype.make_int=function(){this.is_int()||(this.is_float()?this.data=Math.floor(this.data):this.is_string()&&(this.data=parseInt(this.data,10)),this.type=cr.exptype.Integer)},r.prototype.make_float=function(){this.is_float()||(this.is_string()&&(this.data=parseFloat(this.data)),this.type=cr.exptype.Float)},r.prototype.make_string=function(){this.is_string()||(this.data=this.data.toString(),this.type=cr.exptype.String)},r.prototype.set_int=function(t){this.type=cr.exptype.Integer,this.data=Math.floor(t)},r.prototype.set_float=function(t){this.type=cr.exptype.Float,this.data=t},r.prototype.set_string=function(t){this.type=cr.exptype.String,this.data=t},r.prototype.set_any=function(t){cr.is_number(t)?(this.type=cr.exptype.Float,this.data=t):cr.is_string(t)?(this.type=cr.exptype.String,this.data=t.toString()):(this.type=cr.exptype.Integer,this.data=0)},cr.expvalue=r,cr.exptype={Integer:0,Float:1,String:2}}(),cr.system_object=function(t){this.runtime=t,this.waits=[]},cr.system_object.prototype.saveToJSON=function(){var t,e,i,o,s,n,r,a,h={};h.waits=[];var c,l=h.waits;for(t=0,e=this.waits.length;t<e;t++){for(c={t:(n=this.waits[t]).time,st:n.signaltag,s:n.signalled,ev:n.ev.sid,sm:[],sols:{}},n.ev.actions[n.actindex]&&(c.act=n.ev.actions[n.actindex].sid),i=0,o=n.solModifiers.length;i<o;i++)c.sm.push(n.solModifiers[i].sid);for(s in n.sols)if(n.sols.hasOwnProperty(s)){for(r=this.runtime.types_by_index[parseInt(s,10)],a={sa:n.sols[s].sa,insts:[]},i=0,o=n.sols[s].insts.length;i<o;i++)a.insts.push(n.sols[s].insts[i].uid);c.sols[r.sid.toString()]=a}l.push(c)}return h},cr.system_object.prototype.loadFromJSON=function(t){var e,i,o,s,n,r,a,h,c,l,m,u,p,d=t.waits;for(cr.clearArray(this.waits),e=0,i=d.length;e<i;e++)if(r=d[e],h=this.runtime.blocksBySid[r.ev.toString()]){for(c=-1,o=0,s=h.actions.length;o<s;o++)if(h.actions[o].sid===r.act){c=o;break}if(-1!==c){for((a={}).sols={},a.solModifiers=[],a.deleteme=!1,a.time=r.t,a.signaltag=r.st||"",a.signalled=!!r.s,a.ev=h,a.actindex=c,o=0,s=r.sm.length;o<s;o++)(l=this.runtime.getObjectTypeBySid(r.sm[o]))&&a.solModifiers.push(l);for(n in r.sols)if(r.sols.hasOwnProperty(n)){if(!(l=this.runtime.getObjectTypeBySid(parseInt(n,10))))continue;for(u={sa:(m=r.sols[n]).sa,insts:[]},o=0,s=m.insts.length;o<s;o++)(p=this.runtime.getObjectByUID(m.insts[o]))&&u.insts.push(p);a.sols[l.index.toString()]=u}this.waits.push(a)}}},function(){var t=cr.system_object.prototype;function e(){}e.prototype.EveryTick=function(){return!0},e.prototype.OnLayoutStart=function(){return!0},e.prototype.OnLayoutEnd=function(){return!0},e.prototype.Compare=function(t,e,i){return cr.do_cmp(t,e,i)},e.prototype.CompareTime=function(t,e){var i=this.runtime.kahanTime.sum;if(0===t){var o=this.runtime.getCurrentCondition();return!o.extra.CompareTime_executed&&i>=e&&(o.extra.CompareTime_executed=!0,!0)}return cr.do_cmp(i,t,e)},e.prototype.LayerVisible=function(t){return!!t&&t.visible},e.prototype.LayerEmpty=function(t){return!!t&&!t.instances.length},e.prototype.LayerCmpOpacity=function(t,e,i){return!!t&&cr.do_cmp(100*t.opacity,e,i)},e.prototype.Repeat=function(t){var e,i=this.runtime.getCurrentEventStack(),o=i.current_event,s=i.isModifierAfterCnds(),n=this.runtime.pushLoopStack();if(s)for(e=0;e<t&&!n.stopped;e++)this.runtime.pushCopySol(o.solModifiers),n.index=e,o.retrigger(),this.runtime.popSol(o.solModifiers);else for(e=0;e<t&&!n.stopped;e++)n.index=e,o.retrigger();return this.runtime.popLoopStack(),!1},e.prototype.While=function(t){var e,i=this.runtime.getCurrentEventStack(),o=i.current_event,s=i.isModifierAfterCnds(),n=this.runtime.pushLoopStack();if(s)for(e=0;!n.stopped;e++)this.runtime.pushCopySol(o.solModifiers),n.index=e,o.retrigger()||(n.stopped=!0),this.runtime.popSol(o.solModifiers);else for(e=0;!n.stopped;e++)n.index=e,o.retrigger()||(n.stopped=!0);return this.runtime.popLoopStack(),!1},e.prototype.For=function(t,e,i){var o,s=this.runtime.getCurrentEventStack(),n=s.current_event,r=s.isModifierAfterCnds(),a=this.runtime.pushLoopStack(t);if(i<e)if(r)for(o=e;o>=i&&!a.stopped;--o)this.runtime.pushCopySol(n.solModifiers),a.index=o,n.retrigger(),this.runtime.popSol(n.solModifiers);else for(o=e;o>=i&&!a.stopped;--o)a.index=o,n.retrigger();else if(r)for(o=e;o<=i&&!a.stopped;++o)this.runtime.pushCopySol(n.solModifiers),a.index=o,n.retrigger(),this.runtime.popSol(n.solModifiers);else for(o=e;o<=i&&!a.stopped;++o)a.index=o,n.retrigger();return this.runtime.popLoopStack(),!1};var i=[],o=-1;function s(t,e){var i=t.extra.c2_feo_val,o=e.extra.c2_feo_val;return cr.is_number(i)&&cr.is_number(o)?i-o:(i=""+i)<(o=""+o)?-1:i>o?1:0}e.prototype.ForEach=function(t){var e=t.getCurrentSol();o++,i.length===o&&i.push([]);var s=i[o];cr.shallowAssignArray(s,e.getObjects());var n,r,a,h,c,l,m,u=this.runtime.getCurrentEventStack(),p=u.current_event,d=u.isModifierAfterCnds(),y=this.runtime.pushLoopStack(),_=t.is_contained;if(d)for(n=0,r=s.length;n<r&&!y.stopped;n++){if(this.runtime.pushCopySol(p.solModifiers),c=s[n],(e=t.getCurrentSol()).select_all=!1,cr.clearArray(e.instances),e.instances[0]=c,_)for(a=0,h=c.siblings.length;a<h;a++)(m=(l=c.siblings[a]).type.getCurrentSol()).select_all=!1,cr.clearArray(m.instances),m.instances[0]=l;y.index=n,p.retrigger(),this.runtime.popSol(p.solModifiers)}else for(e.select_all=!1,cr.clearArray(e.instances),n=0,r=s.length;n<r&&!y.stopped;n++){if(c=s[n],e.instances[0]=c,_)for(a=0,h=c.siblings.length;a<h;a++)(m=(l=c.siblings[a]).type.getCurrentSol()).select_all=!1,cr.clearArray(m.instances),m.instances[0]=l;y.index=n,p.retrigger()}return cr.clearArray(s),this.runtime.popLoopStack(),o--,!1},e.prototype.ForEachOrdered=function(t,e,n){var r=t.getCurrentSol();o++,i.length===o&&i.push([]);var a=i[o];cr.shallowAssignArray(a,r.getObjects());var h,c,l,m,u,p,d,y=this.runtime.getCurrentEventStack(),_=y.current_event,f=this.runtime.getCurrentCondition(),x=y.isModifierAfterCnds(),g=this.runtime.pushLoopStack();for(h=0,c=a.length;h<c;h++)a[h].extra.c2_feo_val=f.parameters[1].get(h);a.sort(s),1===n&&a.reverse();var b=t.is_contained;if(x)for(h=0,c=a.length;h<c&&!g.stopped;h++){if(this.runtime.pushCopySol(_.solModifiers),u=a[h],(r=t.getCurrentSol()).select_all=!1,cr.clearArray(r.instances),r.instances[0]=u,b)for(l=0,m=u.siblings.length;l<m;l++)(d=(p=u.siblings[l]).type.getCurrentSol()).select_all=!1,cr.clearArray(d.instances),d.instances[0]=p;g.index=h,_.retrigger(),this.runtime.popSol(_.solModifiers)}else for(r.select_all=!1,cr.clearArray(r.instances),h=0,c=a.length;h<c&&!g.stopped;h++){if(u=a[h],r.instances[0]=u,b)for(l=0,m=u.siblings.length;l<m;l++)(d=(p=u.siblings[l]).type.getCurrentSol()).select_all=!1,cr.clearArray(d.instances),d.instances[0]=p;g.index=h,_.retrigger()}return cr.clearArray(a),this.runtime.popLoopStack(),o--,!1},e.prototype.PickByComparison=function(t,e,s,n){var r,a,h,c;if(t){o++,i.length===o&&i.push([]);var l=i[o],m=t.getCurrentSol();cr.shallowAssignArray(l,m.getObjects()),m.select_all&&cr.clearArray(m.else_instances);var u=this.runtime.getCurrentCondition();for(r=0,h=0,a=l.length;r<a;r++)c=l[r],l[h]=c,e=u.parameters[1].get(r),n=u.parameters[3].get(r),cr.do_cmp(e,s,n)?h++:m.else_instances.push(c);return cr.truncateArray(l,h),m.select_all=!1,cr.shallowAssignArray(m.instances,l),cr.clearArray(l),o--,t.applySolToContainer(),!!m.instances.length}},e.prototype.PickByEvaluate=function(t,e){var s,n,r,a;if(t){o++,i.length===o&&i.push([]);var h=i[o],c=t.getCurrentSol();cr.shallowAssignArray(h,c.getObjects()),c.select_all&&cr.clearArray(c.else_instances);var l=this.runtime.getCurrentCondition();for(s=0,r=0,n=h.length;s<n;s++)a=h[s],h[r]=a,l.parameters[1].get(s)?r++:c.else_instances.push(a);return cr.truncateArray(h,r),c.select_all=!1,cr.shallowAssignArray(c.instances,h),cr.clearArray(h),o--,t.applySolToContainer(),!!c.instances.length}},e.prototype.TriggerOnce=function(){var t=this.runtime.getCurrentCondition().extra;void 0===t.TriggerOnce_lastTick&&(t.TriggerOnce_lastTick=-1);var e=t.TriggerOnce_lastTick,i=this.runtime.tickcount;return t.TriggerOnce_lastTick=i,this.runtime.layout_first_tick||e!==i-1},e.prototype.Every=function(t){var e=this.runtime.getCurrentCondition(),i=e.extra.Every_lastTime||0,o=this.runtime.kahanTime.sum;void 0===e.extra.Every_seconds&&(e.extra.Every_seconds=t);var s=e.extra.Every_seconds;return o>=i+s?(e.extra.Every_lastTime=i+s,o>=e.extra.Every_lastTime+.04&&(e.extra.Every_lastTime=o),e.extra.Every_seconds=t,!0):(o<i-.1&&(e.extra.Every_lastTime=o),!1)},e.prototype.PickNth=function(t,e){if(!t)return!1;var i=t.getCurrentSol(),o=i.getObjects();if((e=cr.floor(e))<0||e>=o.length)return!1;var s=o[e];return i.pick_one(s),t.applySolToContainer(),!0},e.prototype.PickRandom=function(t){if(!t)return!1;var e=t.getCurrentSol(),i=e.getObjects(),o=cr.floor(Math.random()*i.length);if(o>=i.length)return!1;var s=i[o];return e.pick_one(s),t.applySolToContainer(),!0},e.prototype.CompareVar=function(t,e,i){return cr.do_cmp(t.getValue(),e,i)},e.prototype.IsGroupActive=function(t){var e=this.runtime.groups_by_name[t.toLowerCase()];return e&&e.group_active},e.prototype.IsPreview=function(){return"undefined"!=typeof cr_is_preview},e.prototype.PickAll=function(t){return!!t&&(!!t.instances.length&&(t.getCurrentSol().select_all=!0,t.applySolToContainer(),!0))},e.prototype.IsMobile=function(){return this.runtime.isMobile},e.prototype.CompareBetween=function(t,e,i){return t>=e&&t<=i},e.prototype.Else=function(){var t=this.runtime.getCurrentEventStack();return!t.else_branch_ran&&!t.last_event_true},e.prototype.OnLoadFinished=function(){return!0},e.prototype.OnCanvasSnapshot=function(){return!0},e.prototype.EffectsSupported=function(){return!!this.runtime.glwrap},e.prototype.OnSaveComplete=function(){return!0},e.prototype.OnSaveFailed=function(){return!0},e.prototype.OnLoadComplete=function(){return!0},e.prototype.OnLoadFailed=function(){return!0},e.prototype.ObjectUIDExists=function(t){return!!this.runtime.getObjectByUID(t)},e.prototype.IsOnPlatform=function(t){var e=this.runtime;switch(t){case 0:return!(e.isDomFree||e.isNodeWebkit||e.isCordova||e.isWinJS||e.isWindowsPhone8||e.isBlackberry10||e.isAmazonWebApp);case 1:return e.isiOS;case 2:return e.isAndroid;case 3:return e.isWindows8App;case 4:return e.isWindowsPhone8;case 5:return e.isBlackberry10;case 6:return e.isTizen;case 7:return e.isCocoonJs;case 8:return e.isCordova;case 9:return e.isArcade;case 10:return e.isNodeWebkit;case 11:return e.isCrosswalk;case 12:return e.isAmazonWebApp;case 13:return e.isWindows10;default:return!1}};var n=null,r="",a="";function h(t,e){return n&&t===r&&e===a||(n=new RegExp(t,e),r=t,a=e),n.lastIndex=0,n}e.prototype.RegexTest=function(t,e,i){return h(e,i).test(t)};var c=[];function l(){}e.prototype.PickOverlappingPoint=function(t,e,i){if(!t)return!1;var o,s,n,r=t.getCurrentSol(),a=r.getObjects(),h=this.runtime.getCurrentEventStack().current_event.orblock,l=this.runtime.getCurrentCondition();for(r.select_all?(cr.shallowAssignArray(c,a),cr.clearArray(r.else_instances),r.select_all=!1,cr.clearArray(r.instances)):h?(cr.shallowAssignArray(c,r.else_instances),cr.clearArray(r.else_instances)):(cr.shallowAssignArray(c,a),cr.clearArray(r.instances)),o=0,s=c.length;o<s;++o)(n=c[o]).update_bbox(),cr.xor(n.contains_pt(e,i),l.inverted)?r.instances.push(n):r.else_instances.push(n);return t.applySolToContainer(),cr.xor(!!r.instances.length,l.inverted)},e.prototype.IsNaN=function(t){return!!isNaN(t)},e.prototype.AngleWithin=function(t,e,i){return cr.angleDiff(cr.to_radians(t),cr.to_radians(i))<=cr.to_radians(e)},e.prototype.IsClockwiseFrom=function(t,e){return cr.angleClockwise(cr.to_radians(t),cr.to_radians(e))},e.prototype.IsBetweenAngles=function(t,e,i){var o=cr.to_clamped_radians(t),s=cr.to_clamped_radians(e),n=cr.to_clamped_radians(i);return!cr.angleClockwise(n,s)?!(!cr.angleClockwise(o,s)&&cr.angleClockwise(o,n)):cr.angleClockwise(o,s)&&!cr.angleClockwise(o,n)},e.prototype.IsValueType=function(t,e){return"number"==typeof t?0===e:1===e},t.cnds=new e,l.prototype.GoToLayout=function(t){this.runtime.isloading||this.runtime.changelayout||(this.runtime.changelayout=t)},l.prototype.NextPrevLayout=function(t){if(!this.runtime.isloading&&!this.runtime.changelayout){var e=this.runtime.layouts_by_index.indexOf(this.runtime.running_layout);if((!t||0!==e)&&(t||e!==this.runtime.layouts_by_index.length-1)){var i=this.runtime.layouts_by_index[e+(t?-1:1)];this.runtime.changelayout=i}}},l.prototype.CreateObject=function(t,e,i,o){if(e&&t){var s=this.runtime.createInstance(t,e,i,o);if(s){var n,r,a;if(this.runtime.isInOnDestroy++,this.runtime.trigger(Object.getPrototypeOf(t.plugin).cnds.OnCreated,s),s.is_contained)for(n=0,r=s.siblings.length;n<r;n++)a=s.siblings[n],this.runtime.trigger(Object.getPrototypeOf(a.type.plugin).cnds.OnCreated,a);this.runtime.isInOnDestroy--;var h=t.getCurrentSol();if(h.select_all=!1,cr.clearArray(h.instances),h.instances[0]=s,s.is_contained)for(n=0,r=s.siblings.length;n<r;n++)(h=(a=s.siblings[n]).type.getCurrentSol()).select_all=!1,cr.clearArray(h.instances),h.instances[0]=a}}},l.prototype.SetLayerVisible=function(t,e){t&&t.visible!==e&&(t.visible=e,this.runtime.redraw=!0)},l.prototype.SetLayerOpacity=function(t,e){t&&(e=cr.clamp(e/100,0,1),t.opacity!==e&&(t.opacity=e,this.runtime.redraw=!0))},l.prototype.SetLayerScaleRate=function(t,e){t&&t.zoomRate!==e&&(t.zoomRate=e,this.runtime.redraw=!0)},l.prototype.SetLayerForceOwnTexture=function(t,e){t&&(e=!!e,t.forceOwnTexture!==e&&(t.forceOwnTexture=e,this.runtime.redraw=!0))},l.prototype.SetLayoutScale=function(t){this.runtime.running_layout&&this.runtime.running_layout.scale!==t&&(this.runtime.running_layout.scale=t,this.runtime.running_layout.boundScrolling(),this.runtime.redraw=!0)},l.prototype.ScrollX=function(t){this.runtime.running_layout.scrollToX(t)},l.prototype.ScrollY=function(t){this.runtime.running_layout.scrollToY(t)},l.prototype.Scroll=function(t,e){this.runtime.running_layout.scrollToX(t),this.runtime.running_layout.scrollToY(e)},l.prototype.ScrollToObject=function(t){var e=t.getFirstPicked();e&&(this.runtime.running_layout.scrollToX(e.x),this.runtime.running_layout.scrollToY(e.y))},l.prototype.SetVar=function(t,e){0===t.vartype?cr.is_number(e)?t.setValue(e):t.setValue(parseFloat(e)):1===t.vartype&&t.setValue(e.toString())},l.prototype.AddVar=function(t,e){0===t.vartype?cr.is_number(e)?t.setValue(t.getValue()+e):t.setValue(t.getValue()+parseFloat(e)):1===t.vartype&&t.setValue(t.getValue()+e.toString())},l.prototype.SubVar=function(t,e){0===t.vartype&&(cr.is_number(e)?t.setValue(t.getValue()-e):t.setValue(t.getValue()-parseFloat(e)))},l.prototype.SetGroupActive=function(t,e){var i=this.runtime.groups_by_name[t.toLowerCase()];if(i)switch(e){case 0:i.setGroupActive(!1);break;case 1:i.setGroupActive(!0);break;case 2:i.setGroupActive(!i.group_active)}},l.prototype.SetTimescale=function(t){var e=t;e<0&&(e=0),this.runtime.timescale=e},l.prototype.SetObjectTimescale=function(t,e){var i=e;if(i<0&&(i=0),t){var o,s,n=t.getCurrentSol().getObjects();for(o=0,s=n.length;o<s;o++)n[o].my_timescale=i}},l.prototype.RestoreObjectTimescale=function(t){if(!t)return!1;var e,i,o=t.getCurrentSol().getObjects();for(e=0,i=o.length;e<i;e++)o[e].my_timescale=-1};var m=[];function u(){var t;return m.length?t=m.pop():((t={}).sols={},t.solModifiers=[]),t.deleteme=!1,t}function p(t){cr.wipe(t.sols),cr.clearArray(t.solModifiers),m.push(t)}var d=[];function y(){var t;return d.length?t=d.pop():(t={}).insts=[],t.sa=!1,t}function _(t){cr.clearArray(t.insts),d.push(t)}function f(t,e){var i=t[0]-e[0];return 0!==i?i:t[1]-e[1]}function x(t,e){return t[1]-e[1]}function g(){}l.prototype.Wait=function(t){if(!(t<0)){var e,i,o,s,n,r=this.runtime.getCurrentEventStack(),a=u();for(a.time=this.runtime.kahanTime.sum+t,a.signaltag="",a.signalled=!1,a.ev=r.current_event,a.actindex=r.actindex+1,e=0,i=this.runtime.types_by_index.length;e<i;e++)(o=(s=this.runtime.types_by_index[e]).getCurrentSol()).select_all&&-1===r.current_event.solModifiers.indexOf(s)||(a.solModifiers.push(s),(n=y()).sa=o.select_all,cr.shallowAssignArray(n.insts,o.instances),a.sols[e.toString()]=n);return this.waits.push(a),!0}},l.prototype.WaitForSignal=function(t){var e,i,o,s,n,r=this.runtime.getCurrentEventStack(),a=u();for(a.time=-1,a.signaltag=t.toLowerCase(),a.signalled=!1,a.ev=r.current_event,a.actindex=r.actindex+1,e=0,i=this.runtime.types_by_index.length;e<i;e++)(o=(s=this.runtime.types_by_index[e]).getCurrentSol()).select_all&&-1===r.current_event.solModifiers.indexOf(s)||(a.solModifiers.push(s),(n=y()).sa=o.select_all,cr.shallowAssignArray(n.insts,o.instances),a.sols[e.toString()]=n);return this.waits.push(a),!0},l.prototype.Signal=function(t){var e,i,o,s=t.toLowerCase();for(e=0,i=this.waits.length;e<i;++e)-1===(o=this.waits[e]).time&&o.signaltag===s&&(o.signalled=!0)},l.prototype.SetLayerScale=function(t,e){t&&t.scale!==e&&(t.scale=e,this.runtime.redraw=!0)},l.prototype.ResetGlobals=function(){var t,e,i;for(t=0,e=this.runtime.all_global_vars.length;t<e;t++)(i=this.runtime.all_global_vars[t]).data=i.initial},l.prototype.SetLayoutAngle=function(t){t=cr.to_radians(t),t=cr.clamp_angle(t),this.runtime.running_layout&&this.runtime.running_layout.angle!==t&&(this.runtime.running_layout.angle=t,this.runtime.redraw=!0)},l.prototype.SetLayerAngle=function(t,e){t&&(e=cr.to_radians(e),e=cr.clamp_angle(e),t.angle!==e&&(t.angle=e,this.runtime.redraw=!0))},l.prototype.SetLayerParallax=function(t,e,i){if(t&&(t.parallaxX!==e/100||t.parallaxY!==i/100)){if(t.parallaxX=e/100,t.parallaxY=i/100,1!==t.parallaxX||1!==t.parallaxY){var o,s,n=t.instances;for(o=0,s=n.length;o<s;++o)n[o].type.any_instance_parallaxed=!0}this.runtime.redraw=!0}},l.prototype.SetLayerBackground=function(t,e){if(t){var i=cr.GetRValue(e),o=cr.GetGValue(e),s=cr.GetBValue(e);t.background_color[0]===i&&t.background_color[1]===o&&t.background_color[2]===s||(t.background_color[0]=i,t.background_color[1]=o,t.background_color[2]=s,this.runtime.redraw=!0)}},l.prototype.SetLayerTransparent=function(t,e){t&&!!e!=!!t.transparent&&(t.transparent=!!e,this.runtime.redraw=!0)},l.prototype.SetLayerBlendMode=function(t,e){t&&t.blend_mode!==e&&(t.blend_mode=e,t.compositeOp=cr.effectToCompositeOp(t.blend_mode),this.runtime.gl&&cr.setGLBlend(t,t.blend_mode,this.runtime.gl),this.runtime.redraw=!0)},l.prototype.StopLoop=function(){this.runtime.loop_stack_index<0||(this.runtime.getCurrentLoop().stopped=!0)},l.prototype.GoToLayoutByName=function(t){var e;if(!this.runtime.isloading&&!this.runtime.changelayout)for(e in this.runtime.layouts)if(this.runtime.layouts.hasOwnProperty(e)&&cr.equals_nocase(e,t))return void(this.runtime.changelayout=this.runtime.layouts[e])},l.prototype.RestartLayout=function(t){var e,i,o;if(!this.runtime.isloading&&(!this.runtime.changelayout&&this.runtime.running_layout))for(this.runtime.changelayout=this.runtime.running_layout,e=0,i=this.runtime.allGroups.length;e<i;e++)(o=this.runtime.allGroups[e]).setGroupActive(o.initially_activated)},l.prototype.SnapshotCanvas=function(t,e){this.runtime.doCanvasSnapshot(0===t?"image/png":"image/jpeg",e/100)},l.prototype.SetCanvasSize=function(t,e){if(!(t<=0||e<=0)){var i=this.runtime.fullscreen_mode;(document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen||this.runtime.isNodeFullscreen)&&this.runtime.fullscreen_scaling>0&&(i=this.runtime.fullscreen_scaling),0===i?this.runtime.setSize(t,e,!0):(this.runtime.original_width=t,this.runtime.original_height=e,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0))}},l.prototype.SetLayoutEffectEnabled=function(t,e){if(this.runtime.running_layout&&this.runtime.glwrap){var i=this.runtime.running_layout.getEffectByName(e);if(i){var o=1===t;i.active!=o&&(i.active=o,this.runtime.running_layout.updateActiveEffects(),this.runtime.redraw=!0)}}},l.prototype.SetLayerEffectEnabled=function(t,e,i){if(t&&this.runtime.glwrap){var o=t.getEffectByName(i);if(o){var s=1===e;o.active!=s&&(o.active=s,t.updateActiveEffects(),this.runtime.redraw=!0)}}},l.prototype.SetLayoutEffectParam=function(t,e,i){if(this.runtime.running_layout&&this.runtime.glwrap){var o=this.runtime.running_layout.getEffectByName(t);if(o){var s=this.runtime.running_layout.effect_params[o.index];(e=Math.floor(e))<0||e>=s.length||(1===this.runtime.glwrap.getProgramParameterType(o.shaderindex,e)&&(i/=100),s[e]!==i&&(s[e]=i,o.active&&(this.runtime.redraw=!0)))}}},l.prototype.SetLayerEffectParam=function(t,e,i,o){if(t&&this.runtime.glwrap){var s=t.getEffectByName(e);if(s){var n=t.effect_params[s.index];(i=Math.floor(i))<0||i>=n.length||(1===this.runtime.glwrap.getProgramParameterType(s.shaderindex,i)&&(o/=100),n[i]!==o&&(n[i]=o,s.active&&(this.runtime.redraw=!0)))}}},l.prototype.SaveState=function(t){this.runtime.saveToSlot=t},l.prototype.LoadState=function(t){this.runtime.loadFromSlot=t},l.prototype.LoadStateJSON=function(t){this.runtime.loadFromJson=t},l.prototype.SetHalfFramerateMode=function(t){this.runtime.halfFramerateMode=0!==t},l.prototype.SetFullscreenQuality=function(t){(document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen||this.isNodeFullscreen||0!==this.runtime.fullscreen_mode)&&(this.runtime.wantFullscreenScalingQuality=0!==t,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0))},l.prototype.ResetPersisted=function(){var t,e;for(t=0,e=this.runtime.layouts_by_index.length;t<e;++t)this.runtime.layouts_by_index[t].persist_data={},this.runtime.layouts_by_index[t].first_visit=!0},l.prototype.RecreateInitialObjects=function(t,e,i,o,s){t&&this.runtime.running_layout.recreateInitialObjects(t,e,i,o,s)},l.prototype.SetPixelRounding=function(t){this.runtime.pixel_rounding=0!==t,this.runtime.redraw=!0},l.prototype.SetMinimumFramerate=function(t){t<1&&(t=1),t>120&&(t=120),this.runtime.minimumFramerate=t},l.prototype.SortZOrderByInstVar=function(t,e){if(t){var i,o,s,n,r,a,h=t.getCurrentSol().getObjects(),c=[],l=[],m=this.runtime.running_layout,u=t.is_family,p=t.family_index;for(i=0,o=h.length;i<o;++i)(s=h[i]).layer&&(n=u?s.instance_vars[e+s.type.family_var_map[p]]:s.instance_vars[e],c.push([s.layer.index,s.get_zindex()]),l.push([s,n]));if(c.length)for(c.sort(f),l.sort(x),i=0,o=c.length;i<o;++i)s=l[i][0],r=m.layers[c[i][0]],a=c[i][1],r.instances[a]!==s&&(r.instances[a]=s,s.layer=r,r.setZIndicesStaleFrom(a))}},t.acts=new l,g.prototype.int=function(t,e){cr.is_string(e)?(t.set_int(parseInt(e,10)),isNaN(t.data)&&(t.data=0)):t.set_int(e)},g.prototype.float=function(t,e){cr.is_string(e)?(t.set_float(parseFloat(e)),isNaN(t.data)&&(t.data=0)):t.set_float(e)},g.prototype.str=function(t,e){cr.is_string(e)?t.set_string(e):t.set_string(e.toString())},g.prototype.len=function(t,e){t.set_int(e.length||0)},g.prototype.random=function(t,e,i){void 0===i?t.set_float(Math.random()*e):t.set_float(Math.random()*(i-e)+e)},g.prototype.sqrt=function(t,e){t.set_float(Math.sqrt(e))},g.prototype.abs=function(t,e){t.set_float(Math.abs(e))},g.prototype.round=function(t,e){t.set_int(Math.round(e))},g.prototype.floor=function(t,e){t.set_int(Math.floor(e))},g.prototype.ceil=function(t,e){t.set_int(Math.ceil(e))},g.prototype.sin=function(t,e){t.set_float(Math.sin(cr.to_radians(e)))},g.prototype.cos=function(t,e){t.set_float(Math.cos(cr.to_radians(e)))},g.prototype.tan=function(t,e){t.set_float(Math.tan(cr.to_radians(e)))},g.prototype.asin=function(t,e){t.set_float(cr.to_degrees(Math.asin(e)))},g.prototype.acos=function(t,e){t.set_float(cr.to_degrees(Math.acos(e)))},g.prototype.atan=function(t,e){t.set_float(cr.to_degrees(Math.atan(e)))},g.prototype.exp=function(t,e){t.set_float(Math.exp(e))},g.prototype.ln=function(t,e){t.set_float(Math.log(e))},g.prototype.log10=function(t,e){t.set_float(Math.log(e)/Math.LN10)},g.prototype.max=function(t){var e,i,o,s=arguments[1];for("number"!=typeof s&&(s=0),e=2,i=arguments.length;e<i;e++)"number"==typeof(o=arguments[e])&&s<o&&(s=o);t.set_float(s)},g.prototype.min=function(t){var e,i,o,s=arguments[1];for("number"!=typeof s&&(s=0),e=2,i=arguments.length;e<i;e++)"number"==typeof(o=arguments[e])&&s>o&&(s=o);t.set_float(s)},g.prototype.dt=function(t){t.set_float(this.runtime.dt)},g.prototype.timescale=function(t){t.set_float(this.runtime.timescale)},g.prototype.wallclocktime=function(t){t.set_float((Date.now()-this.runtime.start_time)/1e3)},g.prototype.time=function(t){t.set_float(this.runtime.kahanTime.sum)},g.prototype.tickcount=function(t){t.set_int(this.runtime.tickcount)},g.prototype.objectcount=function(t){t.set_int(this.runtime.objectcount)},g.prototype.fps=function(t){t.set_int(this.runtime.fps)},g.prototype.loopindex=function(t,e){var i,o;if(this.runtime.loop_stack.length)if(e){for(o=this.runtime.loop_stack_index;o>=0;--o)if((i=this.runtime.loop_stack[o]).name===e)return void t.set_int(i.index);t.set_int(0)}else i=this.runtime.getCurrentLoop(),t.set_int(i?i.index:-1);else t.set_int(0)},g.prototype.distance=function(t,e,i,o,s){t.set_float(cr.distanceTo(e,i,o,s))},g.prototype.angle=function(t,e,i,o,s){t.set_float(cr.to_degrees(cr.angleTo(e,i,o,s)))},g.prototype.scrollx=function(t){t.set_float(this.runtime.running_layout.scrollX)},g.prototype.scrolly=function(t){t.set_float(this.runtime.running_layout.scrollY)},g.prototype.newline=function(t){t.set_string("\n")},g.prototype.lerp=function(t,e,i,o){t.set_float(cr.lerp(e,i,o))},g.prototype.qarp=function(t,e,i,o,s){t.set_float(cr.qarp(e,i,o,s))},g.prototype.cubic=function(t,e,i,o,s,n){t.set_float(cr.cubic(e,i,o,s,n))},g.prototype.cosp=function(t,e,i,o){t.set_float(cr.cosp(e,i,o))},g.prototype.windowwidth=function(t){t.set_int(this.runtime.width)},g.prototype.windowheight=function(t){t.set_int(this.runtime.height)},g.prototype.uppercase=function(t,e){t.set_string(cr.is_string(e)?e.toUpperCase():"")},g.prototype.lowercase=function(t,e){t.set_string(cr.is_string(e)?e.toLowerCase():"")},g.prototype.clamp=function(t,e,i,o){e<i?t.set_float(i):e>o?t.set_float(o):t.set_float(e)},g.prototype.layerscale=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(i.scale):t.set_float(0)},g.prototype.layeropacity=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(100*i.opacity):t.set_float(0)},g.prototype.layerscalerate=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(i.zoomRate):t.set_float(0)},g.prototype.layerparallaxx=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(100*i.parallaxX):t.set_float(0)},g.prototype.layerparallaxy=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(100*i.parallaxY):t.set_float(0)},g.prototype.layerindex=function(t,e){var i=this.runtime.getLayer(e);i?t.set_int(i.index):t.set_int(-1)},g.prototype.layoutscale=function(t){this.runtime.running_layout?t.set_float(this.runtime.running_layout.scale):t.set_float(0)},g.prototype.layoutangle=function(t){t.set_float(cr.to_degrees(this.runtime.running_layout.angle))},g.prototype.layerangle=function(t,e){var i=this.runtime.getLayer(e);i?t.set_float(cr.to_degrees(i.angle)):t.set_float(0)},g.prototype.layoutwidth=function(t){t.set_int(this.runtime.running_layout.width)},g.prototype.layoutheight=function(t){t.set_int(this.runtime.running_layout.height)},g.prototype.find=function(t,e,i){cr.is_string(e)&&cr.is_string(i)?t.set_int(e.search(new RegExp(cr.regexp_escape(i),"i"))):t.set_int(-1)},g.prototype.findcase=function(t,e,i){cr.is_string(e)&&cr.is_string(i)?t.set_int(e.search(new RegExp(cr.regexp_escape(i),""))):t.set_int(-1)},g.prototype.left=function(t,e,i){t.set_string(cr.is_string(e)?e.substr(0,i):"")},g.prototype.right=function(t,e,i){t.set_string(cr.is_string(e)?e.substr(e.length-i):"")},g.prototype.mid=function(t,e,i,o){t.set_string(cr.is_string(e)?e.substr(i,o):"")},g.prototype.tokenat=function(t,e,i,o){if(cr.is_string(e)&&cr.is_string(o)){var s=e.split(o),n=cr.floor(i);n<0||n>=s.length?t.set_string(""):t.set_string(s[n])}else t.set_string("")},g.prototype.tokencount=function(t,e,i){cr.is_string(e)&&e.length?t.set_int(e.split(i).length):t.set_int(0)},g.prototype.replace=function(t,e,i,o){cr.is_string(e)&&cr.is_string(i)&&cr.is_string(o)?t.set_string(e.replace(new RegExp(cr.regexp_escape(i),"gi"),o)):t.set_string(cr.is_string(e)?e:"")},g.prototype.trim=function(t,e){t.set_string(cr.is_string(e)?e.trim():"")},g.prototype.pi=function(t){t.set_float(cr.PI)},g.prototype.layoutname=function(t){this.runtime.running_layout?t.set_string(this.runtime.running_layout.name):t.set_string("")},g.prototype.renderer=function(t){t.set_string(this.runtime.gl?"webgl":"canvas2d")},g.prototype.rendererdetail=function(t){t.set_string(this.runtime.glUnmaskedRenderer)},g.prototype.anglediff=function(t,e,i){t.set_float(cr.to_degrees(cr.angleDiff(cr.to_radians(e),cr.to_radians(i))))},g.prototype.choose=function(t){var e=cr.floor(Math.random()*(arguments.length-1));t.set_any(arguments[e+1])},g.prototype.rgb=function(t,e,i,o){t.set_int(cr.RGB(e,i,o))},g.prototype.projectversion=function(t){t.set_string(this.runtime.versionstr)},g.prototype.projectname=function(t){t.set_string(this.runtime.projectName)},g.prototype.anglelerp=function(t,e,i,o){e=cr.to_radians(e),i=cr.to_radians(i);var s=cr.angleDiff(e,i);cr.angleClockwise(i,e)?t.set_float(cr.to_clamped_degrees(e+s*o)):t.set_float(cr.to_clamped_degrees(e-s*o))},g.prototype.anglerotate=function(t,e,i,o){e=cr.to_radians(e),i=cr.to_radians(i),o=cr.to_radians(o),t.set_float(cr.to_clamped_degrees(cr.angleRotate(e,i,o)))},g.prototype.zeropad=function(t,e,i){var o=e<0?"-":"";e<0&&(e=-e);for(var s=i-e.toString().length,n=0;n<s;n++)o+="0";t.set_string(o+e.toString())},g.prototype.cpuutilisation=function(t){t.set_float(this.runtime.cpuutilisation/1e3)},g.prototype.viewportleft=function(t,e){var i=this.runtime.getLayer(e);t.set_float(i?i.viewLeft:0)},g.prototype.viewporttop=function(t,e){var i=this.runtime.getLayer(e);t.set_float(i?i.viewTop:0)},g.prototype.viewportright=function(t,e){var i=this.runtime.getLayer(e);t.set_float(i?i.viewRight:0)},g.prototype.viewportbottom=function(t,e){var i=this.runtime.getLayer(e);t.set_float(i?i.viewBottom:0)},g.prototype.loadingprogress=function(t){t.set_float(this.runtime.loadingprogress)},g.prototype.unlerp=function(t,e,i,o){t.set_float(cr.unlerp(e,i,o))},g.prototype.canvassnapshot=function(t){t.set_string(this.runtime.snapshotData)},g.prototype.urlencode=function(t,e){t.set_string(encodeURIComponent(e))},g.prototype.urldecode=function(t,e){t.set_string(decodeURIComponent(e))},g.prototype.canvastolayerx=function(t,e,i,o){var s=this.runtime.getLayer(e);t.set_float(s?s.canvasToLayer(i,o,!0):0)},g.prototype.canvastolayery=function(t,e,i,o){var s=this.runtime.getLayer(e);t.set_float(s?s.canvasToLayer(i,o,!1):0)},g.prototype.layertocanvasx=function(t,e,i,o){var s=this.runtime.getLayer(e);t.set_float(s?s.layerToCanvas(i,o,!0):0)},g.prototype.layertocanvasy=function(t,e,i,o){var s=this.runtime.getLayer(e);t.set_float(s?s.layerToCanvas(i,o,!1):0)},g.prototype.savestatejson=function(t){t.set_string(this.runtime.lastSaveJson)},g.prototype.imagememoryusage=function(t){this.runtime.glwrap?t.set_float(Math.round(100*this.runtime.glwrap.estimateVRAM()/1048576)/100):t.set_float(0)},g.prototype.regexsearch=function(t,e,i,o){var s=h(i,o);t.set_int(e?e.search(s):-1)},g.prototype.regexreplace=function(t,e,i,o,s){var n=h(i,o);t.set_string(e?e.replace(n,s):"")};var b=[],v="",B="",D="";function w(t,e,i){if(t!==v||e!==B||i!==D){var o=h(e,i);b=t.match(o),v=t,B=e,D=i}}g.prototype.regexmatchcount=function(t,e,i,o){h(i,o);w(e.toString(),i,o),t.set_int(b?b.length:0)},g.prototype.regexmatchat=function(t,e,i,o,s){s=Math.floor(s);h(i,o);w(e.toString(),i,o),!b||s<0||s>=b.length?t.set_string(""):t.set_string(b[s])},g.prototype.infinity=function(t){t.set_float(1/0)},g.prototype.setbit=function(t,e,i,o){e|=0,i|=0,o=0!==o?1:0,t.set_int(e&~(1<<i)|o<<i)},g.prototype.togglebit=function(t,e,i){e|=0,i|=0,t.set_int(e^1<<i)},g.prototype.getbit=function(t,e,i){e|=0,i|=0,t.set_int(e&1<<i?1:0)},g.prototype.originalwindowwidth=function(t){t.set_int(this.runtime.original_width)},g.prototype.originalwindowheight=function(t){t.set_int(this.runtime.original_height)},t.exps=new g,t.runWaits=function(){var t,e,i,o,s,n,r,a=this.runtime.getCurrentEventStack();for(t=0,i=this.waits.length;t<i;t++){if(-1===(o=this.waits[t]).time){if(!o.signalled)continue}else if(o.time>this.runtime.kahanTime.sum)continue;for(s in a.current_event=o.ev,a.actindex=o.actindex,a.cndindex=0,o.sols)o.sols.hasOwnProperty(s)&&(n=this.runtime.types_by_index[parseInt(s,10)].getCurrentSol(),r=o.sols[s],n.select_all=r.sa,cr.shallowAssignArray(n.instances,r.insts),_(r));o.ev.resume_actions_and_subevents(),this.runtime.clearSol(o.solModifiers),o.deleteme=!0}for(t=0,e=0,i=this.waits.length;t<i;t++)o=this.waits[t],this.waits[e]=o,o.deleteme?p(o):e++;cr.truncateArray(this.waits,e)}}(),function(){cr.add_common_aces=function(t,e){var i=t[1],o=t[3],s=t[4],n=t[5],r=t[6],a=t[7],h=t[8];e.cnds||(e.cnds={}),e.acts||(e.acts={}),e.exps||(e.exps={});var c=e.cnds,l=e.acts,m=e.exps;o&&(c.CompareX=function(t,e){return cr.do_cmp(this.x,t,e)},c.CompareY=function(t,e){return cr.do_cmp(this.y,t,e)},c.IsOnScreen=function(){var t=this.layer;this.update_bbox();var e=this.bbox;return!(e.right<t.viewLeft||e.bottom<t.viewTop||e.left>t.viewRight||e.top>t.viewBottom)},c.IsOutsideLayout=function(){this.update_bbox();var t=this.bbox,e=this.runtime.running_layout;return t.right<0||t.bottom<0||t.left>e.width||t.top>e.height},c.PickDistance=function(t,e,i){var o=this.getCurrentSol(),s=o.getObjects();if(!s.length)return!1;var n,r,a,h=s[0],c=h,l=cr.distanceTo(h.x,h.y,e,i);for(n=1,r=s.length;n<r;n++)h=s[n],a=cr.distanceTo(h.x,h.y,e,i),(0===t&&a<l||1===t&&a>l)&&(l=a,c=h);return o.pick_one(c),!0},l.SetX=function(t){this.x!==t&&(this.x=t,this.set_bbox_changed())},l.SetY=function(t){this.y!==t&&(this.y=t,this.set_bbox_changed())},l.SetPos=function(t,e){this.x===t&&this.y===e||(this.x=t,this.y=e,this.set_bbox_changed())},l.SetPosToObject=function(t,e){var i,o,s=t.getPairedInstance(this);s&&(s.getImagePoint?(i=s.getImagePoint(e,!0),o=s.getImagePoint(e,!1)):(i=s.x,o=s.y),this.x===i&&this.y===o||(this.x=i,this.y=o,this.set_bbox_changed()))},l.MoveForward=function(t){0!==t&&(this.x+=Math.cos(this.angle)*t,this.y+=Math.sin(this.angle)*t,this.set_bbox_changed())},l.MoveAtAngle=function(t,e){0!==e&&(this.x+=Math.cos(cr.to_radians(t))*e,this.y+=Math.sin(cr.to_radians(t))*e,this.set_bbox_changed())},m.X=function(t){t.set_float(this.x)},m.Y=function(t){t.set_float(this.y)},m.dt=function(t){t.set_float(this.runtime.getDt(this))}),s&&(c.CompareWidth=function(t,e){return cr.do_cmp(this.width,t,e)},c.CompareHeight=function(t,e){return cr.do_cmp(this.height,t,e)},l.SetWidth=function(t){this.width!==t&&(this.width=t,this.set_bbox_changed())},l.SetHeight=function(t){this.height!==t&&(this.height=t,this.set_bbox_changed())},l.SetSize=function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.set_bbox_changed())},m.Width=function(t){t.set_float(this.width)},m.Height=function(t){t.set_float(this.height)},m.BBoxLeft=function(t){this.update_bbox(),t.set_float(this.bbox.left)},m.BBoxTop=function(t){this.update_bbox(),t.set_float(this.bbox.top)},m.BBoxRight=function(t){this.update_bbox(),t.set_float(this.bbox.right)},m.BBoxBottom=function(t){this.update_bbox(),t.set_float(this.bbox.bottom)}),n&&(c.AngleWithin=function(t,e){return cr.angleDiff(this.angle,cr.to_radians(e))<=cr.to_radians(t)},c.IsClockwiseFrom=function(t){return cr.angleClockwise(this.angle,cr.to_radians(t))},c.IsBetweenAngles=function(t,e){var i=cr.to_clamped_radians(t),o=cr.to_clamped_radians(e),s=cr.clamp_angle(this.angle);return!cr.angleClockwise(o,i)?!(!cr.angleClockwise(s,i)&&cr.angleClockwise(s,o)):cr.angleClockwise(s,i)&&!cr.angleClockwise(s,o)},l.SetAngle=function(t){var e=cr.to_radians(cr.clamp_angle_degrees(t));isNaN(e)||this.angle!==e&&(this.angle=e,this.set_bbox_changed())},l.RotateClockwise=function(t){0===t||isNaN(t)||(this.angle+=cr.to_radians(t),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},l.RotateCounterclockwise=function(t){0===t||isNaN(t)||(this.angle-=cr.to_radians(t),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},l.RotateTowardAngle=function(t,e){var i=cr.angleRotate(this.angle,cr.to_radians(e),cr.to_radians(t));isNaN(i)||this.angle!==i&&(this.angle=i,this.set_bbox_changed())},l.RotateTowardPosition=function(t,e,i){var o=e-this.x,s=i-this.y,n=Math.atan2(s,o),r=cr.angleRotate(this.angle,n,cr.to_radians(t));isNaN(r)||this.angle!==r&&(this.angle=r,this.set_bbox_changed())},l.SetTowardPosition=function(t,e){var i=t-this.x,o=e-this.y,s=Math.atan2(o,i);isNaN(s)||this.angle!==s&&(this.angle=s,this.set_bbox_changed())},m.Angle=function(t){t.set_float(cr.to_clamped_degrees(this.angle))}),i||(c.CompareInstanceVar=function(t,e,i){return cr.do_cmp(this.instance_vars[t],e,i)},c.IsBoolInstanceVarSet=function(t){return this.instance_vars[t]},c.PickInstVarHiLow=function(t,e){var i=this.getCurrentSol(),o=i.getObjects();if(!o.length)return!1;var s,n,r,a=o[0],h=a,c=a.instance_vars[e];for(s=1,n=o.length;s<n;s++)r=(a=o[s]).instance_vars[e],(0===t&&r<c||1===t&&r>c)&&(c=r,h=a);return i.pick_one(h),!0},c.PickByUID=function(t){var e,i,o,s,n,r,a;if(this.runtime.getCurrentCondition().inverted){if((a=this.getCurrentSol()).select_all){for(a.select_all=!1,cr.clearArray(a.instances),cr.clearArray(a.else_instances),e=0,i=(r=this.instances).length;e<i;e++)(s=r[e]).uid===t?a.else_instances.push(s):a.instances.push(s);return this.applySolToContainer(),!!a.instances.length}for(e=0,o=0,i=a.instances.length;e<i;e++)s=a.instances[e],a.instances[o]=s,s.uid===t?a.else_instances.push(s):o++;return cr.truncateArray(a.instances,o),this.applySolToContainer(),!!a.instances.length}if(!(s=this.runtime.getObjectByUID(t)))return!1;if(!(a=this.getCurrentSol()).select_all&&-1===a.instances.indexOf(s))return!1;if(this.is_family){for(e=0,i=(n=s.type.families).length;e<i;e++)if(n[e]===this)return a.pick_one(s),this.applySolToContainer(),!0}else if(s.type===this)return a.pick_one(s),this.applySolToContainer(),!0;return!1},c.OnCreated=function(){return!0},c.OnDestroyed=function(){return!0},l.SetInstanceVar=function(t,e){var i=this.instance_vars;cr.is_number(i[t])?cr.is_number(e)?i[t]=e:i[t]=parseFloat(e):cr.is_string(i[t])&&(cr.is_string(e)?i[t]=e:i[t]=e.toString())},l.AddInstanceVar=function(t,e){var i=this.instance_vars;cr.is_number(i[t])?cr.is_number(e)?i[t]+=e:i[t]+=parseFloat(e):cr.is_string(i[t])&&(cr.is_string(e)?i[t]+=e:i[t]+=e.toString())},l.SubInstanceVar=function(t,e){var i=this.instance_vars;cr.is_number(i[t])&&(cr.is_number(e)?i[t]-=e:i[t]-=parseFloat(e))},l.SetBoolInstanceVar=function(t,e){this.instance_vars[t]=e?1:0},l.ToggleBoolInstanceVar=function(t){this.instance_vars[t]=1-this.instance_vars[t]},l.Destroy=function(){this.runtime.DestroyInstance(this)},l.LoadFromJsonString||(l.LoadFromJsonString=function(t){var e,i,o,s;try{e=JSON.parse(t)}catch(t){return}if(this.runtime.loadInstanceFromJSON(this,e,!0),this.afterLoad&&this.afterLoad(),this.behavior_insts)for(i=0,o=this.behavior_insts.length;i<o;++i)(s=this.behavior_insts[i]).afterLoad&&s.afterLoad()}),m.Count=function(t){var e,i,o,s=t.object_class.instances.length;for(e=0,i=this.runtime.createRow.length;e<i;e++)o=this.runtime.createRow[e],t.object_class.is_family?o.type.families.indexOf(t.object_class)>=0&&s++:o.type===t.object_class&&s++;t.set_int(s)},m.PickedCount=function(t){t.set_int(t.object_class.getCurrentSol().getObjects().length)},m.UID=function(t){t.set_int(this.uid)},m.IID=function(t){t.set_int(this.get_iid())},m.AsJSON||(m.AsJSON=function(t){t.set_string(JSON.stringify(this.runtime.saveInstanceToJSON(this,!0)))})),r&&(c.IsVisible=function(){return this.visible},l.SetVisible=function(t){!t!=!this.visible&&(this.visible=!!t,this.runtime.redraw=!0)},c.CompareOpacity=function(t,e){return cr.do_cmp(cr.round6dp(100*this.opacity),t,e)},l.SetOpacity=function(t){var e=t/100;e<0?e=0:e>1&&(e=1),e!==this.opacity&&(this.opacity=e,this.runtime.redraw=!0)},m.Opacity=function(t){t.set_float(cr.round6dp(100*this.opacity))}),a&&(c.IsOnLayer=function(t){return!!t&&this.layer===t},c.PickTopBottom=function(t){var e=this.getCurrentSol(),i=e.getObjects();if(!i.length)return!1;var o,s,n=i[0],r=n;for(o=1,s=i.length;o<s;o++)n=i[o],0===t?(n.layer.index>r.layer.index||n.layer.index===r.layer.index&&n.get_zindex()>r.get_zindex())&&(r=n):(n.layer.index<r.layer.index||n.layer.index===r.layer.index&&n.get_zindex()<r.get_zindex())&&(r=n);return e.pick_one(r),!0},l.MoveToTop=function(){var t=this.layer,e=t.instances;e.length&&e[e.length-1]===this||(t.removeFromInstanceList(this,!1),t.appendToInstanceList(this,!1),this.runtime.redraw=!0)},l.MoveToBottom=function(){var t=this.layer,e=t.instances;e.length&&e[0]===this||(t.removeFromInstanceList(this,!1),t.prependToInstanceList(this,!1),this.runtime.redraw=!0)},l.MoveToLayer=function(t){t&&t!=this.layer&&(this.layer.removeFromInstanceList(this,!0),this.layer=t,t.appendToInstanceList(this,!0),this.runtime.redraw=!0)},l.ZMoveToObject=function(t,e){var i=0===t;if(e){var o=e.getFirstPicked(this);o&&o.uid!==this.uid&&(this.layer.index!==o.layer.index&&(this.layer.removeFromInstanceList(this,!0),this.layer=o.layer,o.layer.appendToInstanceList(this,!0)),this.layer.moveInstanceAdjacent(this,o,i),this.runtime.redraw=!0)}},m.LayerNumber=function(t){t.set_int(this.layer.number)},m.LayerName=function(t){t.set_string(this.layer.name)},m.ZIndex=function(t){t.set_int(this.get_zindex())}),h&&(l.SetEffectEnabled=function(t,e){if(this.runtime.glwrap){var i=this.type.getEffectIndexByName(e);if(!(i<0)){var o=1===t;this.active_effect_flags[i]!==o&&(this.active_effect_flags[i]=o,this.updateActiveEffects(),this.runtime.redraw=!0)}}},l.SetEffectParam=function(t,e,i){if(this.runtime.glwrap){var o=this.type.getEffectIndexByName(t);if(!(o<0)){var s=this.type.effect_types[o],n=this.effect_params[o];(e=Math.floor(e))<0||e>=n.length||(1===this.runtime.glwrap.getProgramParameterType(s.shaderindex,e)&&(i/=100),n[e]!==i&&(n[e]=i,s.active&&(this.runtime.redraw=!0)))}}})},cr.set_bbox_changed=function(){this.bbox_changed=!0,this.cell_changed=!0,this.type.any_cell_changed=!0,this.runtime.redraw=!0;var t,e,i=this.bbox_changed_callbacks;for(t=0,e=i.length;t<e;++t)i[t](this);this.layer.useRenderCells&&this.update_bbox()},cr.add_bbox_changed_callback=function(t){t&&this.bbox_changed_callbacks.push(t)},cr.update_bbox=function(){if(this.bbox_changed){var t=this.bbox,e=this.bquad;t.set(this.x,this.y,this.x+this.width,this.y+this.height),t.offset(-this.hotspotX*this.width,-this.hotspotY*this.height),this.angle?(t.offset(-this.x,-this.y),e.set_from_rotated_rect(t,this.angle),e.offset(this.x,this.y),e.bounding_box(t)):e.set_from_rect(t),t.normalize(),this.bbox_changed=!1,this.update_render_cell()}};var t=new cr.rect(0,0,0,0);cr.update_render_cell=function(){if(this.layer.useRenderCells){var e=this.layer.render_grid,i=this.bbox;t.set(e.XToCell(i.left),e.YToCell(i.top),e.XToCell(i.right),e.YToCell(i.bottom)),this.rendercells.equals(t)||(this.rendercells.right<this.rendercells.left?e.update(this,null,t):e.update(this,this.rendercells,t),this.rendercells.copy(t),this.layer.render_list_stale=!0)}},cr.update_collision_cell=function(){if(this.cell_changed&&this.collisionsEnabled){this.update_bbox();var e=this.type.collision_grid,i=this.bbox;t.set(e.XToCell(i.left),e.YToCell(i.top),e.XToCell(i.right),e.YToCell(i.bottom)),this.collcells.equals(t)||(this.collcells.right<this.collcells.left?e.update(this,null,t):e.update(this,this.collcells,t),this.collcells.copy(t),this.cell_changed=!1)}},cr.inst_contains_pt=function(t,e){return!!this.bbox.contains_pt(t,e)&&(!!this.bquad.contains_pt(t,e)&&(this.tilemap_exists?this.testPointOverlapTile(t,e):!(this.collision_poly&&!this.collision_poly.is_empty())||(this.collision_poly.cache_poly(this.width,this.height,this.angle),this.collision_poly.contains_pt(t-this.x,e-this.y))))},cr.inst_get_iid=function(){return this.type.updateIIDs(),this.iid},cr.inst_get_zindex=function(){return this.layer.updateZIndices(),this.zindex},cr.inst_updateActiveEffects=function(){var t,e,i;cr.clearArray(this.active_effect_types);var o=!0;for(t=0,e=this.active_effect_flags.length;t<e;t++)this.active_effect_flags[t]&&(i=this.type.effect_types[t],this.active_effect_types.push(i),i.preservesOpaqueness||(o=!1));this.uses_shaders=!!this.active_effect_types.length,this.shaders_preserve_opaqueness=o},cr.inst_toString=function(){return"Inst"+this.puid},cr.type_getFirstPicked=function(t){var e,i,o;if(t&&t.is_contained&&t.type!=this)for(e=0,i=t.siblings.length;e<i;e++)if((o=t.siblings[e]).type==this)return o;var s=this.getCurrentSol().getObjects();return s.length?s[0]:null},cr.type_getPairedInstance=function(t){var e=this.getCurrentSol().getObjects();return e.length?e[t.get_iid()%e.length]:null},cr.type_updateIIDs=function(){if(this.stale_iids&&!this.is_family){var t,e;for(t=0,e=this.instances.length;t<e;t++)this.instances[t].iid=t;var i=t,o=this.runtime.createRow;for(t=0,e=o.length;t<e;++t)o[t].type===this&&(o[t].iid=i++);this.stale_iids=!1}},cr.type_getInstanceByIID=function(t){if(t<this.instances.length)return this.instances[t];t-=this.instances.length;var e,i,o=this.runtime.createRow;for(e=0,i=o.length;e<i;++e)if(o[e].type===this){if(0===t)return o[e];--t}return null},cr.type_getCurrentSol=function(){return this.solstack[this.cur_sol]},cr.type_pushCleanSol=function(){this.cur_sol++,this.cur_sol===this.solstack.length?this.solstack.push(new cr.selection(this)):(this.solstack[this.cur_sol].select_all=!0,cr.clearArray(this.solstack[this.cur_sol].else_instances))},cr.type_pushCopySol=function(){this.cur_sol++,this.cur_sol===this.solstack.length&&this.solstack.push(new cr.selection(this));var t=this.solstack[this.cur_sol],e=this.solstack[this.cur_sol-1];e.select_all?t.select_all=!0:(t.select_all=!1,cr.shallowAssignArray(t.instances,e.instances)),cr.clearArray(t.else_instances)},cr.type_popSol=function(){this.cur_sol--},cr.type_getBehaviorByName=function(t){var e,i,o,s,n,r=0;if(!this.is_family)for(e=0,i=this.families.length;e<i;e++)for(o=0,s=(n=this.families[e]).behaviors.length;o<s;o++){if(t===n.behaviors[o].name)return this.extra.lastBehIndex=r,n.behaviors[o];r++}for(e=0,i=this.behaviors.length;e<i;e++){if(t===this.behaviors[e].name)return this.extra.lastBehIndex=r,this.behaviors[e];r++}return null},cr.type_getBehaviorIndexByName=function(t){return this.getBehaviorByName(t)?this.extra.lastBehIndex:-1},cr.type_getEffectIndexByName=function(t){var e,i;for(e=0,i=this.effect_types.length;e<i;e++)if(this.effect_types[e].name===t)return e;return-1},cr.type_applySolToContainer=function(){if(this.is_contained&&!this.is_family){var t,e,i,o,s,n,r;this.updateIIDs();var a=(n=this.getCurrentSol()).select_all,h=this.runtime.getCurrentEventStack(),c=h&&h.current_event&&h.current_event.orblock;for(t=0,e=this.container.length;t<e;t++)if((s=this.container[t])!==this&&(s.updateIIDs(),(r=s.getCurrentSol()).select_all=a,!a)){for(cr.clearArray(r.instances),i=0,o=n.instances.length;i<o;++i)r.instances[i]=s.getInstanceByIID(n.instances[i].iid);if(c)for(cr.clearArray(r.else_instances),i=0,o=n.else_instances.length;i<o;++i)r.else_instances[i]=s.getInstanceByIID(n.else_instances[i].iid)}}},cr.type_toString=function(){return"Type"+this.sid},cr.do_cmp=function(t,e,i){if(void 0===t||void 0===i)return!1;switch(e){case 0:return t===i;case 1:return t!==i;case 2:return t<i;case 3:return t<=i;case 4:return t>i;case 5:return t>=i;default:return!1}}}(),cr.shaders={},cr.plugins_.Audio=function(t){this.runtime=t},function(){var t=cr.plugins_.Audio.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){};var e=null,i=null,o="",s="",n=0,r=1,a=2,h=3,c=n,l=null,m=[],u=[],p=null,d=!1,y=0,_=!1,f=1,x=0,g=0,b=!1,v=1,B=1,D=10,w=1e4,C=1,S=null,A="",M=!1,T=[],I=!1,P=!1;function L(t){-1===T.indexOf(t)&&T.push(t)}function V(t){var i,o=t.instanceObject;try{i=o.play()}catch(e){return void L(t)}i?i.catch(function(e){L(t)}):M&&!e.isInUserInputEvent&&L(t)}function R(){var t,e,i,o;P||b||!l||(!function(){"suspended"===l.state&&l.resume&&l.resume();if(!l.createBuffer)return;var t=l.createBuffer(1,220,22050),e=l.createBufferSource();e.buffer=t,e.connect(l.destination),j(e)}(),"running"===l.state&&(P=!0));var s=T.slice(0);if(cr.clearArray(T),!_)for(t=0,e=s.length;t<e;++t)(i=s[t]).stopped||i.is_paused||(o=i.instanceObject.play())&&o.catch(function(t){L(i)})}function O(t){var e=E(t);return isFinite(e)||(e=0),e<0&&(e=0),e>1&&(e=1),e}function k(t){return t<0&&(t=0),t>1&&(t=1),function(t){return Math.log(t)/Math.log(10)*20}(t)}function E(t){return Math.pow(10,t/20)}document.addEventListener("pointerup",R,!0),document.addEventListener("touchend",R,!0),document.addEventListener("click",R,!0),document.addEventListener("keydown",R,!0),document.addEventListener("gamepadconnected",R,!0);var N={};function F(t){return t=t.toLowerCase(),N.hasOwnProperty(t)&&N[t].length?N[t][0].getInputNode():l.destination}function G(){return l.createGain?l.createGain():l.createGainNode()}function J(t){return l.createDelay?l.createDelay(t):l.createDelayNode(t)}function j(t,e){t.start?t.start(e||0):t.noteOn(e||0)}function z(t,e,i,o){t.start?t.start(o||0,e):t.noteGrainOn(o||0,e,i-e)}function W(t){try{t.stop?t.stop(0):t.noteOff(0)}catch(t){}}function U(t,e,i,o){if(t)if(t.cancelScheduledValues(0),0!==o){var s=l.currentTime;switch(o+=s,i){case 0:t.setValueAtTime(e,o);break;case 1:t.setValueAtTime(t.value,s),t.linearRampToValueAtTime(e,o);break;case 2:t.setValueAtTime(t.value,s),t.exponentialRampToValueAtTime(e,o)}}else t.value=e}var q=["lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch","allpass"];function X(t,e,i,o,s,n){this.type="filter",this.params=[t,e,i,o,s,n],this.inputNode=G(),this.wetNode=G(),this.wetNode.gain.value=n,this.dryNode=G(),this.dryNode.gain.value=1-n,this.filterNode=l.createBiquadFilter(),"number"==typeof this.filterNode.type?this.filterNode.type=t:this.filterNode.type=q[t],this.filterNode.frequency.value=e,this.filterNode.detune&&(this.filterNode.detune.value=i),this.filterNode.Q.value=o,this.filterNode.gain.value=s,this.inputNode.connect(this.filterNode),this.inputNode.connect(this.dryNode),this.filterNode.connect(this.wetNode)}function Y(t,e,i){this.type="delay",this.params=[t,e,i],this.inputNode=G(),this.wetNode=G(),this.wetNode.gain.value=i,this.dryNode=G(),this.dryNode.gain.value=1-i,this.mainNode=G(),this.delayNode=J(t),this.delayNode.delayTime.value=t,this.delayGainNode=G(),this.delayGainNode.gain.value=e,this.inputNode.connect(this.mainNode),this.inputNode.connect(this.dryNode),this.mainNode.connect(this.wetNode),this.mainNode.connect(this.delayNode),this.delayNode.connect(this.delayGainNode),this.delayGainNode.connect(this.mainNode)}function K(t,e,i,o){this.type="convolve",this.params=[e,i,o],this.inputNode=G(),this.wetNode=G(),this.wetNode.gain.value=i,this.dryNode=G(),this.dryNode.gain.value=1-i,this.convolveNode=l.createConvolver(),t&&(this.convolveNode.normalize=e,this.convolveNode.buffer=t),this.inputNode.connect(this.convolveNode),this.inputNode.connect(this.dryNode),this.convolveNode.connect(this.wetNode)}function H(t,e,i,o,s){this.type="flanger",this.params=[t,e,i,o,s],this.inputNode=G(),this.dryNode=G(),this.dryNode.gain.value=1-s/2,this.wetNode=G(),this.wetNode.gain.value=s/2,this.feedbackNode=G(),this.feedbackNode.gain.value=o,this.delayNode=J(t+e),this.delayNode.delayTime.value=t,this.oscNode=l.createOscillator(),this.oscNode.frequency.value=i,this.oscGainNode=G(),this.oscGainNode.gain.value=e,this.inputNode.connect(this.delayNode),this.inputNode.connect(this.dryNode),this.delayNode.connect(this.wetNode),this.delayNode.connect(this.feedbackNode),this.feedbackNode.connect(this.delayNode),this.oscNode.connect(this.oscGainNode),this.oscGainNode.connect(this.delayNode.delayTime),j(this.oscNode)}function Z(t,e,i,o,s,n){this.type="phaser",this.params=[t,e,i,o,s,n],this.inputNode=G(),this.dryNode=G(),this.dryNode.gain.value=1-n/2,this.wetNode=G(),this.wetNode.gain.value=n/2,this.filterNode=l.createBiquadFilter(),"number"==typeof this.filterNode.type?this.filterNode.type=7:this.filterNode.type="allpass",this.filterNode.frequency.value=t,this.filterNode.detune&&(this.filterNode.detune.value=e),this.filterNode.Q.value=i,this.oscNode=l.createOscillator(),this.oscNode.frequency.value=s,this.oscGainNode=G(),this.oscGainNode.gain.value=o,this.inputNode.connect(this.filterNode),this.inputNode.connect(this.dryNode),this.filterNode.connect(this.wetNode),this.oscNode.connect(this.oscGainNode),this.oscGainNode.connect(this.filterNode.frequency),j(this.oscNode)}function Q(t){this.type="gain",this.params=[t],this.node=G(),this.node.gain.value=t}function $(t,e){this.type="tremolo",this.params=[t,e],this.node=G(),this.node.gain.value=1-e/2,this.oscNode=l.createOscillator(),this.oscNode.frequency.value=t,this.oscGainNode=G(),this.oscGainNode.gain.value=e/2,this.oscNode.connect(this.oscGainNode),this.oscGainNode.connect(this.node.gain),j(this.oscNode)}function tt(t,e){this.type="ringmod",this.params=[t,e],this.inputNode=G(),this.wetNode=G(),this.wetNode.gain.value=e,this.dryNode=G(),this.dryNode.gain.value=1-e,this.ringNode=G(),this.ringNode.gain.value=0,this.oscNode=l.createOscillator(),this.oscNode.frequency.value=t,this.oscNode.connect(this.ringNode.gain),j(this.oscNode),this.inputNode.connect(this.ringNode),this.inputNode.connect(this.dryNode),this.ringNode.connect(this.wetNode)}function et(t,e,i,o,s){this.type="distortion",this.params=[t,e,i,o,s],this.inputNode=G(),this.preGain=G(),this.postGain=G(),this.setDrive(i,E(o)),this.wetNode=G(),this.wetNode.gain.value=s,this.dryNode=G(),this.dryNode.gain.value=1-s,this.waveShaper=l.createWaveShaper(),this.curve=new Float32Array(65536),this.generateColortouchCurve(t,e),this.waveShaper.curve=this.curve,this.inputNode.connect(this.preGain),this.inputNode.connect(this.dryNode),this.preGain.connect(this.waveShaper),this.waveShaper.connect(this.postGain),this.postGain.connect(this.wetNode)}function it(t,e,i,o,s){this.type="compressor",this.params=[t,e,i,o,s],this.node=l.createDynamicsCompressor();try{this.node.threshold.value=t,this.node.knee.value=e,this.node.ratio.value=i,this.node.attack.value=o,this.node.release.value=s}catch(t){}}function ot(t,e){this.type="analyser",this.params=[t,e],this.node=l.createAnalyser(),this.node.fftSize=t,this.node.smoothingTimeConstant=e,this.freqBins=new Float32Array(this.node.frequencyBinCount),this.signal=new Uint8Array(t),this.peak=0,this.rms=0}function st(){this.obj=null,this.loadUid=0}function nt(t,i){this.src=t,this.myapi=c,this.is_music=i,this.added_end_listener=!1;var o,s=this;switch(this.outNode=null,this.mediaSourceNode=null,this.panWhenReady=[],this.seekWhenReady=0,this.pauseWhenReady=!1,this.supportWebAudioAPI=!1,this.failedToLoad=!1,this.wasEverReady=!1,c===r&&i&&!I&&(this.myapi=n,this.outNode=G()),this.bufferObject=null,this.audioData=null,this.myapi){case n:this.bufferObject=new Audio,this.bufferObject.crossOrigin="anonymous",this.bufferObject.addEventListener("canplaythrough",function(){s.wasEverReady=!0}),c===r&&l.createMediaElementSource&&!/wiiu/i.test(navigator.userAgent)&&(this.supportWebAudioAPI=!0,this.bufferObject.addEventListener("canplay",function(){!s.mediaSourceNode&&s.bufferObject&&(s.mediaSourceNode=l.createMediaElementSource(s.bufferObject),s.mediaSourceNode.connect(s.outNode))})),this.bufferObject.autoplay=!1,this.bufferObject.preload="auto",this.bufferObject.src=t;break;case r:e.isWKWebView?e.fetchLocalFileViaCordovaAsArrayBuffer(t,function(t){s.audioData=t,s.decodeAudioBuffer()},function(t){s.failedToLoad=!0}):((o=new XMLHttpRequest).open("GET",t,!0),o.responseType="arraybuffer",o.onload=function(){s.audioData=o.response,s.decodeAudioBuffer()},o.onerror=function(){s.failedToLoad=!0},o.send());break;case a:case h:this.bufferObject=!0}}function rt(t,m){var u=this;this.tag=m,this.fresh=!0,this.stopped=!0,this.src=t.src,this.buffer=t,this.myapi=c,this.is_music=t.is_music,this.playbackRate=1,this.hasPlaybackEnded=!0,this.resume_me=!1,this.is_paused=!1,this.resume_position=0,this.looping=!1,this.is_muted=!1,this.is_silent=!1,this.volume=1,this.onended_handler=function(t){if(!u.is_paused&&!u.resume_me){var s=this;s||(s=t.target),s===u.active_buffer&&(u.hasPlaybackEnded=!0,u.stopped=!0,o=u.tag,e.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,i))}},this.active_buffer=null,this.isTimescaled=1===y&&!this.is_music||2===y,this.mutevol=1,this.startTime=this.isTimescaled?e.kahanTime.sum:e.wallTime.sum,this.gainNode=null,this.pannerNode=null,this.pannerEnabled=!1,this.objectTracker=null,this.panX=0,this.panY=0,this.panAngle=0,this.panConeInner=0,this.panConeOuter=0,this.panConeOuterGain=0,this.instanceObject=null;var p=!1;switch(this.myapi!==r||this.buffer.myapi!==n||this.buffer.supportWebAudioAPI||(this.myapi=n),this.myapi){case n:this.is_music?(this.instanceObject=t.bufferObject,p=!t.added_end_listener,t.added_end_listener=!0):(this.instanceObject=new Audio,this.instanceObject.crossOrigin="anonymous",this.instanceObject.autoplay=!1,this.instanceObject.src=t.bufferObject.src,p=!0),p&&this.instanceObject.addEventListener("ended",function(){o=u.tag,u.stopped=!0,e.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,i)});break;case r:this.gainNode=G(),this.gainNode.connect(F(m)),this.buffer.myapi===r?t.bufferObject&&(this.instanceObject=l.createBufferSource(),this.instanceObject.buffer=t.bufferObject,this.instanceObject.connect(this.gainNode)):(this.instanceObject=this.buffer.bufferObject,this.buffer.outNode.connect(this.gainNode),this.buffer.added_end_listener||(this.buffer.added_end_listener=!0,this.buffer.bufferObject.addEventListener("ended",function(){o=u.tag,u.stopped=!0,e.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,i)})));break;case a:this.instanceObject=new window.Media(s+this.src,null,null,function(t){t===window.Media.MEDIA_STOPPED&&(u.hasPlaybackEnded=!0,u.stopped=!0,o=u.tag,e.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,i))});break;case h:this.instanceObject=!0}}X.prototype.connectTo=function(t){this.wetNode.disconnect(),this.wetNode.connect(t),this.dryNode.disconnect(),this.dryNode.connect(t)},X.prototype.remove=function(){this.inputNode.disconnect(),this.filterNode.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},X.prototype.getInputNode=function(){return this.inputNode},X.prototype.setParam=function(t,e,i,o){switch(t){case 0:(e/=100)<0&&(e=0),e>1&&(e=1),this.params[5]=e,U(this.wetNode.gain,e,i,o),U(this.dryNode.gain,1-e,i,o);break;case 1:this.params[1]=e,U(this.filterNode.frequency,e,i,o);break;case 2:this.params[2]=e,U(this.filterNode.detune,e,i,o);break;case 3:this.params[3]=e,U(this.filterNode.Q,e,i,o);break;case 4:this.params[4]=e,U(this.filterNode.gain,e,i,o)}},Y.prototype.connectTo=function(t){this.wetNode.disconnect(),this.wetNode.connect(t),this.dryNode.disconnect(),this.dryNode.connect(t)},Y.prototype.remove=function(){this.inputNode.disconnect(),this.mainNode.disconnect(),this.delayNode.disconnect(),this.delayGainNode.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},Y.prototype.getInputNode=function(){return this.inputNode},Y.prototype.setParam=function(t,e,i,o){switch(t){case 0:(e/=100)<0&&(e=0),e>1&&(e=1),this.params[2]=e,U(this.wetNode.gain,e,i,o),U(this.dryNode.gain,1-e,i,o);break;case 4:this.params[1]=O(e),U(this.delayGainNode.gain,O(e),i,o);break;case 5:this.params[0]=e,U(this.delayNode.delayTime,e,i,o)}},K.prototype.connectTo=function(t){this.wetNode.disconnect(),this.wetNode.connect(t),this.dryNode.disconnect(),this.dryNode.connect(t)},K.prototype.remove=function(){this.inputNode.disconnect(),this.convolveNode.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},K.prototype.getInputNode=function(){return this.inputNode},K.prototype.setParam=function(t,e,i,o){switch(t){case 0:(e/=100)<0&&(e=0),e>1&&(e=1),this.params[1]=e,U(this.wetNode.gain,e,i,o),U(this.dryNode.gain,1-e,i,o)}},H.prototype.connectTo=function(t){this.dryNode.disconnect(),this.dryNode.connect(t),this.wetNode.disconnect(),this.wetNode.connect(t)},H.prototype.remove=function(){this.inputNode.disconnect(),this.delayNode.disconnect(),this.oscNode.disconnect(),this.oscGainNode.disconnect(),this.dryNode.disconnect(),this.wetNode.disconnect(),this.feedbackNode.disconnect()},H.prototype.getInputNode=function(){return this.inputNode},H.prototype.setParam=function(t,e,i,o){switch(t){case 0:(e/=100)<0&&(e=0),e>1&&(e=1),this.params[4]=e,U(this.wetNode.gain,e/2,i,o),U(this.dryNode.gain,1-e/2,i,o);break;case 6:this.params[1]=e/1e3,U(this.oscGainNode.gain,e/1e3,i,o);break;case 7:this.params[2]=e,U(this.oscNode.frequency,e,i,o);break;case 8:this.params[3]=e/100,U(this.feedbackNode.gain,e/100,i,o)}},Z.prototype.connectTo=function(t){this.dryNode.disconnect(),this.dryNode.connect(t),this.wetNode.disconnect(),this.wetNode.connect(t)},Z.prototype.remove=function(){this.inputNode.disconnect(),this.filterNode.disconnect(),this.oscNode.disconnect(),this.oscGainNode.disconnect(),this.dryNode.disconnect(),this.wetNode.disconnect()},Z.prototype.getInputNode=function(){return this.inputNode},Z.prototype.setParam=function(t,e,i,o){switch(t){case 0:(e/=100)<0&&(e=0),e>1&&(e=1),this.params[5]=e,U(this.wetNode.gain,e/2,i,o),U(this.dryNode.gain,1-e/2,i,o);break;case 1:this.params[0]=e,U(this.filterNode.frequency,e,i,o);break;case 2:this.params[1]=e,U(this.filterNode.detune,e,i,o);break;case 3:this.params[2]=e,U(this.filterNode.Q,e,i,o);break;case 6:this.params[3]=e,U(this.oscGainNode.gain,e,i,o);break;case 7:this.params[4]=e,U(this.oscNode.frequency,e,i,o)}},Q.prototype.connectTo=function(t){this.node.disconnect(),this.node.connect(t)},Q.prototype.remove=function(){this.node.disconnect()},Q.prototype.getInputNode=function(){return this.node},Q.prototype.setParam=function(t,e,i,o){switch(t){case 4:this.params[0]=O(e),U(this.node.gain,O(e),i,o)}},$.prototype.connectTo=function(t){this.node.disconnect(),this.node.connect(t)},$.prototype.remove=function(){this.oscNode.disconnect(),this.oscGainNode.disconnect(),this.node.disconnect()},$.prototype.getInputNode=function(){return this.node},$.prototype.setParam=function(t,e,i,o){switch(t){case 0:(e/=100)<0&&(e=0),e>1&&(e=1),this.params[1]=e,U(this.node.gain.value,1-e/2,i,o),U(this.oscGainNode.gain.value,e/2,i,o);break;case 7:this.params[0]=e,U(this.oscNode.frequency,e,i,o)}},tt.prototype.connectTo=function(t){this.wetNode.disconnect(),this.wetNode.connect(t),this.dryNode.disconnect(),this.dryNode.connect(t)},tt.prototype.remove=function(){this.oscNode.disconnect(),this.ringNode.disconnect(),this.inputNode.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},tt.prototype.getInputNode=function(){return this.inputNode},tt.prototype.setParam=function(t,e,i,o){switch(t){case 0:(e/=100)<0&&(e=0),e>1&&(e=1),this.params[1]=e,U(this.wetNode.gain,e,i,o),U(this.dryNode.gain,1-e,i,o);break;case 7:this.params[0]=e,U(this.oscNode.frequency,e,i,o)}},et.prototype.setDrive=function(t,e){t<.01&&(t=.01),this.preGain.gain.value=t,this.postGain.gain.value=Math.pow(1/t,.6)*e},et.prototype.shape=function(t,e,i){var o=1.05*i*e-e,s=t<0?-1:1,n=t<0?-t:t,r=n<e?n:e+o*function(t,e){return 1-Math.exp(-e*t)}(n-e,1/o);return r*=s},et.prototype.generateColortouchCurve=function(t,e){for(var i=E(t),o=E(e),s=32768,n=0,r=0;r<s;++r)n=r/s,n=this.shape(n,i,o),this.curve[s+r]=n,this.curve[s-r-1]=-n},et.prototype.connectTo=function(t){this.wetNode.disconnect(),this.wetNode.connect(t),this.dryNode.disconnect(),this.dryNode.connect(t)},et.prototype.remove=function(){this.inputNode.disconnect(),this.preGain.disconnect(),this.waveShaper.disconnect(),this.postGain.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},et.prototype.getInputNode=function(){return this.inputNode},et.prototype.setParam=function(t,e,i,o){switch(t){case 0:(e/=100)<0&&(e=0),e>1&&(e=1),this.params[4]=e,U(this.wetNode.gain,e,i,o),U(this.dryNode.gain,1-e,i,o)}},it.prototype.connectTo=function(t){this.node.disconnect(),this.node.connect(t)},it.prototype.remove=function(){this.node.disconnect()},it.prototype.getInputNode=function(){return this.node},it.prototype.setParam=function(t,e,i,o){},ot.prototype.tick=function(){this.node.getFloatFrequencyData(this.freqBins),this.node.getByteTimeDomainData(this.signal);var t=this.node.fftSize,e=0;this.peak=0;for(var i=0,o=0;e<t;e++)(o=(this.signal[e]-128)/128)<0&&(o=-o),this.peak<o&&(this.peak=o),i+=o*o;this.peak=k(this.peak),this.rms=k(Math.sqrt(i/t))},ot.prototype.connectTo=function(t){this.node.disconnect(),this.node.connect(t)},ot.prototype.remove=function(){this.node.disconnect()},ot.prototype.getInputNode=function(){return this.node},ot.prototype.setParam=function(t,e,i,o){},st.prototype.setObject=function(t){this.obj=t},st.prototype.hasObject=function(){return!!this.obj},st.prototype.tick=function(t){},nt.prototype.release=function(){var t,e,i,o;for(t=0,i=0,e=u.length;t<e;++t)o=u[t],u[i]=o,o.buffer===this?o.stop():++i;u.length=i,this.mediaSourceNode&&(this.mediaSourceNode.disconnect(),this.mediaSourceNode=null),this.outNode&&(this.outNode.disconnect(),this.outNode=null),this.bufferObject=null,this.audioData=null},nt.prototype.decodeAudioBuffer=function(){if(!this.bufferObject&&this.audioData){var t=this;if(l.decodeAudioData)l.decodeAudioData(this.audioData,function(i){var o,s,n,r;if(t.bufferObject=i,t.audioData=null,cr.is_undefined(t.playTagWhenReady)||_){if(!cr.is_undefined(t.convolveWhenReady)){var a=t.convolveWhenReady.convolveNode;a.normalize=t.normalizeWhenReady,a.buffer=i}}else if(t.panWhenReady.length){for(s=0,n=t.panWhenReady.length;s<n;s++)if(o=t.panWhenReady[s],(r=new rt(t,o.thistag)).setPannerEnabled(!0),void 0===o.objUid||(o.obj=e.getObjectByUID(o.objUid),o.obj)){if(o.obj){var h=cr.rotatePtAround(o.obj.x,o.obj.y,-o.obj.layer.getAngle(),x,g,!0),c=cr.rotatePtAround(o.obj.x,o.obj.y,-o.obj.layer.getAngle(),x,g,!1);r.setPan(h,c,cr.to_degrees(o.obj.angle-o.obj.layer.getAngle()),o.ia,o.oa,o.og),r.setObject(o.obj)}else r.setPan(o.x,o.y,o.a,o.ia,o.oa,o.og);r.play(t.loopWhenReady,t.volumeWhenReady,t.seekWhenReady),t.pauseWhenReady&&r.pause(),u.push(r)}cr.clearArray(t.panWhenReady)}else(r=new rt(t,t.playTagWhenReady||"")).play(t.loopWhenReady,t.volumeWhenReady,t.seekWhenReady),t.pauseWhenReady&&r.pause(),u.push(r)},function(e){t.failedToLoad=!0});else if(this.bufferObject=l.createBuffer(this.audioData,!1),this.audioData=null,cr.is_undefined(this.playTagWhenReady)||_){if(!cr.is_undefined(this.convolveWhenReady)){var i=this.convolveWhenReady.convolveNode;i.normalize=this.normalizeWhenReady,i.buffer=this.bufferObject}}else{var o=new rt(this,this.playTagWhenReady);o.play(this.loopWhenReady,this.volumeWhenReady,this.seekWhenReady),this.pauseWhenReady&&o.pause(),u.push(o)}}},nt.prototype.isLoaded=function(){switch(this.myapi){case n:var t=this.bufferObject.readyState>=4;return t&&(this.wasEverReady=!0),t||this.wasEverReady;case r:return!!this.audioData||!!this.bufferObject;case a:case h:return!0}return!1},nt.prototype.isLoadedAndDecoded=function(){switch(this.myapi){case n:return this.isLoaded();case r:return!!this.bufferObject;case a:case h:return!0}return!1},nt.prototype.hasFailedToLoad=function(){switch(this.myapi){case n:return!!this.bufferObject.error;case r:return this.failedToLoad}return!1},rt.prototype.hasEnded=function(){switch(this.myapi){case n:return this.instanceObject.ended;case r:return this.buffer.myapi===r?!(!this.fresh&&!this.stopped&&this.instanceObject.loop)&&(!this.is_paused&&this.hasPlaybackEnded):this.instanceObject.ended;case a:return this.hasPlaybackEnded}return!0},rt.prototype.canBeRecycled=function(){return!(!this.fresh&&!this.stopped)||this.hasEnded()},rt.prototype.setPannerEnabled=function(t){if(c===r)if(!this.pannerEnabled&&t){if(!this.gainNode)return;this.pannerNode||(this.pannerNode=l.createPanner(),"number"==typeof this.pannerNode.panningModel?this.pannerNode.panningModel=v:this.pannerNode.panningModel=["equalpower","HRTF","soundfield"][v],"number"==typeof this.pannerNode.distanceModel?this.pannerNode.distanceModel=B:this.pannerNode.distanceModel=["linear","inverse","exponential"][B],this.pannerNode.refDistance=D,this.pannerNode.maxDistance=w,this.pannerNode.rolloffFactor=C),this.gainNode.disconnect(),this.gainNode.connect(this.pannerNode),this.pannerNode.connect(F(this.tag)),this.pannerEnabled=!0}else if(this.pannerEnabled&&!t){if(!this.gainNode)return;this.pannerNode.disconnect(),this.gainNode.disconnect(),this.gainNode.connect(F(this.tag)),this.pannerEnabled=!1}},rt.prototype.setPan=function(t,e,i,o,s,n){this.pannerEnabled&&c===r&&(this.pannerNode.setPosition(t,e,0),this.pannerNode.setOrientation(Math.cos(cr.to_radians(i)),Math.sin(cr.to_radians(i)),0),this.pannerNode.coneInnerAngle=o,this.pannerNode.coneOuterAngle=s,this.pannerNode.coneOuterGain=n,this.panX=t,this.panY=e,this.panAngle=i,this.panConeInner=o,this.panConeOuter=s,this.panConeOuterGain=n)},rt.prototype.setObject=function(t){this.pannerEnabled&&c===r&&(this.objectTracker||(this.objectTracker=new st),this.objectTracker.setObject(t))},rt.prototype.tick=function(t){if(this.pannerEnabled&&c===r&&this.objectTracker&&this.objectTracker.hasObject()&&this.isPlaying()){this.objectTracker.tick(t);var e=this.objectTracker.obj,i=cr.rotatePtAround(e.x,e.y,-e.layer.getAngle(),x,g,!0),o=cr.rotatePtAround(e.x,e.y,-e.layer.getAngle(),x,g,!1);this.pannerNode.setPosition(i,o,0);var s=0;void 0!==this.objectTracker.obj.angle&&(s=e.angle-e.layer.getAngle(),this.pannerNode.setOrientation(Math.cos(s),Math.sin(s),0))}},rt.prototype.play=function(t,i,o,s){var c=this.instanceObject;this.looping=t,this.volume=i;var m=o||0;switch(s=s||0,this.myapi){case n:if(1!==c.playbackRate&&(c.playbackRate=1),c.volume!==i*f&&(c.volume=i*f),c.loop!==t&&(c.loop=t),c.muted&&(c.muted=!1),c.currentTime!==m)try{c.currentTime=m}catch(t){}V(this);break;case r:if(this.muted=!1,this.mutevol=1,this.buffer.myapi===r)this.gainNode.gain.value=i*f,this.fresh||(this.instanceObject=l.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode)),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=t,this.hasPlaybackEnded=!1,0===m?j(this.instanceObject,s):z(this.instanceObject,m,this.getDuration(),s);else{if(1!==c.playbackRate&&(c.playbackRate=1),c.loop!==t&&(c.loop=t),c.volume=i*f,c.currentTime!==m)try{c.currentTime=m}catch(t){}V(this)}break;case a:(!this.fresh&&this.stopped||0!==m)&&c.seekTo(m),c.play(),this.hasPlaybackEnded=!1;break;case h:e.isDirectCanvas?AppMobi.context.playSound(this.src,t):AppMobi.player.playSound(this.src,t)}this.playbackRate=1,this.startTime=(this.isTimescaled?e.kahanTime.sum:e.wallTime.sum)-m,this.fresh=!1,this.stopped=!1,this.is_paused=!1},rt.prototype.stop=function(){switch(this.myapi){case n:this.instanceObject.paused||this.instanceObject.pause();break;case r:this.buffer.myapi===r?W(this.instanceObject):this.instanceObject.paused||this.instanceObject.pause();break;case a:this.instanceObject.stop();break;case h:e.isDirectCanvas&&AppMobi.context.stopSound(this.src)}this.stopped=!0,this.is_paused=!1},rt.prototype.pause=function(){if(!(this.fresh||this.stopped||this.hasEnded()||this.is_paused)){switch(this.myapi){case n:this.instanceObject.paused||this.instanceObject.pause();break;case r:this.buffer.myapi===r?(this.resume_position=this.getPlaybackTime(!0),this.looping&&(this.resume_position=this.resume_position%this.getDuration()),this.is_paused=!0,W(this.instanceObject)):this.instanceObject.paused||this.instanceObject.pause();break;case a:this.instanceObject.pause();break;case h:e.isDirectCanvas&&AppMobi.context.stopSound(this.src)}this.is_paused=!0}},rt.prototype.resume=function(){if(!(this.fresh||this.stopped||this.hasEnded())&&this.is_paused){switch(this.myapi){case n:V(this);break;case r:this.buffer.myapi===r?(this.instanceObject=l.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=this.looping,this.gainNode.gain.value=f*this.volume*this.mutevol,this.updatePlaybackRate(),this.startTime=(this.isTimescaled?e.kahanTime.sum:e.wallTime.sum)-this.resume_position/(this.playbackRate||.001),z(this.instanceObject,this.resume_position,this.getDuration())):V(this);break;case a:this.instanceObject.play();break;case h:e.isDirectCanvas&&AppMobi.context.resumeSound(this.src)}this.is_paused=!1}},rt.prototype.seek=function(t){if(!(this.fresh||this.stopped||this.hasEnded()))switch(this.myapi){case n:try{this.instanceObject.currentTime=t}catch(t){}break;case r:if(this.buffer.myapi===r)this.is_paused?this.resume_position=t:(this.pause(),this.resume_position=t,this.resume());else try{this.instanceObject.currentTime=t}catch(t){}break;case a:break;case h:e.isDirectCanvas&&AppMobi.context.seekSound(this.src,t)}},rt.prototype.reconnect=function(t){this.myapi===r&&(this.pannerEnabled?(this.pannerNode.disconnect(),this.pannerNode.connect(t)):(this.gainNode.disconnect(),this.gainNode.connect(t)))},rt.prototype.getDuration=function(t){var i=0;switch(this.myapi){case n:void 0!==this.instanceObject.duration&&(i=this.instanceObject.duration);break;case r:i=this.buffer.bufferObject.duration;break;case a:i=this.instanceObject.getDuration();break;case h:e.isDirectCanvas&&(i=AppMobi.context.getDurationSound(this.src))}return t&&(i/=this.playbackRate||.001),i},rt.prototype.getPlaybackTime=function(t){var i=this.getDuration(),o=0;switch(this.myapi){case n:void 0!==this.instanceObject.currentTime&&(o=this.instanceObject.currentTime);break;case r:if(this.buffer.myapi===r){if(this.is_paused)return this.resume_position;o=(this.isTimescaled?e.kahanTime.sum:e.wallTime.sum)-this.startTime}else void 0!==this.instanceObject.currentTime&&(o=this.instanceObject.currentTime);break;case a:break;case h:e.isDirectCanvas&&(o=AppMobi.context.getPlaybackTimeSound(this.src))}return t&&(o*=this.playbackRate),!this.looping&&o>i&&(o=i),o},rt.prototype.isPlaying=function(){return!(this.is_paused||this.fresh||this.stopped||this.hasEnded())},rt.prototype.shouldSave=function(){return!this.fresh&&!this.stopped&&!this.hasEnded()},rt.prototype.setVolume=function(t){this.volume=t,this.updateVolume()},rt.prototype.updateVolume=function(){var t=this.volume*f;switch(isFinite(t)||(t=0),this.myapi){case n:void 0!==this.instanceObject.volume&&this.instanceObject.volume!==t&&(this.instanceObject.volume=t);break;case r:this.buffer.myapi===r?this.gainNode.gain.value=t*this.mutevol:void 0!==this.instanceObject.volume&&this.instanceObject.volume!==t&&(this.instanceObject.volume=t)}},rt.prototype.getVolume=function(){return this.volume},rt.prototype.doSetMuted=function(t){switch(this.myapi){case n:this.instanceObject.muted!==!!t&&(this.instanceObject.muted=!!t);break;case r:this.buffer.myapi===r?(this.mutevol=t?0:1,this.gainNode.gain.value=f*this.volume*this.mutevol):this.instanceObject.muted!==!!t&&(this.instanceObject.muted=!!t)}},rt.prototype.setMuted=function(t){this.is_muted=!!t,this.doSetMuted(this.is_muted||this.is_silent)},rt.prototype.setSilent=function(t){this.is_silent=!!t,this.doSetMuted(this.is_muted||this.is_silent)},rt.prototype.setLooping=function(t){switch(this.looping=t,this.myapi){case n:case r:this.instanceObject.loop!==!!t&&(this.instanceObject.loop=!!t);break;case a:break;case h:e.isDirectCanvas&&AppMobi.context.setLoopingSound(this.src,t)}},rt.prototype.setPlaybackRate=function(t){this.playbackRate=t,this.updatePlaybackRate()},rt.prototype.updatePlaybackRate=function(){var t=this.playbackRate;switch(this.isTimescaled&&(t*=e.timescale),this.myapi){case n:this.instanceObject.playbackRate!==t&&(this.instanceObject.playbackRate=t);break;case r:this.buffer.myapi===r?this.instanceObject.playbackRate.value!==t&&(this.instanceObject.playbackRate.value=t):this.instanceObject.playbackRate!==t&&(this.instanceObject.playbackRate=t)}},rt.prototype.setSuspended=function(t){switch(this.myapi){case n:t?this.isPlaying()?(this.resume_me=!0,this.instanceObject.pause()):this.resume_me=!1:this.resume_me&&(this.instanceObject.play(),this.resume_me=!1);break;case r:t?this.isPlaying()?(this.resume_me=!0,this.buffer.myapi===r?(this.resume_position=this.getPlaybackTime(!0),this.looping&&(this.resume_position=this.resume_position%this.getDuration()),W(this.instanceObject)):this.instanceObject.pause()):this.resume_me=!1:this.resume_me&&(this.buffer.myapi===r?(this.instanceObject=l.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=this.looping,this.gainNode.gain.value=f*this.volume*this.mutevol,this.updatePlaybackRate(),this.startTime=(this.isTimescaled?e.kahanTime.sum:e.wallTime.sum)-this.resume_position/(this.playbackRate||.001),z(this.instanceObject,this.resume_position,this.getDuration())):this.instanceObject.play(),this.resume_me=!1);break;case a:t?this.isPlaying()?(this.instanceObject.pause(),this.resume_me=!0):this.resume_me=!1:this.resume_me&&(this.resume_me=!1,this.instanceObject.play())}},t.Instance=function(t){if(this.type=t,this.runtime=t.runtime,e=this.runtime,i=this,this.listenerTracker=null,this.listenerZ=-600,this.runtime.isWKWebView&&(I=!0),!(this.runtime.isiOS||this.runtime.isAndroid&&(this.runtime.isChrome||this.runtime.isAndroidStockBrowser))||this.runtime.isCrosswalk||this.runtime.isDomFree||this.runtime.isAmazonWebApp||I||(M=!0),l=null,"undefined"!=typeof AudioContext?(c=r,l=new AudioContext):"undefined"!=typeof webkitAudioContext&&(c=r,l=new webkitAudioContext),this.runtime.isiOS&&l&&(l.close&&l.close(),"undefined"!=typeof AudioContext?l=new AudioContext:"undefined"!=typeof webkitAudioContext&&(l=new webkitAudioContext)),c!==r&&(this.runtime.isCordova&&void 0!==window.Media?c=a:this.runtime.isAppMobi&&(c=h)),c===a){var o=(s=location.href).lastIndexOf("/");o>-1&&(s=s.substr(0,o+1)),s=s.replace("file://","")}if(this.runtime.isSafari&&this.runtime.isWindows&&"undefined"==typeof Audio)alert("It looks like you're using Safari for Windows without Quicktime.  Audio cannot be played until Quicktime is installed."),this.runtime.DestroyInstance(this);else{if(this.runtime.isDirectCanvas)d=this.runtime.isAndroid;else try{d=!!(new Audio).canPlayType('audio/ogg; codecs="vorbis"')&&!this.runtime.isWindows10}catch(t){d=!1}c,this.runtime.tickMe(this)}};var at=t.Instance.prototype;at.onCreate=function(){this.runtime.audioInstance=this,y=this.properties[0],this.saveload=this.properties[1],this.playinbackground=0!==this.properties[2],this.nextPlayTime=0,v=this.properties[3],B=this.properties[4],this.listenerZ=-this.properties[5],D=this.properties[6],w=this.properties[7],C=this.properties[8],this.listenerTracker=new st;var t=this.runtime.draw_width||this.runtime.width,e=this.runtime.draw_height||this.runtime.height;c===r&&(l.listener.setPosition(t/2,e/2,this.listenerZ),l.listener.setOrientation(0,0,1,0,-1,0),window.c2OnAudioMicStream=function(t,e){S&&S.disconnect(),A=e.toLowerCase(),(S=l.createMediaStreamSource(t)).connect(F(A))}),this.runtime.addSuspendCallback(function(t){i.onSuspend(t)});var o=this;this.runtime.addDestroyCallback(function(t){o.onInstanceDestroyed(t)})},at.onInstanceDestroyed=function(t){var e,i,o;for(e=0,i=u.length;e<i;e++)(o=u[e]).objectTracker&&o.objectTracker.obj===t&&(o.objectTracker.obj=null,o.pannerEnabled&&o.isPlaying()&&o.looping&&o.stop());this.listenerTracker.obj===t&&(this.listenerTracker.obj=null)},at.saveToJSON=function(){var t,e,i,o,s,n,r,a={silent:_,masterVolume:f,listenerZ:this.listenerZ,listenerUid:this.listenerTracker.hasObject()?this.listenerTracker.obj.uid:-1,playing:[],effects:{}},h=a.playing;for(t=0,e=u.length;t<e;t++)(i=u[t]).shouldSave()&&3!==this.saveload&&(i.is_music&&1===this.saveload||(i.is_music||2!==this.saveload)&&(r=i.getPlaybackTime(),i.looping&&(r%=i.getDuration()),o={tag:i.tag,buffersrc:i.buffer.src,is_music:i.is_music,playbackTime:r,volume:i.volume,looping:i.looping,muted:i.is_muted,playbackRate:i.playbackRate,paused:i.is_paused,resume_position:i.resume_position},i.pannerEnabled&&(o.pan={},n=o.pan,i.objectTracker&&i.objectTracker.hasObject()?n.objUid=i.objectTracker.obj.uid:(n.x=i.panX,n.y=i.panY,n.a=i.panAngle),n.ia=i.panConeInner,n.oa=i.panConeOuter,n.og=i.panConeOuterGain),h.push(o)));var c,l=a.effects;for(s in N)if(N.hasOwnProperty(s)){for(c=[],t=0,e=N[s].length;t<e;t++)c.push({type:N[s][t].type,params:N[s][t].params});l[s]=c}return a};var ht=[];at.loadFromJSON=function(t){var e=t.silent;f=t.masterVolume,this.listenerZ=t.listenerZ,this.listenerTracker.setObject(null);var i=t.listenerUid;-1!==i&&(this.listenerTracker.loadUid=i,ht.push(this.listenerTracker));var o,s,n,r,a,h,c,l,m,p,d,y,x,g,b,v,B,D,w=t.playing;if(3!==this.saveload)for(o=0,s=u.length;o<s;o++)(d=u[o]).is_music&&1===this.saveload||(d.is_music||2!==this.saveload)&&d.stop();for(y in N)if(N.hasOwnProperty(y))for(o=0,s=N[y].length;o<s;o++)N[y][o].remove();for(y in cr.wipe(N),t.effects)if(t.effects.hasOwnProperty(y))for(o=0,s=(b=t.effects[y]).length;o<s;o++)switch(v=b[o].type,B=b[o].params,v){case"filter":dt(y,new X(B[0],B[1],B[2],B[3],B[4],B[5]));break;case"delay":dt(y,new Y(B[0],B[1],B[2]));break;case"convolve":r=B[2],(p=this.getAudioBuffer(r,!1)).bufferObject?D=new K(p.bufferObject,B[0],B[1],r):(D=new K(null,B[0],B[1],r),p.normalizeWhenReady=B[0],p.convolveWhenReady=D),dt(y,D);break;case"flanger":dt(y,new H(B[0],B[1],B[2],B[3],B[4]));break;case"phaser":dt(y,new Z(B[0],B[1],B[2],B[3],B[4],B[5]));break;case"gain":dt(y,new Q(B[0]));break;case"tremolo":dt(y,new $(B[0],B[1]));break;case"ringmod":dt(y,new tt(B[0],B[1]));break;case"distortion":dt(y,new et(B[0],B[1],B[2],B[3],B[4]));break;case"compressor":dt(y,new it(B[0],B[1],B[2],B[3],B[4]));break;case"analyser":dt(y,new ot(B[0],B[1]))}for(o=0,s=w.length;o<s;o++)3!==this.saveload&&(r=(n=w[o]).buffersrc,a=n.is_music,h=n.tag,c=n.playbackTime,l=n.looping,m=n.volume,g=(x=n.pan)&&x.hasOwnProperty("objUid")?x.objUid:-1,a&&1===this.saveload||(a||2!==this.saveload)&&((d=this.getAudioInstance(r,h,a,l,m))?(d.resume_position=n.resume_position,d.setPannerEnabled(!!x),d.play(l,m,c),d.updatePlaybackRate(),d.updateVolume(),d.doSetMuted(d.is_muted||d.is_silent),n.paused&&d.pause(),n.muted&&d.setMuted(!0),d.doSetMuted(d.is_muted||d.is_silent),x&&(-1!==g?(d.objectTracker=d.objectTracker||new st,d.objectTracker.loadUid=g,ht.push(d.objectTracker)):d.setPan(x.x,x.y,x.a,x.ia,x.oa,x.og))):((p=this.getAudioBuffer(r,a)).seekWhenReady=c,p.pauseWhenReady=n.paused,x&&(-1!==g?p.panWhenReady.push({objUid:g,ia:x.ia,oa:x.oa,og:x.og,thistag:h}):p.panWhenReady.push({x:x.x,y:x.y,a:x.a,ia:x.ia,oa:x.oa,og:x.og,thistag:h})))));if(e&&!_){for(o=0,s=u.length;o<s;o++)u[o].setSilent(!0);_=!0}else if(!e&&_){for(o=0,s=u.length;o<s;o++)u[o].setSilent(!1);_=!1}},at.afterLoad=function(){var t,e,i,o;for(t=0,e=ht.length;t<e;t++)i=ht[t],o=this.runtime.getObjectByUID(i.loadUid),i.setObject(o),i.loadUid=-1,o&&(x=o.x,g=o.y);cr.clearArray(ht)},at.onSuspend=function(t){if(!this.playinbackground){var e,i;for(!t&&l&&l.resume&&(l.resume(),b=!1),e=0,i=u.length;e<i;e++)u[e].setSuspended(t);t&&l&&l.suspend&&(l.suspend(),b=!0)}},at.tick=function(){var t,e,i,o,s,n,a=this.runtime.dt;for(t=0,e=u.length;t<e;t++)(i=u[t]).tick(a),0!==y&&i.updatePlaybackRate();for(o in N)if(N.hasOwnProperty(o))for(t=0,e=(s=N[o]).length;t<e;t++)(n=s[t]).tick&&n.tick();c===r&&this.listenerTracker.hasObject()&&(this.listenerTracker.tick(a),x=this.listenerTracker.obj.x,g=this.listenerTracker.obj.y,l.listener.setPosition(this.listenerTracker.obj.x,this.listenerTracker.obj.y,this.listenerZ))};var ct=[];at.setPreloadList=function(t){var e,i,o,s,n,r,a=0;for(e=0,i=t.length;e<i;++e)s=(o=t[e])[0],n=2*o[1],((r=s.length>4&&".ogg"===s.substr(s.length-4))&&d||!r&&!d)&&(ct.push({filename:s,size:n,obj:null}),a+=n);return a},at.startPreloads=function(){var t,e,i,o;for(t=0,e=ct.length;t<e;++t)i=ct[t],o=this.runtime.files_subfolder+i.filename,i.obj=this.getAudioBuffer(o,!1)},at.getPreloadedSize=function(){var t,e,i,o=0;for(t=0,e=ct.length;t<e;++t)(i=ct[t]).obj.isLoadedAndDecoded()||i.obj.hasFailedToLoad()||this.runtime.isDomFree||this.runtime.isAndroidStockBrowser?o+=i.size:i.obj.isLoaded()&&(o+=Math.floor(i.size/2));return o},at.releaseAllMusicBuffers=function(){var t,e,i,o;for(t=0,i=0,e=m.length;t<e;++t)o=m[t],m[i]=o,o.is_music?o.release():++i;m.length=i},at.getAudioBuffer=function(t,e,i){var o,s,n,r=null;for(o=0,s=m.length;o<s;o++)if((n=m[o]).src===t){r=n;break}return r||i||(I&&e&&this.releaseAllMusicBuffers(),r=new nt(t,e),m.push(r)),r},at.getAudioInstance=function(t,e,i,o,s){var n,r,a;for(n=0,r=u.length;n<r;n++)if((a=u[n]).src===t&&(a.canBeRecycled()||i))return a.tag=e,a;var h=this.getAudioBuffer(t,i);return h.bufferObject?(a=new rt(h,e),u.push(a),a):("<preload>"!==e&&(h.playTagWhenReady=e,h.loopWhenReady=o,h.volumeWhenReady=s),null)};var lt=[];function mt(t,e){var i=t.isPlaying()?1:0,o=e.isPlaying()?1:0;return i===o?0:i<o?1:-1}function ut(t,e){if(cr.clearArray(lt),!t.length)return!p||p.hasEnded()?void 0:(cr.clearArray(lt),void(lt[0]=p));var i,o,s;for(i=0,o=u.length;i<o;i++)s=u[i],cr.equals_nocase(t,s.tag)&&lt.push(s);e&&lt.sort(mt)}function pt(t){var e,i,o,s,n=l.destination;if(N.hasOwnProperty(t)&&(o=N[t]).length)for(n=o[0].getInputNode(),e=0,i=o.length;e<i;e++)s=o[e],e+1===i?s.connectTo(l.destination):s.connectTo(o[e+1].getInputNode());for(ut(t),e=0,i=lt.length;e<i;e++)lt[e].reconnect(n);S&&A===t&&(S.disconnect(),S.connect(n))}function dt(t,e){N.hasOwnProperty(t)?N[t].push(e):N[t]=[e],pt(t)}function yt(){}function _t(){}function ft(){}function xt(t,e){var i=null;return N.hasOwnProperty(t)&&(i=N[t]),i&&e>=0&&e<i.length&&i[e].freqBins?i[e]:null}yt.prototype.OnEnded=function(t){return cr.equals_nocase(o,t)},yt.prototype.PreloadsComplete=function(){var t,e;for(t=0,e=m.length;t<e;t++)if(!m[t].isLoadedAndDecoded()&&!m[t].hasFailedToLoad())return!1;return!0},yt.prototype.AdvancedAudioSupported=function(){return c===r},yt.prototype.IsSilent=function(){return _},yt.prototype.IsAnyPlaying=function(){var t,e;for(t=0,e=u.length;t<e;t++)if(u[t].isPlaying())return!0;return!1},yt.prototype.IsTagPlaying=function(t){var e,i;for(ut(t),e=0,i=lt.length;e<i;e++)if(lt[e].isPlaying())return!0;return!1},t.cnds=new yt,_t.prototype.Play=function(t,e,i,o){if(!_){var s=O(i),n=t[1],r=this.runtime.files_subfolder+t[0]+(d?".ogg":".m4a");(p=this.getAudioInstance(r,o,n,0!==e,s))&&(p.setPannerEnabled(!1),p.play(0!==e,s,0,this.nextPlayTime),this.nextPlayTime=0)}},_t.prototype.PlayAtPosition=function(t,e,i,o,s,n,r,a,h,c){if(!_){var l=O(i),m=t[1],u=this.runtime.files_subfolder+t[0]+(d?".ogg":".m4a");if(p=this.getAudioInstance(u,c,m,0!==e,l))p.setPannerEnabled(!0),p.setPan(o,s,n,r,a,O(h)),p.play(0!==e,l,0,this.nextPlayTime),this.nextPlayTime=0;else this.getAudioBuffer(u,m).panWhenReady.push({x:o,y:s,a:n,ia:r,oa:a,og:O(h),thistag:c})}},_t.prototype.PlayAtObject=function(t,e,i,o,s,n,r,a){if(!_&&o){var h=o.getFirstPicked();if(h){var c=O(i),l=t[1],m=this.runtime.files_subfolder+t[0]+(d?".ogg":".m4a");if(p=this.getAudioInstance(m,a,l,0!==e,c)){p.setPannerEnabled(!0);var u=cr.rotatePtAround(h.x,h.y,-h.layer.getAngle(),x,g,!0),y=cr.rotatePtAround(h.x,h.y,-h.layer.getAngle(),x,g,!1);p.setPan(u,y,cr.to_degrees(h.angle-h.layer.getAngle()),s,n,O(r)),p.setObject(h),p.play(0!==e,c,0,this.nextPlayTime),this.nextPlayTime=0}else{this.getAudioBuffer(m,l).panWhenReady.push({obj:h,ia:s,oa:n,og:O(r),thistag:a})}}}},_t.prototype.PlayByName=function(t,e,i,o,s){if(!_){var n=O(o),r=1===t,a=this.runtime.files_subfolder+e.toLowerCase()+(d?".ogg":".m4a");(p=this.getAudioInstance(a,s,r,0!==i,n))&&(p.setPannerEnabled(!1),p.play(0!==i,n,0,this.nextPlayTime),this.nextPlayTime=0)}},_t.prototype.PlayAtPositionByName=function(t,e,i,o,s,n,r,a,h,c,l){if(!_){var m=O(o),u=1===t,y=this.runtime.files_subfolder+e.toLowerCase()+(d?".ogg":".m4a");if(p=this.getAudioInstance(y,l,u,0!==i,m))p.setPannerEnabled(!0),p.setPan(s,n,r,a,h,O(c)),p.play(0!==i,m,0,this.nextPlayTime),this.nextPlayTime=0;else this.getAudioBuffer(y,u).panWhenReady.push({x:s,y:n,a:r,ia:a,oa:h,og:O(c),thistag:l})}},_t.prototype.PlayAtObjectByName=function(t,e,i,o,s,n,r,a,h){if(!_&&s){var c=s.getFirstPicked();if(c){var l=O(o),m=1===t,u=this.runtime.files_subfolder+e.toLowerCase()+(d?".ogg":".m4a");if(p=this.getAudioInstance(u,h,m,0!==i,l)){p.setPannerEnabled(!0);var y=cr.rotatePtAround(c.x,c.y,-c.layer.getAngle(),x,g,!0),f=cr.rotatePtAround(c.x,c.y,-c.layer.getAngle(),x,g,!1);p.setPan(y,f,cr.to_degrees(c.angle-c.layer.getAngle()),n,r,O(a)),p.setObject(c),p.play(0!==i,l,0,this.nextPlayTime),this.nextPlayTime=0}else{this.getAudioBuffer(u,m).panWhenReady.push({obj:c,ia:n,oa:r,og:O(a),thistag:h})}}}},_t.prototype.SetLooping=function(t,e){var i,o;for(ut(t),i=0,o=lt.length;i<o;i++)lt[i].setLooping(0===e)},_t.prototype.SetMuted=function(t,e){var i,o;for(ut(t),i=0,o=lt.length;i<o;i++)lt[i].setMuted(0===e)},_t.prototype.SetVolume=function(t,e){ut(t);var i,o,s=O(e);for(i=0,o=lt.length;i<o;i++)lt[i].setVolume(s)},_t.prototype.Preload=function(t){if(!_){var e=t[1],i=this.runtime.files_subfolder+t[0]+(d?".ogg":".m4a");c!==h?c!==a&&this.getAudioInstance(i,"<preload>",e,!1):this.runtime.isDirectCanvas?AppMobi.context.loadSound(i):AppMobi.player.loadSound(i)}},_t.prototype.PreloadByName=function(t,e){if(!_){var i=1===t,o=this.runtime.files_subfolder+e.toLowerCase()+(d?".ogg":".m4a");c!==h?c!==a&&this.getAudioInstance(o,"<preload>",i,!1):this.runtime.isDirectCanvas?AppMobi.context.loadSound(o):AppMobi.player.loadSound(o)}},_t.prototype.SetPlaybackRate=function(t,e){var i,o;for(ut(t),e<0&&(e=0),i=0,o=lt.length;i<o;i++)lt[i].setPlaybackRate(e)},_t.prototype.Stop=function(t){var e,i;for(ut(t),e=0,i=lt.length;e<i;e++)lt[e].stop()},_t.prototype.StopAll=function(){var t,e;for(t=0,e=u.length;t<e;t++)u[t].stop()},_t.prototype.SetPaused=function(t,e){var i,o;for(ut(t),i=0,o=lt.length;i<o;i++)0===e?lt[i].pause():lt[i].resume()},_t.prototype.Seek=function(t,e){var i,o;for(ut(t),i=0,o=lt.length;i<o;i++)lt[i].seek(e)},_t.prototype.SetSilent=function(t){var e,i;if(2===t&&(t=_?1:0),0!==t||_){if(1===t&&_){for(e=0,i=u.length;e<i;e++)u[e].setSilent(!1);_=!1}}else{for(e=0,i=u.length;e<i;e++)u[e].setSilent(!0);_=!0}},_t.prototype.SetMasterVolume=function(t){var e,i;for(f=O(t),e=0,i=u.length;e<i;e++)u[e].updateVolume()},_t.prototype.AddFilterEffect=function(t,e,i,o,s,n,a){c!==r||e<0||e>=q.length||!l.createBiquadFilter||((a/=100)<0&&(a=0),a>1&&(a=1),dt(t=t.toLowerCase(),new X(e,i,o,s,n,a)))},_t.prototype.AddDelayEffect=function(t,e,i,o){c===r&&((o/=100)<0&&(o=0),o>1&&(o=1),dt(t=t.toLowerCase(),new Y(e,O(i),o)))},_t.prototype.AddFlangerEffect=function(t,e,i,o,s,n){c===r&&l.createOscillator&&((n/=100)<0&&(n=0),n>1&&(n=1),dt(t=t.toLowerCase(),new H(e/1e3,i/1e3,o,s/100,n)))},_t.prototype.AddPhaserEffect=function(t,e,i,o,s,n,a){c===r&&l.createOscillator&&((a/=100)<0&&(a=0),a>1&&(a=1),dt(t=t.toLowerCase(),new Z(e,i,o,s,n,a)))},_t.prototype.AddConvolutionEffect=function(t,e,i,o){if(c===r&&l.createConvolver){var s,n=0===i,a=this.runtime.files_subfolder+e[0]+(d?".ogg":".m4a"),h=this.getAudioBuffer(a,!1);t=t.toLowerCase(),(o/=100)<0&&(o=0),o>1&&(o=1),h.bufferObject?s=new K(h.bufferObject,n,o,a):(s=new K(null,n,o,a),h.normalizeWhenReady=n,h.convolveWhenReady=s),dt(t,s)}},_t.prototype.AddGainEffect=function(t,e){c===r&&dt(t=t.toLowerCase(),new Q(O(e)))},_t.prototype.AddMuteEffect=function(t){c===r&&dt(t=t.toLowerCase(),new Q(0))},_t.prototype.AddTremoloEffect=function(t,e,i){c===r&&l.createOscillator&&((i/=100)<0&&(i=0),i>1&&(i=1),dt(t=t.toLowerCase(),new $(e,i)))},_t.prototype.AddRingModEffect=function(t,e,i){c===r&&l.createOscillator&&((i/=100)<0&&(i=0),i>1&&(i=1),dt(t=t.toLowerCase(),new tt(e,i)))},_t.prototype.AddDistortionEffect=function(t,e,i,o,s,n){c===r&&l.createWaveShaper&&((n/=100)<0&&(n=0),n>1&&(n=1),dt(t=t.toLowerCase(),new et(e,i,o,s,n)))},_t.prototype.AddCompressorEffect=function(t,e,i,o,s,n){c===r&&l.createDynamicsCompressor&&dt(t=t.toLowerCase(),new it(e,i,o,s/1e3,n/1e3))},_t.prototype.AddAnalyserEffect=function(t,e,i){c===r&&dt(t=t.toLowerCase(),new ot(e,i))},_t.prototype.RemoveEffects=function(t){var e,i,o;if(c===r&&(t=t.toLowerCase(),N.hasOwnProperty(t)&&(o=N[t]).length)){for(e=0,i=o.length;e<i;e++)o[e].remove();cr.clearArray(o),pt(t)}},_t.prototype.SetEffectParameter=function(t,e,i,o,s,n){var a;c===r&&(t=t.toLowerCase(),e=Math.floor(e),N.hasOwnProperty(t)&&(a=N[t],e<0||e>=a.length||a[e].setParam(i,o,s,n)))},_t.prototype.SetListenerObject=function(t){if(t&&c===r){var e=t.getFirstPicked();e&&(this.listenerTracker.setObject(e),x=e.x,g=e.y)}},_t.prototype.SetListenerZ=function(t){this.listenerZ=t},_t.prototype.ScheduleNextPlay=function(t){l&&(this.nextPlayTime=t)},_t.prototype.UnloadAudio=function(t){var e=t[1],i=this.runtime.files_subfolder+t[0]+(d?".ogg":".m4a"),o=this.getAudioBuffer(i,e,!0);o&&(o.release(),cr.arrayFindRemove(m,o))},_t.prototype.UnloadAudioByName=function(t,e){var i=1===t,o=this.runtime.files_subfolder+e.toLowerCase()+(d?".ogg":".m4a"),s=this.getAudioBuffer(o,i,!0);s&&(s.release(),cr.arrayFindRemove(m,s))},_t.prototype.UnloadAll=function(){var t,e;for(t=0,e=m.length;t<e;++t)m[t].release();cr.clearArray(m)},t.acts=new _t,ft.prototype.Duration=function(t,e){ut(e,!0),lt.length?t.set_float(lt[0].getDuration()):t.set_float(0)},ft.prototype.PlaybackTime=function(t,e){ut(e,!0),lt.length?t.set_float(lt[0].getPlaybackTime(!0)):t.set_float(0)},ft.prototype.Volume=function(t,e){if(ut(e,!0),lt.length){var i=lt[0].getVolume();t.set_float(k(i))}else t.set_float(0)},ft.prototype.MasterVolume=function(t){t.set_float(k(f))},ft.prototype.EffectCount=function(t,e){e=e.toLowerCase();var i=null;N.hasOwnProperty(e)&&(i=N[e]),t.set_int(i?i.length:0)},ft.prototype.AnalyserFreqBinCount=function(t,e,i){var o=xt(e=e.toLowerCase(),i=Math.floor(i));t.set_int(o?o.node.frequencyBinCount:0)},ft.prototype.AnalyserFreqBinAt=function(t,e,i,o){e=e.toLowerCase(),i=Math.floor(i),o=Math.floor(o);var s=xt(e,i);s?o<0||o>=s.node.frequencyBinCount?t.set_float(0):t.set_float(s.freqBins[o]):t.set_float(0)},ft.prototype.AnalyserPeakLevel=function(t,e,i){var o=xt(e=e.toLowerCase(),i=Math.floor(i));o?t.set_float(o.peak):t.set_float(0)},ft.prototype.AnalyserRMSLevel=function(t,e,i){var o=xt(e=e.toLowerCase(),i=Math.floor(i));o?t.set_float(o.rms):t.set_float(0)},ft.prototype.SampleRate=function(t){t.set_int(l?l.sampleRate:0)},ft.prototype.CurrentTime=function(t){t.set_float(l?l.currentTime:cr.performance_now())},t.exps=new ft}(),cr.plugins_.Browser=function(t){this.runtime=t},function(){var pluginProto=cr.plugins_.Browser.prototype;pluginProto.Type=function(t){this.plugin=t,this.runtime=t.runtime};var typeProto=pluginProto.Type.prototype;typeProto.onCreate=function(){};var offlineScriptReady=!1,browserPluginReady=!1;document.addEventListener("DOMContentLoaded",function(){if(window.C2_RegisterSW&&navigator.serviceWorker){var t=document.createElement("script");t.onload=function(){offlineScriptReady=!0,checkReady()},t.src="offlineClient.js",document.head.appendChild(t)}});var browserInstance=null;function checkReady(){offlineScriptReady&&browserPluginReady&&window.OfflineClientInfo&&window.OfflineClientInfo.SetMessageCallback(function(t){browserInstance.onSWMessage(t)})}typeProto.onAppBegin=function(){browserPluginReady=!0,checkReady()},pluginProto.Instance=function(t){this.type=t,this.runtime=t.runtime};var instanceProto=pluginProto.Instance.prototype;instanceProto.onCreate=function(){var t=this;window.addEventListener("resize",function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnResize,t)}),browserInstance=this,void 0!==navigator.onLine&&(window.addEventListener("online",function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOnline,t)}),window.addEventListener("offline",function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOffline,t)})),this.runtime.isDirectCanvas||(document.addEventListener("appMobi.device.update.available",function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateReady,t)}),document.addEventListener("backbutton",function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,t)}),document.addEventListener("menubutton",function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnMenuButton,t)}),document.addEventListener("searchbutton",function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnSearchButton,t)}),document.addEventListener("tizenhwkey",function(e){switch(e.keyName){case"back":t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,t)||window.tizen&&window.tizen.application.getCurrentApplication().exit();break;case"menu":t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnMenuButton,t)||e.preventDefault()}})),this.runtime.isWindows10&&"undefined"!=typeof Windows?Windows.UI.Core.SystemNavigationManager.getForCurrentView().addEventListener("backrequested",function(e){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,t)&&(e.handled=!0)}):this.runtime.isWinJS&&WinJS.Application&&(WinJS.Application.onbackclick=function(e){return!!t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,t)}),this.runtime.addSuspendCallback(function(e){e?t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageHidden,t):t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageVisible,t)}),this.is_arcade=void 0!==window.is_scirra_arcade},instanceProto.onSWMessage=function(t){var e=t.data.type;"downloading-update"===e?this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateFound,this):"update-ready"===e||"update-pending"===e?this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateReady,this):"offline-ready"===e&&this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOfflineReady,this)};var batteryManager=null,loadedBatteryManager=!1;function maybeLoadBatteryManager(){if(!loadedBatteryManager&&navigator.getBattery){var t=navigator.getBattery();loadedBatteryManager=!0,t&&t.then(function(t){batteryManager=t})}}function Cnds(){}function Acts(){}Cnds.prototype.CookiesEnabled=function(){return!!navigator&&navigator.cookieEnabled},Cnds.prototype.IsOnline=function(){return!!navigator&&navigator.onLine},Cnds.prototype.HasJava=function(){return!!navigator&&navigator.javaEnabled()},Cnds.prototype.OnOnline=function(){return!0},Cnds.prototype.OnOffline=function(){return!0},Cnds.prototype.IsDownloadingUpdate=function(){return!1},Cnds.prototype.OnUpdateReady=function(){return!0},Cnds.prototype.PageVisible=function(){return!this.runtime.isSuspended},Cnds.prototype.OnPageVisible=function(){return!0},Cnds.prototype.OnPageHidden=function(){return!0},Cnds.prototype.OnResize=function(){return!0},Cnds.prototype.IsFullscreen=function(){return!!(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||this.runtime.isNodeFullscreen)},Cnds.prototype.OnBackButton=function(){return!0},Cnds.prototype.OnMenuButton=function(){return!0},Cnds.prototype.OnSearchButton=function(){return!0},Cnds.prototype.IsMetered=function(){var t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return!!t&&!!t.metered},Cnds.prototype.IsCharging=function(){var t=navigator.battery||navigator.mozBattery||navigator.webkitBattery;return t?!!t.charging:(maybeLoadBatteryManager(),!batteryManager||!!batteryManager.charging)},Cnds.prototype.IsPortraitLandscape=function(t){return(window.innerWidth<=window.innerHeight?0:1)===t},Cnds.prototype.SupportsFullscreen=function(){if(this.runtime.isNodeWebkit)return!0;var t=this.runtime.canvasdiv||this.runtime.canvas;return!!(t.requestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen||t.webkitRequestFullScreen)},Cnds.prototype.OnUpdateFound=function(){return!0},Cnds.prototype.OnUpdateReady=function(){return!0},Cnds.prototype.OnOfflineReady=function(){return!0},pluginProto.cnds=new Cnds,Acts.prototype.Alert=function(t){this.runtime.isDomFree||alert(t.toString())},Acts.prototype.Close=function(){this.runtime.isCocoonJs?CocoonJS.App.forceToFinish():window.tizen?window.tizen.application.getCurrentApplication().exit():navigator.app&&navigator.app.exitApp?navigator.app.exitApp():navigator.device&&navigator.device.exitApp?navigator.device.exitApp():this.is_arcade||this.runtime.isDomFree||window.close()},Acts.prototype.Focus=function(){this.runtime.isNodeWebkit?window.nwgui.Window.get().focus():this.is_arcade||this.runtime.isDomFree||window.focus()},Acts.prototype.Blur=function(){this.runtime.isNodeWebkit?window.nwgui.Window.get().blur():this.is_arcade||this.runtime.isDomFree||window.blur()},Acts.prototype.GoBack=function(){navigator.app&&navigator.app.backHistory?navigator.app.backHistory():this.is_arcade||this.runtime.isDomFree||!window.back||window.back()},Acts.prototype.GoForward=function(){this.is_arcade||this.runtime.isDomFree||!window.forward||window.forward()},Acts.prototype.GoHome=function(){this.is_arcade||this.runtime.isDomFree||!window.home||window.home()},Acts.prototype.GoToURL=function(t,e){this.runtime.isCocoonJs?CocoonJS.App.openURL(t):this.runtime.isEjecta?ejecta.openURL(t):this.runtime.isWinJS?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(t)):navigator.app&&navigator.app.loadUrl?navigator.app.loadUrl(t,{openExternal:!0}):this.runtime.isCordova?window.open(t,"_system"):this.is_arcade||this.runtime.isDomFree||(2!==e||this.is_arcade?1!==e||this.is_arcade?window.location=t:window.parent.location=t:window.top.location=t)},Acts.prototype.GoToURLWindow=function(t,e){this.runtime.isCocoonJs?CocoonJS.App.openURL(t):this.runtime.isEjecta?ejecta.openURL(t):this.runtime.isWinJS?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(t)):navigator.app&&navigator.app.loadUrl?navigator.app.loadUrl(t,{openExternal:!0}):this.runtime.isCordova?window.open(t,"_system"):this.is_arcade||this.runtime.isDomFree||window.open(t,e)},Acts.prototype.Reload=function(){this.is_arcade||this.runtime.isDomFree||window.location.reload()};var firstRequestFullscreen=!0,crruntime=null;function onFullscreenError(t){console&&console.warn&&console.warn("Fullscreen request failed: ",t),crruntime.setSize(window.innerWidth,window.innerHeight)}Acts.prototype.RequestFullScreen=function(t){if(this.runtime.isDomFree)cr.logexport("[Construct 2] Requesting fullscreen is not supported on this platform - the request has been ignored");else if(t>=2&&(t+=1),6===t&&(t=2),this.runtime.isNodeWebkit)this.runtime.isDebug?debuggerFullscreen(!0):!this.runtime.isNodeFullscreen&&window.nwgui&&(window.nwgui.Window.get().enterFullscreen(),this.runtime.isNodeFullscreen=!0,this.runtime.fullscreen_scaling=t>=2?t:0);else{if(document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement||document.fullScreen||document.fullScreenElement)return;this.runtime.fullscreen_scaling=t>=2?t:0;var e=document.documentElement;firstRequestFullscreen&&(firstRequestFullscreen=!1,crruntime=this.runtime,e.addEventListener("mozfullscreenerror",onFullscreenError),e.addEventListener("webkitfullscreenerror",onFullscreenError),e.addEventListener("MSFullscreenError",onFullscreenError),e.addEventListener("fullscreenerror",onFullscreenError)),e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitRequestFullScreen&&("undefined"!=typeof Element&&void 0!==Element.ALLOW_KEYBOARD_INPUT?e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):e.webkitRequestFullScreen())}},Acts.prototype.CancelFullScreen=function(){this.runtime.isDomFree?cr.logexport("[Construct 2] Exiting fullscreen is not supported on this platform - the request has been ignored"):this.runtime.isNodeWebkit?this.runtime.isDebug?debuggerFullscreen(!1):this.runtime.isNodeFullscreen&&window.nwgui&&(window.nwgui.Window.get().leaveFullscreen(),this.runtime.isNodeFullscreen=!1):document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()},Acts.prototype.Vibrate=function(t){try{var e,i,o=t.split(",");for(e=0,i=o.length;e<i;e++)o[e]=parseInt(o[e],10);navigator.vibrate?navigator.vibrate(o):navigator.mozVibrate?navigator.mozVibrate(o):navigator.webkitVibrate?navigator.webkitVibrate(o):navigator.msVibrate&&navigator.msVibrate(o)}catch(t){}},Acts.prototype.InvokeDownload=function(t,e){var i=document.createElement("a");if(void 0===i.download)window.open(t);else{var o=document.getElementsByTagName("body")[0];i.textContent=e,i.href=t,i.download=e,o.appendChild(i);var s=new MouseEvent("click");i.dispatchEvent(s),o.removeChild(i)}},Acts.prototype.InvokeDownloadString=function(t,e,i){var o="data:"+e+","+encodeURIComponent(t),s=document.createElement("a");if(void 0===s.download)window.open(o);else{var n=document.getElementsByTagName("body")[0];s.textContent=i,s.href=o,s.download=i,n.appendChild(s);var r=new MouseEvent("click");s.dispatchEvent(r),n.removeChild(s)}},Acts.prototype.ConsoleLog=function(t,e){"undefined"!=typeof console&&(0===t&&console.log&&console.log(e.toString()),1===t&&console.warn&&console.warn(e.toString()),2===t&&console.error&&console.error(e.toString()))},Acts.prototype.ConsoleGroup=function(t){console&&console.group&&console.group(t)},Acts.prototype.ConsoleGroupEnd=function(){console&&console.groupEnd&&console.groupEnd()},Acts.prototype.ExecJs=function(js_){try{eval&&eval(js_)}catch(t){console&&console.error&&console.error("Error executing Javascript: ",t)}};var orientations=["portrait","landscape","portrait-primary","portrait-secondary","landscape-primary","landscape-secondary"];function Exps(){}Acts.prototype.LockOrientation=function(t){if(!((t=Math.floor(t))<0||t>=orientations.length)){this.runtime.autoLockOrientation=!1;var e=orientations[t];screen.orientation&&screen.orientation.lock?screen.orientation.lock(e):screen.lockOrientation?screen.lockOrientation(e):screen.webkitLockOrientation?screen.webkitLockOrientation(e):screen.mozLockOrientation?screen.mozLockOrientation(e):screen.msLockOrientation&&screen.msLockOrientation(e)}},Acts.prototype.UnlockOrientation=function(){this.runtime.autoLockOrientation=!1,screen.orientation&&screen.orientation.unlock?screen.orientation.unlock():screen.unlockOrientation?screen.unlockOrientation():screen.webkitUnlockOrientation?screen.webkitUnlockOrientation():screen.mozUnlockOrientation?screen.mozUnlockOrientation():screen.msUnlockOrientation&&screen.msUnlockOrientation()},pluginProto.acts=new Acts,Exps.prototype.URL=function(t){t.set_string(this.runtime.isDomFree?"":window.location.toString())},Exps.prototype.Protocol=function(t){t.set_string(this.runtime.isDomFree?"":window.location.protocol)},Exps.prototype.Domain=function(t){t.set_string(this.runtime.isDomFree?"":window.location.hostname)},Exps.prototype.PathName=function(t){t.set_string(this.runtime.isDomFree?"":window.location.pathname)},Exps.prototype.Hash=function(t){t.set_string(this.runtime.isDomFree?"":window.location.hash)},Exps.prototype.Referrer=function(t){t.set_string(this.runtime.isDomFree?"":document.referrer)},Exps.prototype.Title=function(t){t.set_string(this.runtime.isDomFree?"":document.title)},Exps.prototype.Name=function(t){t.set_string(this.runtime.isDomFree?"":navigator.appName)},Exps.prototype.Version=function(t){t.set_string(this.runtime.isDomFree?"":navigator.appVersion)},Exps.prototype.Language=function(t){navigator&&navigator.language?t.set_string(navigator.language):t.set_string("")},Exps.prototype.Platform=function(t){t.set_string(this.runtime.isDomFree?"":navigator.platform)},Exps.prototype.Product=function(t){navigator&&navigator.product?t.set_string(navigator.product):t.set_string("")},Exps.prototype.Vendor=function(t){navigator&&navigator.vendor?t.set_string(navigator.vendor):t.set_string("")},Exps.prototype.UserAgent=function(t){t.set_string(this.runtime.isDomFree?"":navigator.userAgent)},Exps.prototype.QueryString=function(t){t.set_string(this.runtime.isDomFree?"":window.location.search)},Exps.prototype.QueryParam=function(t,e){if(this.runtime.isDomFree)t.set_string("");else{var i=RegExp("[?&]"+e+"=([^&]*)").exec(window.location.search);i?t.set_string(decodeURIComponent(i[1].replace(/\+/g," "))):t.set_string("")}},Exps.prototype.Bandwidth=function(t){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;e?void 0!==e.bandwidth?t.set_float(e.bandwidth):void 0!==e.downlinkMax?t.set_float(e.downlinkMax):t.set_float(Number.POSITIVE_INFINITY):t.set_float(Number.POSITIVE_INFINITY)},Exps.prototype.ConnectionType=function(t){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;e?t.set_string(e.type||"unknown"):t.set_string("unknown")},Exps.prototype.BatteryLevel=function(t){var e=navigator.battery||navigator.mozBattery||navigator.webkitBattery;e?t.set_float(e.level):(maybeLoadBatteryManager(),batteryManager?t.set_float(batteryManager.level):t.set_float(1))},Exps.prototype.BatteryTimeLeft=function(t){var e=navigator.battery||navigator.mozBattery||navigator.webkitBattery;e?t.set_float(e.dischargingTime):(maybeLoadBatteryManager(),batteryManager?t.set_float(batteryManager.dischargingTime):t.set_float(Number.POSITIVE_INFINITY))},Exps.prototype.ExecJS=function(ret,js_){if(eval){var result=0;try{result=eval(js_)}catch(t){console&&console.error&&console.error("Error executing Javascript: ",t)}"number"==typeof result?ret.set_any(result):"string"==typeof result?ret.set_any(result):"boolean"==typeof result?ret.set_any(result?1:0):ret.set_any(0)}else ret.set_any(0)},Exps.prototype.ScreenWidth=function(t){t.set_int(screen.width)},Exps.prototype.ScreenHeight=function(t){t.set_int(screen.height)},Exps.prototype.DevicePixelRatio=function(t){t.set_float(this.runtime.devicePixelRatio)},Exps.prototype.WindowInnerWidth=function(t){t.set_int(window.innerWidth)},Exps.prototype.WindowInnerHeight=function(t){t.set_int(window.innerHeight)},Exps.prototype.WindowOuterWidth=function(t){t.set_int(window.outerWidth)},Exps.prototype.WindowOuterHeight=function(t){t.set_int(window.outerHeight)},pluginProto.exps=new Exps}(),cr.plugins_.Function=function(t){this.runtime=t},function(){var t=cr.plugins_.Function.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t){this.type=t,this.runtime=t.runtime};var e=t.Instance.prototype,i=[],o=-1;function s(){this.name="",this.retVal=0,this.params=[]}function n(){return++o===i.length&&i.push(new s),i[o]}function r(){return o<0?null:i[o]}function a(){o--}function h(){}function c(){}function l(){}e.onCreate=function(){"undefined"!=typeof cr_is_preview;var t=this;window.c2_callFunction=function(e,i){var o,s,r,h=n();if(h.name=e.toLowerCase(),h.retVal=0,i)for(h.params.length=i.length,o=0,s=i.length;o<s;++o)r=i[o],h.params[o]="number"==typeof r||"string"==typeof r?r:"boolean"==typeof r&&r?1:0;else cr.clearArray(h.params);return t.runtime.trigger(cr.plugins_.Function.prototype.cnds.OnFunction,t,h.name),a(),h.retVal}},h.prototype.OnFunction=function(t){var e=r();return!!e&&cr.equals_nocase(t,e.name)},h.prototype.CompareParam=function(t,e,i){var o=r();return!!o&&(!((t=cr.floor(t))<0||t>=o.params.length)&&cr.do_cmp(o.params[t],e,i))},t.cnds=new h,c.prototype.CallFunction=function(t,e){var i=n();i.name=t.toLowerCase(),i.retVal=0,cr.shallowAssignArray(i.params,e);this.runtime.trigger(cr.plugins_.Function.prototype.cnds.OnFunction,this,i.name);a()},c.prototype.SetReturnValue=function(t){var e=r();e&&(e.retVal=t)},c.prototype.CallExpression=function(t){},t.acts=new c,l.prototype.ReturnValue=function(t){var e=function(){if(!i.length)return null;var t=o+1;return t>=i.length&&(t=i.length-1),i[t]}();e?t.set_any(e.retVal):t.set_int(0)},l.prototype.ParamCount=function(t){var e=r();e?t.set_int(e.params.length):t.set_int(0)},l.prototype.Param=function(t,e){e=cr.floor(e);var i=r();i&&e>=0&&e<i.params.length?t.set_any(i.params[e]):t.set_int(0)},l.prototype.Call=function(t,e){var i,o,s=n();for(s.name=e.toLowerCase(),s.retVal=0,cr.clearArray(s.params),i=2,o=arguments.length;i<o;i++)s.params.push(arguments[i]);this.runtime.trigger(cr.plugins_.Function.prototype.cnds.OnFunction,this,s.name);a(),t.set_any(s.retVal)},t.exps=new l}(),cr.plugins_.GD_SDK=function(t){this.runtime=t},function(){var t=cr.plugins_.GD_SDK.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t){this.type=t,this.runtime=t.runtime,window.gdsdk={},window.GD_OPTIONS={}};var e=t.Instance.prototype,i=!1;function o(){}function s(){}e.onCreate=function(){i=!0,this.gdsdk=window.gdsdk;var t=this;this.gdsdk.onInit=function(){t.isShowingBannerAd=!1,t.runtime.trigger(cr.plugins_.GD_SDK.prototype.cnds.onInit,t)},this.gdsdk.onError=function(){t.isShowingBannerAd=!0,t.runtime.trigger(cr.plugins_.GD_SDK.prototype.cnds.onError,t)},this.gdsdk.onResumeGame=function(){t.isShowingBannerAd=!1,t.runtime.trigger(cr.plugins_.GD_SDK.prototype.cnds.onResumeGame,t)},this.gdsdk.onPauseGame=function(){t.isShowingBannerAd=!0,t.runtime.trigger(cr.plugins_.GD_SDK.prototype.cnds.onPauseGame,t)},this.gdsdk.onPreloadedAd=function(){t.isShowingBannerAd=!0,t.runtime.trigger(cr.plugins_.GD_SDK.prototype.cnds.onPreloadedAd,t)}},o.prototype.IsShowingBanner=function(){return this.isShowingBannerAd},o.prototype.onInit=function(){return!0},o.prototype.onError=function(t){return!0},o.prototype.onResumeGame=function(t){return!0},o.prototype.onPauseGame=function(t){return!0},o.prototype.onPreloadedAd=function(t){return!0},t.cnds=new o,s.prototype.ShowAd=function(){i&&(this.isShowingBannerAd=!0)},s.prototype.ShowRewardedAd=function(){i&&(this.isShowingBannerAd=!0)},s.prototype.PreloadRewardedAd=function(){i&&(this.isShowingBannerAd=!1)},s.prototype.PlayLog=function(){},s.prototype.CustomLog=function(){},s.prototype.InitAds=function(){},t.acts=new s,t.exps=new function(){}}(),cr.plugins_.Keyboard=function(t){this.runtime=t},function(){var t=cr.plugins_.Keyboard.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t){this.type=t,this.runtime=t.runtime,this.keyMap=new Array(256),this.usedKeys=new Array(256),this.triggerKey=0};var e=t.Instance.prototype;e.onCreate=function(){var t=this;this.runtime.isDomFree||(jQuery(document).keydown(function(e){t.onKeyDown(e)}),jQuery(document).keyup(function(e){t.onKeyUp(e)}))};var i=[32,33,34,35,36,37,38,39,40,44];function o(){}function s(){}e.onKeyDown=function(t){var e=!1;if(window!=window.top&&i.indexOf(t.which)>-1&&(t.preventDefault(),e=!0,t.stopPropagation()),this.keyMap[t.which])this.usedKeys[t.which]&&!e&&t.preventDefault();else{this.keyMap[t.which]=!0,this.triggerKey=t.which,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKey,this);var o=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKey,this),s=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCode,this);this.runtime.isInUserInputEvent=!1,(o||s)&&(this.usedKeys[t.which]=!0,e||t.preventDefault())}},e.onKeyUp=function(t){this.keyMap[t.which]=!1,this.triggerKey=t.which,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKeyReleased,this);var e=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyReleased,this),i=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCodeReleased,this);this.runtime.isInUserInputEvent=!1,(e||i||this.usedKeys[t.which])&&(this.usedKeys[t.which]=!0,t.preventDefault())},e.onWindowBlur=function(){var t;for(t=0;t<256;++t)if(this.keyMap[t]){this.keyMap[t]=!1,this.triggerKey=t,this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKeyReleased,this);var e=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyReleased,this),i=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCodeReleased,this);(e||i)&&(this.usedKeys[t]=!0)}},e.saveToJSON=function(){return{triggerKey:this.triggerKey}},e.loadFromJSON=function(t){this.triggerKey=t.triggerKey},o.prototype.IsKeyDown=function(t){return this.keyMap[t]},o.prototype.OnKey=function(t){return t===this.triggerKey},o.prototype.OnAnyKey=function(t){return!0},o.prototype.OnAnyKeyReleased=function(t){return!0},o.prototype.OnKeyReleased=function(t){return t===this.triggerKey},o.prototype.IsKeyCodeDown=function(t){return!((t=Math.floor(t))<0||t>=this.keyMap.length)&&this.keyMap[t]},o.prototype.OnKeyCode=function(t){return t===this.triggerKey},o.prototype.OnKeyCodeReleased=function(t){return t===this.triggerKey},t.cnds=new o,t.acts=new function(){},s.prototype.LastKeyCode=function(t){t.set_int(this.triggerKey)},s.prototype.StringFromKeyCode=function(t,e){t.set_string(function(t){switch(t=Math.floor(t)){case 8:return"backspace";case 9:return"tab";case 13:return"enter";case 16:return"shift";case 17:return"control";case 18:return"alt";case 19:return"pause";case 20:return"capslock";case 27:return"esc";case 33:return"pageup";case 34:return"pagedown";case 35:return"end";case 36:return"home";case 37:return"←";case 38:return"↑";case 39:return"→";case 40:return"↓";case 45:return"insert";case 46:return"del";case 91:return"left window key";case 92:return"right window key";case 93:return"select";case 96:return"numpad 0";case 97:return"numpad 1";case 98:return"numpad 2";case 99:return"numpad 3";case 100:return"numpad 4";case 101:return"numpad 5";case 102:return"numpad 6";case 103:return"numpad 7";case 104:return"numpad 8";case 105:return"numpad 9";case 106:return"numpad *";case 107:return"numpad +";case 109:return"numpad -";case 110:return"numpad .";case 111:return"numpad /";case 112:return"F1";case 113:return"F2";case 114:return"F3";case 115:return"F4";case 116:return"F5";case 117:return"F6";case 118:return"F7";case 119:return"F8";case 120:return"F9";case 121:return"F10";case 122:return"F11";case 123:return"F12";case 144:return"numlock";case 145:return"scroll lock";case 186:return";";case 187:return"=";case 188:return",";case 189:return"-";case 190:return".";case 191:return"/";case 192:return"'";case 219:return"[";case 220:return"\\";case 221:return"]";case 222:return"#";case 223:return"`";default:return String.fromCharCode(t)}}(e))},t.exps=new s}(),cr.plugins_.Mouse=function(t){this.runtime=t},function(){var t=cr.plugins_.Mouse.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t){this.type=t,this.runtime=t.runtime,this.buttonMap=new Array(4),this.mouseXcanvas=0,this.mouseYcanvas=0,this.triggerButton=0,this.triggerType=0,this.triggerDir=0,this.handled=!1};var e=t.Instance.prototype;e.onCreate=function(){var t=this;if(!this.runtime.isDomFree){jQuery(document).mousemove(function(e){t.onMouseMove(e)}),jQuery(document).mousedown(function(e){t.onMouseDown(e)}),jQuery(document).mouseup(function(e){t.onMouseUp(e)}),jQuery(document).dblclick(function(e){t.onDoubleClick(e)});var e=function(e){t.onWheel(e)};document.addEventListener("mousewheel",e,!1),document.addEventListener("DOMMouseScroll",e,!1)}};var i={left:0,top:0};function o(){}function s(){}e.onMouseMove=function(t){var e=this.runtime.isDomFree?i:jQuery(this.runtime.canvas).offset();this.mouseXcanvas=t.pageX-e.left,this.mouseYcanvas=t.pageY-e.top},e.mouseInGame=function(){return this.runtime.fullscreen_mode>0||this.mouseXcanvas>=0&&this.mouseYcanvas>=0&&this.mouseXcanvas<this.runtime.width&&this.mouseYcanvas<this.runtime.height},e.onMouseDown=function(t){this.mouseInGame()&&(this.buttonMap[t.which]=!0,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnAnyClick,this),this.triggerButton=t.which-1,this.triggerType=0,this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnClick,this),this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnObjectClicked,this),this.runtime.isInUserInputEvent=!1)},e.onMouseUp=function(t){this.buttonMap[t.which]&&(this.runtime.had_a_click&&!this.runtime.isMobile&&t.preventDefault(),this.runtime.had_a_click=!0,this.buttonMap[t.which]=!1,this.runtime.isInUserInputEvent=!0,this.triggerButton=t.which-1,this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnRelease,this),this.runtime.isInUserInputEvent=!1)},e.onDoubleClick=function(t){this.mouseInGame()&&(t.preventDefault(),this.runtime.isInUserInputEvent=!0,this.triggerButton=t.which-1,this.triggerType=1,this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnClick,this),this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnObjectClicked,this),this.runtime.isInUserInputEvent=!1)},e.onWheel=function(t){var e=t.wheelDelta?t.wheelDelta:t.detail?-t.detail:0;this.triggerDir=e<0?0:1,this.handled=!1,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnWheel,this),this.runtime.isInUserInputEvent=!1,this.handled&&cr.isCanvasInputEvent(t)&&t.preventDefault()},e.onWindowBlur=function(){var t,e;for(t=0,e=this.buttonMap.length;t<e;++t)this.buttonMap[t]&&(this.buttonMap[t]=!1,this.triggerButton=t-1,this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnRelease,this))},o.prototype.OnClick=function(t,e){return t===this.triggerButton&&e===this.triggerType},o.prototype.OnAnyClick=function(){return!0},o.prototype.IsButtonDown=function(t){return this.buttonMap[t+1]},o.prototype.OnRelease=function(t){return t===this.triggerButton},o.prototype.IsOverObject=function(t){var e=this.runtime.getCurrentCondition(),i=this.mouseXcanvas,o=this.mouseYcanvas;return cr.xor(this.runtime.testAndSelectCanvasPointOverlap(t,i,o,e.inverted),e.inverted)},o.prototype.OnObjectClicked=function(t,e,i){return t===this.triggerButton&&e===this.triggerType&&this.runtime.testAndSelectCanvasPointOverlap(i,this.mouseXcanvas,this.mouseYcanvas,!1)},o.prototype.OnWheel=function(t){return this.handled=!0,t===this.triggerDir},t.cnds=new o;var n=null;function r(){}s.prototype.SetCursor=function(t){if(!this.runtime.isDomFree){var e=["auto","pointer","text","crosshair","move","help","wait","none"][t];n!==e&&(n=e,document.body.style.cursor=e)}},s.prototype.SetCursorSprite=function(t){if(!this.runtime.isDomFree&&!this.runtime.isMobile&&t){var e=t.getFirstPicked();if(e&&e.curFrame){var i=e.curFrame;if(n!==i){n=i;var o="url("+i.getDataUri()+") "+Math.round(i.hotspotX*i.width)+" "+Math.round(i.hotspotY*i.height)+", auto";document.body.style.cursor="",document.body.style.cursor=o}}}},t.acts=new s,r.prototype.X=function(t,e){var i,o,s,n,r;cr.is_undefined(e)?(o=(i=this.runtime.getLayerByNumber(0)).scale,s=i.zoomRate,n=i.parallaxX,r=i.angle,i.scale=1,i.zoomRate=1,i.parallaxX=1,i.angle=0,t.set_float(i.canvasToLayer(this.mouseXcanvas,this.mouseYcanvas,!0)),i.scale=o,i.zoomRate=s,i.parallaxX=n,i.angle=r):(i=cr.is_number(e)?this.runtime.getLayerByNumber(e):this.runtime.getLayerByName(e))?t.set_float(i.canvasToLayer(this.mouseXcanvas,this.mouseYcanvas,!0)):t.set_float(0)},r.prototype.Y=function(t,e){var i,o,s,n,r;cr.is_undefined(e)?(o=(i=this.runtime.getLayerByNumber(0)).scale,s=i.zoomRate,n=i.parallaxY,r=i.angle,i.scale=1,i.zoomRate=1,i.parallaxY=1,i.angle=0,t.set_float(i.canvasToLayer(this.mouseXcanvas,this.mouseYcanvas,!1)),i.scale=o,i.zoomRate=s,i.parallaxY=n,i.angle=r):(i=cr.is_number(e)?this.runtime.getLayerByNumber(e):this.runtime.getLayerByName(e))?t.set_float(i.canvasToLayer(this.mouseXcanvas,this.mouseYcanvas,!1)):t.set_float(0)},r.prototype.AbsoluteX=function(t){t.set_float(this.mouseXcanvas)},r.prototype.AbsoluteY=function(t){t.set_float(this.mouseYcanvas)},t.exps=new r}(),cr.plugins_.Particles=function(t){this.runtime=t},function(){var t=cr.plugins_.Particles.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime};var e=t.Type.prototype;function i(t){this.owner=t,this.active=!1,this.x=0,this.y=0,this.speed=0,this.angle=0,this.opacity=1,this.grow=0,this.size=0,this.gs=0,this.age=0,cr.seal(this)}e.onCreate=function(){this.is_family||(this.texture_img=new Image,this.texture_img.cr_filesize=this.texture_filesize,this.webGL_texture=null,this.runtime.waitForImageLoad(this.texture_img,this.texture_file))},e.onLostWebGLContext=function(){this.is_family||(this.webGL_texture=null)},e.onRestoreWebGLContext=function(){!this.is_family&&this.instances.length&&(this.webGL_texture||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat)))},e.loadTextures=function(){this.is_family||this.webGL_texture||!this.runtime.glwrap||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat))},e.unloadTextures=function(){this.is_family||this.instances.length||!this.webGL_texture||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)},e.preloadCanvas2D=function(t){t.drawImage(this.texture_img,0,0)},i.prototype.init=function(){var t=this.owner;this.x=t.x-t.xrandom/2+Math.random()*t.xrandom,this.y=t.y-t.yrandom/2+Math.random()*t.yrandom,this.speed=t.initspeed-t.speedrandom/2+Math.random()*t.speedrandom,this.angle=t.angle-t.spraycone/2+Math.random()*t.spraycone,this.opacity=t.initopacity,this.size=t.initsize-t.sizerandom/2+Math.random()*t.sizerandom,this.grow=t.growrate-t.growrandom/2+Math.random()*t.growrandom,this.gs=0,this.age=0},i.prototype.tick=function(t){var e=this.owner;this.x+=Math.cos(this.angle)*this.speed*t,this.y+=Math.sin(this.angle)*this.speed*t,this.y+=this.gs*t,this.speed+=e.acc*t,this.size+=this.grow*t,this.gs+=e.g*t,this.age+=t,this.size<1?this.active=!1:(0!==e.lifeanglerandom&&(this.angle+=Math.random()*e.lifeanglerandom*t-e.lifeanglerandom*t/2),0!==e.lifespeedrandom&&(this.speed+=Math.random()*e.lifespeedrandom*t-e.lifespeedrandom*t/2),0!==e.lifeopacityrandom&&(this.opacity+=Math.random()*e.lifeopacityrandom*t-e.lifeopacityrandom*t/2,this.opacity<0?this.opacity=0:this.opacity>1&&(this.opacity=1)),e.destroymode<=1&&this.age>=e.timeout&&(this.active=!1),2===e.destroymode&&this.speed<=0&&(this.active=!1))},i.prototype.draw=function(t){var e=this.owner.opacity*this.opacity;if(0!==e){0===this.owner.destroymode&&(e*=1-this.age/this.owner.timeout),t.globalAlpha=e;var i=this.x-this.size/2,o=this.y-this.size/2;this.owner.runtime.pixel_rounding&&(i=i+.5|0,o=o+.5|0),t.drawImage(this.owner.type.texture_img,i,o,this.size,this.size)}},i.prototype.drawGL=function(t){var e=this.owner.opacity*this.opacity;0===this.owner.destroymode&&(e*=1-this.age/this.owner.timeout);var i=this.size,o=i*this.owner.particlescale,s=this.x-i/2,n=this.y-i/2;this.owner.runtime.pixel_rounding&&(s=s+.5|0,n=n+.5|0),o<1||0===e||(o<t.minPointSize||o>t.maxPointSize?(t.setOpacity(e),t.quad(s,n,s+i,n,s+i,n+i,s,n+i)):t.point(this.x,this.y,o,e))},i.prototype.left=function(){return this.x-this.size/2},i.prototype.right=function(){return this.x+this.size/2},i.prototype.top=function(){return this.y-this.size/2},i.prototype.bottom=function(){return this.y+this.size/2},t.Instance=function(t){this.type=t,this.runtime=t.runtime};var o=t.Instance.prototype,s=[];function n(){}function r(){}function a(){}o.onCreate=function(){var t=this.properties;if(this.rate=t[0],this.spraycone=cr.to_radians(t[1]),this.spraytype=t[2],this.spraying=!0,this.initspeed=t[3],this.initsize=t[4],this.initopacity=t[5]/100,this.growrate=t[6],this.xrandom=t[7],this.yrandom=t[8],this.speedrandom=t[9],this.sizerandom=t[10],this.growrandom=t[11],this.acc=t[12],this.g=t[13],this.lifeanglerandom=t[14],this.lifespeedrandom=t[15],this.lifeopacityrandom=t[16],this.destroymode=t[17],this.timeout=t[18],this.particleCreateCounter=0,this.particlescale=1,this.particleBoxLeft=this.x,this.particleBoxTop=this.y,this.particleBoxRight=this.x,this.particleBoxBottom=this.y,this.add_bbox_changed_callback(function(t){t.bbox.set(t.particleBoxLeft,t.particleBoxTop,t.particleBoxRight,t.particleBoxBottom),t.bquad.set_from_rect(t.bbox),t.bbox_changed=!1,t.update_collision_cell(),t.update_render_cell()}),this.recycled||(this.particles=[]),this.runtime.tickMe(this),this.type.loadTextures(),1===this.spraytype)for(var e=0;e<this.rate;e++)this.allocateParticle().opacity=0;this.first_tick=!0},o.saveToJSON=function(){var t,e,i,o={r:this.rate,sc:this.spraycone,st:this.spraytype,s:this.spraying,isp:this.initspeed,isz:this.initsize,io:this.initopacity,gr:this.growrate,xr:this.xrandom,yr:this.yrandom,spr:this.speedrandom,szr:this.sizerandom,grnd:this.growrandom,acc:this.acc,g:this.g,lar:this.lifeanglerandom,lsr:this.lifespeedrandom,lor:this.lifeopacityrandom,dm:this.destroymode,to:this.timeout,pcc:this.particleCreateCounter,ft:this.first_tick,p:[]},s=o.p;for(t=0,e=this.particles.length;t<e;t++)i=this.particles[t],s.push([i.x,i.y,i.speed,i.angle,i.opacity,i.grow,i.size,i.gs,i.age]);return o},o.loadFromJSON=function(t){var e,i,o,n;this.rate=t.r,this.spraycone=t.sc,this.spraytype=t.st,this.spraying=t.s,this.initspeed=t.isp,this.initsize=t.isz,this.initopacity=t.io,this.growrate=t.gr,this.xrandom=t.xr,this.yrandom=t.yr,this.speedrandom=t.spr,this.sizerandom=t.szr,this.growrandom=t.grnd,this.acc=t.acc,this.g=t.g,this.lifeanglerandom=t.lar,this.lifespeedrandom=t.lsr,this.lifeopacityrandom=t.lor,this.destroymode=t.dm,this.timeout=t.to,this.particleCreateCounter=t.pcc,this.first_tick=t.ft,s.push.apply(s,this.particles),cr.clearArray(this.particles);var r=t.p;for(e=0,i=r.length;e<i;e++)o=this.allocateParticle(),n=r[e],o.x=n[0],o.y=n[1],o.speed=n[2],o.angle=n[3],o.opacity=n[4],o.grow=n[5],o.size=n[6],o.gs=n[7],o.age=n[8]},o.onDestroy=function(){s.push.apply(s,this.particles),cr.clearArray(this.particles)},o.allocateParticle=function(){var t;return s.length?(t=s.pop()).owner=this:t=new i(this),this.particles.push(t),t.active=!0,t},o.tick=function(){var t,e,i,o,n,r=this.runtime.getDt(this);if(0===this.spraytype&&this.spraying)for(this.particleCreateCounter+=r*this.rate,o=cr.floor(this.particleCreateCounter),this.particleCreateCounter-=o,t=0;t<o;t++)(i=this.allocateParticle()).init();for(this.particleBoxLeft=this.x,this.particleBoxTop=this.y,this.particleBoxRight=this.x,this.particleBoxBottom=this.y,t=0,n=0,e=this.particles.length;t<e;t++)i=this.particles[t],this.particles[n]=i,this.runtime.redraw=!0,1===this.spraytype&&this.first_tick&&i.init(),i.tick(r),i.active?(i.left()<this.particleBoxLeft&&(this.particleBoxLeft=i.left()),i.right()>this.particleBoxRight&&(this.particleBoxRight=i.right()),i.top()<this.particleBoxTop&&(this.particleBoxTop=i.top()),i.bottom()>this.particleBoxBottom&&(this.particleBoxBottom=i.bottom()),n++):s.push(i);cr.truncateArray(this.particles,n),this.set_bbox_changed(),this.first_tick=!1,1===this.spraytype&&0===this.particles.length&&this.runtime.DestroyInstance(this)},o.draw=function(t){var e,i,o,s=this.layer;for(e=0,i=this.particles.length;e<i;e++)(o=this.particles[e]).right()>=s.viewLeft&&o.bottom()>=s.viewTop&&o.left()<=s.viewRight&&o.top()<=s.viewBottom&&o.draw(t)},o.drawGL=function(t){this.particlescale=this.layer.getScale(),t.setTexture(this.type.webGL_texture);var e,i,o,s=this.layer;for(e=0,i=this.particles.length;e<i;e++)(o=this.particles[e]).right()>=s.viewLeft&&o.bottom()>=s.viewTop&&o.left()<=s.viewRight&&o.top()<=s.viewBottom&&o.drawGL(t)},n.prototype.IsSpraying=function(){return this.spraying},t.cnds=new n,r.prototype.SetSpraying=function(t){this.spraying=0!==t},r.prototype.SetEffect=function(t){this.blend_mode=t,this.compositeOp=cr.effectToCompositeOp(t),cr.setGLBlend(this,t,this.runtime.gl),this.runtime.redraw=!0},r.prototype.SetRate=function(t){var e,i;if(this.rate=t,1===this.spraytype&&this.first_tick)if(t<this.particles.length)for(e=this.particles.length-t,i=0;i<e;i++)s.push(this.particles.pop());else if(t>this.particles.length)for(e=t-this.particles.length,i=0;i<e;i++)this.allocateParticle().opacity=0},r.prototype.SetSprayCone=function(t){this.spraycone=cr.to_radians(t)},r.prototype.SetInitSpeed=function(t){this.initspeed=t},r.prototype.SetInitSize=function(t){this.initsize=t},r.prototype.SetInitOpacity=function(t){this.initopacity=t/100},r.prototype.SetGrowRate=function(t){this.growrate=t},r.prototype.SetXRandomiser=function(t){this.xrandom=t},r.prototype.SetYRandomiser=function(t){this.yrandom=t},r.prototype.SetSpeedRandomiser=function(t){this.speedrandom=t},r.prototype.SetSizeRandomiser=function(t){this.sizerandom=t},r.prototype.SetGrowRateRandomiser=function(t){this.growrandom=t},r.prototype.SetParticleAcc=function(t){this.acc=t},r.prototype.SetGravity=function(t){this.g=t},r.prototype.SetAngleRandomiser=function(t){this.lifeanglerandom=t},r.prototype.SetLifeSpeedRandomiser=function(t){this.lifespeedrandom=t},r.prototype.SetOpacityRandomiser=function(t){this.lifeopacityrandom=t},r.prototype.SetTimeout=function(t){this.timeout=t},t.acts=new r,a.prototype.ParticleCount=function(t){t.set_int(this.particles.length)},a.prototype.Rate=function(t){t.set_float(this.rate)},a.prototype.SprayCone=function(t){t.set_float(cr.to_degrees(this.spraycone))},a.prototype.InitSpeed=function(t){t.set_float(this.initspeed)},a.prototype.InitSize=function(t){t.set_float(this.initsize)},a.prototype.InitOpacity=function(t){t.set_float(100*this.initopacity)},a.prototype.InitGrowRate=function(t){t.set_float(this.growrate)},a.prototype.XRandom=function(t){t.set_float(this.xrandom)},a.prototype.YRandom=function(t){t.set_float(this.yrandom)},a.prototype.InitSpeedRandom=function(t){t.set_float(this.speedrandom)},a.prototype.InitSizeRandom=function(t){t.set_float(this.sizerandom)},a.prototype.InitGrowRandom=function(t){t.set_float(this.growrandom)},a.prototype.ParticleAcceleration=function(t){t.set_float(this.acc)},a.prototype.Gravity=function(t){t.set_float(this.g)},a.prototype.ParticleAngleRandom=function(t){t.set_float(this.lifeanglerandom)},a.prototype.ParticleSpeedRandom=function(t){t.set_float(this.lifespeedrandom)},a.prototype.ParticleOpacityRandom=function(t){t.set_float(this.lifeopacityrandom)},a.prototype.Timeout=function(t){t.set_float(this.timeout)},t.exps=new a}(),cr.plugins_.Sprite=function(t){this.runtime=t},function(){var t=cr.plugins_.Sprite.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime};var e=t.Type.prototype;function i(){if(0===this.datauri.length){var t=document.createElement("canvas");t.width=this.width,t.height=this.height;var e=t.getContext("2d");this.spritesheeted?e.drawImage(this.texture_img,this.offx,this.offy,this.width,this.height,0,0,this.width,this.height):e.drawImage(this.texture_img,0,0,this.width,this.height),this.datauri=t.toDataURL("image/png")}return this.datauri}e.onCreate=function(){var t,e,o,s,n,r,a,h,c,l;if(!this.is_family)for(this.all_frames=[],this.has_loaded_textures=!1,t=0,e=this.animations.length;t<e;t++){for(n=this.animations[t],(a={}).name=n[0],a.speed=n[1],a.loop=n[2],a.repeatcount=n[3],a.repeatto=n[4],a.pingpong=n[5],a.sid=n[6],a.frames=[],o=0,s=n[7].length;o<s;o++)r=n[7][o],(h={}).texture_file=r[0],h.texture_filesize=r[1],h.offx=r[2],h.offy=r[3],h.width=r[4],h.height=r[5],h.duration=r[6],h.hotspotX=r[7],h.hotspotY=r[8],h.image_points=r[9],h.poly_pts=r[10],h.pixelformat=r[11],h.spritesheeted=0!==h.width,h.datauri="",h.getDataUri=i,(l={}).left=0,l.top=0,l.right=1,l.bottom=1,h.sheetTex=l,h.webGL_texture=null,(c=this.runtime.findWaitingTexture(r[0]))?h.texture_img=c:(h.texture_img=new Image,h.texture_img.cr_src=r[0],h.texture_img.cr_filesize=r[1],h.texture_img.c2webGL_texture=null,this.runtime.waitForImageLoad(h.texture_img,r[0])),cr.seal(h),a.frames.push(h),this.all_frames.push(h);cr.seal(a),this.animations[t]=a}},e.updateAllCurrentTexture=function(){var t,e,i;for(t=0,e=this.instances.length;t<e;t++)(i=this.instances[t]).curWebGLTexture=i.curFrame.webGL_texture},e.onLostWebGLContext=function(){if(!this.is_family){var t,e,i;for(t=0,e=this.all_frames.length;t<e;++t)(i=this.all_frames[t]).texture_img.c2webGL_texture=null,i.webGL_texture=null;this.has_loaded_textures=!1,this.updateAllCurrentTexture()}},e.onRestoreWebGLContext=function(){if(!this.is_family&&this.instances.length){var t,e,i;for(t=0,e=this.all_frames.length;t<e;++t)(i=this.all_frames[t]).webGL_texture=this.runtime.glwrap.loadTexture(i.texture_img,!1,this.runtime.linearSampling,i.pixelformat);this.updateAllCurrentTexture()}},e.loadTextures=function(){if(!this.is_family&&!this.has_loaded_textures&&this.runtime.glwrap){var t,e,i;for(t=0,e=this.all_frames.length;t<e;++t)(i=this.all_frames[t]).webGL_texture=this.runtime.glwrap.loadTexture(i.texture_img,!1,this.runtime.linearSampling,i.pixelformat);this.has_loaded_textures=!0}},e.unloadTextures=function(){if(!this.is_family&&!this.instances.length&&this.has_loaded_textures){var t,e,i;for(t=0,e=this.all_frames.length;t<e;++t)i=this.all_frames[t],this.runtime.glwrap.deleteTexture(i.webGL_texture),i.webGL_texture=null;this.has_loaded_textures=!1}};var o=[];e.preloadCanvas2D=function(t){var e,i,s;for(cr.clearArray(o),e=0,i=this.all_frames.length;e<i;++e)s=this.all_frames[e].texture_img,-1===o.indexOf(s)&&(t.drawImage(s,0,0),o.push(s))},t.Instance=function(t){this.type=t,this.runtime=t.runtime;var e=this.type.animations[0].frames[0].poly_pts;this.recycled?this.collision_poly.set_pts(e):this.collision_poly=new cr.CollisionPoly(e)};var s=t.Instance.prototype;function n(){}s.onCreate=function(){this.visible=0===this.properties[0],this.isTicking=!1,this.inAnimTrigger=!1,this.collisionsEnabled=0!==this.properties[3],this.cur_animation=this.getAnimationByName(this.properties[1])||this.type.animations[0],this.cur_frame=this.properties[2],this.cur_frame<0&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1);var t,e,i,o,s,n,r,a,h=this.cur_animation.frames[this.cur_frame];for(this.collision_poly.set_pts(h.poly_pts),this.hotspotX=h.hotspotX,this.hotspotY=h.hotspotY,this.cur_anim_speed=this.cur_animation.speed,this.cur_anim_repeatto=this.cur_animation.repeatto,1===this.type.animations.length&&1===this.type.animations[0].frames.length||0===this.cur_anim_speed||(this.runtime.tickMe(this),this.isTicking=!0),this.recycled?this.animTimer.reset():this.animTimer=new cr.KahanAdder,this.frameStart=this.getNowTime(),this.animPlaying=!0,this.animRepeats=0,this.animForwards=!0,this.animTriggerName="",this.changeAnimName="",this.changeAnimFrom=0,this.changeAnimFrame=-1,this.type.loadTextures(),t=0,e=this.type.animations.length;t<e;t++)for(i=0,o=(s=this.type.animations[t]).frames.length;i<o;i++)0===(n=s.frames[i]).width&&(n.width=n.texture_img.width,n.height=n.texture_img.height),n.spritesheeted&&(a=n.texture_img,(r=n.sheetTex).left=n.offx/a.width,r.top=n.offy/a.height,r.right=(n.offx+n.width)/a.width,r.bottom=(n.offy+n.height)/a.height,0===n.offx&&0===n.offy&&n.width===a.width&&n.height===a.height&&(n.spritesheeted=!1));this.curFrame=this.cur_animation.frames[this.cur_frame],this.curWebGLTexture=this.curFrame.webGL_texture},s.saveToJSON=function(){var t={a:this.cur_animation.sid,f:this.cur_frame,cas:this.cur_anim_speed,fs:this.frameStart,ar:this.animRepeats,at:this.animTimer.sum,rt:this.cur_anim_repeatto};return this.animPlaying||(t.ap=this.animPlaying),this.animForwards||(t.af=this.animForwards),t},s.loadFromJSON=function(t){var e=this.getAnimationBySid(t.a);e&&(this.cur_animation=e),this.cur_frame=t.f,this.cur_frame<0&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1),this.cur_anim_speed=t.cas,this.frameStart=t.fs,this.animRepeats=t.ar,this.animTimer.reset(),this.animTimer.sum=t.at,this.animPlaying=!t.hasOwnProperty("ap")||t.ap,this.animForwards=!t.hasOwnProperty("af")||t.af,t.hasOwnProperty("rt")?this.cur_anim_repeatto=t.rt:this.cur_anim_repeatto=this.cur_animation.repeatto,this.curFrame=this.cur_animation.frames[this.cur_frame],this.curWebGLTexture=this.curFrame.webGL_texture,this.collision_poly.set_pts(this.curFrame.poly_pts),this.hotspotX=this.curFrame.hotspotX,this.hotspotY=this.curFrame.hotspotY},s.animationFinish=function(t){this.cur_frame=t?0:this.cur_animation.frames.length-1,this.animPlaying=!1,this.animTriggerName=this.cur_animation.name,this.inAnimTrigger=!0,this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnyAnimFinished,this),this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnimFinished,this),this.inAnimTrigger=!1,this.animRepeats=0},s.getNowTime=function(){return this.animTimer.sum},s.tick=function(){this.animTimer.add(this.runtime.getDt(this)),this.changeAnimName.length&&this.doChangeAnim(),this.changeAnimFrame>=0&&this.doChangeAnimFrame();var t,e=this.getNowTime(),i=this.cur_animation,o=i.frames[this.cur_frame],s=o.duration/this.cur_anim_speed;this.animPlaying&&e>=this.frameStart+s&&(this.animForwards?this.cur_frame++:this.cur_frame--,this.frameStart+=s,this.cur_frame>=i.frames.length&&(i.pingpong?(this.animForwards=!1,this.cur_frame=i.frames.length-2):i.loop?this.cur_frame=this.cur_anim_repeatto:(this.animRepeats++,this.animRepeats>=i.repeatcount?this.animationFinish(!1):this.cur_frame=this.cur_anim_repeatto)),this.cur_frame<0&&(i.pingpong?(this.cur_frame=1,this.animForwards=!0,i.loop||(this.animRepeats++,this.animRepeats>=i.repeatcount&&this.animationFinish(!0))):i.loop?this.cur_frame=this.cur_anim_repeatto:(this.animRepeats++,this.animRepeats>=i.repeatcount?this.animationFinish(!0):this.cur_frame=this.cur_anim_repeatto)),this.cur_frame<0?this.cur_frame=0:this.cur_frame>=i.frames.length&&(this.cur_frame=i.frames.length-1),e>this.frameStart+i.frames[this.cur_frame].duration/this.cur_anim_speed&&(this.frameStart=e),t=i.frames[this.cur_frame],this.OnFrameChanged(o,t),this.runtime.redraw=!0)},s.getAnimationByName=function(t){var e,i,o;for(e=0,i=this.type.animations.length;e<i;e++)if(o=this.type.animations[e],cr.equals_nocase(o.name,t))return o;return null},s.getAnimationBySid=function(t){var e,i,o;for(e=0,i=this.type.animations.length;e<i;e++)if((o=this.type.animations[e]).sid===t)return o;return null},s.doChangeAnim=function(){var t=this.cur_animation.frames[this.cur_frame],e=this.getAnimationByName(this.changeAnimName);this.changeAnimName="",e&&(cr.equals_nocase(e.name,this.cur_animation.name)&&this.animPlaying||(this.cur_animation=e,this.cur_anim_speed=e.speed,this.cur_anim_repeatto=e.repeatto,this.cur_frame<0&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1),1===this.changeAnimFrom&&(this.cur_frame=0),this.animPlaying=!0,this.frameStart=this.getNowTime(),this.animForwards=!0,this.OnFrameChanged(t,this.cur_animation.frames[this.cur_frame]),this.runtime.redraw=!0))},s.doChangeAnimFrame=function(){var t=this.cur_animation.frames[this.cur_frame],e=this.cur_frame;this.cur_frame=cr.floor(this.changeAnimFrame),this.cur_frame<0&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1),e!==this.cur_frame&&(this.OnFrameChanged(t,this.cur_animation.frames[this.cur_frame]),this.frameStart=this.getNowTime(),this.runtime.redraw=!0),this.changeAnimFrame=-1},s.OnFrameChanged=function(t,e){var i,o,s,n=t.width,r=t.height,a=e.width,h=e.height;for(n!=a&&(this.width*=a/n),r!=h&&(this.height*=h/r),this.hotspotX=e.hotspotX,this.hotspotY=e.hotspotY,this.collision_poly.set_pts(e.poly_pts),this.set_bbox_changed(),this.curFrame=e,this.curWebGLTexture=e.webGL_texture,i=0,o=this.behavior_insts.length;i<o;i++)(s=this.behavior_insts[i]).onSpriteFrameChanged&&s.onSpriteFrameChanged(t,e);this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnFrameChanged,this)},s.draw=function(t){t.globalAlpha=this.opacity;var e=this.curFrame,i=e.spritesheeted,o=e.texture_img,s=this.x,n=this.y,r=this.width,a=this.height;if(0===this.angle&&r>=0&&a>=0)s-=this.hotspotX*r,n-=this.hotspotY*a,this.runtime.pixel_rounding&&(s=Math.round(s),n=Math.round(n)),i?t.drawImage(o,e.offx,e.offy,e.width,e.height,s,n,r,a):t.drawImage(o,s,n,r,a);else{this.runtime.pixel_rounding&&(s=Math.round(s),n=Math.round(n)),t.save();var h=r>0?1:-1,c=a>0?1:-1;t.translate(s,n),1===h&&1===c||t.scale(h,c),t.rotate(this.angle*h*c);var l=0-this.hotspotX*cr.abs(r),m=0-this.hotspotY*cr.abs(a);i?t.drawImage(o,e.offx,e.offy,e.width,e.height,l,m,cr.abs(r),cr.abs(a)):t.drawImage(o,l,m,cr.abs(r),cr.abs(a)),t.restore()}},s.drawGL_earlyZPass=function(t){this.drawGL(t)},s.drawGL=function(t){t.setTexture(this.curWebGLTexture),t.setOpacity(this.opacity);var e=this.curFrame,i=this.bquad;if(this.runtime.pixel_rounding){var o=Math.round(this.x)-this.x,s=Math.round(this.y)-this.y;e.spritesheeted?t.quadTex(i.tlx+o,i.tly+s,i.trx+o,i.try_+s,i.brx+o,i.bry+s,i.blx+o,i.bly+s,e.sheetTex):t.quad(i.tlx+o,i.tly+s,i.trx+o,i.try_+s,i.brx+o,i.bry+s,i.blx+o,i.bly+s)}else e.spritesheeted?t.quadTex(i.tlx,i.tly,i.trx,i.try_,i.brx,i.bry,i.blx,i.bly,e.sheetTex):t.quad(i.tlx,i.tly,i.trx,i.try_,i.brx,i.bry,i.blx,i.bly)},s.getImagePointIndexByName=function(t){var e,i,o=this.curFrame;for(e=0,i=o.image_points.length;e<i;e++)if(cr.equals_nocase(t,o.image_points[e][0]))return e;return-1},s.getImagePoint=function(t,e){var i,o=this.curFrame,s=o.image_points;if(i=cr.is_string(t)?this.getImagePointIndexByName(t):t-1,(i=cr.floor(i))<0||i>=s.length)return e?this.x:this.y;var n=(s[i][1]-o.hotspotX)*this.width,r=s[i][2];r=(r-o.hotspotY)*this.height;var a=Math.cos(this.angle),h=Math.sin(this.angle),c=n*a-r*h;return r=r*a+n*h,n=c,n+=this.x,r+=this.y,e?n:r};var r=[];function a(t){t[0]=0,t[1]=0,t[2]=0,r.push(t)}function h(t,e){return t<e?t+","+e:e+","+t}function c(t,e,i,o){var s=e.uid,n=i.uid,a=h(s,n);if(t.hasOwnProperty(a))t[a][2]=o;else{var c=r.length?r.pop():[0,0,0];c[0]=s,c[1]=n,c[2]=o,t[a]=c}}function l(t,e,i){var o=h(e.uid,i.uid);t.hasOwnProperty(o)&&(a(t[o]),delete t[o])}var m=-2;function u(t,e,i){var o=h(e.uid,i.uid);return t.hasOwnProperty(o)?(m=t[o][2],!0):(m=-2,!1)}var p=[];n.prototype.OnCollision=function(t){if(!t)return!1;var e=this.runtime,i=e.getCurrentCondition(),o=i.type,s=null;i.extra.collmemory?s=i.extra.collmemory:(s={},i.extra.collmemory=s),i.extra.spriteCreatedDestroyCallback||(i.extra.spriteCreatedDestroyCallback=!0,e.addDestroyCallback(function(t){!function(t,e){var i,o,s=e.uid;for(i in t)t.hasOwnProperty(i)&&((o=t[i])[0]!==s&&o[1]!==s||(a(t[i]),delete t[i]))}(i.extra.collmemory,t)}));var n,r,h,d,y,_,f,x,g=o.getCurrentSol(),b=t.getCurrentSol(),v=g.getObjects(),B=this.runtime.tickcount,D=B-1,w=e.getCurrentEventStack().current_event;w.orblock;for(r=0;r<v.length;r++){for(h=v[r],b.select_all?(h.update_bbox(),this.runtime.getCollisionCandidates(h.layer,t,h.bbox,p),n=p,this.runtime.addRegisteredCollisionCandidates(h,t,n)):n=b.getObjects(),d=0;d<n.length;d++)y=n[d],e.testOverlap(h,y)||e.checkRegisteredCollision(h,y)?(x=!u(s,h,y)||m<D,c(s,h,y,B),x&&(e.pushCopySol(w.solModifiers),_=o.getCurrentSol(),f=t.getCurrentSol(),_.select_all=!1,f.select_all=!1,o===t?(_.instances.length=2,_.instances[0]=h,_.instances[1]=y,o.applySolToContainer()):(_.instances.length=1,f.instances.length=1,_.instances[0]=h,f.instances[0]=y,o.applySolToContainer(),t.applySolToContainer()),w.retrigger(),e.popSol(w.solModifiers))):l(s,h,y);cr.clearArray(p)}return!1};var d=null,y=new cr.ObjectSet,_=!1,f=[],x=new cr.rect(0,0,0,0);function g(t,e,i){if(!t)return!1;var o,s,n,r,a,h,c=0!==e||0!==i,l=!1,m=this.runtime.getCurrentCondition(),u=m.type,p=m.inverted,g=t.getCurrentSol(),b=this.runtime.getCurrentEventStack().current_event.orblock;for(g.select_all?(this.update_bbox(),x.copy(this.bbox),x.offset(e,i),this.runtime.getCollisionCandidates(this.layer,t,x,f),h=f):h=b?this.runtime.isCurrentConditionFirst()&&!g.else_instances.length&&g.instances.length?g.instances:g.else_instances:g.instances,d=t,_=u!==t&&!p,c&&(o=this.x,s=this.y,this.x+=e,this.y+=i,this.set_bbox_changed()),n=0,r=h.length;n<r;n++)if(a=h[n],this.runtime.testOverlap(this,a)){if(l=!0,p)break;u!==t&&y.add(a)}return c&&(this.x=o,this.y=s,this.set_bbox_changed()),cr.clearArray(f),l}function b(){}function v(){}e.finish=function(t){if(_){if(t){var e,i,o,s=this.runtime.getCurrentEventStack().current_event.orblock,n=d.getCurrentSol(),r=y.valuesRef();if(n.select_all){for(n.select_all=!1,cr.clearArray(n.instances),e=0,i=r.length;e<i;++e)n.instances[e]=r[e];if(s)for(cr.clearArray(n.else_instances),e=0,i=d.instances.length;e<i;++e)o=d.instances[e],y.contains(o)||n.else_instances.push(o)}else if(s){var a=n.instances.length;for(e=0,i=r.length;e<i;++e)n.instances[a+e]=r[e],cr.arrayFindRemove(n.else_instances,r[e])}else cr.shallowAssignArray(n.instances,r);d.applySolToContainer()}y.clear(),_=!1}},n.prototype.IsOverlapping=function(t){return g.call(this,t,0,0)},n.prototype.IsOverlappingOffset=function(t,e,i){return g.call(this,t,e,i)},n.prototype.IsAnimPlaying=function(t){return this.changeAnimName.length?cr.equals_nocase(this.changeAnimName,t):cr.equals_nocase(this.cur_animation.name,t)},n.prototype.CompareFrame=function(t,e){return cr.do_cmp(this.cur_frame,t,e)},n.prototype.CompareAnimSpeed=function(t,e){var i=this.animForwards?this.cur_anim_speed:-this.cur_anim_speed;return cr.do_cmp(i,t,e)},n.prototype.OnAnimFinished=function(t){return cr.equals_nocase(this.animTriggerName,t)},n.prototype.OnAnyAnimFinished=function(){return!0},n.prototype.OnFrameChanged=function(){return!0},n.prototype.IsMirrored=function(){return this.width<0},n.prototype.IsFlipped=function(){return this.height<0},n.prototype.OnURLLoaded=function(){return!0},n.prototype.IsCollisionEnabled=function(){return this.collisionsEnabled},t.cnds=new n,b.prototype.Spawn=function(t,e,i){if(t&&e){var o=this.runtime.createInstance(t,e,this.getImagePoint(i,!0),this.getImagePoint(i,!1));if(o){var s,n,r;if(void 0!==o.angle&&(o.angle=this.angle,o.set_bbox_changed()),this.runtime.isInOnDestroy++,this.runtime.trigger(Object.getPrototypeOf(t.plugin).cnds.OnCreated,o),o.is_contained)for(s=0,n=o.siblings.length;s<n;s++)r=o.siblings[s],this.runtime.trigger(Object.getPrototypeOf(r.type.plugin).cnds.OnCreated,r);this.runtime.isInOnDestroy--;var a,h=this.runtime.getCurrentAction(),c=!1;if((cr.is_undefined(h.extra.Spawn_LastExec)||h.extra.Spawn_LastExec<this.runtime.execcount)&&(c=!0,h.extra.Spawn_LastExec=this.runtime.execcount),t!=this.type&&((a=t.getCurrentSol()).select_all=!1,c?(cr.clearArray(a.instances),a.instances[0]=o):a.instances.push(o),o.is_contained))for(s=0,n=o.siblings.length;s<n;s++)(a=(r=o.siblings[s]).type.getCurrentSol()).select_all=!1,c?(cr.clearArray(a.instances),a.instances[0]=r):a.instances.push(r)}}},b.prototype.SetEffect=function(t){this.blend_mode=t,this.compositeOp=cr.effectToCompositeOp(t),cr.setGLBlend(this,t,this.runtime.gl),this.runtime.redraw=!0},b.prototype.StopAnim=function(){this.animPlaying=!1},b.prototype.StartAnim=function(t){this.animPlaying=!0,this.frameStart=this.getNowTime(),1===t&&0!==this.cur_frame&&(this.changeAnimFrame=0,this.inAnimTrigger||this.doChangeAnimFrame()),this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0)},b.prototype.SetAnim=function(t,e){this.changeAnimName=t,this.changeAnimFrom=e,this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0),this.inAnimTrigger||this.doChangeAnim()},b.prototype.SetAnimFrame=function(t){this.changeAnimFrame=t,this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0),this.inAnimTrigger||this.doChangeAnimFrame()},b.prototype.SetAnimSpeed=function(t){this.cur_anim_speed=cr.abs(t),this.animForwards=t>=0,this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0)},b.prototype.SetAnimRepeatToFrame=function(t){(t=Math.floor(t))<0&&(t=0),t>=this.cur_animation.frames.length&&(t=this.cur_animation.frames.length-1),this.cur_anim_repeatto=t},b.prototype.SetMirrored=function(t){var e=cr.abs(this.width)*(0===t?-1:1);this.width!==e&&(this.width=e,this.set_bbox_changed())},b.prototype.SetFlipped=function(t){var e=cr.abs(this.height)*(0===t?-1:1);this.height!==e&&(this.height=e,this.set_bbox_changed())},b.prototype.SetScale=function(t){var e=this.curFrame,i=this.width<0?-1:1,o=this.height<0?-1:1,s=e.width*t*i,n=e.height*t*o;this.width===s&&this.height===n||(this.width=s,this.height=n,this.set_bbox_changed())},b.prototype.LoadURL=function(t,e,i){var o=new Image,s=this,n=this.curFrame;o.onload=function(){if(n.texture_img.src===o.src)return s.runtime.glwrap&&s.curFrame===n&&(s.curWebGLTexture=n.webGL_texture),0===e&&(s.width=o.width,s.height=o.height,s.set_bbox_changed()),s.runtime.redraw=!0,void s.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnURLLoaded,s);n.texture_img=o,n.offx=0,n.offy=0,n.width=o.width,n.height=o.height,n.spritesheeted=!1,n.datauri="",n.pixelformat=0,s.runtime.glwrap&&(n.webGL_texture&&s.runtime.glwrap.deleteTexture(n.webGL_texture),n.webGL_texture=s.runtime.glwrap.loadTexture(o,!1,s.runtime.linearSampling),s.curFrame===n&&(s.curWebGLTexture=n.webGL_texture),s.type.updateAllCurrentTexture()),0===e&&(s.width=o.width,s.height=o.height,s.set_bbox_changed()),s.runtime.redraw=!0,s.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnURLLoaded,s)},"data:"!==t.substr(0,5)&&0===i&&(o.crossOrigin="anonymous"),this.runtime.setImageSrc(o,t)},b.prototype.SetCollisions=function(t){this.collisionsEnabled!==(0!==t)&&(this.collisionsEnabled=0!==t,this.collisionsEnabled?this.set_bbox_changed():(this.collcells.right>=this.collcells.left&&this.type.collision_grid.update(this,this.collcells,null),this.collcells.set(0,0,-1,-1)))},t.acts=new b,v.prototype.AnimationFrame=function(t){t.set_int(this.cur_frame)},v.prototype.AnimationFrameCount=function(t){t.set_int(this.cur_animation.frames.length)},v.prototype.AnimationName=function(t){t.set_string(this.cur_animation.name)},v.prototype.AnimationSpeed=function(t){t.set_float(this.animForwards?this.cur_anim_speed:-this.cur_anim_speed)},v.prototype.ImagePointX=function(t,e){t.set_float(this.getImagePoint(e,!0))},v.prototype.ImagePointY=function(t,e){t.set_float(this.getImagePoint(e,!1))},v.prototype.ImagePointCount=function(t){t.set_int(this.curFrame.image_points.length)},v.prototype.ImageWidth=function(t){t.set_float(this.curFrame.width)},v.prototype.ImageHeight=function(t){t.set_float(this.curFrame.height)},t.exps=new v}(),cr.plugins_.Spritefont2=function(t){this.runtime=t},function(){var t=cr.plugins_.Spritefont2.prototype;t.onCreate=function(){},t.Type=function(t){this.plugin=t,this.runtime=t.runtime};var e=t.Type.prototype;e.onCreate=function(){this.is_family||(this.texture_img=new Image,this.runtime.waitForImageLoad(this.texture_img,this.texture_file),this.webGL_texture=null)},e.onLostWebGLContext=function(){this.is_family||(this.webGL_texture=null)},e.onRestoreWebGLContext=function(){var t,e;if(!this.is_family&&this.instances.length)for(this.webGL_texture||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!1,this.runtime.linearSampling,this.texture_pixelformat)),t=0,e=this.instances.length;t<e;t++)this.instances[t].webGL_texture=this.webGL_texture},e.unloadTextures=function(){this.is_family||this.instances.length||!this.webGL_texture||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)},e.preloadCanvas2D=function(t){t.drawImage(this.texture_img,0,0)},t.Instance=function(t){this.type=t,this.runtime=t.runtime};var i=t.Instance.prototype;function o(t){return t.replace(/\s\s*$/,"")}i.onDestroy=function(){var t;m(this.lines),t=this.clipList,a(p,t,!1),function(t){a(d,t,!1)}(this.clipUV),cr.wipe(this.characterWidthList)},i.onCreate=function(){this.texture_img=this.type.texture_img,this.characterWidth=this.properties[0],this.characterHeight=this.properties[1],this.characterSet=this.properties[2],this.text=this.properties[3],this.characterScale=this.properties[4],this.visible=0===this.properties[5],this.halign=this.properties[6]/2,this.valign=this.properties[7]/2,this.wrapbyword=0===this.properties[9],this.characterSpacing=this.properties[10],this.lineHeight=this.properties[11],this.textWidth=0,this.textHeight=0,this.recycled?(cr.clearArray(this.lines),cr.wipe(this.clipList),cr.wipe(this.clipUV),cr.wipe(this.characterWidthList)):(this.lines=[],this.clipList={},this.clipUV={},this.characterWidthList={}),this.text_changed=!0,this.lastwrapwidth=this.width,this.runtime.glwrap&&(this.type.webGL_texture||(this.type.webGL_texture=this.runtime.glwrap.loadTexture(this.type.texture_img,!1,this.runtime.linearSampling,this.type.texture_pixelformat)),this.webGL_texture=this.type.webGL_texture),this.SplitSheet()},i.saveToJSON=function(){var t={t:this.text,csc:this.characterScale,csp:this.characterSpacing,lh:this.lineHeight,tw:this.textWidth,th:this.textHeight,lrt:this.last_render_tick,ha:this.halign,va:this.valign,cw:{}};for(var e in this.characterWidthList)t.cw[e]=this.characterWidthList[e];return t},i.loadFromJSON=function(t){for(var e in this.text=t.t,this.characterScale=t.csc,this.characterSpacing=t.csp,this.lineHeight=t.lh,this.textWidth=t.tw,this.textHeight=t.th,this.last_render_tick=t.lrt,t.hasOwnProperty("ha")&&(this.halign=t.ha),t.hasOwnProperty("va")&&(this.valign=t.va),t.cw)this.characterWidthList[e]=t.cw[e];this.text_changed=!0,this.lastwrapwidth=this.width};var s=1e3;function n(t,e){return t.length?t.pop():new e}function r(t,e){t.length<s&&t.push(e)}function a(t,e,i){if(i){var o,s;for(o=0,s=e.length;o<s;o++)r(t,e[o]);cr.clearArray(e)}else{var n;for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r(t,e[n]),delete e[n])}}function h(t,e,i){var s,n=t.lines;i=o(i),e>=n.length&&n.push(l()),(s=n[e]).text=i,s.width=t.measureWidth(i),t.textWidth=cr.max(t.textWidth,s.width)}var c=[];function l(){return n(c,Object)}function m(t){a(c,t,!0)}function u(t,e,i,o,s,r){void 0===t[e]&&(t[e]=n(p,Object)),t[e].x=i,t[e].y=o,t[e].w=s,t[e].h=r}var p=[];var d=[];i.SplitSheet=function(){for(var t,e,i,o,s,r,a=this.texture_img,h=a.width,c=a.height,l=this.characterWidth,m=this.characterHeight,p=l/h,y=m/c,_=this.characterSet,f=Math.floor(h/l),x=Math.floor(c/m),g=0;g<_.length&&!(g>=f*x);g++){var b=g%f,v=Math.floor(g/f),B=_.charAt(g);this.runtime.glwrap?(t=this.clipUV,i=b*p,o=v*y,s=(b+1)*p,r=(v+1)*y,void 0===t[e=B]&&(t[e]=n(d,cr.rect)),t[e].left=i,t[e].top=o,t[e].right=s,t[e].bottom=r):u(this.clipList,B,b*l,v*m,l,m)}};var y=[];t.TokeniseWords=function(t){cr.clearArray(y);for(var e,i="",o=0;o<t.length;)if("\n"===(e=t.charAt(o)))i.length&&(y.push(i),i=""),y.push("\n"),++o;else if(" "===e||"\t"===e||"-"===e){do{i+=t.charAt(o),o++}while(o<t.length&&(" "===t.charAt(o)||"\t"===t.charAt(o)));y.push(i),i=""}else o<t.length&&(i+=e,o++);i.length&&y.push(i)},t.WordWrap=function(t){var e=t.text,i=t.lines;if(e&&e.length){var o=t.width;if(o<=2)m(i);else{var s=t.characterWidth,n=t.characterScale,r=t.characterSpacing;if(e.length*(s*n+r)-r<=o&&-1===e.indexOf("\n")){var a=t.measureWidth(e);if(a<=o)return m(i),i.push(l()),i[0].text=e,i[0].width=a,t.textWidth=a,void(t.textHeight=t.characterHeight*n+t.lineHeight)}t.wrapbyword;this.WrapText(t),t.textHeight=i.length*(t.characterHeight*n+t.lineHeight)}}else m(i)},t.WrapText=function(t){var e,i=t.wrapbyword,s=t.text,n=t.lines,a=t.width;i?(this.TokeniseWords(s),e=y):e=s;var l,m,u,p="",d=0,_=!1;for(m=0;m<e.length;m++)"\n"!==e[m]?(_=!1,l=p,p+=e[m],t.measureWidth(o(p))>a&&(""===l?(h(t,d,p),p="",_=!0):(h(t,d,l),p=e[m]),d++,i||" "!==p||(p=""))):(!0===_?_=!1:(h(t,d,p),d++),p="");for(o(p).length&&(h(t,d,p),d++),m=d;m<n.length;m++)u=n[m],r(c,u);n.length=d},i.measureWidth=function(t){for(var e=this.characterSpacing,i=t.length,o=0,s=0;s<i;s++)o+=this.getCharacterWidth(t.charAt(s))*this.characterScale+e;return o-=o>0?e:0},i.getCharacterWidth=function(t){var e=this.characterWidthList;return void 0!==e[t]?e[t]:this.characterWidth},i.rebuildText=function(){(this.text_changed||this.width!==this.lastwrapwidth)&&(this.textWidth=0,this.textHeight=0,this.type.plugin.WordWrap(this),this.text_changed=!1,this.lastwrapwidth=this.width)};i.draw=function(t,e){var i=this.texture_img;if(""!==this.text&&null!=i){if(this.rebuildText(),this.height<this.characterHeight*this.characterScale+this.lineHeight)return;t.globalAlpha=this.opacity;var o=this.x,s=this.y;this.runtime.pixel_rounding&&(o=Math.round(o),s=Math.round(s));var n=this.layer.viewLeft,r=this.layer.viewTop,a=this.layer.viewRight,h=this.layer.viewBottom;t.save(),t.translate(o,s),t.rotate(this.angle);for(var c,l,m,u,p=this.angle,d=this.halign,y=this.valign,_=this.characterScale,f=this.characterHeight*_,x=this.lineHeight,g=this.characterSpacing,b=this.lines,v=this.textHeight,B=y*cr.max(0,this.height-v),D=-this.hotspotX*this.width,w=-this.hotspotY*this.height,C=w+=B,S=0;S<b.length;S++){var A=b[S].text,M=b[S].width;if(l=D+d*cr.max(0,this.width-M),C+=x,0===p&&s+C+f<r)C+=f;else{for(var T=0;T<A.length;T++){var I=A.charAt(T);c=this.getCharacterWidth(I);var P=this.clipList[I];if(0===p&&o+l+c*_+g<n)l+=c*_+g;else{if(l+c*_>this.width+1e-5)break;if(void 0!==P&&(m=l,u=C,0===p&&1===_&&(m=Math.round(m),u=Math.round(u)),t.drawImage(this.texture_img,P.x,P.y,P.w,P.h,m,u,P.w*_,P.h*_)),l+=c*_+g,0===p&&o+l>a)break}}if(C+=f,0===p&&(C+f+x>this.height||s+C>h))break}}t.restore()}};var _=new cr.quad;function f(t,e,i){var o;o=t.tlx*e-t.tly*i,t.tly=t.tly*e+t.tlx*i,t.tlx=o,o=t.trx*e-t.try_*i,t.try_=t.try_*e+t.trx*i,t.trx=o,o=t.blx*e-t.bly*i,t.bly=t.bly*e+t.blx*i,t.blx=o,o=t.brx*e-t.bry*i,t.bry=t.bry*e+t.brx*i,t.brx=o}function x(){}function g(){}function b(){}i.drawGL=function(t){if(t.setTexture(this.webGL_texture),t.setOpacity(this.opacity),this.text&&(this.rebuildText(),!(this.height<this.characterHeight*this.characterScale+this.lineHeight))){this.update_bbox();var e=this.bquad,i=0,o=0;this.runtime.pixel_rounding&&(i=Math.round(this.x)-this.x,o=Math.round(this.y)-this.y);var s,n,r,a=this.layer.viewLeft,h=this.layer.viewTop,c=this.layer.viewRight,l=this.layer.viewBottom,m=this.angle,u=this.halign,p=this.valign,d=this.characterScale,y=this.characterHeight*d,x=this.lineHeight,g=this.characterSpacing,b=this.lines,v=this.textHeight;0!==m&&(n=Math.cos(m),r=Math.sin(m));for(var B,D,w,C=p*cr.max(0,this.height-v),S=e.tlx+i,A=e.tly+o,M=C,T=0;T<b.length;T++){var I=b[T].text,P=b[T].width;if(B=u*cr.max(0,this.width-P),M+=x,0===m&&A+M+y<h)M+=y;else{for(var L=0;L<I.length;L++){var V=I.charAt(L);s=this.getCharacterWidth(V);var R=this.clipUV[V];if(0===m&&S+B+s*d+g<a)B+=s*d+g;else{if(B+s*d>this.width+1e-5)break;if(void 0!==R){var O=this.characterWidth*d,k=this.characterHeight*d;D=B,w=M,0===m&&1===d&&(D=Math.round(D),w=Math.round(w)),_.tlx=D,_.tly=w,_.trx=D+O,_.try_=w,_.blx=D,_.bly=w+k,_.brx=D+O,_.bry=w+k,0!==m&&f(_,n,r),_.offset(S,A),t.quadTex(_.tlx,_.tly,_.trx,_.try_,_.brx,_.bry,_.blx,_.bly,R)}if(B+=s*d+g,0===m&&S+B>c)break}}if(M+=y,0===m&&(M+y+x>this.height||A+M>l))break}}}},x.prototype.CompareText=function(t,e){return e?this.text==t:cr.equals_nocase(this.text,t)},t.cnds=new x,g.prototype.SetText=function(t){cr.is_number(t)&&t<1e9&&(t=Math.round(1e10*t)/1e10);var e=t.toString();this.text!==e&&(this.text=e,this.text_changed=!0,this.runtime.redraw=!0)},g.prototype.AppendText=function(t){cr.is_number(t)&&(t=Math.round(1e10*t)/1e10);var e=t.toString();e&&(this.text+=e,this.text_changed=!0,this.runtime.redraw=!0)},g.prototype.SetScale=function(t){t!==this.characterScale&&(this.characterScale=t,this.text_changed=!0,this.runtime.redraw=!0)},g.prototype.SetCharacterSpacing=function(t){t!==this.CharacterSpacing&&(this.characterSpacing=t,this.text_changed=!0,this.runtime.redraw=!0)},g.prototype.SetLineHeight=function(t){t!==this.lineHeight&&(this.lineHeight=t,this.text_changed=!0,this.runtime.redraw=!0)},i.SetCharWidth=function(t,e){var i=parseInt(e,10);this.characterWidthList[t]!==i&&(this.characterWidthList[t]=i,this.text_changed=!0,this.runtime.redraw=!0)},g.prototype.SetCharacterWidth=function(t,e){if(""!==t)for(var i=0;i<t.length;i++)this.SetCharWidth(t.charAt(i),e)},g.prototype.SetEffect=function(t){this.blend_mode=t,this.compositeOp=cr.effectToCompositeOp(t),cr.setGLBlend(this,t,this.runtime.gl),this.runtime.redraw=!0},g.prototype.SetHAlign=function(t){this.halign=t/2,this.text_changed=!0,this.runtime.redraw=!0},g.prototype.SetVAlign=function(t){this.valign=t/2,this.text_changed=!0,this.runtime.redraw=!0},t.acts=new g,b.prototype.CharacterWidth=function(t,e){t.set_int(this.getCharacterWidth(e))},b.prototype.CharacterHeight=function(t){t.set_int(this.characterHeight)},b.prototype.CharacterScale=function(t){t.set_float(this.characterScale)},b.prototype.CharacterSpacing=function(t){t.set_int(this.characterSpacing)},b.prototype.LineHeight=function(t){t.set_int(this.lineHeight)},b.prototype.Text=function(t){t.set_string(this.text)},b.prototype.TextWidth=function(t){this.rebuildText(),t.set_float(this.textWidth)},b.prototype.TextHeight=function(t){this.rebuildText(),t.set_float(this.textHeight)},t.exps=new b}(),cr.plugins_.TiledBg=function(t){this.runtime=t},function(){var t=cr.plugins_.TiledBg.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime};var e=t.Type.prototype;e.onCreate=function(){this.is_family||(this.texture_img=new Image,this.texture_img.cr_filesize=this.texture_filesize,this.runtime.waitForImageLoad(this.texture_img,this.texture_file),this.pattern=null,this.webGL_texture=null)},e.onLostWebGLContext=function(){this.is_family||(this.webGL_texture=null)},e.onRestoreWebGLContext=function(){var t,e;if(!this.is_family&&this.instances.length)for(this.webGL_texture||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat)),t=0,e=this.instances.length;t<e;t++)this.instances[t].webGL_texture=this.webGL_texture},e.loadTextures=function(){this.is_family||this.webGL_texture||!this.runtime.glwrap||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat))},e.unloadTextures=function(){this.is_family||this.instances.length||!this.webGL_texture||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)},e.preloadCanvas2D=function(t){t.drawImage(this.texture_img,0,0)},t.Instance=function(t){this.type=t,this.runtime=t.runtime};var i=t.Instance.prototype;function o(){}function s(){}function n(){}i.onCreate=function(){this.visible=0===this.properties[0],this.rcTex=new cr.rect(0,0,0,0),this.has_own_texture=!1,this.texture_img=this.type.texture_img,this.runtime.glwrap?(this.type.loadTextures(),this.webGL_texture=this.type.webGL_texture):(this.type.pattern||(this.type.pattern=this.runtime.ctx.createPattern(this.type.texture_img,"repeat")),this.pattern=this.type.pattern)},i.afterLoad=function(){this.has_own_texture=!1,this.texture_img=this.type.texture_img},i.onDestroy=function(){this.runtime.glwrap&&this.has_own_texture&&this.webGL_texture&&(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)},i.draw=function(t){t.globalAlpha=this.opacity,t.save(),t.fillStyle=this.pattern;var e=this.x,i=this.y;this.runtime.pixel_rounding&&(e=Math.round(e),i=Math.round(i));var o=-this.hotspotX*this.width,s=-this.hotspotY*this.height,n=o%this.texture_img.width,r=s%this.texture_img.height;n<0&&(n+=this.texture_img.width),r<0&&(r+=this.texture_img.height),t.translate(e,i),t.rotate(this.angle),t.translate(n,r),t.fillRect(o-n,s-r,this.width,this.height),t.restore()},i.drawGL_earlyZPass=function(t){this.drawGL(t)},i.drawGL=function(t){t.setTexture(this.webGL_texture),t.setOpacity(this.opacity);var e=this.rcTex;e.right=this.width/this.texture_img.width,e.bottom=this.height/this.texture_img.height;var i=this.bquad;if(this.runtime.pixel_rounding){var o=Math.round(this.x)-this.x,s=Math.round(this.y)-this.y;t.quadTex(i.tlx+o,i.tly+s,i.trx+o,i.try_+s,i.brx+o,i.bry+s,i.blx+o,i.bly+s,e)}else t.quadTex(i.tlx,i.tly,i.trx,i.try_,i.brx,i.bry,i.blx,i.bly,e)},o.prototype.OnURLLoaded=function(){return!0},t.cnds=new o,s.prototype.SetEffect=function(t){this.blend_mode=t,this.compositeOp=cr.effectToCompositeOp(t),cr.setGLBlend(this,t,this.runtime.gl),this.runtime.redraw=!0},s.prototype.LoadURL=function(t,e){var i=new Image,o=this;i.onload=function(){o.texture_img=i,o.runtime.glwrap?(o.has_own_texture&&o.webGL_texture&&o.runtime.glwrap.deleteTexture(o.webGL_texture),o.webGL_texture=o.runtime.glwrap.loadTexture(i,!0,o.runtime.linearSampling)):o.pattern=o.runtime.ctx.createPattern(i,"repeat"),o.has_own_texture=!0,o.runtime.redraw=!0,o.runtime.trigger(cr.plugins_.TiledBg.prototype.cnds.OnURLLoaded,o)},"data:"!==t.substr(0,5)&&0===e&&(i.crossOrigin="anonymous"),this.runtime.setImageSrc(i,t)},t.acts=new s,n.prototype.ImageWidth=function(t){t.set_float(this.texture_img.width)},n.prototype.ImageHeight=function(t){t.set_float(this.texture_img.height)},t.exps=new n}(),cr.plugins_.Touch=function(t){this.runtime=t},function(){var t=cr.plugins_.Touch.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t){this.type=t,this.runtime=t.runtime,this.touches=[],this.mouseDown=!1};var e=t.Instance.prototype,i={left:0,top:0};e.findTouch=function(t){var e,i;for(e=0,i=this.touches.length;e<i;e++)if(this.touches[e].id===t)return e;return-1};var o=0,s=0,n=0;function r(t){o=t.x,s=t.y,n=t.z}var a=[];function h(t,e,i,o){var s;return(s=a.length?a.pop():new l).init(t,e,i,o),s}function c(t){a.length<100&&a.push(t)}function l(){this.starttime=0,this.time=0,this.lasttime=0,this.startx=0,this.starty=0,this.x=0,this.y=0,this.lastx=0,this.lasty=0,this.id=0,this.startindex=0,this.triggeredHold=!1,this.tooFarForHold=!1}l.prototype.init=function(t,e,i,o){var s=cr.performance_now();this.time=s,this.lasttime=s,this.starttime=s,this.startx=t,this.starty=e,this.x=t,this.y=e,this.lastx=t,this.lasty=e,this.width=0,this.height=0,this.pressure=0,this.id=i,this.startindex=o,this.triggeredHold=!1,this.tooFarForHold=!1},l.prototype.update=function(t,e,i,o,s,n){this.lasttime=this.time,this.time=t,this.lastx=this.x,this.lasty=this.y,this.x=e,this.y=i,this.width=o,this.height=s,this.pressure=n,!this.tooFarForHold&&cr.distanceTo(this.startx,this.starty,this.x,this.y)>=15&&(this.tooFarForHold=!0)},l.prototype.maybeTriggerHold=function(t,e){this.triggeredHold||cr.performance_now()-this.starttime>=500&&!this.tooFarForHold&&cr.distanceTo(this.startx,this.starty,this.x,this.y)<15&&(this.triggeredHold=!0,t.trigger_index=this.startindex,t.trigger_id=this.id,t.getTouchIndex=e,t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnHoldGesture,t),t.curTouchX=this.x,t.curTouchY=this.y,t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnHoldGestureObject,t),t.getTouchIndex=0)};var m=-1e3,u=-1e3,p=-1e4;l.prototype.maybeTriggerTap=function(t,e){if(!this.triggeredHold){var i=cr.performance_now();i-this.starttime<=333&&!this.tooFarForHold&&cr.distanceTo(this.startx,this.starty,this.x,this.y)<15&&(t.trigger_index=this.startindex,t.trigger_id=this.id,t.getTouchIndex=e,i-p<=666&&cr.distanceTo(m,u,this.x,this.y)<25?(t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnDoubleTapGesture,t),t.curTouchX=this.x,t.curTouchY=this.y,t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnDoubleTapGestureObject,t),m=-1e3,u=-1e3,p=-1e4):(t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTapGesture,t),t.curTouchX=this.x,t.curTouchY=this.y,t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTapGestureObject,t),m=this.x,u=this.y,p=i),t.getTouchIndex=0)}},e.onCreate=function(){this,this.isWindows8=!(void 0===window.c2isWindows8||!window.c2isWindows8),this.orient_alpha=0,this.orient_beta=0,this.orient_gamma=0,this.acc_g_x=0,this.acc_g_y=0,this.acc_g_z=0,this.acc_x=0,this.acc_y=0,this.acc_z=0,this.curTouchX=0,this.curTouchY=0,this.trigger_index=0,this.trigger_id=0,this.trigger_permission=0,this.getTouchIndex=0,this.useMouseInput=0!==this.properties[0];var t=this.runtime.fullscreen_mode>0?document:this.runtime.canvas,e=document;this.runtime.isDirectCanvas?e=t=window.Canvas:this.runtime.isCocoonJs&&(e=t=window);var i=this;if("undefined"!=typeof PointerEvent?(t.addEventListener("pointerdown",function(t){i.onPointerStart(t)},!1),t.addEventListener("pointermove",function(t){i.onPointerMove(t)},!1),e.addEventListener("pointerup",function(t){i.onPointerEnd(t,!1)},!1),e.addEventListener("pointercancel",function(t){i.onPointerEnd(t,!0)},!1),this.runtime.canvas&&(this.runtime.canvas.addEventListener("MSGestureHold",function(t){t.preventDefault()},!1),document.addEventListener("MSGestureHold",function(t){t.preventDefault()},!1),this.runtime.canvas.addEventListener("gesturehold",function(t){t.preventDefault()},!1),document.addEventListener("gesturehold",function(t){t.preventDefault()},!1))):window.navigator.msPointerEnabled?(t.addEventListener("MSPointerDown",function(t){i.onPointerStart(t)},!1),t.addEventListener("MSPointerMove",function(t){i.onPointerMove(t)},!1),e.addEventListener("MSPointerUp",function(t){i.onPointerEnd(t,!1)},!1),e.addEventListener("MSPointerCancel",function(t){i.onPointerEnd(t,!0)},!1),this.runtime.canvas&&(this.runtime.canvas.addEventListener("MSGestureHold",function(t){t.preventDefault()},!1),document.addEventListener("MSGestureHold",function(t){t.preventDefault()},!1))):(t.addEventListener("touchstart",function(t){i.onTouchStart(t)},!1),t.addEventListener("touchmove",function(t){i.onTouchMove(t)},!1),e.addEventListener("touchend",function(t){i.onTouchEnd(t,!1)},!1),e.addEventListener("touchcancel",function(t){i.onTouchEnd(t,!0)},!1)),this.isWindows8){var o=function(t){var e=t.reading;i.acc_x=e.accelerationX,i.acc_y=e.accelerationY,i.acc_z=e.accelerationZ},s=function(t){var e=t.reading;i.orient_alpha=e.yawDegrees,i.orient_beta=e.pitchDegrees,i.orient_gamma=e.rollDegrees},n=Windows.Devices.Sensors.Accelerometer.getDefault();n&&(n.reportInterval=Math.max(n.minimumReportInterval,16),n.addEventListener("readingchanged",o));var a=Windows.Devices.Sensors.Inclinometer.getDefault();a&&(a.reportInterval=Math.max(a.minimumReportInterval,16),a.addEventListener("readingchanged",s)),document.addEventListener("visibilitychange",function(t){document.hidden||document.msHidden?(n&&n.removeEventListener("readingchanged",o),a&&a.removeEventListener("readingchanged",s)):(n&&n.addEventListener("readingchanged",o),a&&a.addEventListener("readingchanged",s))},!1)}else window.addEventListener("deviceorientation",function(t){i.orient_alpha=t.alpha||0,i.orient_beta=t.beta||0,i.orient_gamma=t.gamma||0},!1),window.addEventListener("devicemotion",function(t){t.accelerationIncludingGravity&&(i.acc_g_x=t.accelerationIncludingGravity.x||0,i.acc_g_y=t.accelerationIncludingGravity.y||0,i.acc_g_z=t.accelerationIncludingGravity.z||0),t.acceleration&&(i.acc_x=t.acceleration.x||0,i.acc_y=t.acceleration.y||0,i.acc_z=t.acceleration.z||0)},!1);this.useMouseInput&&!this.runtime.isDomFree&&(jQuery(document).mousemove(function(t){i.onMouseMove(t)}),jQuery(document).mousedown(function(t){i.onMouseDown(t)}),jQuery(document).mouseup(function(t){i.onMouseUp(t)})),!this.runtime.isiOS&&this.runtime.isCordova&&navigator.accelerometer&&navigator.accelerometer.watchAcceleration&&navigator.accelerometer.watchAcceleration(r,null,{frequency:40}),this.runtime.tick2Me(this)},e.onPointerMove=function(t){if(t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType){t.preventDefault&&t.preventDefault();var e=this.findTouch(t.pointerId),o=cr.performance_now();if(e>=0){var s=this.runtime.isDomFree?i:jQuery(this.runtime.canvas).offset(),n=this.touches[e];if(o-n.time<2)return;n.update(o,t.pageX-s.left,t.pageY-s.top,t.width||0,t.height||0,t.pressure||0)}}},e.onPointerStart=function(t){if(t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType){t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault();var e=this.runtime.isDomFree?i:jQuery(this.runtime.canvas).offset(),o=t.pageX-e.left,s=t.pageY-e.top;cr.performance_now();this.trigger_index=this.touches.length,this.trigger_id=t.pointerId,this.touches.push(h(o,s,t.pointerId,this.trigger_index)),this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart,this),this.curTouchX=o,this.curTouchY=s,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject,this),this.runtime.isInUserInputEvent=!1}},e.onPointerEnd=function(t,e){if(t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType){t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault();var i=this.findTouch(t.pointerId);this.trigger_index=i>=0?this.touches[i].startindex:-1,this.trigger_id=i>=0?this.touches[i].id:-1,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd,this),i>=0&&(e||this.touches[i].maybeTriggerTap(this,i),c(this.touches[i]),this.touches.splice(i,1)),this.runtime.isInUserInputEvent=!1}},e.onTouchMove=function(t){t.preventDefault&&t.preventDefault();var e,o,s,n,r=cr.performance_now();for(e=0,o=t.changedTouches.length;e<o;e++){s=t.changedTouches[e];var a=this.findTouch(s.identifier);if(a>=0){var h=this.runtime.isDomFree?i:jQuery(this.runtime.canvas).offset();if(r-(n=this.touches[a]).time<2)continue;var c=2*(s.radiusX||s.webkitRadiusX||s.mozRadiusX||s.msRadiusX||0),l=2*(s.radiusY||s.webkitRadiusY||s.mozRadiusY||s.msRadiusY||0),m=s.force||s.webkitForce||s.mozForce||s.msForce||0;n.update(r,s.pageX-h.left,s.pageY-h.top,c,l,m)}}},e.onTouchStart=function(t){t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault();var e,o,s,n=this.runtime.isDomFree?i:jQuery(this.runtime.canvas).offset();cr.performance_now();for(this.runtime.isInUserInputEvent=!0,e=0,o=t.changedTouches.length;e<o;e++)if(s=t.changedTouches[e],-1===this.findTouch(s.identifier)){var r=s.pageX-n.left,a=s.pageY-n.top;this.trigger_index=this.touches.length,this.trigger_id=s.identifier,this.touches.push(h(r,a,s.identifier,this.trigger_index)),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart,this),this.curTouchX=r,this.curTouchY=a,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject,this)}this.runtime.isInUserInputEvent=!1},e.onTouchEnd=function(t,e){var i,o,s,n;for(t.preventDefault&&cr.isCanvasInputEvent(t)&&t.preventDefault(),this.runtime.isInUserInputEvent=!0,i=0,o=t.changedTouches.length;i<o;i++)s=t.changedTouches[i],(n=this.findTouch(s.identifier))>=0&&(this.trigger_index=this.touches[n].startindex,this.trigger_id=this.touches[n].id,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd,this),e||this.touches[n].maybeTriggerTap(this,n),c(this.touches[n]),this.touches.splice(n,1));this.runtime.isInUserInputEvent=!1},e.getAlpha=function(){return this.runtime.isCordova&&0===this.orient_alpha&&0!==n?90*n:this.orient_alpha},e.getBeta=function(){return this.runtime.isCordova&&0===this.orient_beta&&0!==s?90*s:this.orient_beta},e.getGamma=function(){return this.runtime.isCordova&&0===this.orient_gamma&&0!==o?90*o:this.orient_gamma};function d(t){return t.sourceCapabilities&&t.sourceCapabilities.firesTouchEvents||t.originalEvent&&t.originalEvent.sourceCapabilities&&t.originalEvent.sourceCapabilities.firesTouchEvents}function y(){}e.onMouseDown=function(t){if(!d(t)){var e={changedTouches:[{pageX:t.pageX,pageY:t.pageY,identifier:0}]};this.onTouchStart(e),this.mouseDown=!0}},e.onMouseMove=function(t){if(this.mouseDown&&!d(t)){var e={changedTouches:[{pageX:t.pageX,pageY:t.pageY,identifier:0}]};this.onTouchMove(e)}},e.onMouseUp=function(t){if(t.preventDefault&&this.runtime.had_a_click&&!this.runtime.isMobile&&t.preventDefault(),this.runtime.had_a_click=!0,!d(t)){var e={changedTouches:[{pageX:t.pageX,pageY:t.pageY,identifier:0}]};this.onTouchEnd(e),this.mouseDown=!1}},e.tick2=function(){var t,e,i,o=cr.performance_now();for(t=0,e=this.touches.length;t<e;++t)(i=this.touches[t]).time<=o-50&&(i.lasttime=o),i.maybeTriggerHold(this,t)},y.prototype.OnTouchStart=function(){return!0},y.prototype.OnTouchEnd=function(){return!0},y.prototype.IsInTouch=function(){return this.touches.length},y.prototype.OnTouchObject=function(t){return!!t&&this.runtime.testAndSelectCanvasPointOverlap(t,this.curTouchX,this.curTouchY,!1)};var _=[];function f(){}function x(){}y.prototype.IsTouchingObject=function(t){if(!t)return!1;var e,i,o,s,n,r,a=t.getCurrentSol(),h=a.getObjects();for(o=0,s=h.length;o<s;o++){var c=h[o];for(c.update_bbox(),n=0,r=this.touches.length;n<r;n++){var l=this.touches[n];if(e=c.layer.canvasToLayer(l.x,l.y,!0),i=c.layer.canvasToLayer(l.x,l.y,!1),c.contains_pt(e,i)){_.push(c);break}}}return!!_.length&&(a.select_all=!1,cr.shallowAssignArray(a.instances,_),t.applySolToContainer(),cr.clearArray(_),!0)},y.prototype.CompareTouchSpeed=function(t,e,i){if((t=Math.floor(t))<0||t>=this.touches.length)return!1;var o=this.touches[t],s=cr.distanceTo(o.x,o.y,o.lastx,o.lasty),n=(o.time-o.lasttime)/1e3,r=0;return n>0&&(r=s/n),cr.do_cmp(r,e,i)},y.prototype.OrientationSupported=function(){return void 0!==window.DeviceOrientationEvent},y.prototype.MotionSupported=function(){return void 0!==window.DeviceMotionEvent},y.prototype.CompareOrientation=function(t,e,i){var o=0;return o=0===t?this.getAlpha():1===t?this.getBeta():this.getGamma(),cr.do_cmp(o,e,i)},y.prototype.CompareAcceleration=function(t,e,i){var o=0;return 0===t?o=this.acc_g_x:1===t?o=this.acc_g_y:2===t?o=this.acc_g_z:3===t?o=this.acc_x:4===t?o=this.acc_y:5===t&&(o=this.acc_z),cr.do_cmp(o,e,i)},y.prototype.OnNthTouchStart=function(t){return(t=Math.floor(t))===this.trigger_index},y.prototype.OnNthTouchEnd=function(t){return(t=Math.floor(t))===this.trigger_index},y.prototype.HasNthTouch=function(t){return t=Math.floor(t),this.touches.length>=t+1},y.prototype.OnHoldGesture=function(){return!0},y.prototype.OnTapGesture=function(){return!0},y.prototype.OnDoubleTapGesture=function(){return!0},y.prototype.OnHoldGestureObject=function(t){return!!t&&this.runtime.testAndSelectCanvasPointOverlap(t,this.curTouchX,this.curTouchY,!1)},y.prototype.OnTapGestureObject=function(t){return!!t&&this.runtime.testAndSelectCanvasPointOverlap(t,this.curTouchX,this.curTouchY,!1)},y.prototype.OnDoubleTapGestureObject=function(t){return!!t&&this.runtime.testAndSelectCanvasPointOverlap(t,this.curTouchX,this.curTouchY,!1)},y.prototype.OnPermissionGranted=function(t){return this.trigger_permission===t},y.prototype.OnPermissionDenied=function(t){return this.trigger_permission===t},t.cnds=new y,f.prototype.RequestPermission=function(t){var e=this,i=Promise.resolve(!0);0===t?window.DeviceOrientationEvent&&window.DeviceOrientationEvent.requestPermission&&(i=window.DeviceOrientationEvent.requestPermission().then(function(t){return"granted"===t})):window.DeviceMotionEvent&&window.DeviceMotionEvent.requestPermission&&(i=window.DeviceMotionEvent.requestPermission().then(function(t){return"granted"===t})),i.then(function(i){e.trigger_permission=t,i?e.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnPermissionGranted,e):e.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnPermissionDenied,e)})},t.acts=new f,x.prototype.TouchCount=function(t){t.set_int(this.touches.length)},x.prototype.X=function(t,e){var i,o,s,n,r,a=this.getTouchIndex;a<0||a>=this.touches.length?t.set_float(0):cr.is_undefined(e)?(o=(i=this.runtime.getLayerByNumber(0)).scale,s=i.zoomRate,n=i.parallaxX,r=i.angle,i.scale=1,i.zoomRate=1,i.parallaxX=1,i.angle=0,t.set_float(i.canvasToLayer(this.touches[a].x,this.touches[a].y,!0)),i.scale=o,i.zoomRate=s,i.parallaxX=n,i.angle=r):(i=cr.is_number(e)?this.runtime.getLayerByNumber(e):this.runtime.getLayerByName(e))?t.set_float(i.canvasToLayer(this.touches[a].x,this.touches[a].y,!0)):t.set_float(0)},x.prototype.XAt=function(t,e,i){var o,s,n,r,a;(e=Math.floor(e))<0||e>=this.touches.length?t.set_float(0):cr.is_undefined(i)?(s=(o=this.runtime.getLayerByNumber(0)).scale,n=o.zoomRate,r=o.parallaxX,a=o.angle,o.scale=1,o.zoomRate=1,o.parallaxX=1,o.angle=0,t.set_float(o.canvasToLayer(this.touches[e].x,this.touches[e].y,!0)),o.scale=s,o.zoomRate=n,o.parallaxX=r,o.angle=a):(o=cr.is_number(i)?this.runtime.getLayerByNumber(i):this.runtime.getLayerByName(i))?t.set_float(o.canvasToLayer(this.touches[e].x,this.touches[e].y,!0)):t.set_float(0)},x.prototype.XForID=function(t,e,i){var o=this.findTouch(e);if(o<0)t.set_float(0);else{var s,n,r,a,h,c=this.touches[o];cr.is_undefined(i)?(n=(s=this.runtime.getLayerByNumber(0)).scale,r=s.zoomRate,a=s.parallaxX,h=s.angle,s.scale=1,s.zoomRate=1,s.parallaxX=1,s.angle=0,t.set_float(s.canvasToLayer(c.x,c.y,!0)),s.scale=n,s.zoomRate=r,s.parallaxX=a,s.angle=h):(s=cr.is_number(i)?this.runtime.getLayerByNumber(i):this.runtime.getLayerByName(i))?t.set_float(s.canvasToLayer(c.x,c.y,!0)):t.set_float(0)}},x.prototype.Y=function(t,e){var i,o,s,n,r,a=this.getTouchIndex;a<0||a>=this.touches.length?t.set_float(0):cr.is_undefined(e)?(o=(i=this.runtime.getLayerByNumber(0)).scale,s=i.zoomRate,n=i.parallaxY,r=i.angle,i.scale=1,i.zoomRate=1,i.parallaxY=1,i.angle=0,t.set_float(i.canvasToLayer(this.touches[a].x,this.touches[a].y,!1)),i.scale=o,i.zoomRate=s,i.parallaxY=n,i.angle=r):(i=cr.is_number(e)?this.runtime.getLayerByNumber(e):this.runtime.getLayerByName(e))?t.set_float(i.canvasToLayer(this.touches[a].x,this.touches[a].y,!1)):t.set_float(0)},x.prototype.YAt=function(t,e,i){var o,s,n,r,a;(e=Math.floor(e))<0||e>=this.touches.length?t.set_float(0):cr.is_undefined(i)?(s=(o=this.runtime.getLayerByNumber(0)).scale,n=o.zoomRate,r=o.parallaxY,a=o.angle,o.scale=1,o.zoomRate=1,o.parallaxY=1,o.angle=0,t.set_float(o.canvasToLayer(this.touches[e].x,this.touches[e].y,!1)),o.scale=s,o.zoomRate=n,o.parallaxY=r,o.angle=a):(o=cr.is_number(i)?this.runtime.getLayerByNumber(i):this.runtime.getLayerByName(i))?t.set_float(o.canvasToLayer(this.touches[e].x,this.touches[e].y,!1)):t.set_float(0)},x.prototype.YForID=function(t,e,i){var o=this.findTouch(e);if(o<0)t.set_float(0);else{var s,n,r,a,h,c=this.touches[o];cr.is_undefined(i)?(n=(s=this.runtime.getLayerByNumber(0)).scale,r=s.zoomRate,a=s.parallaxY,h=s.angle,s.scale=1,s.zoomRate=1,s.parallaxY=1,s.angle=0,t.set_float(s.canvasToLayer(c.x,c.y,!1)),s.scale=n,s.zoomRate=r,s.parallaxY=a,s.angle=h):(s=cr.is_number(i)?this.runtime.getLayerByNumber(i):this.runtime.getLayerByName(i))?t.set_float(s.canvasToLayer(c.x,c.y,!1)):t.set_float(0)}},x.prototype.AbsoluteX=function(t){this.touches.length?t.set_float(this.touches[0].x):t.set_float(0)},x.prototype.AbsoluteXAt=function(t,e){(e=Math.floor(e))<0||e>=this.touches.length?t.set_float(0):t.set_float(this.touches[e].x)},x.prototype.AbsoluteXForID=function(t,e){var i=this.findTouch(e);if(i<0)t.set_float(0);else{var o=this.touches[i];t.set_float(o.x)}},x.prototype.AbsoluteY=function(t){this.touches.length?t.set_float(this.touches[0].y):t.set_float(0)},x.prototype.AbsoluteYAt=function(t,e){(e=Math.floor(e))<0||e>=this.touches.length?t.set_float(0):t.set_float(this.touches[e].y)},x.prototype.AbsoluteYForID=function(t,e){var i=this.findTouch(e);if(i<0)t.set_float(0);else{var o=this.touches[i];t.set_float(o.y)}},x.prototype.SpeedAt=function(t,e){if((e=Math.floor(e))<0||e>=this.touches.length)t.set_float(0);else{var i=this.touches[e],o=cr.distanceTo(i.x,i.y,i.lastx,i.lasty),s=(i.time-i.lasttime)/1e3;s<=0?t.set_float(0):t.set_float(o/s)}},x.prototype.SpeedForID=function(t,e){var i=this.findTouch(e);if(i<0)t.set_float(0);else{var o=this.touches[i],s=cr.distanceTo(o.x,o.y,o.lastx,o.lasty),n=(o.time-o.lasttime)/1e3;n<=0?t.set_float(0):t.set_float(s/n)}},x.prototype.AngleAt=function(t,e){if((e=Math.floor(e))<0||e>=this.touches.length)t.set_float(0);else{var i=this.touches[e];t.set_float(cr.to_degrees(cr.angleTo(i.lastx,i.lasty,i.x,i.y)))}},x.prototype.AngleForID=function(t,e){var i=this.findTouch(e);if(i<0)t.set_float(0);else{var o=this.touches[i];t.set_float(cr.to_degrees(cr.angleTo(o.lastx,o.lasty,o.x,o.y)))}},x.prototype.Alpha=function(t){t.set_float(this.getAlpha())},x.prototype.Beta=function(t){t.set_float(this.getBeta())},x.prototype.Gamma=function(t){t.set_float(this.getGamma())},x.prototype.AccelerationXWithG=function(t){t.set_float(this.acc_g_x)},x.prototype.AccelerationYWithG=function(t){t.set_float(this.acc_g_y)},x.prototype.AccelerationZWithG=function(t){t.set_float(this.acc_g_z)},x.prototype.AccelerationX=function(t){t.set_float(this.acc_x)},x.prototype.AccelerationY=function(t){t.set_float(this.acc_y)},x.prototype.AccelerationZ=function(t){t.set_float(this.acc_z)},x.prototype.TouchIndex=function(t){t.set_int(this.trigger_index)},x.prototype.TouchID=function(t){t.set_float(this.trigger_id)},x.prototype.WidthForID=function(t,e){var i=this.findTouch(e);if(i<0)t.set_float(0);else{var o=this.touches[i];t.set_float(o.width)}},x.prototype.HeightForID=function(t,e){var i=this.findTouch(e);if(i<0)t.set_float(0);else{var o=this.touches[i];t.set_float(o.height)}},x.prototype.PressureForID=function(t,e){var i=this.findTouch(e);if(i<0)t.set_float(0);else{var o=this.touches[i];t.set_float(o.pressure)}},t.exps=new x}(),cr.plugins_.WebStorage=function(t){this.runtime=t},function(){var t=cr.plugins_.WebStorage.prototype;t.Type=function(t){this.plugin=t,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t){this.type=t,this.runtime=t.runtime};var e=t.Instance.prototype,i="",o=void 0!==window.is_scirra_arcade;o&&(i="arcade"+window.scirra_arcade_id);var s=!1;try{localStorage.getItem("test"),s=!0}catch(t){s=!1}function n(){}function r(){}function a(){}e.onCreate=function(){s||cr.logexport("[Construct 2] Webstorage plugin: local storage is not supported on this platform.")},n.prototype.LocalStorageEnabled=function(){return s},n.prototype.SessionStorageEnabled=function(){return s},n.prototype.LocalStorageExists=function(t){return!!s&&null!=localStorage.getItem(i+t)},n.prototype.SessionStorageExists=function(t){return!!s&&null!=sessionStorage.getItem(i+t)},n.prototype.OnQuotaExceeded=function(){return!0},n.prototype.CompareKeyText=function(t,e,o){if(!s)return!1;var n=localStorage.getItem(i+t)||"";return o?n==e:cr.equals_nocase(n,e)},n.prototype.CompareKeyNumber=function(t,e,o){if(!s)return!1;var n=localStorage.getItem(i+t)||"";return cr.do_cmp(parseFloat(n),e,o)},t.cnds=new n,r.prototype.StoreLocal=function(t,e){if(s)try{localStorage.setItem(i+t,e)}catch(t){this.runtime.trigger(cr.plugins_.WebStorage.prototype.cnds.OnQuotaExceeded,this)}},r.prototype.StoreSession=function(t,e){if(s)try{sessionStorage.setItem(i+t,e)}catch(t){this.runtime.trigger(cr.plugins_.WebStorage.prototype.cnds.OnQuotaExceeded,this)}},r.prototype.RemoveLocal=function(t){s&&localStorage.removeItem(i+t)},r.prototype.RemoveSession=function(t){s&&sessionStorage.removeItem(i+t)},r.prototype.ClearLocal=function(){s&&(o||localStorage.clear())},r.prototype.ClearSession=function(){s&&(o||sessionStorage.clear())},r.prototype.JSONLoad=function(t,e){if(s){var n;try{n=JSON.parse(t)}catch(t){return}if(n.c2dictionary){var r,a=n.data;for(r in 0!==e||o||localStorage.clear(),a)if(a.hasOwnProperty(r))try{localStorage.setItem(i+r,a[r])}catch(t){return void this.runtime.trigger(cr.plugins_.WebStorage.prototype.cnds.OnQuotaExceeded,this)}}}},t.acts=new r,a.prototype.LocalValue=function(t,e){s?t.set_string(localStorage.getItem(i+e)||""):t.set_string("")},a.prototype.SessionValue=function(t,e){s?t.set_string(sessionStorage.getItem(i+e)||""):t.set_string("")},a.prototype.LocalCount=function(t){s?t.set_int(o?0:localStorage.length):t.set_int(0)},a.prototype.SessionCount=function(t){s?t.set_int(o?0:sessionStorage.length):t.set_int(0)},a.prototype.LocalAt=function(t,e){o||!s?t.set_string(""):t.set_string(localStorage.getItem(localStorage.key(e))||"")},a.prototype.SessionAt=function(t,e){o||!s?t.set_string(""):t.set_string(sessionStorage.getItem(sessionStorage.key(e))||"")},a.prototype.LocalKeyAt=function(t,e){o||!s?t.set_string(""):t.set_string(localStorage.key(e)||"")},a.prototype.SessionKeyAt=function(t,e){o||!s?t.set_string(""):t.set_string(sessionStorage.key(e)||"")},a.prototype.AsJSON=function(t){if(s){var e,n,r,a={};for(e=0,n=localStorage.length;e<n;e++)r=localStorage.key(e),o?r.substr(0,i.length)===i&&(a[r.substr(i.length)]=localStorage.getItem(r)):a[r]=localStorage.getItem(r);t.set_string(JSON.stringify({c2dictionary:!0,data:a}))}else t.set_string("")},t.exps=new a}(),cr.plugins_.sirg_kiz=function(t){this.runtime=t},function(){var t=cr.plugins_.sirg_kiz.prototype;function e(){}t.Type=function(t){this.plugin=t,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t){this.type=t,this.runtime=t.runtime},t.Instance.prototype.onCreate=function(){},t.cnds=new function(){},e.prototype.SubmitScore=function(t,e){},e.prototype.UnlockAchievement=function(t,e){},t.acts=new e,t.exps=new function(){}}(),cr.behaviors.Bullet=function(t){this.runtime=t},function(){var t=cr.behaviors.Bullet.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var e=t.Instance.prototype;function i(){}function o(){}function s(){}e.onCreate=function(){var t=this.properties[0];this.acc=this.properties[1],this.g=this.properties[2],this.bounceOffSolid=0!==this.properties[3],this.setAngle=0!==this.properties[4],this.dx=Math.cos(this.inst.angle)*t,this.dy=Math.sin(this.inst.angle)*t,this.lastx=this.inst.x,this.lasty=this.inst.y,this.lastKnownAngle=this.inst.angle,this.travelled=0,this.enabled=0!==this.properties[5]},e.saveToJSON=function(){return{acc:this.acc,g:this.g,dx:this.dx,dy:this.dy,lx:this.lastx,ly:this.lasty,lka:this.lastKnownAngle,t:this.travelled,e:this.enabled}},e.loadFromJSON=function(t){this.acc=t.acc,this.g=t.g,this.dx=t.dx,this.dy=t.dy,this.lastx=t.lx,this.lasty=t.ly,this.lastKnownAngle=t.lka,this.travelled=t.t,this.enabled=t.e},e.tick=function(){if(this.enabled){var t,e,i,o,s=this.runtime.getDt(this.inst);this.inst.angle!==this.lastKnownAngle&&(this.setAngle&&(t=cr.distanceTo(0,0,this.dx,this.dy),this.dx=Math.cos(this.inst.angle)*t,this.dy=Math.sin(this.inst.angle)*t),this.lastKnownAngle=this.inst.angle),0!==this.acc&&(t=cr.distanceTo(0,0,this.dx,this.dy),e=0===this.dx&&0===this.dy?this.inst.angle:cr.angleTo(0,0,this.dx,this.dy),(t+=this.acc*s)<0&&(t=0),this.dx=Math.cos(e)*t,this.dy=Math.sin(e)*t),0!==this.g&&(this.dy+=this.g*s),this.lastx=this.inst.x,this.lasty=this.inst.y,0===this.dx&&0===this.dy||(this.inst.x+=this.dx*s,this.inst.y+=this.dy*s,this.travelled+=cr.distanceTo(0,0,this.dx*s,this.dy*s),this.setAngle&&(this.inst.angle=cr.angleTo(0,0,this.dx,this.dy),this.inst.set_bbox_changed(),this.lastKnownAngle=this.inst.angle),this.inst.set_bbox_changed(),this.bounceOffSolid&&(i=this.runtime.testOverlapSolid(this.inst))&&(this.runtime.registerCollision(this.inst,i),t=cr.distanceTo(0,0,this.dx,this.dy),o=this.runtime.calculateSolidBounceAngle(this.inst,this.lastx,this.lasty),this.dx=Math.cos(o)*t,this.dy=Math.sin(o)*t,this.inst.x+=this.dx*s,this.inst.y+=this.dy*s,this.inst.set_bbox_changed(),this.setAngle&&(this.inst.angle=o,this.lastKnownAngle=o,this.inst.set_bbox_changed()),this.runtime.pushOutSolid(this.inst,this.dx/t,this.dy/t,Math.max(2.5*t*s,30))||this.runtime.pushOutSolidNearest(this.inst,100)))}},i.prototype.CompareSpeed=function(t,e){return cr.do_cmp(cr.distanceTo(0,0,this.dx,this.dy),t,e)},i.prototype.CompareTravelled=function(t,e){return cr.do_cmp(this.travelled,t,e)},t.cnds=new i,o.prototype.SetSpeed=function(t){var e=cr.angleTo(0,0,this.dx,this.dy);this.dx=Math.cos(e)*t,this.dy=Math.sin(e)*t},o.prototype.SetAcceleration=function(t){this.acc=t},o.prototype.SetGravity=function(t){this.g=t},o.prototype.SetAngleOfMotion=function(t){t=cr.to_radians(t);var e=cr.distanceTo(0,0,this.dx,this.dy);this.dx=Math.cos(t)*e,this.dy=Math.sin(t)*e},o.prototype.Bounce=function(t){if(t){var e=t.getFirstPicked(this.inst);if(e){var i=this.runtime.getDt(this.inst),o=cr.distanceTo(0,0,this.dx,this.dy),s=this.runtime.calculateSolidBounceAngle(this.inst,this.lastx,this.lasty,e);this.dx=Math.cos(s)*o,this.dy=Math.sin(s)*o,this.inst.x+=this.dx*i,this.inst.y+=this.dy*i,this.inst.set_bbox_changed(),this.setAngle&&(this.inst.angle=s,this.lastKnownAngle=s,this.inst.set_bbox_changed()),0!==o&&(this.bounceOffSolid?this.runtime.pushOutSolid(this.inst,this.dx/o,this.dy/o,Math.max(2.5*o*i,30))||this.runtime.pushOutSolidNearest(this.inst,100):this.runtime.pushOut(this.inst,this.dx/o,this.dy/o,Math.max(2.5*o*i,30),e))}}},o.prototype.SetDistanceTravelled=function(t){this.travelled=t},o.prototype.SetEnabled=function(t){this.enabled=1===t},t.acts=new o,s.prototype.Speed=function(t){var e=cr.distanceTo(0,0,this.dx,this.dy);e=cr.round6dp(e),t.set_float(e)},s.prototype.Acceleration=function(t){t.set_float(this.acc)},s.prototype.AngleOfMotion=function(t){t.set_float(cr.to_degrees(cr.angleTo(0,0,this.dx,this.dy)))},s.prototype.DistanceTravelled=function(t){t.set_float(this.travelled)},s.prototype.Gravity=function(t){t.set_float(this.g)},t.exps=new s}(),cr.behaviors.Fade=function(t){this.runtime=t},function(){var t=cr.behaviors.Fade.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var e=t.Instance.prototype;function i(){}function o(){}function s(){}e.onCreate=function(){this.activeAtStart=1===this.properties[0],this.setMaxOpacity=!1,this.fadeInTime=this.properties[1],this.waitTime=this.properties[2],this.fadeOutTime=this.properties[3],this.destroy=this.properties[4],this.stage=this.activeAtStart?0:3,this.recycled?this.stageTime.reset():this.stageTime=new cr.KahanAdder,this.maxOpacity=this.inst.opacity?this.inst.opacity:1,this.activeAtStart&&(0===this.fadeInTime?(this.stage=1,0===this.waitTime&&(this.stage=2)):(this.inst.opacity=0,this.runtime.redraw=!0))},e.saveToJSON=function(){return{fit:this.fadeInTime,wt:this.waitTime,fot:this.fadeOutTime,s:this.stage,st:this.stageTime.sum,mo:this.maxOpacity}},e.loadFromJSON=function(t){this.fadeInTime=t.fit,this.waitTime=t.wt,this.fadeOutTime=t.fot,this.stage=t.s,this.stageTime.reset(),this.stageTime.sum=t.st,this.maxOpacity=t.mo},e.tick=function(){this.stageTime.add(this.runtime.getDt(this.inst)),0===this.stage&&(this.inst.opacity=this.stageTime.sum/this.fadeInTime*this.maxOpacity,this.runtime.redraw=!0,this.inst.opacity>=this.maxOpacity&&(this.inst.opacity=this.maxOpacity,this.stage=1,this.stageTime.reset(),this.runtime.trigger(cr.behaviors.Fade.prototype.cnds.OnFadeInEnd,this.inst))),1===this.stage&&this.stageTime.sum>=this.waitTime&&(this.stage=2,this.stageTime.reset(),this.runtime.trigger(cr.behaviors.Fade.prototype.cnds.OnWaitEnd,this.inst)),2===this.stage&&0!==this.fadeOutTime&&(this.inst.opacity=this.maxOpacity-this.stageTime.sum/this.fadeOutTime*this.maxOpacity,this.runtime.redraw=!0,this.inst.opacity<0&&(this.inst.opacity=0,this.stage=3,this.stageTime.reset(),this.runtime.trigger(cr.behaviors.Fade.prototype.cnds.OnFadeOutEnd,this.inst),1===this.destroy&&this.runtime.DestroyInstance(this.inst)))},e.doStart=function(){this.stage=0,this.stageTime.reset(),0===this.fadeInTime?(this.stage=1,0===this.waitTime&&(this.stage=2)):(this.inst.opacity=0,this.runtime.redraw=!0)},i.prototype.OnFadeOutEnd=function(){return!0},i.prototype.OnFadeInEnd=function(){return!0},i.prototype.OnWaitEnd=function(){return!0},t.cnds=new i,o.prototype.StartFade=function(){this.activeAtStart||this.setMaxOpacity||(this.maxOpacity=this.inst.opacity?this.inst.opacity:1,this.setMaxOpacity=!0),3===this.stage&&this.doStart()},o.prototype.RestartFade=function(){this.doStart()},o.prototype.SetFadeInTime=function(t){t<0&&(t=0),this.fadeInTime=t},o.prototype.SetWaitTime=function(t){t<0&&(t=0),this.waitTime=t},o.prototype.SetFadeOutTime=function(t){t<0&&(t=0),this.fadeOutTime=t},t.acts=new o,s.prototype.FadeInTime=function(t){t.set_float(this.fadeInTime)},s.prototype.WaitTime=function(t){t.set_float(this.waitTime)},s.prototype.FadeOutTime=function(t){t.set_float(this.fadeOutTime)},t.exps=new s}(),cr.behaviors.Flash=function(t){this.runtime=t},function(){var t=cr.behaviors.Flash.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var e=t.Instance.prototype;function i(){}function o(){}e.onCreate=function(){this.ontime=0,this.offtime=0,this.stage=0,this.stagetimeleft=0,this.timeleft=0},e.saveToJSON=function(){return{ontime:this.ontime,offtime:this.offtime,stage:this.stage,stagetimeleft:this.stagetimeleft,timeleft:this.timeleft}},e.loadFromJSON=function(t){this.ontime=t.ontime,this.offtime=t.offtime,this.stage=t.stage,this.stagetimeleft=t.stagetimeleft,this.timeleft=t.timeleft,null===this.timeleft&&(this.timeleft=1/0)},e.tick=function(){if(!(this.timeleft<=0)){var t=this.runtime.getDt(this.inst);if(this.timeleft-=t,this.timeleft<=0)return this.timeleft=0,this.inst.visible=!0,this.runtime.redraw=!0,void this.runtime.trigger(cr.behaviors.Flash.prototype.cnds.OnFlashEnded,this.inst);this.stagetimeleft-=t,this.stagetimeleft<=0&&(0===this.stage?(this.inst.visible=!1,this.stage=1,this.stagetimeleft+=this.offtime):(this.inst.visible=!0,this.stage=0,this.stagetimeleft+=this.ontime),this.runtime.redraw=!0)}},i.prototype.IsFlashing=function(){return this.timeleft>0},i.prototype.OnFlashEnded=function(){return!0},t.cnds=new i,o.prototype.Flash=function(t,e,i){this.ontime=t,this.offtime=e,this.stage=1,this.stagetimeleft=e,this.timeleft=i,this.inst.visible=!1,this.runtime.redraw=!0},o.prototype.StopFlashing=function(){this.timeleft=0,this.inst.visible=!0,this.runtime.redraw=!0},t.acts=new o,t.exps=new function(){}}();var Box2D={};function c2inherit(t,e){for(var i in e.prototype)e.prototype.hasOwnProperty(i)&&(t.prototype[i]=e.prototype[i])}Box2D.Dynamics={},Box2D.Dynamics.Joints={},Box2D.Common={},Box2D.Common.Math={},Box2D.Collision={},Box2D.Collision.Shapes={},Box2D.Collision.b2Collision={},Box2D.Collision.b2Distance={},Box2D.Common.b2Settings={},Box2D.Common.Math.b2Math={},Box2D.Consts={},Box2D.Dynamics.Contacts={},Box2D.Dynamics.Controllers={},Box2D.generateCallback=function(t,e){return function(){e.apply(t,arguments)}},Box2D.Consts.MIN_VALUE_SQUARED=Number.MIN_VALUE*Number.MIN_VALUE,Box2D.Common.b2Settings.b2MixFriction=function(t,e){return Math.sqrt(t*e)},Box2D.Common.b2Settings.b2MixRestitution=function(t,e){return t>e?t:e},Box2D.Common.b2Settings.VERSION="2.1alpha-illandril",Box2D.Common.b2Settings.USHRT_MAX=65535,Box2D.Common.b2Settings.b2_maxManifoldPoints=2,Box2D.Common.b2Settings.b2_aabbExtension=.1,Box2D.Common.b2Settings.b2_aabbMultiplier=2,Box2D.Common.b2Settings.b2_polygonRadius=2*Box2D.Common.b2Settings.b2_linearSlop,Box2D.Common.b2Settings.b2_linearSlop=.005,Box2D.Common.b2Settings.b2_angularSlop=2/180*Math.PI,Box2D.Common.b2Settings.b2_toiSlop=8*Box2D.Common.b2Settings.b2_linearSlop,Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32,Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32,Box2D.Common.b2Settings.b2_velocityThreshold=1,Box2D.Common.b2Settings.b2_maxLinearCorrection=.2,Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*Math.PI,Box2D.Common.b2Settings.b2_maxTranslation=2,Box2D.Common.b2Settings.b2_maxTranslationSquared=Box2D.Common.b2Settings.b2_maxTranslation*Box2D.Common.b2Settings.b2_maxTranslation,Box2D.Common.b2Settings.b2_maxRotation=.5*Math.PI,Box2D.Common.b2Settings.b2_maxRotationSquared=Box2D.Common.b2Settings.b2_maxRotation*Box2D.Common.b2Settings.b2_maxRotation,Box2D.Common.b2Settings.b2_contactBaumgarte=.2,Box2D.Common.b2Settings.b2_timeToSleep=.5,Box2D.Common.b2Settings.b2_linearSleepTolerance=.01,Box2D.Common.b2Settings.b2_linearSleepToleranceSquared=Box2D.Common.b2Settings.b2_linearSleepTolerance*Box2D.Common.b2Settings.b2_linearSleepTolerance,Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*Math.PI,Box2D.Common.b2Settings.b2_angularSleepToleranceSquared=Box2D.Common.b2Settings.b2_angularSleepTolerance*Box2D.Common.b2Settings.b2_angularSleepTolerance,Box2D.Common.b2Settings.MIN_VALUE_SQUARED=Number.MIN_VALUE*Number.MIN_VALUE,Box2D.Common.Math.b2Math.Dot=function(t,e){return t.x*e.x+t.y*e.y},Box2D.Common.Math.b2Math.CrossVV=function(t,e){return t.x*e.y-t.y*e.x},Box2D.Common.Math.b2Math.CrossVF=function(t,e){return Box2D.Common.Math.b2Vec2.Get(e*t.y,-e*t.x)},Box2D.Common.Math.b2Math.CrossFV=function(t,e){return Box2D.Common.Math.b2Vec2.Get(-t*e.y,t*e.x)},Box2D.Common.Math.b2Math.MulMV=function(t,e){return Box2D.Common.Math.b2Vec2.Get(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y)},Box2D.Common.Math.b2Math.MulTMV=function(t,e){return Box2D.Common.Math.b2Vec2.Get(Box2D.Common.Math.b2Math.Dot(e,t.col1),Box2D.Common.Math.b2Math.Dot(e,t.col2))},Box2D.Common.Math.b2Math.MulX=function(t,e){var i=Box2D.Common.Math.b2Math.MulMV(t.R,e);return i.x+=t.position.x,i.y+=t.position.y,i},Box2D.Common.Math.b2Math.MulXT=function(t,e){var i=Box2D.Common.Math.b2Math.SubtractVV(e,t.position),o=i.x*t.R.col1.x+i.y*t.R.col1.y;return i.y=i.x*t.R.col2.x+i.y*t.R.col2.y,i.x=o,i},Box2D.Common.Math.b2Math.AddVV=function(t,e){return Box2D.Common.Math.b2Vec2.Get(t.x+e.x,t.y+e.y)},Box2D.Common.Math.b2Math.SubtractVV=function(t,e){return Box2D.Common.Math.b2Vec2.Get(t.x-e.x,t.y-e.y)},Box2D.Common.Math.b2Math.Distance=function(t,e){t.x,e.x,t.y,e.y;return Math.sqrt(Box2D.Common.Math.b2Math.DistanceSquared(t,e))},Box2D.Common.Math.b2Math.DistanceSquared=function(t,e){var i=t.x-e.x,o=t.y-e.y;return i*i+o*o},Box2D.Common.Math.b2Math.MulFV=function(t,e){return Box2D.Common.Math.b2Vec2.Get(t*e.x,t*e.y)},Box2D.Common.Math.b2Math.AddMM=function(t,e){return Box2D.Common.Math.b2Mat22.FromVV(Box2D.Common.Math.b2Math.AddVV(t.col1,e.col1),Box2D.Common.Math.b2Math.AddVV(t.col2,e.col2))},Box2D.Common.Math.b2Math.MulMM=function(t,e){return Box2D.Common.Math.b2Mat22.FromVV(Box2D.Common.Math.b2Math.MulMV(t,e.col1),Box2D.Common.Math.b2Math.MulMV(t,e.col2))},Box2D.Common.Math.b2Math.MulTMM=function(t,e){var i=Box2D.Common.Math.b2Vec2.Get(Box2D.Common.Math.b2Math.Dot(t.col1,e.col1),Box2D.Common.Math.b2Math.Dot(t.col2,e.col1)),o=Box2D.Common.Math.b2Vec2.Get(Box2D.Common.Math.b2Math.Dot(t.col1,e.col2),Box2D.Common.Math.b2Math.Dot(t.col2,e.col2));return Box2D.Common.Math.b2Mat22.FromVV(i,o)},Box2D.Common.Math.b2Math.AbsV=function(t){return Box2D.Common.Math.b2Vec2.Get(Math.abs(t.x),Math.abs(t.y))},Box2D.Common.Math.b2Math.AbsM=function(t){return Box2D.Common.Math.b2Mat22.FromVV(Box2D.Common.Math.b2Math.AbsV(t.col1),Box2D.Common.Math.b2Math.AbsV(t.col2))},Box2D.Common.Math.b2Math.Clamp=function(t,e,i){return t<e?e:t>i?i:t},Box2D.Common.Math.b2Math.ClampV=function(t,e,i){var o=Box2D.Common.Math.b2Math.Clamp(t.x,e.x,i.x),s=Box2D.Common.Math.b2Math.Clamp(t.y,e.y,i.y);return Box2D.Common.Math.b2Vec2.Get(o,s)},Box2D.Common.Math.b2Mat22=function(){this.col1=Box2D.Common.Math.b2Vec2.Get(0,0),this.col2=Box2D.Common.Math.b2Vec2.Get(0,0),this.SetIdentity()},Box2D.Common.Math.b2Mat22.FromAngle=function(t){var e=new Box2D.Common.Math.b2Mat22;return e.Set(t),e},Box2D.Common.Math.b2Mat22.FromVV=function(t,e){var i=new Box2D.Common.Math.b2Mat22;return i.SetVV(t,e),i},Box2D.Common.Math.b2Mat22.prototype.Set=function(t){var e=Math.cos(t),i=Math.sin(t);this.col1.Set(e,i),this.col2.Set(-i,e)},Box2D.Common.Math.b2Mat22.prototype.SetVV=function(t,e){this.col1.SetV(t),this.col2.SetV(e)},Box2D.Common.Math.b2Mat22.prototype.Copy=function(){var t=new Box2D.Common.Math.b2Mat22;return t.SetM(this),t},Box2D.Common.Math.b2Mat22.prototype.SetM=function(t){this.col1.SetV(t.col1),this.col2.SetV(t.col2)},Box2D.Common.Math.b2Mat22.prototype.AddM=function(t){this.col1.Add(t.col1),this.col2.Add(t.col2)},Box2D.Common.Math.b2Mat22.prototype.SetIdentity=function(){this.col1.Set(1,0),this.col2.Set(0,1)},Box2D.Common.Math.b2Mat22.prototype.SetZero=function(){this.col1.Set(0,0),this.col2.Set(0,0)},Box2D.Common.Math.b2Mat22.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},Box2D.Common.Math.b2Mat22.prototype.GetInverse=function(t){var e=this.col1.x*this.col2.y-this.col2.x*this.col1.y;return 0!==e&&(e=1/e),t.col1.x=e*this.col2.y,t.col2.x=-e*this.col2.x,t.col1.y=-e*this.col1.y,t.col2.y=e*this.col1.x,t},Box2D.Common.Math.b2Mat22.prototype.Solve=function(t,e,i){var o=this.col1.x*this.col2.y-this.col2.x*this.col1.y;return 0!==o&&(o=1/o),t.x=o*(this.col2.y*e-this.col2.x*i),t.y=o*(this.col1.x*i-this.col1.y*e),t},Box2D.Common.Math.b2Mat22.prototype.Abs=function(){this.col1.Abs(),this.col2.Abs()},Box2D.Common.Math.b2Mat33=function(t,e,i){this.col1=new Box2D.Common.Math.b2Vec3(0,0,0),this.col2=new Box2D.Common.Math.b2Vec3(0,0,0),this.col3=new Box2D.Common.Math.b2Vec3(0,0,0),t&&this.col1.SetV(t),e&&this.col2.SetV(e),i&&this.col3.SetV(i)},Box2D.Common.Math.b2Mat33.prototype.SetVVV=function(t,e,i){this.col1.SetV(t),this.col2.SetV(e),this.col3.SetV(i)},Box2D.Common.Math.b2Mat33.prototype.Copy=function(){return new Box2D.Common.Math.b2Mat33(this.col1,this.col2,this.col3)},Box2D.Common.Math.b2Mat33.prototype.SetM=function(t){this.col1.SetV(t.col1),this.col2.SetV(t.col2),this.col3.SetV(t.col3)},Box2D.Common.Math.b2Mat33.prototype.AddM=function(t){this.col1.x+=t.col1.x,this.col1.y+=t.col1.y,this.col1.z+=t.col1.z,this.col2.x+=t.col2.x,this.col2.y+=t.col2.y,this.col2.z+=t.col2.z,this.col3.x+=t.col3.x,this.col3.y+=t.col3.y,this.col3.z+=t.col3.z},Box2D.Common.Math.b2Mat33.prototype.SetIdentity=function(){this.col1.Set(1,0,0),this.col2.Set(0,1,0),this.col3.Set(0,0,1)},Box2D.Common.Math.b2Mat33.prototype.SetZero=function(){this.col1.Set(0,0,0),this.col2.Set(0,0,0),this.col3.Set(0,0,0)},Box2D.Common.Math.b2Mat33.prototype.Solve22=function(t,e,i){var o=this.col1.x,s=this.col2.x,n=this.col1.y,r=this.col2.y,a=o*r-s*n;return 0!=a&&(a=1/a),t.x=a*(r*e-s*i),t.y=a*(o*i-n*e),t},Box2D.Common.Math.b2Mat33.prototype.Solve33=function(t,e,i,o){var s=this.col1.x,n=this.col1.y,r=this.col1.z,a=this.col2.x,h=this.col2.y,c=this.col2.z,l=this.col3.x,m=this.col3.y,u=this.col3.z,p=s*(h*u-c*m)+n*(c*l-a*u)+r*(a*m-h*l);return 0!=p&&(p=1/p),t.x=p*(e*(h*u-c*m)+i*(c*l-a*u)+o*(a*m-h*l)),t.y=p*(s*(i*u-o*m)+n*(o*l-e*u)+r*(e*m-i*l)),t.z=p*(s*(h*o-c*i)+n*(c*e-a*o)+r*(a*i-h*e)),t},Box2D.Common.Math.b2Sweep=function(){this.localCenter=Box2D.Common.Math.b2Vec2.Get(0,0),this.c0=Box2D.Common.Math.b2Vec2.Get(0,0),this.c=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Common.Math.b2Sweep.prototype.Set=function(t){this.localCenter.SetV(t.localCenter),this.c0.SetV(t.c0),this.c.SetV(t.c),this.a0=t.a0,this.a=t.a,this.t0=t.t0},Box2D.Common.Math.b2Sweep.prototype.Copy=function(){var t=new Box2D.Common.Math.b2Sweep;return t.localCenter.SetV(this.localCenter),t.c0.SetV(this.c0),t.c.SetV(this.c),t.a0=this.a0,t.a=this.a,t.t0=this.t0,t},Box2D.Common.Math.b2Sweep.prototype.GetTransform=function(t,e){void 0===e&&(e=0),t.position.x=(1-e)*this.c0.x+e*this.c.x,t.position.y=(1-e)*this.c0.y+e*this.c.y;var i=(1-e)*this.a0+e*this.a;t.R.Set(i);var o=t.R;t.position.x-=o.col1.x*this.localCenter.x+o.col2.x*this.localCenter.y,t.position.y-=o.col1.y*this.localCenter.x+o.col2.y*this.localCenter.y},Box2D.Common.Math.b2Sweep.prototype.Advance=function(t){if(void 0===t&&(t=0),this.t0<t&&1-this.t0>Number.MIN_VALUE){var e=(t-this.t0)/(1-this.t0);this.c0.x=(1-e)*this.c0.x+e*this.c.x,this.c0.y=(1-e)*this.c0.y+e*this.c.y,this.a0=(1-e)*this.a0+e*this.a,this.t0=t}},Box2D.Common.Math.b2Transform=function(t,e){this.position=Box2D.Common.Math.b2Vec2.Get(0,0),this.R=new Box2D.Common.Math.b2Mat22,t&&this.position.SetV(t),e&&this.R.SetM(e)},Box2D.Common.Math.b2Transform.prototype.Initialize=function(t,e){this.position.SetV(t),this.R.SetM(e)},Box2D.Common.Math.b2Transform.prototype.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},Box2D.Common.Math.b2Transform.prototype.Set=function(t){this.position.SetV(t.position),this.R.SetM(t.R)},Box2D.Common.Math.b2Transform.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)},Box2D.Common.Math.b2Vec2=function(t,e){this.x=t,this.y=e},Box2D.Common.Math.b2Vec2._freeCache=[],Box2D.Common.Math.b2Vec2.Get=function(t,e){if(Box2D.Common.Math.b2Vec2._freeCache.length>0){var i=Box2D.Common.Math.b2Vec2._freeCache.pop();return i.Set(t,e),i}return new Box2D.Common.Math.b2Vec2(t,e)},Box2D.Common.Math.b2Vec2.Free=function(t){Box2D.Common.Math.b2Vec2._freeCache.push(t)},Box2D.Common.Math.b2Vec2.prototype.SetZero=function(){this.x=0,this.y=0},Box2D.Common.Math.b2Vec2.prototype.Set=function(t,e){this.x=t,this.y=e},Box2D.Common.Math.b2Vec2.prototype.SetV=function(t){this.x=t.x,this.y=t.y},Box2D.Common.Math.b2Vec2.prototype.GetNegative=function(){return Box2D.Common.Math.b2Vec2.Get(-this.x,-this.y)},Box2D.Common.Math.b2Vec2.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y},Box2D.Common.Math.b2Vec2.prototype.Copy=function(){return Box2D.Common.Math.b2Vec2.Get(this.x,this.y)},Box2D.Common.Math.b2Vec2.prototype.Add=function(t){this.x+=t.x,this.y+=t.y},Box2D.Common.Math.b2Vec2.prototype.Subtract=function(t){this.x-=t.x,this.y-=t.y},Box2D.Common.Math.b2Vec2.prototype.Multiply=function(t){this.x*=t,this.y*=t},Box2D.Common.Math.b2Vec2.prototype.MulM=function(t){var e=this.x;this.x=t.col1.x*e+t.col2.x*this.y,this.y=t.col1.y*e+t.col2.y*this.y},Box2D.Common.Math.b2Vec2.prototype.MulTM=function(t){var e=this.x*t.col1.x+this.y*t.col1.y;this.y=this.x*t.col2.x+this.y*t.col2.y,this.x=e},Box2D.Common.Math.b2Vec2.prototype.CrossVF=function(t){var e=this.x;this.x=t*this.y,this.y=-t*e},Box2D.Common.Math.b2Vec2.prototype.CrossFV=function(t){var e=this.x;this.x=-t*this.y,this.y=t*e},Box2D.Common.Math.b2Vec2.prototype.MinV=function(t){this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y)},Box2D.Common.Math.b2Vec2.prototype.MaxV=function(t){this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y)},Box2D.Common.Math.b2Vec2.prototype.Abs=function(){this.x=Math.abs(this.x),this.y=Math.abs(this.y)},Box2D.Common.Math.b2Vec2.prototype.Length=function(){return Math.sqrt(this.LengthSquared())},Box2D.Common.Math.b2Vec2.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},Box2D.Common.Math.b2Vec2.prototype.Normalize=function(){var t=this.Length();if(t<Number.MIN_VALUE)return 0;var e=1/t;return this.x*=e,this.y*=e,t},Box2D.Common.Math.b2Vec2.prototype.IsValid=function(){return isFinite(this.x)&&isFinite(this.y)},Box2D.Common.Math.b2Vec3=function(t,e,i){this.x=t,this.y=e,this.z=i},Box2D.Common.Math.b2Vec3.prototype.SetZero=function(){this.x=0,this.y=0,this.z=0},Box2D.Common.Math.b2Vec3.prototype.Set=function(t,e,i){this.x=t,this.y=e,this.z=i},Box2D.Common.Math.b2Vec3.prototype.SetV=function(t){this.x=t.x,this.y=t.y,this.z=t.z},Box2D.Common.Math.b2Vec3.prototype.GetNegative=function(){return new Box2D.Common.Math.b2Vec3(-this.x,-this.y,-this.z)},Box2D.Common.Math.b2Vec3.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},Box2D.Common.Math.b2Vec3.prototype.Copy=function(){return new Box2D.Common.Math.b2Vec3(this.x,this.y,this.z)},Box2D.Common.Math.b2Vec3.prototype.Add=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},Box2D.Common.Math.b2Vec3.prototype.Subtract=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z},Box2D.Common.Math.b2Vec3.prototype.Multiply=function(t){this.x*=t,this.y*=t,this.z*=t},Box2D.Collision.Shapes.b2Shape=function(){this.m_radius=Box2D.Common.b2Settings.b2_linearSlop},Box2D.Collision.Shapes.b2Shape.prototype.GetTypeName=function(){},Box2D.Collision.Shapes.b2Shape.prototype.Copy=function(){},Box2D.Collision.Shapes.b2Shape.prototype.Set=function(t){this.m_radius=t.m_radius},Box2D.Collision.Shapes.b2Shape.prototype.TestPoint=function(){},Box2D.Collision.Shapes.b2Shape.prototype.RayCast=function(){},Box2D.Collision.Shapes.b2Shape.prototype.ComputeAABB=function(){},Box2D.Collision.Shapes.b2Shape.prototype.ComputeMass=function(){},Box2D.Collision.Shapes.b2Shape.prototype.ComputeSubmergedArea=function(){},Box2D.Collision.Shapes.b2Shape.prototype.SetDistanceProxy=function(){},Box2D.Collision.Shapes.b2Shape.TestOverlap=function(t,e,i,o){var s=new Box2D.Collision.b2DistanceInput;s.proxyA=new Box2D.Collision.b2DistanceProxy,s.proxyA.Set(t),s.proxyB=new Box2D.Collision.b2DistanceProxy,s.proxyB.Set(i),s.transformA=e,s.transformB=o,s.useRadii=!0;var n=new Box2D.Collision.b2SimplexCache;n.count=0;var r=new Box2D.Collision.b2DistanceOutput;return Box2D.Collision.b2Distance.Distance(r,n,s),r.distance<10*Number.MIN_VALUE},Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=-1,Box2D.Collision.Shapes.b2Shape.e_missCollide=0,Box2D.Collision.Shapes.b2Shape.e_hitCollide=1,Box2D.Collision.Shapes.b2CircleShape=function(t){Box2D.Collision.Shapes.b2Shape.call(this),this.m_radius=t,this.m_radiusSquared=t*t,this.m_p=Box2D.Common.Math.b2Vec2.Get(0,0)},c2inherit(Box2D.Collision.Shapes.b2CircleShape,Box2D.Collision.Shapes.b2Shape),Box2D.Collision.Shapes.b2CircleShape.prototype.GetTypeName=function(){return Box2D.Collision.Shapes.b2CircleShape.NAME},Box2D.Collision.Shapes.b2CircleShape.prototype.Copy=function(){var t=new Box2D.Collision.Shapes.b2CircleShape(this.m_radius);return t.Set(this),t},Box2D.Collision.Shapes.b2CircleShape.prototype.Set=function(t){Box2D.Collision.Shapes.b2Shape.prototype.Set.call(this,t),t instanceof Box2D.Collision.Shapes.b2CircleShape&&this.m_p.SetV(t.m_p)},Box2D.Collision.Shapes.b2CircleShape.prototype.TestPoint=function(t,e){t.R;var i=e.x-(t.position.x+(t.R.col1.x*this.m_p.x+t.R.col2.x*this.m_p.y)),o=e.y-(t.position.y+(t.R.col1.y*this.m_p.x+t.R.col2.y*this.m_p.y));return i*i+o*o<=this.m_radiusSquared},Box2D.Collision.Shapes.b2CircleShape.prototype.RayCast=function(t,e,i){var o=i.R,s=i.position.x+(o.col1.x*this.m_p.x+o.col2.x*this.m_p.y),n=i.position.y+(o.col1.y*this.m_p.x+o.col2.y*this.m_p.y),r=e.p1.x-s,a=e.p1.y-n,h=r*r+a*a-this.m_radiusSquared,c=e.p2.x-e.p1.x,l=e.p2.y-e.p1.y,m=r*c+a*l,u=c*c+l*l,p=m*m-u*h;if(p<0||u<Number.MIN_VALUE)return!1;var d=-(m+Math.sqrt(p));return 0<=d&&d<=e.maxFraction*u&&(d/=u,t.fraction=d,t.normal.x=r+d*c,t.normal.y=a+d*l,t.normal.Normalize(),!0)},Box2D.Collision.Shapes.b2CircleShape.prototype.ComputeAABB=function(t,e){var i=e.R,o=e.position.x+(i.col1.x*this.m_p.x+i.col2.x*this.m_p.y),s=e.position.y+(i.col1.y*this.m_p.x+i.col2.y*this.m_p.y);t.lowerBound_.Set(o-this.m_radius,s-this.m_radius),t.upperBound_.Set(o+this.m_radius,s+this.m_radius)},Box2D.Collision.Shapes.b2CircleShape.prototype.ComputeMass=function(t,e){t.mass=e*Math.PI*this.m_radiusSquared,t.center.SetV(this.m_p),t.I=t.mass*(.5*this.m_radiusSquared+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))},Box2D.Collision.Shapes.b2CircleShape.prototype.ComputeSubmergedArea=function(t,e,i,o){var s=Box2D.Common.Math.b2Math.MulX(i,this.m_p),n=-(Box2D.Common.Math.b2Math.Dot(t,s)-e);if(n<-this.m_radius+Number.MIN_VALUE)return 0;if(n>this.m_radius)return o.SetV(s),Math.PI*this.m_radiusSquared;var r=n*n,a=this.m_radiusSquared*(Math.asin(n/this.m_radius)+Math.PI/2)+n*Math.sqrt(this.m_radiusSquared-r),h=-2/3*Math.pow(this.m_radiusSquared-r,1.5)/a;return o.x=s.x+t.x*h,o.y=s.y+t.y*h,a},Box2D.Collision.Shapes.b2CircleShape.prototype.SetDistanceProxy=function(t){t.m_vertices=[this.m_p],t.m_count=1,t.m_radius=this.m_radius},Box2D.Collision.Shapes.b2CircleShape.prototype.GetLocalPosition=function(){return this.m_p},Box2D.Collision.Shapes.b2CircleShape.prototype.SetLocalPosition=function(t){this.m_p.SetV(t)},Box2D.Collision.Shapes.b2CircleShape.prototype.GetRadius=function(){return this.m_radius},Box2D.Collision.Shapes.b2CircleShape.prototype.SetRadius=function(t){this.m_radius=t,this.m_radiusSquared=t*t},Box2D.Collision.Shapes.b2CircleShape.NAME="b2CircleShape",Box2D.Collision.Shapes.b2EdgeChainDef=function(){this.vertexCount=0,this.isALoop=!0,this.vertices=[]},Box2D.Collision.Shapes.b2EdgeShape=function(t,e){Box2D.Collision.Shapes.b2Shape.call(this),this.m_prevEdge=null,this.m_nextEdge=null,this.m_v1=t,this.m_v2=e,this.m_direction=Box2D.Common.Math.b2Vec2.Get(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.Normalize(),this.m_normal=Box2D.Common.Math.b2Vec2.Get(this.m_direction.y,-this.m_direction.x),this.m_coreV1=Box2D.Common.Math.b2Vec2.Get(-Box2D.Common.b2Settings.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-Box2D.Common.b2Settings.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2=Box2D.Common.Math.b2Vec2.Get(-Box2D.Common.b2Settings.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-Box2D.Common.b2Settings.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2=Box2D.Common.Math.b2Vec2.Get(-this.m_normal.x,-this.m_normal.y),this.m_cornerConvex1=!1,this.m_cornerConvex2=!1},c2inherit(Box2D.Collision.Shapes.b2EdgeShape,Box2D.Collision.Shapes.b2Shape),Box2D.Collision.Shapes.b2EdgeShape.prototype.GetTypeName=function(){return Box2D.Collision.Shapes.b2EdgeShape.NAME},Box2D.Collision.Shapes.b2EdgeShape.prototype.TestPoint=function(t,e){return!1},Box2D.Collision.Shapes.b2EdgeShape.prototype.RayCast=function(t,e,i){var o=e.p2.x-e.p1.x,s=e.p2.y-e.p1.y,n=i.R,r=i.position.x+(n.col1.x*this.m_v1.x+n.col2.x*this.m_v1.y),a=i.position.y+(n.col1.y*this.m_v1.x+n.col2.y*this.m_v1.y),h=i.position.y+(n.col1.y*this.m_v2.x+n.col2.y*this.m_v2.y)-a,c=-(i.position.x+(n.col1.x*this.m_v2.x+n.col2.x*this.m_v2.y)-r),l=100*Number.MIN_VALUE,m=-(o*h+s*c);if(m>l){var u=e.p1.x-r,p=e.p1.y-a,d=u*h+p*c;if(0<=d&&d<=e.maxFraction*m){var y=-o*p+s*u;if(-l*m<=y&&y<=m*(1+l)){d/=m,t.fraction=d;var _=Math.sqrt(h*h+c*c);return t.normal.x=h/_,t.normal.y=c/_,!0}}}return!1},Box2D.Collision.Shapes.b2EdgeShape.prototype.ComputeAABB=function(t,e){var i=e.R,o=e.position.x+(i.col1.x*this.m_v1.x+i.col2.x*this.m_v1.y),s=e.position.y+(i.col1.y*this.m_v1.x+i.col2.y*this.m_v1.y),n=e.position.x+(i.col1.x*this.m_v2.x+i.col2.x*this.m_v2.y),r=e.position.y+(i.col1.y*this.m_v2.x+i.col2.y*this.m_v2.y);o<n?(t.lowerBound_.x=o,t.upperBound_.x=n):(t.lowerBound_.x=n,t.upperBound_.x=o),s<r?(t.lowerBound_.y=s,t.upperBound_.y=r):(t.lowerBound_.y=r,t.upperBound_.y=s)},Box2D.Collision.Shapes.b2EdgeShape.prototype.ComputeMass=function(t,e){t.mass=0,t.center.SetV(this.m_v1),t.I=0},Box2D.Collision.Shapes.b2EdgeShape.prototype.ComputeSubmergedArea=function(t,e,i,o){void 0===e&&(e=0);var s=Box2D.Common.Math.b2Vec2.Get(t.x*e,t.y*e),n=Box2D.Common.Math.b2Math.MulX(i,this.m_v1),r=Box2D.Common.Math.b2Math.MulX(i,this.m_v2),a=Box2D.Common.Math.b2Math.Dot(t,n)-e,h=Box2D.Common.Math.b2Math.Dot(t,r)-e;if(a>0){if(h>0)return 0;n.x=-h/(a-h)*n.x+a/(a-h)*r.x,n.y=-h/(a-h)*n.y+a/(a-h)*r.y}else h>0&&(r.x=-h/(a-h)*n.x+a/(a-h)*r.x,r.y=-h/(a-h)*n.y+a/(a-h)*r.y);return o.x=(s.x+n.x+r.x)/3,o.y=(s.y+n.y+r.y)/3,.5*((n.x-s.x)*(r.y-s.y)-(n.y-s.y)*(r.x-s.x))},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetLength=function(){return this.m_length},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetVertex1=function(){return this.m_v1},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetVertex2=function(){return this.m_v2},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetCoreVertex1=function(){return this.m_coreV1},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetCoreVertex2=function(){return this.m_coreV2},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetNormalVector=function(){return this.m_normal},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetDirectionVector=function(){return this.m_direction},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetCorner1Vector=function(){return this.m_cornerDir1},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetCorner2Vector=function(){return this.m_cornerDir2},Box2D.Collision.Shapes.b2EdgeShape.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1},Box2D.Collision.Shapes.b2EdgeShape.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetFirstVertex=function(t){var e=t.R;return Box2D.Common.Math.b2Vec2.Get(t.position.x+(e.col1.x*this.m_coreV1.x+e.col2.x*this.m_coreV1.y),t.position.y+(e.col1.y*this.m_coreV1.x+e.col2.y*this.m_coreV1.y))},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetNextEdge=function(){return this.m_nextEdge},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetPrevEdge=function(){return this.m_prevEdge},Box2D.Collision.Shapes.b2EdgeShape.prototype.Support=function(t,e,i){var o=t.R,s=t.position.x+(o.col1.x*this.m_coreV1.x+o.col2.x*this.m_coreV1.y),n=t.position.y+(o.col1.y*this.m_coreV1.x+o.col2.y*this.m_coreV1.y),r=t.position.x+(o.col1.x*this.m_coreV2.x+o.col2.x*this.m_coreV2.y),a=t.position.y+(o.col1.y*this.m_coreV2.x+o.col2.y*this.m_coreV2.y);return s*e+n*i>r*e+a*i?Box2D.Common.Math.b2Vec2.Get(s,n):Box2D.Common.Math.b2Vec2.Get(r,a)},Box2D.Collision.Shapes.b2EdgeShape.prototype.SetPrevEdge=function(t,e,i,o){this.m_prevEdge=t,this.m_coreV1=e,this.m_cornerDir1=i,this.m_cornerConvex1=o},Box2D.Collision.Shapes.b2EdgeShape.prototype.SetNextEdge=function(t,e,i,o){this.m_nextEdge=t,this.m_coreV2=e,this.m_cornerDir2=i,this.m_cornerConvex2=o},Box2D.Collision.Shapes.b2EdgeShape.NAME="b2EdgeShape",Box2D.Collision.Shapes.b2MassData=function(){this.mass=0,this.center=Box2D.Common.Math.b2Vec2.Get(0,0),this.I=0},Box2D.Collision.Shapes.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.call(this),this.m_centroid=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_vertices=[],this.m_normals=[]},c2inherit(Box2D.Collision.Shapes.b2PolygonShape,Box2D.Collision.Shapes.b2Shape),Box2D.Collision.Shapes.b2PolygonShape.prototype.GetTypeName=function(){return Box2D.Collision.Shapes.b2PolygonShape.NAME},Box2D.Collision.Shapes.b2PolygonShape.prototype.Copy=function(){var t=new Box2D.Collision.Shapes.b2PolygonShape;return t.Set(this),t},Box2D.Collision.Shapes.b2PolygonShape.prototype.Set=function(t){if(Box2D.Collision.Shapes.b2Shape.prototype.Set.call(this,t),t instanceof Box2D.Collision.Shapes.b2PolygonShape){this.m_centroid.SetV(t.m_centroid),this.m_vertexCount=t.m_vertexCount,this.Reserve(this.m_vertexCount);for(var e=0;e<this.m_vertexCount;e++)this.m_vertices[e].SetV(t.m_vertices[e]),this.m_normals[e].SetV(t.m_normals[e])}},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsArray=function(t){this.SetAsVector(t)},Box2D.Collision.Shapes.b2PolygonShape.AsArray=function(t){var e=new Box2D.Collision.Shapes.b2PolygonShape;return e.SetAsArray(t),e},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsVector=function(t){var e=t.length;this.m_vertexCount=e,this.Reserve(e);var i=0;for(i=0;i<this.m_vertexCount;i++)this.m_vertices[i].SetV(t[i]);for(i=0;i<this.m_vertexCount;++i){var o=i,s=i+1<this.m_vertexCount?i+1:0,n=Box2D.Common.Math.b2Math.SubtractVV(this.m_vertices[s],this.m_vertices[o]);this.m_normals[i].SetV(Box2D.Common.Math.b2Math.CrossVF(n,1)),this.m_normals[i].Normalize()}this.m_centroid=Box2D.Collision.Shapes.b2PolygonShape.ComputeCentroid(this.m_vertices,this.m_vertexCount)},Box2D.Collision.Shapes.b2PolygonShape.AsVector=function(t){var e=new Box2D.Collision.Shapes.b2PolygonShape;return e.SetAsVector(t),e},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsBox=function(t,e){this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},Box2D.Collision.Shapes.b2PolygonShape.AsBox=function(t,e){var i=new Box2D.Collision.Shapes.b2PolygonShape;return i.SetAsBox(t,e),i},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsOrientedBox=function(t,e,i,o){this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=i;var s=new Box2D.Common.Math.b2Mat22;s.Set(o);for(var n=new Box2D.Common.Math.b2Transform(i,s),r=0;r<this.m_vertexCount;++r)this.m_vertices[r]=Box2D.Common.Math.b2Math.MulX(n,this.m_vertices[r]),this.m_normals[r]=Box2D.Common.Math.b2Math.MulMV(n.R,this.m_normals[r])},Box2D.Collision.Shapes.b2PolygonShape.AsOrientedBox=function(t,e,i,o){var s=new Box2D.Collision.Shapes.b2PolygonShape;return s.SetAsOrientedBox(t,e,i,o),s},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsEdge=function(t,e){this.m_vertexCount=2,this.Reserve(2),this.m_vertices[0].SetV(t),this.m_vertices[1].SetV(e),this.m_centroid.x=.5*(t.x+e.x),this.m_centroid.y=.5*(t.y+e.y),this.m_normals[0]=Box2D.Common.Math.b2Math.CrossVF(Box2D.Common.Math.b2Math.SubtractVV(e,t),1),this.m_normals[0].Normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},Box2D.Collision.Shapes.b2PolygonShape.AsEdge=function(t,e){var i=new Box2D.Collision.Shapes.b2PolygonShape;return i.SetAsEdge(t,e),i},Box2D.Collision.Shapes.b2PolygonShape.prototype.TestPoint=function(t,e){for(var i,o=t.R,s=e.x-t.position.x,n=e.y-t.position.y,r=s*o.col1.x+n*o.col1.y,a=s*o.col2.x+n*o.col2.y,h=0;h<this.m_vertexCount;++h){if(s=r-(i=this.m_vertices[h]).x,n=a-i.y,(i=this.m_normals[h]).x*s+i.y*n>0)return!1}return!0},Box2D.Collision.Shapes.b2PolygonShape.prototype.RayCast=function(t,e,i){var o,s,n=0,r=e.maxFraction,a=0,h=0;a=e.p1.x-i.position.x,h=e.p1.y-i.position.y;var c=a*(o=i.R).col1.x+h*o.col1.y,l=a*o.col2.x+h*o.col2.y;a=e.p2.x-i.position.x,h=e.p2.y-i.position.y;for(var m=a*(o=i.R).col1.x+h*o.col1.y-c,u=a*o.col2.x+h*o.col2.y-l,p=-1,d=0;d<this.m_vertexCount;++d){a=(s=this.m_vertices[d]).x-c,h=s.y-l;var y=(s=this.m_normals[d]).x*a+s.y*h,_=s.x*m+s.y*u;if(0==_){if(y<0)return!1}else _<0&&y<n*_?(n=y/_,p=d):_>0&&y<r*_&&(r=y/_);if(r<n-Number.MIN_VALUE)return!1}return p>=0&&(t.fraction=n,o=i.R,s=this.m_normals[p],t.normal.x=o.col1.x*s.x+o.col2.x*s.y,t.normal.y=o.col1.y*s.x+o.col2.y*s.y,!0)},Box2D.Collision.Shapes.b2PolygonShape.prototype.ComputeAABB=function(t,e){for(var i=e.R,o=this.m_vertices[0],s=e.position.x+(i.col1.x*o.x+i.col2.x*o.y),n=e.position.y+(i.col1.y*o.x+i.col2.y*o.y),r=s,a=n,h=1;h<this.m_vertexCount;++h){o=this.m_vertices[h];var c=e.position.x+(i.col1.x*o.x+i.col2.x*o.y),l=e.position.y+(i.col1.y*o.x+i.col2.y*o.y);s=s<c?s:c,n=n<l?n:l,r=r>c?r:c,a=a>l?a:l}t.lowerBound_.x=s-this.m_radius,t.lowerBound_.y=n-this.m_radius,t.upperBound_.x=r+this.m_radius,t.upperBound_.y=a+this.m_radius},Box2D.Collision.Shapes.b2PolygonShape.prototype.ComputeMass=function(t,e){if(2==this.m_vertexCount)return t.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),t.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),t.mass=0,void(t.I=0);for(var i=0,o=0,s=0,n=0,r=0;r<this.m_vertexCount;++r){var a=this.m_vertices[r],h=r+1<this.m_vertexCount?this.m_vertices[r+1]:this.m_vertices[0],c=a.x-0,l=a.y-0,m=h.x-0,u=h.y-0,p=c*u-l*m,d=.5*p;s+=d,i+=d*(1/3)*(0+a.x+h.x),o+=d*(1/3)*(0+a.y+h.y);n+=p*(1/3*(.25*(c*c+m*c+m*m)+(0*c+0*m))+0+(1/3*(.25*(l*l+u*l+u*u)+(0*l+0*u))+0))}t.mass=e*s,i*=1/s,o*=1/s,t.center.Set(i,o),t.I=e*n},Box2D.Collision.Shapes.b2PolygonShape.prototype.ComputeSubmergedArea=function(t,e,i,o){var s=Box2D.Common.Math.b2Math.MulTMV(i.R,t),n=e-Box2D.Common.Math.b2Math.Dot(t,i.position),r=[],a=0,h=-1,c=-1,l=!1,m=0;for(m=0;m<this.m_vertexCount;++m){r[m]=Box2D.Common.Math.b2Math.Dot(s,this.m_vertices[m])-n;var u=r[m]<-Number.MIN_VALUE;m>0&&(u?l||(h=m-1,a++):l&&(c=m-1,a++)),l=u}switch(a){case 0:if(l){var p=new Box2D.Collision.Shapes.b2MassData;return this.ComputeMass(p,1),o.SetV(Box2D.Common.Math.b2Math.MulX(i,p.center)),p.mass}return 0;case 1:-1==h?h=this.m_vertexCount-1:c=this.m_vertexCount-1}var d,y=(h+1)%this.m_vertexCount,_=(c+1)%this.m_vertexCount,f=(0-r[h])/(r[y]-r[h]),x=(0-r[c])/(r[_]-r[c]),g=Box2D.Common.Math.b2Vec2.Get(this.m_vertices[h].x*(1-f)+this.m_vertices[y].x*f,this.m_vertices[h].y*(1-f)+this.m_vertices[y].y*f),b=Box2D.Common.Math.b2Vec2.Get(this.m_vertices[c].x*(1-x)+this.m_vertices[_].x*x,this.m_vertices[c].y*(1-x)+this.m_vertices[_].y*x),v=0,B=Box2D.Common.Math.b2Vec2.Get(0,0),D=this.m_vertices[y];for(m=y;m!=_;){d=(m=(m+1)%this.m_vertexCount)==_?b:this.m_vertices[m];var w=.5*((D.x-g.x)*(d.y-g.y)-(D.y-g.y)*(d.x-g.x));v+=w,B.x+=w*(g.x+D.x+d.x)/3,B.y+=w*(g.y+D.y+d.y)/3,D=d}return B.Multiply(1/v),o.SetV(Box2D.Common.Math.b2Math.MulX(i,B)),v},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetDistanceProxy=function(t){t.m_vertices=this.m_vertices,t.m_count=this.m_vertexCount,t.m_radius=this.m_radius},Box2D.Collision.Shapes.b2PolygonShape.prototype.GetVertexCount=function(){return this.m_vertexCount},Box2D.Collision.Shapes.b2PolygonShape.prototype.GetVertices=function(){return this.m_vertices},Box2D.Collision.Shapes.b2PolygonShape.prototype.GetNormals=function(){return this.m_normals},Box2D.Collision.Shapes.b2PolygonShape.prototype.GetSupport=function(t){for(var e=0,i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,o=1;o<this.m_vertexCount;++o){var s=this.m_vertices[o].x*t.x+this.m_vertices[o].y*t.y;s>i&&(e=o,i=s)}return e},Box2D.Collision.Shapes.b2PolygonShape.prototype.GetSupportVertex=function(t){for(var e=0,i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,o=1;o<this.m_vertexCount;++o){var s=this.m_vertices[o].x*t.x+this.m_vertices[o].y*t.y;s>i&&(e=o,i=s)}return this.m_vertices[e]},Box2D.Collision.Shapes.b2PolygonShape.prototype.Reserve=function(t){this.m_vertices=[],this.m_normals=[];for(var e=this.m_vertices.length;e<t;e++)this.m_vertices[e]=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_normals[e]=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.Shapes.b2PolygonShape.ComputeCentroid=function(t,e){for(var i=Box2D.Common.Math.b2Vec2.Get(0,0),o=0,s=0;s<e;++s){var n=t[s],r=s+1<e?t[s+1]:t[0],a=n.x-0,h=n.y-0,c=r.x-0,l=.5*(a*(r.y-0)-h*c);o+=l,i.x+=l*(1/3)*(0+n.x+r.x),i.y+=l*(1/3)*(0+n.y+r.y)}return i.x*=1/o,i.y*=1/o,i},Box2D.Collision.Shapes.b2PolygonShape.s_mat=new Box2D.Common.Math.b2Mat22,Box2D.Collision.Shapes.b2PolygonShape.NAME="b2PolygonShape",Box2D.Collision.b2ContactID=function(){this._key=0,this._referenceEdge=0,this._incidentEdge=0,this._incidentVertex=0},Box2D.Collision.b2ContactID.prototype.GetKey=function(){return this._key},Box2D.Collision.b2ContactID.prototype.SetKey=function(t){this._key=t,this._referenceEdge=255&this._key,this._incidentEdge=(65280&this._key)>>8&255,this._incidentVertex=(16711680&this._key)>>16&255,this._flip=(4278190080&this._key)>>24&255},Box2D.Collision.b2ContactID.prototype.Set=function(t){this.SetKey(t._key)},Box2D.Collision.b2ContactID.prototype.SetReferenceEdge=function(t){this._referenceEdge=t,this._key=4294967040&this._key|255&this._referenceEdge},Box2D.Collision.b2ContactID.prototype.SetIncidentEdge=function(t){this._incidentEdge=t,this._key=4294902015&this._key|this._incidentEdge<<8&65280},Box2D.Collision.b2ContactID.prototype.SetIncidentVertex=function(t){this._incidentVertex=t,this._key=4278255615&this._key|this._incidentVertex<<16&16711680},Box2D.Collision.b2ContactID.prototype.SetFlip=function(t){this._flip=t,this._key=16777215&this._key|this._flip<<24&4278190080},Box2D.Collision.b2ContactID.prototype.Copy=function(){var t=new Box2D.Collision.b2ContactID;return t.Set(this),t},Box2D.Collision.ClipVertex=function(){this.v=Box2D.Common.Math.b2Vec2.Get(0,0),this.id=new Box2D.Collision.b2ContactID},Box2D.Collision.ClipVertex.prototype.Set=function(t){this.v.SetV(t.v),this.id.Set(t.id)},Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase",Box2D.Collision.b2AABB=function(){this.lowerBound_=Box2D.Common.Math.b2Vec2.Get(0,0),this.upperBound_=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2AABB._freeCache=[],Box2D.Collision.b2AABB.Get=function(){if(Box2D.Collision.b2AABB._freeCache.length>0){var t=Box2D.Collision.b2AABB._freeCache.pop();return t.SetZero(),t}return new Box2D.Collision.b2AABB},Box2D.Collision.b2AABB.Free=function(t){Box2D.Collision.b2AABB._freeCache.push(t)},Box2D.Collision.b2AABB.prototype.SetZero=function(){this.lowerBound_.Set(0,0),this.upperBound_.Set(0,0)},Box2D.Collision.b2AABB.prototype.IsValid=function(){return!(this.upperBound_.x-this.lowerBound_.x<0)&&(!(this.upperBound_.y-this.lowerBound_.y<0)&&(this.lowerBound_.IsValid()&&this.upperBound_.IsValid()))},Box2D.Collision.b2AABB.prototype.GetCenter=function(){return Box2D.Common.Math.b2Vec2.Get((this.lowerBound_.x+this.upperBound_.x)/2,(this.lowerBound_.y+this.upperBound_.y)/2)},Box2D.Collision.b2AABB.prototype.SetCenter=function(t){var e=this.GetCenter();this.lowerBound_.Subtract(e),this.upperBound_.Subtract(e),this.lowerBound_.Add(t),this.upperBound_.Add(t),Box2D.Common.Math.b2Vec2.Free(e)},Box2D.Collision.b2AABB.prototype.GetExtents=function(){return Box2D.Common.Math.b2Vec2.Get((this.upperBound_.x-this.lowerBound_.x)/2,(this.upperBound_.y-this.lowerBound_.y)/2)},Box2D.Collision.b2AABB.prototype.Contains=function(t){var e=!0;return e=(e=(e=(e=e&&this.lowerBound_.x<=t.lowerBound_.x)&&this.lowerBound_.y<=t.lowerBound_.y)&&t.upperBound_.x<=this.upperBound_.x)&&t.upperBound_.y<=this.upperBound_.y},Box2D.Collision.b2AABB.prototype.RayCast=function(t,e){var i=-Number.MAX_VALUE,o=Number.MAX_VALUE,s=e.p2.x-e.p1.x;if(Math.abs(s)<Number.MIN_VALUE){if(e.p1.x<this.lowerBound_.x||this.upperBound_.x<e.p1.x)return!1}else{var n=1/s,r=-1;if((c=(this.lowerBound_.x-e.p1.x)*n)>(l=(this.upperBound_.x-e.p1.x)*n)){var a=c;c=l,l=a,r=1}if(c>i&&(t.normal.x=r,t.normal.y=0,i=c),i>(o=Math.min(o,l)))return!1}var h=e.p2.y-e.p1.y;if(Math.abs(h)<Number.MIN_VALUE){if(e.p1.y<this.lowerBound_.y||this.upperBound_.y<e.p1.y)return!1}else{var c,l;n=1/h,r=-1;if((c=(this.lowerBound_.y-e.p1.y)*n)>(l=(this.upperBound_.y-e.p1.y)*n)){a=c;c=l,l=a,r=1}if(c>i&&(t.normal.y=r,t.normal.x=0,i=c),i>(o=Math.min(o,l)))return!1}return t.fraction=i,!0},Box2D.Collision.b2AABB.prototype.TestOverlap=function(t){return!(t.lowerBound_.x-this.upperBound_.x>0)&&(!(t.lowerBound_.y-this.upperBound_.y>0)&&(!(this.lowerBound_.x-t.upperBound_.x>0)&&!(this.lowerBound_.y-t.upperBound_.y>0)))},Box2D.Collision.b2AABB.Combine=function(t,e){var i=Box2D.Collision.b2AABB.Get();return i.Combine(t,e),i},Box2D.Collision.b2AABB.prototype.Combine=function(t,e){this.lowerBound_.x=Math.min(t.lowerBound_.x,e.lowerBound_.x),this.lowerBound_.y=Math.min(t.lowerBound_.y,e.lowerBound_.y),this.upperBound_.x=Math.max(t.upperBound_.x,e.upperBound_.x),this.upperBound_.y=Math.max(t.upperBound_.y,e.upperBound_.y)},Box2D.Collision.b2Collision.ClipSegmentToLine=function(t,e,i,o){var s=0,n=e[0].v,r=e[1].v,a=i.x*n.x+i.y*n.y-o,h=i.x*r.x+i.y*r.y-o;if(a<=0&&t[s++].Set(e[0]),h<=0&&t[s++].Set(e[1]),a*h<0){var c=a/(a-h),l=t[s].v;l.x=n.x+c*(r.x-n.x),l.y=n.y+c*(r.y-n.y),t[s].id=a>0?e[0].id:e[1].id,s++}return s},Box2D.Collision.b2Collision.EdgeSeparation=function(t,e,i,o,s){for(var n=e.R.col1.x*t.m_normals[i].x+e.R.col2.x*t.m_normals[i].y,r=e.R.col1.y*t.m_normals[i].x+e.R.col2.y*t.m_normals[i].y,a=s.R.col1.x*n+s.R.col1.y*r,h=s.R.col2.x*n+s.R.col2.y*r,c=0,l=Number.MAX_VALUE,m=0;m<o.m_vertexCount;m++){var u=o.m_vertices[m].x*a+o.m_vertices[m].y*h;u<l&&(l=u,c=m)}var p=e.position.x+(e.R.col1.x*t.m_vertices[i].x+e.R.col2.x*t.m_vertices[i].y),d=e.position.y+(e.R.col1.y*t.m_vertices[i].x+e.R.col2.y*t.m_vertices[i].y);return(s.position.x+(s.R.col1.x*o.m_vertices[c].x+s.R.col2.x*o.m_vertices[c].y)-p)*n+(s.position.y+(s.R.col1.y*o.m_vertices[c].x+s.R.col2.y*o.m_vertices[c].y)-d)*r},Box2D.Collision.b2Collision.FindMaxSeparation=function(t,e,i,o){var s=o.position.x+(o.R.col1.x*i.m_centroid.x+o.R.col2.x*i.m_centroid.y),n=o.position.y+(o.R.col1.y*i.m_centroid.x+o.R.col2.y*i.m_centroid.y);s-=e.position.x+(e.R.col1.x*t.m_centroid.x+e.R.col2.x*t.m_centroid.y),n-=e.position.y+(e.R.col1.y*t.m_centroid.x+e.R.col2.y*t.m_centroid.y);for(var r=s*e.R.col1.x+n*e.R.col1.y,a=s*e.R.col2.x+n*e.R.col2.y,h=0,c=-Number.MAX_VALUE,l=0;l<t.m_vertexCount;++l){var m=t.m_normals[l].x*r+t.m_normals[l].y*a;m>c&&(c=m,h=l)}var u=Box2D.Collision.b2Collision.EdgeSeparation(t,e,h,i,o),p=h-1;p<0&&(p=t.m_vertexCount-1);var d=Box2D.Collision.b2Collision.EdgeSeparation(t,e,p,i,o),y=h+1;y>=t.m_vertexCount&&(y=0);var _=Box2D.Collision.b2Collision.EdgeSeparation(t,e,y,i,o),f=0,x=0;if(d>u&&d>_)for(f=p,x=d;(h=f-1)<0&&(h=t.m_vertexCount-1),(u=Box2D.Collision.b2Collision.EdgeSeparation(t,e,h,i,o))>x;)f=h,x=u;else if(_>u)for(f=y,x=_;(h=f+1)>=t.m_vertexCount&&(h=0),(u=Box2D.Collision.b2Collision.EdgeSeparation(t,e,h,i,o))>x;)f=h,x=u;else f=h,x=u;return{bestEdge:f,separation:x}},Box2D.Collision.b2Collision.FindIncidentEdge=function(t,e,i,o,s,n){void 0===o&&(o=0);var r=i.R.col1.x*e.m_normals[o].x+i.R.col2.x*e.m_normals[o].y,a=i.R.col1.y*e.m_normals[o].x+i.R.col2.y*e.m_normals[o].y,h=n.R.col1.x*r+n.R.col1.y*a;a=n.R.col2.x*r+n.R.col2.y*a,r=h;for(var c=0,l=Number.MAX_VALUE,m=0;m<s.m_vertexCount;m++){var u=r*s.m_normals[m].x+a*s.m_normals[m].y;u<l&&(l=u,c=m)}var p=c+1;p>=s.m_vertexCount&&(p=0),t[0].v.x=n.position.x+(n.R.col1.x*s.m_vertices[c].x+n.R.col2.x*s.m_vertices[c].y),t[0].v.y=n.position.y+(n.R.col1.y*s.m_vertices[c].x+n.R.col2.y*s.m_vertices[c].y),t[0].id.SetReferenceEdge(o),t[0].id.SetIncidentEdge(c),t[0].id.SetIncidentVertex(0),t[1].v.x=n.position.x+(n.R.col1.x*s.m_vertices[p].x+n.R.col2.x*s.m_vertices[p].y),t[1].v.y=n.position.y+(n.R.col1.y*s.m_vertices[p].x+n.R.col2.y*s.m_vertices[p].y),t[1].id.SetReferenceEdge(o),t[1].id.SetIncidentEdge(p),t[1].id.SetIncidentVertex(1)},Box2D.Collision.b2Collision.MakeClipPointVector=function(){return[new Box2D.Collision.ClipVertex,new Box2D.Collision.ClipVertex]},Box2D.Collision.b2Collision.CollidePolygons=function(t,e,i,o,s){t.m_pointCount=0;var n=e.m_radius+o.m_radius,r=Box2D.Collision.b2Collision.FindMaxSeparation(e,i,o,s),a=r.bestEdge;if(!(r.separation>n)){var h=Box2D.Collision.b2Collision.FindMaxSeparation(o,s,e,i);if(!(h.separation>n)){var c=e,l=o,m=i,u=s,p=0;t.m_type=Box2D.Collision.b2Manifold.e_faceA,h.separation>.98*r.separation+.001&&(c=o,l=e,m=s,u=i,a=h.bestEdge,t.m_type=Box2D.Collision.b2Manifold.e_faceB,p=1);var d=Box2D.Collision.b2Collision.s_incidentEdge;Box2D.Collision.b2Collision.FindIncidentEdge(d,c,m,a,l,u);var y,_=c.m_vertices[a];y=a+1<c.m_vertexCount?c.m_vertices[a+1]:c.m_vertices[0],Box2D.Collision.b2Collision.s_localTangent.Set(y.x-_.x,y.y-_.y),Box2D.Collision.b2Collision.s_localTangent.Normalize(),Box2D.Collision.b2Collision.s_localNormal.x=Box2D.Collision.b2Collision.s_localTangent.y,Box2D.Collision.b2Collision.s_localNormal.y=-Box2D.Collision.b2Collision.s_localTangent.x,Box2D.Collision.b2Collision.s_planePoint.Set(.5*(_.x+y.x),.5*(_.y+y.y)),Box2D.Collision.b2Collision.s_tangent.x=m.R.col1.x*Box2D.Collision.b2Collision.s_localTangent.x+m.R.col2.x*Box2D.Collision.b2Collision.s_localTangent.y,Box2D.Collision.b2Collision.s_tangent.y=m.R.col1.y*Box2D.Collision.b2Collision.s_localTangent.x+m.R.col2.y*Box2D.Collision.b2Collision.s_localTangent.y,Box2D.Collision.b2Collision.s_tangent2.x=-Box2D.Collision.b2Collision.s_tangent.x,Box2D.Collision.b2Collision.s_tangent2.y=-Box2D.Collision.b2Collision.s_tangent.y,Box2D.Collision.b2Collision.s_normal.x=Box2D.Collision.b2Collision.s_tangent.y,Box2D.Collision.b2Collision.s_normal.y=-Box2D.Collision.b2Collision.s_tangent.x,Box2D.Collision.b2Collision.s_v11.x=m.position.x+(m.R.col1.x*_.x+m.R.col2.x*_.y),Box2D.Collision.b2Collision.s_v11.y=m.position.y+(m.R.col1.y*_.x+m.R.col2.y*_.y),Box2D.Collision.b2Collision.s_v12.x=m.position.x+(m.R.col1.x*y.x+m.R.col2.x*y.y),Box2D.Collision.b2Collision.s_v12.y=m.position.y+(m.R.col1.y*y.x+m.R.col2.y*y.y);var f=-Box2D.Collision.b2Collision.s_tangent.x*Box2D.Collision.b2Collision.s_v11.x-Box2D.Collision.b2Collision.s_tangent.y*Box2D.Collision.b2Collision.s_v11.y+n;if(!(Box2D.Collision.b2Collision.ClipSegmentToLine(Box2D.Collision.b2Collision.s_clipPoints1,d,Box2D.Collision.b2Collision.s_tangent2,f)<2)){var x=Box2D.Collision.b2Collision.s_tangent.x*Box2D.Collision.b2Collision.s_v12.x+Box2D.Collision.b2Collision.s_tangent.y*Box2D.Collision.b2Collision.s_v12.y+n;if(!(Box2D.Collision.b2Collision.ClipSegmentToLine(Box2D.Collision.b2Collision.s_clipPoints2,Box2D.Collision.b2Collision.s_clipPoints1,Box2D.Collision.b2Collision.s_tangent,x)<2)){t.m_localPlaneNormal.SetV(Box2D.Collision.b2Collision.s_localNormal),t.m_localPoint.SetV(Box2D.Collision.b2Collision.s_planePoint);for(var g=Box2D.Collision.b2Collision.s_normal.x*Box2D.Collision.b2Collision.s_v11.x+Box2D.Collision.b2Collision.s_normal.y*Box2D.Collision.b2Collision.s_v11.y,b=0,v=0;v<Box2D.Common.b2Settings.b2_maxManifoldPoints;++v){if(Box2D.Collision.b2Collision.s_normal.x*Box2D.Collision.b2Collision.s_clipPoints2[v].v.x+Box2D.Collision.b2Collision.s_normal.y*Box2D.Collision.b2Collision.s_clipPoints2[v].v.y-g<=n){var B=Box2D.Collision.b2Collision.s_clipPoints2[v].v.x-u.position.x,D=Box2D.Collision.b2Collision.s_clipPoints2[v].v.y-u.position.y;t.m_points[b].m_localPoint.x=B*u.R.col1.x+D*u.R.col1.y,t.m_points[b].m_localPoint.y=B*u.R.col2.x+D*u.R.col2.y,t.m_points[b].m_id.Set(Box2D.Collision.b2Collision.s_clipPoints2[v].id),t.m_points[b].m_id.SetFlip(p),b++}}t.m_pointCount=b}}}}},Box2D.Collision.b2Collision.CollideCircles=function(t,e,i,o,s){t.m_pointCount=0;var n=i.position.x+(i.R.col1.x*e.m_p.x+i.R.col2.x*e.m_p.y),r=i.position.y+(i.R.col1.y*e.m_p.x+i.R.col2.y*e.m_p.y),a=s.position.x+(s.R.col1.x*o.m_p.x+s.R.col2.x*o.m_p.y)-n,h=s.position.y+(s.R.col1.y*o.m_p.x+s.R.col2.y*o.m_p.y)-r,c=a*a+h*h,l=e.m_radius+o.m_radius;c>l*l||(t.m_type=Box2D.Collision.b2Manifold.e_circles,t.m_localPoint.SetV(e.m_p),t.m_localPlaneNormal.SetZero(),t.m_pointCount=1,t.m_points[0].m_localPoint.SetV(o.m_p),t.m_points[0].m_id.SetKey(0))},Box2D.Collision.b2Collision.CollidePolygonAndCircle=function(t,e,i,o,s){t.m_pointCount=0;for(var n=s.position.x+(s.R.col1.x*o.m_p.x+s.R.col2.x*o.m_p.y)-i.position.x,r=s.position.y+(s.R.col1.y*o.m_p.x+s.R.col2.y*o.m_p.y)-i.position.y,a=n*i.R.col1.x+r*i.R.col1.y,h=n*i.R.col2.x+r*i.R.col2.y,c=0,l=-Number.MAX_VALUE,m=e.m_radius+o.m_radius,u=0;u<e.m_vertexCount;++u){var p=e.m_normals[u].x*(a-e.m_vertices[u].x)+e.m_normals[u].y*(h-e.m_vertices[u].y);if(p>m)return;p>l&&(l=p,c=u)}var d=c+1;d>=e.m_vertexCount&&(d=0);var y=e.m_vertices[c],_=e.m_vertices[d];if(l<Number.MIN_VALUE)t.m_pointCount=1,t.m_type=Box2D.Collision.b2Manifold.e_faceA,t.m_localPlaneNormal.SetV(e.m_normals[c]),t.m_localPoint.x=.5*(y.x+_.x),t.m_localPoint.y=.5*(y.y+_.y),t.m_points[0].m_localPoint.SetV(o.m_p),t.m_points[0].m_id.SetKey(0);else if((a-y.x)*(_.x-y.x)+(h-y.y)*(_.y-y.y)<=0){if((a-y.x)*(a-y.x)+(h-y.y)*(h-y.y)>m*m)return;t.m_pointCount=1,t.m_type=Box2D.Collision.b2Manifold.e_faceA,t.m_localPlaneNormal.x=a-y.x,t.m_localPlaneNormal.y=h-y.y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.SetV(y),t.m_points[0].m_localPoint.SetV(o.m_p),t.m_points[0].m_id.SetKey(0)}else{if((a-_.x)*(y.x-_.x)+(h-_.y)*(y.y-_.y)<=0){if((a-_.x)*(a-_.x)+(h-_.y)*(h-_.y)>m*m)return;t.m_pointCount=1,t.m_type=Box2D.Collision.b2Manifold.e_faceA,t.m_localPlaneNormal.x=a-_.x,t.m_localPlaneNormal.y=h-_.y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.SetV(_),t.m_points[0].m_localPoint.SetV(o.m_p),t.m_points[0].m_id.SetKey(0)}else{var f=.5*(y.x+_.x),x=.5*(y.y+_.y);if((l=(a-f)*e.m_normals[c].x+(h-x)*e.m_normals[c].y)>m)return;t.m_pointCount=1,t.m_type=Box2D.Collision.b2Manifold.e_faceA,t.m_localPlaneNormal.x=e.m_normals[c].x,t.m_localPlaneNormal.y=e.m_normals[c].y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.Set(f,x),t.m_points[0].m_localPoint.SetV(o.m_p),t.m_points[0].m_id.SetKey(0)}}},Box2D.Collision.b2Collision.TestOverlap=function(t,e){return!(e.lowerBound_.x-t.upperBound_.x>0)&&(!(e.lowerBound_.y-t.upperBound_.y>0)&&(!(t.lowerBound_.x-e.upperBound_.x>0)&&!(t.lowerBound_.y-e.upperBound_.y>0)))},Box2D.Collision.b2ContactPoint=function(){this.position=Box2D.Common.Math.b2Vec2.Get(0,0),this.velocity=Box2D.Common.Math.b2Vec2.Get(0,0),this.normal=Box2D.Common.Math.b2Vec2.Get(0,0),this.id=new Box2D.Collision.b2ContactID},Box2D.Collision.b2Distance.Distance=function(t,e,i){var o=new Box2D.Collision.b2Simplex;o.ReadCache(e,i.proxyA,i.transformA,i.proxyB,i.transformB),o.m_count<1||o.m_count;for(var s=0;s<20;){for(var n=[],r=0;r<o.m_count;r++)n[r]={},n[r].indexA=o.m_vertices[r].indexA,n[r].indexB=o.m_vertices[r].indexB;if(2==o.m_count?o.Solve2():3==o.m_count&&o.Solve3(),3==o.m_count)break;var a=o.GetSearchDirection();if(a.LengthSquared()<Box2D.Common.b2Settings.MIN_VALUE_SQUARED)break;var h=a.GetNegative();o.m_vertices[o.m_count].indexA=i.proxyA.GetSupport(Box2D.Common.Math.b2Math.MulTMV(i.transformA.R,h)),o.m_vertices[o.m_count].wA=Box2D.Common.Math.b2Math.MulX(i.transformA,i.proxyA.GetVertex(o.m_vertices[o.m_count].indexA)),o.m_vertices[o.m_count].indexB=i.proxyB.GetSupport(Box2D.Common.Math.b2Math.MulTMV(i.transformB.R,a)),o.m_vertices[o.m_count].wB=Box2D.Common.Math.b2Math.MulX(i.transformB,i.proxyB.GetVertex(o.m_vertices[o.m_count].indexB)),o.m_vertices[o.m_count].w=Box2D.Common.Math.b2Math.SubtractVV(o.m_vertices[o.m_count].wB,o.m_vertices[o.m_count].wA),Box2D.Common.Math.b2Vec2.Free(a),Box2D.Common.Math.b2Vec2.Free(h),s++;var c=!1;for(r=0;r<n.length;r++)if(o.m_vertices[o.m_count].indexA==n[r].indexA&&o.m_vertices[o.m_count].indexB==n[r].indexB){c=!0;break}if(c)break;o.m_count++}if(o.GetWitnessPoints(t.pointA,t.pointB),t.distance=Box2D.Common.Math.b2Math.SubtractVV(t.pointA,t.pointB).Length(),o.WriteCache(e),i.useRadii){var l=i.proxyA.m_radius,m=i.proxyB.m_radius;if(t.distance>l+m&&t.distance>Number.MIN_VALUE){t.distance-=l+m;var u=Box2D.Common.Math.b2Math.SubtractVV(t.pointB,t.pointA);u.Normalize(),t.pointA.x+=l*u.x,t.pointA.y+=l*u.y,t.pointB.x-=m*u.x,t.pointB.y-=m*u.y,Box2D.Common.Math.b2Vec2.Free(u)}else{var p=Box2D.Common.Math.b2Vec2.Get(0,0);p.x=.5*(t.pointA.x+t.pointB.x),p.y=.5*(t.pointA.y+t.pointB.y),t.pointA.x=t.pointB.x=p.x,t.pointA.y=t.pointB.y=p.y,t.distance=0,Box2D.Common.Math.b2Vec2.Free(p)}}},Box2D.Collision.b2DistanceInput=function(){},Box2D.Collision.b2DistanceOutput=function(){this.pointA=Box2D.Common.Math.b2Vec2.Get(0,0),this.pointB=Box2D.Common.Math.b2Vec2.Get(0,0),this.distance=0},Box2D.Collision.b2DistanceProxy=function(){},Box2D.Collision.b2DistanceProxy.prototype.Set=function(t){t.SetDistanceProxy(this)},Box2D.Collision.b2DistanceProxy.prototype.GetSupport=function(t){for(var e=0,i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,o=1;o<this.m_count;o++){var s=this.m_vertices[o].x*t.x+this.m_vertices[o].y*t.y;s>i&&(e=o,i=s)}return e},Box2D.Collision.b2DistanceProxy.prototype.GetSupportVertex=function(t){return this.m_vertices[this.GetSupport(t)]},Box2D.Collision.b2DistanceProxy.prototype.GetVertexCount=function(){return this.m_count},Box2D.Collision.b2DistanceProxy.prototype.GetVertex=function(t){return void 0===t&&(t=0),this.m_vertices[t]},Box2D.Collision.b2DynamicTree=function(){this.m_root=null,this.m_path=0,this.m_insertionCount=0},Box2D.Collision.b2DynamicTree.prototype.CreateProxy=function(t,e){var i=Box2D.Collision.b2DynamicTreeNode.Get(e),o=Box2D.Common.b2Settings.b2_aabbExtension,s=Box2D.Common.b2Settings.b2_aabbExtension;return i.aabb.lowerBound_.x=t.lowerBound_.x-o,i.aabb.lowerBound_.y=t.lowerBound_.y-s,i.aabb.upperBound_.x=t.upperBound_.x+o,i.aabb.upperBound_.y=t.upperBound_.y+s,this.InsertLeaf(i),i},Box2D.Collision.b2DynamicTree.prototype.DestroyProxy=function(t){this.RemoveLeaf(t),t.Destroy()},Box2D.Collision.b2DynamicTree.prototype.MoveProxy=function(t,e,i){if(t.aabb.Contains(e))return!1;this.RemoveLeaf(t);var o=Box2D.Common.b2Settings.b2_aabbExtension+Box2D.Common.b2Settings.b2_aabbMultiplier*Math.abs(i.x),s=Box2D.Common.b2Settings.b2_aabbExtension+Box2D.Common.b2Settings.b2_aabbMultiplier*Math.abs(i.y);return t.aabb.lowerBound_.x=e.lowerBound_.x-o,t.aabb.lowerBound_.y=e.lowerBound_.y-s,t.aabb.upperBound_.x=e.upperBound_.x+o,t.aabb.upperBound_.y=e.upperBound_.y+s,this.InsertLeaf(t),!0},Box2D.Collision.b2DynamicTree.prototype.Rebalance=function(t){if(null!==this.m_root)for(var e=0;e<t;e++){for(var i=this.m_root,o=0;!i.IsLeaf();)i=this.m_path>>o&1?i.child2:i.child1,o=o+1&31;this.m_path++,this.RemoveLeaf(i),this.InsertLeaf(i)}},Box2D.Collision.b2DynamicTree.prototype.GetFatAABB=function(t){return t.aabb},Box2D.Collision.b2DynamicTree.prototype.Query=function(t,e){if(null!==this.m_root){var i=[];for(i.push(this.m_root);i.length>0;){var o=i.pop();if(o.aabb.TestOverlap(e))if(o.IsLeaf()){if(!t(o.fixture))return}else i.push(o.child1),i.push(o.child2)}}},Box2D.Collision.b2DynamicTree.prototype.RayCast=function(t,e){if(null!==this.m_root){var i=Box2D.Common.Math.b2Math.SubtractVV(e.p1,e.p2);i.Normalize();var o=Box2D.Common.Math.b2Math.CrossFV(1,i),s=Box2D.Common.Math.b2Math.AbsV(o),n=e.maxFraction,r=e.p1.x+n*(e.p2.x-e.p1.x),a=e.p1.y+n*(e.p2.y-e.p1.y),h=Box2D.Collision.b2AABB.Get();h.lowerBound_.x=Math.min(e.p1.x,r),h.lowerBound_.y=Math.min(e.p1.y,a),h.upperBound_.x=Math.max(e.p1.x,r),h.upperBound_.y=Math.max(e.p1.y,a);var c=[];for(c.push(this.m_root);c.length>0;){var l=c.pop();if(l.aabb.TestOverlap(h)){var m=l.aabb.GetCenter(),u=l.aabb.GetExtents();if(!(Math.abs(o.x*(e.p1.x-m.x)+o.y*(e.p1.y-m.y))-s.x*u.x-s.y*u.y>0))if(l.IsLeaf()){new Box2D.Collision.b2RayCastInput(e.p1,e.p2,e.maxFraction);if(0==(n=t(e,l.fixture)))break;n>0&&(r=e.p1.x+n*(e.p2.x-e.p1.x),a=e.p1.y+n*(e.p2.y-e.p1.y),h.lowerBound_.x=Math.min(e.p1.x,r),h.lowerBound_.y=Math.min(e.p1.y,a),h.upperBound_.x=Math.max(e.p1.x,r),h.upperBound_.y=Math.max(e.p1.y,a))}else c.push(l.child1),c.push(l.child2)}}Box2D.Collision.b2AABB.Free(h)}},Box2D.Collision.b2DynamicTree.prototype.InsertLeaf=function(t){if(this.m_insertionCount++,null===this.m_root)return this.m_root=t,void(this.m_root.parent=null);var e=this.GetBestSibling(t),i=e.parent,o=Box2D.Collision.b2DynamicTreeNode.Get();if(o.parent=i,o.aabb.Combine(t.aabb,e.aabb),i)for(e.parent.child1==e?i.child1=o:i.child2=o,o.child1=e,o.child2=t,e.parent=o,t.parent=o;i&&!i.aabb.Contains(o.aabb);)i.aabb.Combine(i.child1.aabb,i.child2.aabb),o=i,i=i.parent;else o.child1=e,o.child2=t,e.parent=o,t.parent=o,this.m_root=o},Box2D.Collision.b2DynamicTree.prototype.GetBestSibling=function(t){for(var e=t.aabb.GetCenter(),i=this.m_root;!i.IsLeaf();){var o=i.child1,s=i.child2;i=Math.abs((o.aabb.lowerBound_.x+o.aabb.upperBound_.x)/2-e.x)+Math.abs((o.aabb.lowerBound_.y+o.aabb.upperBound_.y)/2-e.y)<Math.abs((s.aabb.lowerBound_.x+s.aabb.upperBound_.x)/2-e.x)+Math.abs((s.aabb.lowerBound_.y+s.aabb.upperBound_.y)/2-e.y)?o:s}return Box2D.Common.Math.b2Vec2.Free(e),i},Box2D.Collision.b2DynamicTree.prototype.RemoveLeaf=function(t){if(t!=this.m_root){var e,i=t.parent,o=i.parent;if(e=i.child1==t?i.child2:i.child1,o)for(o.child1==i?o.child1=e:o.child2=e,e.parent=o;o;){var s=o.aabb;if(o.aabb.Combine(o.child1.aabb,o.child2.aabb),s.Contains(o.aabb))break;o=o.parent}else this.m_root=e,e.parent=null;i.Destroy()}else this.m_root=null},Box2D.Collision.b2DynamicTreeBroadPhase=function(){this.m_tree=new Box2D.Collision.b2DynamicTree,this.m_moveBuffer=[]},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.CreateProxy=function(t,e){var i=this.m_tree.CreateProxy(t,e);return this.BufferMove(i),i},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.DestroyProxy=function(t){this.UnBufferMove(t),this.m_tree.DestroyProxy(t)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.MoveProxy=function(t,e,i){this.m_tree.MoveProxy(t,e,i)&&this.BufferMove(t)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.TestOverlap=function(t,e){var i=this.m_tree.GetFatAABB(t),o=this.m_tree.GetFatAABB(e);return i.TestOverlap(o)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.GetFatAABB=function(t){return this.m_tree.GetFatAABB(t)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.GetProxyCount=function(){return this.m_tree.length},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.UpdatePairs=function(t){for(var e=[];this.m_moveBuffer.length>0;){var i=this.m_moveBuffer.pop(),o=this.m_tree.GetFatAABB(i);this.m_tree.Query(function(t){return t!=i.fixture&&e.push(new Box2D.Collision.b2DynamicTreePair(i.fixture,t)),!0},o)}for(var s=0;s<e.length;){var n=e[s];for(t(n.fixtureA,n.fixtureB),s++;s<e.length;){var r=e[s];if(!(r.fixtureA==n.fixtureA&&r.fixtureB==n.fixtureB||r.fixtureA==n.fixtureB&&r.fixtureB==n.fixtureA))break;s++}}},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.Query=function(t,e){this.m_tree.Query(t,e)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.RayCast=function(t,e){this.m_tree.RayCast(t,e)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.Rebalance=function(t){this.m_tree.Rebalance(t)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.BufferMove=function(t){this.m_moveBuffer.push(t)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.UnBufferMove=function(t){cr.arrayFindRemove(this.m_moveBuffer,t)},Box2D.Collision.b2DynamicTreeBroadPhase.__implements={},Box2D.Collision.b2DynamicTreeBroadPhase.__implements[Box2D.Collision.IBroadPhase]=!0,Box2D.Collision.b2DynamicTreeNode=function(t){this.aabb=Box2D.Collision.b2AABB.Get(),this.child1=null,this.child2=null,this.parent=null,this.fixture=null,void 0!==t&&(this.fixture=t)},Box2D.Collision.b2DynamicTreeNode._freeCache=[],Box2D.Collision.b2DynamicTreeNode.Get=function(t){if(Box2D.Collision.b2DynamicTreeNode._freeCache.length>0){var e=Box2D.Collision.b2DynamicTreeNode._freeCache.pop();return void 0!==t&&(e.fixture=t),e.aabb.SetZero(),e}return new Box2D.Collision.b2DynamicTreeNode(t)},Box2D.Collision.b2DynamicTreeNode.prototype.Destroy=function(){this.child1=null,this.child2=null,this.parent=null,this.fixture=null,Box2D.Collision.b2DynamicTreeNode._freeCache.push(this)},Box2D.Collision.b2DynamicTreeNode.prototype.IsLeaf=function(){return null===this.child1},Box2D.Collision.b2DynamicTreePair=function(t,e){this.fixtureA=t,this.fixtureB=e},Box2D.Collision.b2Manifold=function(){this.m_pointCount=0,this.m_type=0,this.m_points=[];for(var t=0;t<Box2D.Common.b2Settings.b2_maxManifoldPoints;t++)this.m_points[t]=new Box2D.Collision.b2ManifoldPoint;this.m_localPlaneNormal=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localPoint=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2Manifold.prototype.Reset=function(){for(var t=0;t<Box2D.Common.b2Settings.b2_maxManifoldPoints;t++)this.m_points[t].Reset();this.m_localPlaneNormal.SetZero(),this.m_localPoint.SetZero(),this.m_type=0,this.m_pointCount=0},Box2D.Collision.b2Manifold.prototype.Set=function(t){this.m_pointCount=t.m_pointCount;for(var e=0;e<Box2D.Common.b2Settings.b2_maxManifoldPoints;e++)this.m_points[e].Set(t.m_points[e]);this.m_localPlaneNormal.SetV(t.m_localPlaneNormal),this.m_localPoint.SetV(t.m_localPoint),this.m_type=t.m_type},Box2D.Collision.b2Manifold.prototype.Copy=function(){var t=new Box2D.Collision.b2Manifold;return t.Set(this),t},Box2D.Collision.b2Manifold.e_circles=1,Box2D.Collision.b2Manifold.e_faceA=2,Box2D.Collision.b2Manifold.e_faceB=4,Box2D.Collision.b2ManifoldPoint=function(){this.m_localPoint=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_id=new Box2D.Collision.b2ContactID,this.Reset()},Box2D.Collision.b2ManifoldPoint.prototype.Reset=function(){this.m_localPoint.SetZero(),this.m_normalImpulse=0,this.m_tangentImpulse=0,this.m_id.SetKey(0)},Box2D.Collision.b2ManifoldPoint.prototype.Set=function(t){this.m_localPoint.SetV(t.m_localPoint),this.m_normalImpulse=t.m_normalImpulse,this.m_tangentImpulse=t.m_tangentImpulse,this.m_id.Set(t.m_id)},Box2D.Collision.b2RayCastInput=function(t,e,i){this.p1=Box2D.Common.Math.b2Vec2.Get(0,0),this.p2=Box2D.Common.Math.b2Vec2.Get(0,0),void 0===i&&(i=1),t&&this.p1.SetV(t),e&&this.p2.SetV(e),this.maxFraction=i},Box2D.Collision.b2RayCastOutput=function(){this.normal=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2Segment=function(){this.p1=Box2D.Common.Math.b2Vec2.Get(0,0),this.p2=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2Segment.prototype.TestSegment=function(t,e,i,o){void 0===o&&(o=0);var s=i.p1,n=i.p2.x-s.x,r=i.p2.y-s.y,a=this.p2.x-this.p1.x,h=this.p2.y-this.p1.y,c=-a,l=100*Number.MIN_VALUE,m=-(n*h+r*c);if(m>l){var u=s.x-this.p1.x,p=s.y-this.p1.y,d=u*h+p*c;if(0<=d&&d<=o*m){var y=-n*p+r*u;if(-l*m<=y&&y<=m*(1+l)){d/=m;var _=Math.sqrt(h*h+c*c);return h/=_,c/=_,t[0]=d,e.Set(h,c),!0}}}return!1},Box2D.Collision.b2Segment.prototype.Extend=function(t){this.ExtendForward(t),this.ExtendBackward(t)},Box2D.Collision.b2Segment.prototype.ExtendForward=function(t){var e=this.p2.x-this.p1.x,i=this.p2.y-this.p1.y,o=Math.min(e>0?(t.upperBound_.x-this.p1.x)/e:e<0?(t.lowerBound_.x-this.p1.x)/e:Number.POSITIVE_INFINITY,i>0?(t.upperBound_.y-this.p1.y)/i:i<0?(t.lowerBound_.y-this.p1.y)/i:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+e*o,this.p2.y=this.p1.y+i*o},Box2D.Collision.b2Segment.prototype.ExtendBackward=function(t){var e=-this.p2.x+this.p1.x,i=-this.p2.y+this.p1.y,o=Math.min(e>0?(t.upperBound_.x-this.p2.x)/e:e<0?(t.lowerBound_.x-this.p2.x)/e:Number.POSITIVE_INFINITY,i>0?(t.upperBound_.y-this.p2.y)/i:i<0?(t.lowerBound_.y-this.p2.y)/i:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+e*o,this.p1.y=this.p2.y+i*o},Box2D.Collision.b2SeparationFunction=function(){this.m_localPoint=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_axis=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2SeparationFunction.prototype.Initialize=function(t,e,i,o,s){this.m_proxyA=e,this.m_proxyB=o;var n,r,a,h,c,l,m,u,p=0,d=0,y=0,_=0,f=0,x=0,g=0;if(1==t.count)this.m_type=Box2D.Collision.b2SeparationFunction.e_points,n=this.m_proxyA.GetVertex(t.indexA[0]),h=this.m_proxyB.GetVertex(t.indexB[0]),u=n,m=i.R,p=i.position.x+(m.col1.x*u.x+m.col2.x*u.y),d=i.position.y+(m.col1.y*u.x+m.col2.y*u.y),u=h,m=s.R,y=s.position.x+(m.col1.x*u.x+m.col2.x*u.y),_=s.position.y+(m.col1.y*u.x+m.col2.y*u.y),this.m_axis.x=y-p,this.m_axis.y=_-d,this.m_axis.Normalize();else if(t.indexB[0]==t.indexB[1])this.m_type=Box2D.Collision.b2SeparationFunction.e_faceA,r=this.m_proxyA.GetVertex(t.indexA[0]),a=this.m_proxyA.GetVertex(t.indexA[1]),h=this.m_proxyB.GetVertex(t.indexB[0]),this.m_localPoint.x=.5*(r.x+a.x),this.m_localPoint.y=.5*(r.y+a.y),this.m_axis=Box2D.Common.Math.b2Math.CrossVF(Box2D.Common.Math.b2Math.SubtractVV(a,r),1),this.m_axis.Normalize(),u=this.m_axis,f=(m=i.R).col1.x*u.x+m.col2.x*u.y,x=m.col1.y*u.x+m.col2.y*u.y,u=this.m_localPoint,m=i.R,p=i.position.x+(m.col1.x*u.x+m.col2.x*u.y),d=i.position.y+(m.col1.y*u.x+m.col2.y*u.y),u=h,m=s.R,(g=((y=s.position.x+(m.col1.x*u.x+m.col2.x*u.y))-p)*f+((_=s.position.y+(m.col1.y*u.x+m.col2.y*u.y))-d)*x)<0&&this.m_axis.NegativeSelf();else if(t.indexA[0]==t.indexA[0])this.m_type=Box2D.Collision.b2SeparationFunction.e_faceB,c=this.m_proxyB.GetVertex(t.indexB[0]),l=this.m_proxyB.GetVertex(t.indexB[1]),n=this.m_proxyA.GetVertex(t.indexA[0]),this.m_localPoint.x=.5*(c.x+l.x),this.m_localPoint.y=.5*(c.y+l.y),this.m_axis=Box2D.Common.Math.b2Math.CrossVF(Box2D.Common.Math.b2Math.SubtractVV(l,c),1),this.m_axis.Normalize(),u=this.m_axis,f=(m=s.R).col1.x*u.x+m.col2.x*u.y,x=m.col1.y*u.x+m.col2.y*u.y,u=this.m_localPoint,m=s.R,y=s.position.x+(m.col1.x*u.x+m.col2.x*u.y),_=s.position.y+(m.col1.y*u.x+m.col2.y*u.y),u=n,m=i.R,(g=((p=i.position.x+(m.col1.x*u.x+m.col2.x*u.y))-y)*f+((d=i.position.y+(m.col1.y*u.x+m.col2.y*u.y))-_)*x)<0&&this.m_axis.NegativeSelf();else{r=this.m_proxyA.GetVertex(t.indexA[0]),a=this.m_proxyA.GetVertex(t.indexA[1]),c=this.m_proxyB.GetVertex(t.indexB[0]),l=this.m_proxyB.GetVertex(t.indexB[1]);var b=Box2D.Common.Math.b2Math.MulMV(i.R,Box2D.Common.Math.b2Math.SubtractVV(a,r)),v=Box2D.Common.Math.b2Math.MulMV(s.R,Box2D.Common.Math.b2Math.SubtractVV(l,c)),B=b.x*b.x+b.y*b.y,D=v.x*v.x+v.y*v.y,w=Box2D.Common.Math.b2Math.SubtractVV(v,b),C=b.x*w.x+b.y*w.y,S=v.x*w.x+v.y*w.y,A=b.x*v.x+b.y*v.y,M=B*D-A*A;g=0,0!=M&&(g=Box2D.Common.Math.b2Math.Clamp((A*S-C*D)/M,0,1));var T=(A*g+S)/D;T<0&&(T=0,g=Box2D.Common.Math.b2Math.Clamp((A-C)/B,0,1)),(n=Box2D.Common.Math.b2Vec2.Get(0,0)).x=r.x+g*(a.x-r.x),n.y=r.y+g*(a.y-r.y),(h=Box2D.Common.Math.b2Vec2.Get(0,0)).x=c.x+g*(l.x-c.x),h.y=c.y+g*(l.y-c.y),0==g||1==g?(this.m_type=Box2D.Collision.b2SeparationFunction.e_faceB,this.m_axis=Box2D.Common.Math.b2Math.CrossVF(Box2D.Common.Math.b2Math.SubtractVV(l,c),1),this.m_axis.Normalize(),this.m_localPoint=h,u=this.m_axis,f=(m=s.R).col1.x*u.x+m.col2.x*u.y,x=m.col1.y*u.x+m.col2.y*u.y,u=this.m_localPoint,m=s.R,y=s.position.x+(m.col1.x*u.x+m.col2.x*u.y),_=s.position.y+(m.col1.y*u.x+m.col2.y*u.y),u=n,m=i.R,((p=i.position.x+(m.col1.x*u.x+m.col2.x*u.y))-y)*f+((d=i.position.y+(m.col1.y*u.x+m.col2.y*u.y))-_)*x,g<0&&this.m_axis.NegativeSelf()):(this.m_type=Box2D.Collision.b2SeparationFunction.e_faceA,this.m_axis=Box2D.Common.Math.b2Math.CrossVF(Box2D.Common.Math.b2Math.SubtractVV(a,r),1),this.m_localPoint=n,u=this.m_axis,f=(m=i.R).col1.x*u.x+m.col2.x*u.y,x=m.col1.y*u.x+m.col2.y*u.y,u=this.m_localPoint,m=i.R,p=i.position.x+(m.col1.x*u.x+m.col2.x*u.y),d=i.position.y+(m.col1.y*u.x+m.col2.y*u.y),u=h,m=s.R,((y=s.position.x+(m.col1.x*u.x+m.col2.x*u.y))-p)*f+((_=s.position.y+(m.col1.y*u.x+m.col2.y*u.y))-d)*x,g<0&&this.m_axis.NegativeSelf())}},Box2D.Collision.b2SeparationFunction.prototype.Evaluate=function(t,e){var i,o,s,n,r,a,h,c=0;switch(this.m_type){case Box2D.Collision.b2SeparationFunction.e_points:i=Box2D.Common.Math.b2Math.MulTMV(t.R,this.m_axis),o=Box2D.Common.Math.b2Math.MulTMV(e.R,this.m_axis.GetNegative()),s=this.m_proxyA.GetSupportVertex(i),n=this.m_proxyB.GetSupportVertex(o),r=Box2D.Common.Math.b2Math.MulX(t,s),c=((a=Box2D.Common.Math.b2Math.MulX(e,n)).x-r.x)*this.m_axis.x+(a.y-r.y)*this.m_axis.y;break;case Box2D.Collision.b2SeparationFunction.e_faceA:h=Box2D.Common.Math.b2Math.MulMV(t.R,this.m_axis),r=Box2D.Common.Math.b2Math.MulX(t,this.m_localPoint),o=Box2D.Common.Math.b2Math.MulTMV(e.R,h.GetNegative()),n=this.m_proxyB.GetSupportVertex(o),c=((a=Box2D.Common.Math.b2Math.MulX(e,n)).x-r.x)*h.x+(a.y-r.y)*h.y;break;case Box2D.Collision.b2SeparationFunction.e_faceB:h=Box2D.Common.Math.b2Math.MulMV(e.R,this.m_axis),a=Box2D.Common.Math.b2Math.MulX(e,this.m_localPoint),i=Box2D.Common.Math.b2Math.MulTMV(t.R,h.GetNegative()),s=this.m_proxyA.GetSupportVertex(i),c=((r=Box2D.Common.Math.b2Math.MulX(t,s)).x-a.x)*h.x+(r.y-a.y)*h.y}return c},Box2D.Collision.b2SeparationFunction.e_points=1,Box2D.Collision.b2SeparationFunction.e_faceA=2,Box2D.Collision.b2SeparationFunction.e_faceB=4,Box2D.Collision.b2Simplex=function(){this.m_v1=new Box2D.Collision.b2SimplexVertex,this.m_v2=new Box2D.Collision.b2SimplexVertex,this.m_v3=new Box2D.Collision.b2SimplexVertex,this.m_vertices=[this.m_v1,this.m_v2,this.m_v3]},Box2D.Collision.b2Simplex.prototype.ReadCache=function(t,e,i,o,s){var n,r;this.m_count=t.count;for(var a=this.m_vertices,h=0;h<this.m_count;h++){var c=a[h];c.indexA=t.indexA[h],c.indexB=t.indexB[h],n=e.GetVertex(c.indexA),r=o.GetVertex(c.indexB),c.wA=Box2D.Common.Math.b2Math.MulX(i,n),c.wB=Box2D.Common.Math.b2Math.MulX(s,r),c.w=Box2D.Common.Math.b2Math.SubtractVV(c.wB,c.wA),c.a=0}if(this.m_count>1){var l=t.metric,m=this.GetMetric();(m<.5*l||2*l<m||m<Number.MIN_VALUE)&&(this.m_count=0)}0==this.m_count&&((c=a[0]).indexA=0,c.indexB=0,n=e.GetVertex(0),r=o.GetVertex(0),c.wA=Box2D.Common.Math.b2Math.MulX(i,n),c.wB=Box2D.Common.Math.b2Math.MulX(s,r),c.w=Box2D.Common.Math.b2Math.SubtractVV(c.wB,c.wA),this.m_count=1)},Box2D.Collision.b2Simplex.prototype.WriteCache=function(t){t.metric=this.GetMetric(),t.count=this.m_count;for(var e=this.m_vertices,i=0;i<this.m_count;i++)t.indexA[i]=e[i].indexA,t.indexB[i]=e[i].indexB},Box2D.Collision.b2Simplex.prototype.GetSearchDirection=function(){if(1==this.m_count)return this.m_v1.w.GetNegative();if(2==this.m_count){var t=Box2D.Common.Math.b2Math.SubtractVV(this.m_v2.w,this.m_v1.w);return Box2D.Common.Math.b2Math.CrossVV(t,this.m_v1.w.GetNegative())>0?Box2D.Common.Math.b2Math.CrossFV(1,t):Box2D.Common.Math.b2Math.CrossVF(t,1)}return Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2Simplex.prototype.GetClosestPoint=function(){return 1==this.m_count?this.m_v1.w:2==this.m_count?Box2D.Common.Math.b2Vec2.Get(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y):Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2Simplex.prototype.GetWitnessPoints=function(t,e){1==this.m_count?(t.SetV(this.m_v1.wA),e.SetV(this.m_v1.wB)):2==this.m_count?(t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y):3==this.m_count&&(e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y)},Box2D.Collision.b2Simplex.prototype.GetMetric=function(){return 1==this.m_count?0:2==this.m_count?Box2D.Common.Math.b2Math.SubtractVV(this.m_v1.w,this.m_v2.w).Length():3==this.m_count?Box2D.Common.Math.b2Math.CrossVV(Box2D.Common.Math.b2Math.SubtractVV(this.m_v2.w,this.m_v1.w),Box2D.Common.Math.b2Math.SubtractVV(this.m_v3.w,this.m_v1.w)):0},Box2D.Collision.b2Simplex.prototype.Solve2=function(){var t=this.m_v1.w,e=this.m_v2.w,i=Box2D.Common.Math.b2Math.SubtractVV(e,t),o=-(t.x*i.x+t.y*i.y);if(o<=0)return this.m_v1.a=1,void(this.m_count=1);var s=e.x*i.x+e.y*i.y;if(s<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Set(this.m_v2);var n=1/(s+o);this.m_v1.a=s*n,this.m_v2.a=o*n,this.m_count=2},Box2D.Collision.b2Simplex.prototype.Solve3=function(){var t=this.m_v1.w,e=this.m_v2.w,i=this.m_v3.w,o=Box2D.Common.Math.b2Math.SubtractVV(e,t),s=Box2D.Common.Math.b2Math.Dot(t,o),n=Box2D.Common.Math.b2Math.Dot(e,o),r=-s,a=Box2D.Common.Math.b2Math.SubtractVV(i,t),h=Box2D.Common.Math.b2Math.Dot(t,a),c=Box2D.Common.Math.b2Math.Dot(i,a),l=-h,m=Box2D.Common.Math.b2Math.SubtractVV(i,e),u=Box2D.Common.Math.b2Math.Dot(e,m),p=Box2D.Common.Math.b2Math.Dot(i,m),d=-u,y=Box2D.Common.Math.b2Math.CrossVV(o,a),_=y*Box2D.Common.Math.b2Math.CrossVV(e,i),f=y*Box2D.Common.Math.b2Math.CrossVV(i,t),x=y*Box2D.Common.Math.b2Math.CrossVV(t,e);if(r<=0&&l<=0)return this.m_v1.a=1,void(this.m_count=1);if(n>0&&r>0&&x<=0){var g=1/(n+r);return this.m_v1.a=n*g,this.m_v2.a=r*g,void(this.m_count=2)}if(c>0&&l>0&&f<=0){var b=1/(c+l);return this.m_v1.a=c*b,this.m_v3.a=l*b,this.m_count=2,void this.m_v2.Set(this.m_v3)}if(n<=0&&d<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Set(this.m_v2);if(c<=0&&p<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Set(this.m_v3);if(p>0&&d>0&&_<=0){var v=1/(p+d);return this.m_v2.a=p*v,this.m_v3.a=d*v,this.m_count=2,void this.m_v1.Set(this.m_v3)}var B=1/(_+f+x);this.m_v1.a=_*B,this.m_v2.a=f*B,this.m_v3.a=x*B,this.m_count=3},Box2D.Collision.b2SimplexCache=function(){this.indexA=[0,0,0],this.indexB=[0,0,0]},Box2D.Collision.b2SimplexVertex=function(){},Box2D.Collision.b2SimplexVertex.prototype.Set=function(t){this.wA.SetV(t.wA),this.wB.SetV(t.wB),this.w.SetV(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB},Box2D.Collision.b2TOIInput=function(){this.proxyA=new Box2D.Collision.b2DistanceProxy,this.proxyB=new Box2D.Collision.b2DistanceProxy,this.sweepA=new Box2D.Common.Math.b2Sweep,this.sweepB=new Box2D.Common.Math.b2Sweep},Box2D.Collision.b2TimeOfImpact={},Box2D.Collision.b2TimeOfImpact.TimeOfImpact=function(t){Box2D.Collision.b2TimeOfImpact.b2_toiCalls++;var e=t.proxyA,i=t.proxyB,o=t.sweepA,s=t.sweepB,n=e.m_radius+i.m_radius,r=t.tolerance,a=0,h=0,c=0;for(Box2D.Collision.b2TimeOfImpact.s_cache.count=0,Box2D.Collision.b2TimeOfImpact.s_distanceInput.useRadii=!1;;){if(o.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfA,a),s.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfB,a),Box2D.Collision.b2TimeOfImpact.s_distanceInput.proxyA=e,Box2D.Collision.b2TimeOfImpact.s_distanceInput.proxyB=i,Box2D.Collision.b2TimeOfImpact.s_distanceInput.transformA=Box2D.Collision.b2TimeOfImpact.s_xfA,Box2D.Collision.b2TimeOfImpact.s_distanceInput.transformB=Box2D.Collision.b2TimeOfImpact.s_xfB,Box2D.Collision.b2Distance.Distance(Box2D.Collision.b2TimeOfImpact.s_distanceOutput,Box2D.Collision.b2TimeOfImpact.s_cache,Box2D.Collision.b2TimeOfImpact.s_distanceInput),Box2D.Collision.b2TimeOfImpact.s_distanceOutput.distance<=0){a=1;break}Box2D.Collision.b2TimeOfImpact.s_fcn.Initialize(Box2D.Collision.b2TimeOfImpact.s_cache,e,Box2D.Collision.b2TimeOfImpact.s_xfA,i,Box2D.Collision.b2TimeOfImpact.s_xfB);var l=Box2D.Collision.b2TimeOfImpact.s_fcn.Evaluate(Box2D.Collision.b2TimeOfImpact.s_xfA,Box2D.Collision.b2TimeOfImpact.s_xfB);if(l<=0){a=1;break}if(0==h&&(c=l>n?Math.max(n-r,.75*n):Math.max(l-r,.02*n)),l-c<.5*r){if(0==h){a=1;break}break}var m=a,u=a,p=1,d=l;o.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfA,p),s.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfB,p);var y=Box2D.Collision.b2TimeOfImpact.s_fcn.Evaluate(Box2D.Collision.b2TimeOfImpact.s_xfA,Box2D.Collision.b2TimeOfImpact.s_xfB);if(y>=c){a=1;break}for(var _=0;;){var f=0;f=1&_?u+(c-d)*(p-u)/(y-d):.5*(u+p),o.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfA,f),s.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfB,f);var x=Box2D.Collision.b2TimeOfImpact.s_fcn.Evaluate(Box2D.Collision.b2TimeOfImpact.s_xfA,Box2D.Collision.b2TimeOfImpact.s_xfB);if(Math.abs(x-c)<.025*r){m=f;break}if(x>c?(u=f,d=x):(p=f,y=x),_++,Box2D.Collision.b2TimeOfImpact.b2_toiRootIters++,50==_)break}if(Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=Math.max(Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters,_),m<(1+100*Number.MIN_VALUE)*a)break;if(a=m,h++,Box2D.Collision.b2TimeOfImpact.b2_toiIters++,1e3==h)break}return Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=Math.max(Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters,h),a},Box2D.Collision.b2WorldManifold=function(){this.m_normal=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_points=[],this.m_pointCount=0;for(var t=0;t<Box2D.Common.b2Settings.b2_maxManifoldPoints;t++)this.m_points[t]=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2WorldManifold.prototype.Initialize=function(t,e,i,o,s){if(0!=t.m_pointCount){var n,r,a=0,h=0,c=0,l=0,m=0,u=0,p=0;switch(t.m_type){case Box2D.Collision.b2Manifold.e_circles:r=e.R,n=t.m_localPoint;var d=e.position.x+r.col1.x*n.x+r.col2.x*n.y,y=e.position.y+r.col1.y*n.x+r.col2.y*n.y;r=o.R,n=t.m_points[0].m_localPoint;var _=o.position.x+r.col1.x*n.x+r.col2.x*n.y,f=o.position.y+r.col1.y*n.x+r.col2.y*n.y,x=_-d,g=f-y,b=x*x+g*g;if(b>Box2D.Common.b2Settings.MIN_VALUE_SQUARED){var v=Math.sqrt(b);this.m_normal.x=x/v,this.m_normal.y=g/v}else this.m_normal.x=1,this.m_normal.y=0;var B=d+i*this.m_normal.x,D=y+i*this.m_normal.y,w=_-s*this.m_normal.x,C=f-s*this.m_normal.y;this.m_points[0].x=.5*(B+w),this.m_points[0].y=.5*(D+C);break;case Box2D.Collision.b2Manifold.e_faceA:for(r=e.R,n=t.m_localPlaneNormal,h=r.col1.x*n.x+r.col2.x*n.y,c=r.col1.y*n.x+r.col2.y*n.y,r=e.R,n=t.m_localPoint,l=e.position.x+r.col1.x*n.x+r.col2.x*n.y,m=e.position.y+r.col1.y*n.x+r.col2.y*n.y,this.m_normal.x=h,this.m_normal.y=c,a=0;a<t.m_pointCount;a++)r=o.R,n=t.m_points[a].m_localPoint,u=o.position.x+r.col1.x*n.x+r.col2.x*n.y,p=o.position.y+r.col1.y*n.x+r.col2.y*n.y,this.m_points[a].x=u+.5*(i-(u-l)*h-(p-m)*c-s)*h,this.m_points[a].y=p+.5*(i-(u-l)*h-(p-m)*c-s)*c;break;case Box2D.Collision.b2Manifold.e_faceB:for(r=o.R,n=t.m_localPlaneNormal,h=r.col1.x*n.x+r.col2.x*n.y,c=r.col1.y*n.x+r.col2.y*n.y,r=o.R,n=t.m_localPoint,l=o.position.x+r.col1.x*n.x+r.col2.x*n.y,m=o.position.y+r.col1.y*n.x+r.col2.y*n.y,this.m_normal.x=-h,this.m_normal.y=-c,a=0;a<t.m_pointCount;a++)r=e.R,n=t.m_points[a].m_localPoint,u=e.position.x+r.col1.x*n.x+r.col2.x*n.y,p=e.position.y+r.col1.y*n.x+r.col2.y*n.y,this.m_points[a].x=u+.5*(s-(u-l)*h-(p-m)*c-i)*h,this.m_points[a].y=p+.5*(s-(u-l)*h-(p-m)*c-i)*c}}},Box2D.Dynamics.b2Body=function(t,e){this.ID="Body"+Box2D.Dynamics.b2Body.NEXT_ID++,this.m_xf=new Box2D.Common.Math.b2Transform,this.m_xf.position.SetV(t.position),this.m_xf.R.Set(t.angle),this.m_sweep=new Box2D.Common.Math.b2Sweep,this.m_sweep.localCenter.SetZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=t.angle,this.m_sweep.c.x=this.m_xf.R.col1.x*this.m_sweep.localCenter.x+this.m_xf.R.col2.x*this.m_sweep.localCenter.y,this.m_sweep.c.y=this.m_xf.R.col1.y*this.m_sweep.localCenter.x+this.m_xf.R.col2.y*this.m_sweep.localCenter.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_linearVelocity=t.linearVelocity.Copy(),this.m_force=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_bullet=t.bullet,this.m_fixedRotation=t.fixedRotation,this.m_allowSleep=t.allowSleep,this.m_awake=t.awake,this.m_active=t.active,this.m_world=e,this.m_jointList=null,this.contactList=new Box2D.Dynamics.Contacts.b2ContactList,this.controllerList=new Box2D.Dynamics.Controllers.b2ControllerList,this.m_controllerCount=0,this.m_angularVelocity=t.angularVelocity,this.m_linearDamping=t.linearDamping,this.m_angularDamping=t.angularDamping,this.m_torque=0,this.m_sleepTime=0,this.m_type=t.type,this.m_mass=this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody?1:0,this.m_invMass=this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody?1:0,this.m_I=0,this.m_invI=0,this.m_inertiaScale=t.inertiaScale,this.fixtureList=new Box2D.Dynamics.b2FixtureList,this.m_lists=[]},Box2D.Dynamics.b2Body.prototype.CreateFixture=function(t){var e=new Box2D.Dynamics.b2Fixture(this,this.m_xf,t);if(this.m_active){var i=this.m_world.m_contactManager.m_broadPhase;e.CreateProxy(i,this.m_xf)}return this.fixtureList.AddFixture(e),e.m_body=this,e.m_density>0&&this.ResetMassData(),this.m_world.m_newFixture=!0,e},Box2D.Dynamics.b2Body.prototype.CreateFixture2=function(t,e){void 0===e&&(e=0);var i=new Box2D.Dynamics.b2FixtureDef;return i.shape=t,i.density=e,this.CreateFixture(i)},Box2D.Dynamics.b2Body.prototype.Destroy=function(){Box2D.Common.Math.b2Vec2.Free(this.m_linearVelocity),Box2D.Common.Math.b2Vec2.Free(this.m_force)},Box2D.Dynamics.b2Body.prototype.DestroyFixture=function(t){this.fixtureList.RemoveFixture(t);for(var e=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);e;e=e.GetNextNode())t!=e.contact.m_fixtureA&&t!=e.contact.m_fixtureB||this.m_world.m_contactManager.Destroy(e.contact);if(this.m_active){var i=this.m_world.m_contactManager.m_broadPhase;t.DestroyProxy(i)}t.Destroy(),t.m_body=null,this.ResetMassData()},Box2D.Dynamics.b2Body.prototype.SetPositionAndAngle=function(t,e){this.m_xf.R.Set(e),this.m_xf.position.SetV(t);var i=this.m_xf.R,o=this.m_sweep.localCenter;this.m_sweep.c.x=i.col1.x*o.x+i.col2.x*o.y,this.m_sweep.c.y=i.col1.y*o.x+i.col2.y*o.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=e;for(var s=this.m_world.m_contactManager.m_broadPhase,n=this.fixtureList.GetFirstNode();n;n=n.GetNextNode())n.fixture.Synchronize(s,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()},Box2D.Dynamics.b2Body.prototype.SetTransform=function(t){this.SetPositionAndAngle(t.position,t.GetAngle())},Box2D.Dynamics.b2Body.prototype.GetTransform=function(){return this.m_xf},Box2D.Dynamics.b2Body.prototype.GetPosition=function(){return this.m_xf.position},Box2D.Dynamics.b2Body.prototype.SetPosition=function(t){this.SetPositionAndAngle(t,this.GetAngle())},Box2D.Dynamics.b2Body.prototype.GetAngle=function(){return this.m_sweep.a},Box2D.Dynamics.b2Body.prototype.SetAngle=function(t){this.SetPositionAndAngle(this.GetPosition(),t)},Box2D.Dynamics.b2Body.prototype.GetWorldCenter=function(){return this.m_sweep.c},Box2D.Dynamics.b2Body.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},Box2D.Dynamics.b2Body.prototype.SetLinearVelocity=function(t){this.m_type!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&this.m_linearVelocity.SetV(t)},Box2D.Dynamics.b2Body.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},Box2D.Dynamics.b2Body.prototype.SetAngularVelocity=function(t){void 0===t&&(t=0),this.m_type!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&(this.m_angularVelocity=t)},Box2D.Dynamics.b2Body.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},Box2D.Dynamics.b2Body.prototype.GetDefinition=function(){var t=new Box2D.Dynamics.b2BodyDef;return t.type=this.GetType(),t.allowSleep=this.m_allowSleep,t.angle=this.GetAngle(),t.angularDamping=this.m_angularDamping,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=this.m_fixedRotation,t.bullet=this.m_bullet,t.active=this.m_active,t.awake=this.m_awake,t.linearDamping=this.m_linearDamping,t.linearVelocity.SetV(this.GetLinearVelocity()),t.position=this.GetPosition(),t},Box2D.Dynamics.b2Body.prototype.ApplyForce=function(t,e){this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&(this.SetAwake(!0),this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x)},Box2D.Dynamics.b2Body.prototype.ApplyTorque=function(t){void 0===t&&(t=0),this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&(this.SetAwake(!0),this.m_torque+=t)},Box2D.Dynamics.b2Body.prototype.ApplyImpulse=function(t,e){this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&(this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x))},Box2D.Dynamics.b2Body.prototype.Split=function(t){for(var e=this.GetLinearVelocity().Copy(),i=this.GetAngularVelocity(),o=this.GetWorldCenter(),s=this.m_world.CreateBody(this.GetDefinition()),n=this.fixtureList.GetFirstNode();n;n=n.GetNextNode()){var r=n.fixture;t(r)&&(this.fixtureList.RemoveFixture(r),s.fixtureList.AddFixture(r))}this.ResetMassData(),s.ResetMassData();var a=this.GetWorldCenter(),h=s.GetWorldCenter(),c=Box2D.Common.Math.b2Math.AddVV(e,Box2D.Common.Math.b2Math.CrossFV(i,Box2D.Common.Math.b2Math.SubtractVV(a,o))),l=Box2D.Common.Math.b2Math.AddVV(e,Box2D.Common.Math.b2Math.CrossFV(i,Box2D.Common.Math.b2Math.SubtractVV(h,o)));return this.SetLinearVelocity(c),s.SetLinearVelocity(l),this.SetAngularVelocity(i),s.SetAngularVelocity(i),this.SynchronizeFixtures(),s.SynchronizeFixtures(),s},Box2D.Dynamics.b2Body.prototype.Merge=function(t){for(var e=t.fixtureList.GetFirstNode();e;e=e.GetNextNode())this.fixtureList.AddFixture(e.fixture),t.fixtureList.RemoveFixture(e.fixture);t.ResetMassData(),this.ResetMassData(),this.SynchronizeFixtures()},Box2D.Dynamics.b2Body.prototype.GetMass=function(){return this.m_mass},Box2D.Dynamics.b2Body.prototype.GetInertia=function(){return this.m_I},Box2D.Dynamics.b2Body.prototype.GetMassData=function(t){return t||(t=new Box2D.Collision.Shapes.b2MassData),t.mass=this.m_mass,t.I=this.m_I,t.center.SetV(this.m_sweep.localCenter),t},Box2D.Dynamics.b2Body.prototype.SetMassData=function(t){if(this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,t.I>0&&!this.m_fixedRotation&&(this.m_I=t.I-this.m_mass*(t.center.x*t.center.x+t.center.y*t.center.y),this.m_invI=1/this.m_I);var e=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(t.center),this.m_sweep.c0.SetV(Box2D.Common.Math.b2Math.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-e.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-e.x)}},Box2D.Dynamics.b2Body.prototype.ResetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&this.m_type!=Box2D.Dynamics.b2BodyDef.b2_kinematicBody){for(var t=Box2D.Common.Math.b2Vec2.Get(0,0),e=this.fixtureList.GetFirstNode();e;e=e.GetNextNode()){var i=e.fixture;if(0!=i.m_density){var o=i.GetMassData();this.m_mass+=o.mass,t.x+=o.center.x*o.mass,t.y+=o.center.y*o.mass,this.m_I+=o.I}}this.m_mass>0?(this.m_invMass=1/this.m_mass,t.x*=this.m_invMass,t.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&!this.m_fixedRotation?(this.m_I-=this.m_mass*(t.x*t.x+t.y*t.y),this.m_I*=this.m_inertiaScale,this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var s=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(t),this.m_sweep.c0.SetV(Box2D.Common.Math.b2Math.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-s.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-s.x),Box2D.Common.Math.b2Vec2.Free(t),Box2D.Common.Math.b2Vec2.Free(s)}},Box2D.Dynamics.b2Body.prototype.GetWorldPoint=function(t){var e=this.m_xf.R,i=Box2D.Common.Math.b2Vec2.Get(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y);return i.x+=this.m_xf.position.x,i.y+=this.m_xf.position.y,i},Box2D.Dynamics.b2Body.prototype.GetWorldVector=function(t){return Box2D.Common.Math.b2Math.MulMV(this.m_xf.R,t)},Box2D.Dynamics.b2Body.prototype.GetLocalPoint=function(t){return Box2D.Common.Math.b2Math.MulXT(this.m_xf,t)},Box2D.Dynamics.b2Body.prototype.GetLocalVector=function(t){return Box2D.Common.Math.b2Math.MulTMV(this.m_xf.R,t)},Box2D.Dynamics.b2Body.prototype.GetLinearVelocityFromWorldPoint=function(t){return Box2D.Common.Math.b2Vec2.Get(this.m_linearVelocity.x-this.m_angularVelocity*(t.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(t.x-this.m_sweep.c.x))},Box2D.Dynamics.b2Body.prototype.GetLinearVelocityFromLocalPoint=function(t){var e=this.m_xf.R,i=Box2D.Common.Math.b2Vec2.Get(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y);i.x+=this.m_xf.position.x,i.y+=this.m_xf.position.y;var o=Box2D.Common.Math.b2Vec2.Get(this.m_linearVelocity.x-this.m_angularVelocity*(i.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(i.x-this.m_sweep.c.x));return Box2D.Common.Math.b2Vec2.Free(i),o},Box2D.Dynamics.b2Body.prototype.GetLinearDamping=function(){return this.m_linearDamping},Box2D.Dynamics.b2Body.prototype.SetLinearDamping=function(t){this.m_linearDamping=t},Box2D.Dynamics.b2Body.prototype.GetAngularDamping=function(){return this.m_angularDamping},Box2D.Dynamics.b2Body.prototype.SetAngularDamping=function(t){this.m_angularDamping=t},Box2D.Dynamics.b2Body.prototype.SetType=function(t){if(this.m_type!=t){this.m_type=t,this.ResetMassData(),this.m_type==Box2D.Dynamics.b2BodyDef.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var e=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);e;e=e.GetNextNode())e.contact.FlagForFiltering();for(var i=0;i<this.m_lists.length;i++)this.m_lists[i].UpdateBody(this)}},Box2D.Dynamics.b2Body.prototype.GetType=function(){return this.m_type},Box2D.Dynamics.b2Body.prototype.SetBullet=function(t){this.m_bullet=t},Box2D.Dynamics.b2Body.prototype.IsBullet=function(){return this.m_bullet},Box2D.Dynamics.b2Body.prototype.SetSleepingAllowed=function(t){this.m_allowSleep=t,t||this.SetAwake(!0)},Box2D.Dynamics.b2Body.prototype.SetAwake=function(t){if(this.m_awake!=t){this.m_awake=t,this.m_sleepTime=0,t||(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0);for(var e=0;e<this.m_lists.length;e++)this.m_lists[e].UpdateBody(this)}},Box2D.Dynamics.b2Body.prototype.IsAwake=function(){return this.m_awake},Box2D.Dynamics.b2Body.prototype.SetFixedRotation=function(t){this.m_fixedRotation=t,this.ResetMassData()},Box2D.Dynamics.b2Body.prototype.IsFixedRotation=function(){return this.m_fixedRotation},Box2D.Dynamics.b2Body.prototype.SetActive=function(t){if(t!=this.m_active){if(t){this.m_active=!0;for(var e=this.m_world.m_contactManager.m_broadPhase,i=this.fixtureList.GetFirstNode();i;i=i.GetNextNode())i.fixture.CreateProxy(e,this.m_xf)}else{this.m_active=!1;for(e=this.m_world.m_contactManager.m_broadPhase,i=this.fixtureList.GetFirstNode();i;i=i.GetNextNode())i.fixture.DestroyProxy(e);for(var o=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);o;o=o.GetNextNode())this.m_world.m_contactManager.Destroy(o.contact)}for(var s=0;s<this.m_lists.length;s++)this.m_lists[s].UpdateBody(this)}},Box2D.Dynamics.b2Body.prototype.IsActive=function(){return this.m_active},Box2D.Dynamics.b2Body.prototype.IsSleepingAllowed=function(){return this.m_allowSleep},Box2D.Dynamics.b2Body.prototype.GetFixtureList=function(){return this.fixtureList},Box2D.Dynamics.b2Body.prototype.GetJointList=function(){return this.m_jointList},Box2D.Dynamics.b2Body.prototype.GetControllerList=function(){return this.controllerList},Box2D.Dynamics.b2Body.prototype.AddController=function(t){this.controllerList.AddController(t)},Box2D.Dynamics.b2Body.prototype.RemoveController=function(t){this.controllerList.RemoveController(t)},Box2D.Dynamics.b2Body.prototype.GetContactList=function(){return this.contactList},Box2D.Dynamics.b2Body.prototype.GetWorld=function(){return this.m_world},Box2D.Dynamics.b2Body.prototype.SynchronizeFixtures=function(){var t=Box2D.Dynamics.b2Body.s_xf1;t.R.Set(this.m_sweep.a0);var e=t.R,i=this.m_sweep.localCenter;t.position.x=this.m_sweep.c0.x-(e.col1.x*i.x+e.col2.x*i.y),t.position.y=this.m_sweep.c0.y-(e.col1.y*i.x+e.col2.y*i.y);for(var o=this.m_world.m_contactManager.m_broadPhase,s=this.fixtureList.GetFirstNode();s;s=s.GetNextNode())s.fixture.Synchronize(o,t,this.m_xf)},Box2D.Dynamics.b2Body.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var t=this.m_xf.R,e=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(t.col1.x*e.x+t.col2.x*e.y),this.m_xf.position.y=this.m_sweep.c.y-(t.col1.y*e.x+t.col2.y*e.y)},Box2D.Dynamics.b2Body.prototype.ShouldCollide=function(t){if(this.m_type!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&t.m_type!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody)return!1;for(var e=this.m_jointList;e;e=e.next)if(e.other==t&&0==e.joint.m_collideConnected)return!1;return!0},Box2D.Dynamics.b2Body.prototype.Advance=function(t){this.m_sweep.Advance(t),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},Box2D.Dynamics.b2Body.NEXT_ID=0,Box2D.Dynamics.b2BodyDef=function(){this.position=Box2D.Common.Math.b2Vec2.Get(0,0),this.linearVelocity=Box2D.Common.Math.b2Vec2.Get(0,0),this.angle=0,this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.type=Box2D.Dynamics.b2BodyDef.b2_staticBody,this.active=!0,this.inertiaScale=1},Box2D.Dynamics.b2BodyDef.b2_staticBody=0,Box2D.Dynamics.b2BodyDef.b2_kinematicBody=1,Box2D.Dynamics.b2BodyDef.b2_dynamicBody=2,Box2D.Dynamics.b2BodyList=function(){this.bodyFirstNodes=[];for(var t=0;t<=Box2D.Dynamics.b2BodyList.TYPES.allBodies;t++)this.bodyFirstNodes[t]=null;this.bodyLastNodes=[];for(t=0;t<=Box2D.Dynamics.b2BodyList.TYPES.allBodies;t++)this.bodyLastNodes[t]=null;this.bodyNodeLookup={},this.bodyCount=0},Box2D.Dynamics.b2BodyList.prototype.GetFirstNode=function(t){return this.bodyFirstNodes[t]},Box2D.Dynamics.b2BodyList.prototype.AddBody=function(t){var e=t.ID;null==this.bodyNodeLookup[e]&&(this.CreateNode(t,e,Box2D.Dynamics.b2BodyList.TYPES.allBodies),this.UpdateBody(t),t.m_lists.push(this),this.bodyCount++)},Box2D.Dynamics.b2BodyList.prototype.UpdateBody=function(t){var e=t.GetType(),i=t.ID,o=t.IsAwake(),s=t.IsActive();e==Box2D.Dynamics.b2BodyDef.b2_dynamicBody?this.CreateNode(t,i,Box2D.Dynamics.b2BodyList.TYPES.dynamicBodies):this.RemoveNode(i,Box2D.Dynamics.b2BodyList.TYPES.dynamicBodies),e!=Box2D.Dynamics.b2BodyDef.b2_staticBody?this.CreateNode(t,i,Box2D.Dynamics.b2BodyList.TYPES.nonStaticBodies):this.RemoveNode(i,Box2D.Dynamics.b2BodyList.TYPES.nonStaticBodies),e!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&s&&o?this.CreateNode(t,i,Box2D.Dynamics.b2BodyList.TYPES.nonStaticActiveAwakeBodies):this.RemoveNode(i,Box2D.Dynamics.b2BodyList.TYPES.nonStaticActiveAwakeBodies),o?this.CreateNode(t,i,Box2D.Dynamics.b2BodyList.TYPES.awakeBodies):this.RemoveNode(i,Box2D.Dynamics.b2BodyList.TYPES.awakeBodies),s?this.CreateNode(t,i,Box2D.Dynamics.b2BodyList.TYPES.activeBodies):this.RemoveNode(i,Box2D.Dynamics.b2BodyList.TYPES.activeBodies)},Box2D.Dynamics.b2BodyList.prototype.RemoveBody=function(t){var e=t.ID;if(null!=this.bodyNodeLookup[e]){cr.arrayFindRemove(t.m_lists,this);for(var i=0;i<=Box2D.Dynamics.b2BodyList.TYPES.allBodies;i++)this.RemoveNode(e,i);delete this.bodyNodeLookup[e],this.bodyCount--}},Box2D.Dynamics.b2BodyList.prototype.RemoveNode=function(t,e){var i=this.bodyNodeLookup[t];if(null!=i){var o=i[e];if(null!=o){i[e]=null;var s=o.GetPreviousNode(),n=o.GetNextNode();null==s?this.bodyFirstNodes[e]=n:s.SetNextNode(n),null==n?this.bodyLastNodes[e]=s:n.SetPreviousNode(s)}}},Box2D.Dynamics.b2BodyList.prototype.CreateNode=function(t,e,i){var o=this.bodyNodeLookup[e];if(null==o){o=[];for(var s=0;s<=Box2D.Dynamics.b2BodyList.TYPES.allBodies;s++)o[s]=null;this.bodyNodeLookup[e]=o}if(null==o[i]){o[i]=new Box2D.Dynamics.b2BodyListNode(t);var n=this.bodyLastNodes[i];null!=n?n.SetNextNode(o[i]):this.bodyFirstNodes[i]=o[i],o[i].SetPreviousNode(n),this.bodyLastNodes[i]=o[i]}},Box2D.Dynamics.b2BodyList.prototype.GetBodyCount=function(){return this.bodyCount},Box2D.Dynamics.b2BodyList.TYPES={dynamicBodies:0,nonStaticBodies:1,activeBodies:2,nonStaticActiveAwakeBodies:3,awakeBodies:4,allBodies:5},Box2D.Dynamics.b2BodyListNode=function(t){this.body=t,this.next=null,this.previous=null},Box2D.Dynamics.b2BodyListNode.prototype.SetNextNode=function(t){this.next=t},Box2D.Dynamics.b2BodyListNode.prototype.SetPreviousNode=function(t){this.previous=t},Box2D.Dynamics.b2BodyListNode.prototype.GetBody=function(){return this.body},Box2D.Dynamics.b2BodyListNode.prototype.GetNextNode=function(){return this.next},Box2D.Dynamics.b2BodyListNode.prototype.GetPreviousNode=function(){return this.previous},Box2D.Dynamics.b2ContactFilter=function(){},Box2D.Dynamics.b2ContactFilter.prototype.ShouldCollide=function(t,e){var i=t.GetFilterData(),o=e.GetFilterData();return i.groupIndex==o.groupIndex&&0!=i.groupIndex?i.groupIndex>0:0!=(i.maskBits&o.categoryBits)&&0!=(i.categoryBits&o.maskBits)},Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.b2ContactImpulse=function(){this.normalImpulses=[],this.tangentImpulses=[]},Box2D.Dynamics.b2ContactListener=function(){},Box2D.Dynamics.b2ContactListener.prototype.BeginContact=function(t){},Box2D.Dynamics.b2ContactListener.prototype.EndContact=function(t){},Box2D.Dynamics.b2ContactListener.prototype.PreSolve=function(t,e){},Box2D.Dynamics.b2ContactListener.prototype.PostSolve=function(t,e){},Box2D.Dynamics.b2ContactManager=function(t){this.m_world=t,this.m_contactFilter=Box2D.Dynamics.b2ContactFilter.b2_defaultFilter,this.m_contactListener=Box2D.Dynamics.b2ContactListener.b2_defaultListener,this.m_contactFactory=new Box2D.Dynamics.Contacts.b2ContactFactory,this.m_broadPhase=new Box2D.Collision.b2DynamicTreeBroadPhase},Box2D.Dynamics.b2ContactManager.prototype.AddPair=function(t,e){var i=t.GetBody(),o=e.GetBody();if(i!=o&&o.ShouldCollide(i)&&this.m_contactFilter.ShouldCollide(t,e)){for(var s=o.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);s;s=s.GetNextNode()){var n=s.contact.m_fixtureA;if(n==t){if(s.contact.m_fixtureB==e)return}else if(n==e){if(s.contact.m_fixtureB==t)return}}this.m_contactFactory.Create(t,e)}},Box2D.Dynamics.b2ContactManager.prototype.FindNewContacts=function(){var t=this;this.m_broadPhase.UpdatePairs(function(e,i){t.AddPair(e,i)})},Box2D.Dynamics.b2ContactManager.prototype.Destroy=function(t){var e=t.m_fixtureA,i=t.m_fixtureB;e.GetBody(),i.GetBody();t.touching&&this.m_contactListener.EndContact(t),t.m_manifold.m_pointCount>0&&(t.m_fixtureA.GetBody().SetAwake(!0),t.m_fixtureB.GetBody().SetAwake(!0)),t.RemoveFromLists(),this.m_contactFactory.Destroy(t)},Box2D.Dynamics.b2ContactManager.prototype.Collide=function(){for(var t=this.m_world.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);t;t=t.GetNextNode()){var e=t.contact,i=e.m_fixtureA,o=e.m_fixtureB,s=i.GetBody(),n=o.GetBody();if(0!=s.IsAwake()||0!=n.IsAwake()){if(e.IsFiltering()){if(0==n.ShouldCollide(s)){this.Destroy(e);continue}if(0==this.m_contactFilter.ShouldCollide(i,o)){this.Destroy(e);continue}e.ClearFiltering()}var r=i.m_proxy,a=o.m_proxy;0!=this.m_broadPhase.TestOverlap(r,a)?e.Update(this.m_contactListener):this.Destroy(e)}}},Box2D.Dynamics.b2DestructionListener=function(){},Box2D.Dynamics.b2DestructionListener.prototype.SayGoodbyeJoint=function(t){},Box2D.Dynamics.b2DestructionListener.prototype.SayGoodbyeFixture=function(t){},Box2D.Dynamics.b2FilterData=function(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0},Box2D.Dynamics.b2FilterData.prototype.Copy=function(){var t=new Box2D.Dynamics.b2FilterData;return t.categoryBits=this.categoryBits,t.maskBits=this.maskBits,t.groupIndex=this.groupIndex,t},Box2D.Dynamics.b2Fixture=function(t,e,i){this.ID="Fixture"+Box2D.Dynamics.b2Fixture.NEXT_ID++,this.m_filter=i.filter.Copy(),this.m_aabb=Box2D.Collision.b2AABB.Get(),this.m_body=t,this.m_shape=i.shape.Copy(),this.m_density=i.density,this.m_friction=i.friction,this.m_restitution=i.restitution,this.m_isSensor=i.isSensor},Box2D.Dynamics.b2Fixture.prototype.GetShape=function(){return this.m_shape},Box2D.Dynamics.b2Fixture.prototype.SetSensor=function(t){if(this.m_isSensor!=t&&(this.m_isSensor=t,null!=this.m_body))for(var e=this.m_body.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);e;e=e.GetNextNode()){var i=e.contact.m_fixtureA,o=e.contact.m_fixtureB;i!=this&&o!=this||e.contact.SetSensor(i.sensor||o.sensor)}},Box2D.Dynamics.b2Fixture.prototype.IsSensor=function(){return this.m_isSensor},Box2D.Dynamics.b2Fixture.prototype.SetFilterData=function(t){if(this.m_filter=t.Copy(),null!=this.m_body)for(var e=this.m_body.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);e;e=e.GetNextNode())e.contact.m_fixtureA!=this&&e.contact.m_fixtureB!=this||e.contact.FlagForFiltering()},Box2D.Dynamics.b2Fixture.prototype.GetFilterData=function(){return this.m_filter.Copy()},Box2D.Dynamics.b2Fixture.prototype.GetBody=function(){return this.m_body},Box2D.Dynamics.b2Fixture.prototype.TestPoint=function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)},Box2D.Dynamics.b2Fixture.prototype.RayCast=function(t,e){return this.m_shape.RayCast(t,e,this.m_body.GetTransform())},Box2D.Dynamics.b2Fixture.prototype.GetMassData=function(t){return t||(t=new Box2D.Collision.Shapes.b2MassData),this.m_shape.ComputeMass(t,this.m_density),t},Box2D.Dynamics.b2Fixture.prototype.SetDensity=function(t){this.m_density=t},Box2D.Dynamics.b2Fixture.prototype.GetDensity=function(){return this.m_density},Box2D.Dynamics.b2Fixture.prototype.GetFriction=function(){return this.m_friction},Box2D.Dynamics.b2Fixture.prototype.SetFriction=function(t){this.m_friction=t},Box2D.Dynamics.b2Fixture.prototype.GetRestitution=function(){return this.m_restitution},Box2D.Dynamics.b2Fixture.prototype.SetRestitution=function(t){this.m_restitution=t},Box2D.Dynamics.b2Fixture.prototype.GetAABB=function(){return this.m_aabb},Box2D.Dynamics.b2Fixture.prototype.Destroy=function(){Box2D.Collision.b2AABB.Free(this.m_aabb)},Box2D.Dynamics.b2Fixture.prototype.CreateProxy=function(t,e){this.m_shape.ComputeAABB(this.m_aabb,e),this.m_proxy=t.CreateProxy(this.m_aabb,this)},Box2D.Dynamics.b2Fixture.prototype.DestroyProxy=function(t){null!=this.m_proxy&&(t.DestroyProxy(this.m_proxy),this.m_proxy=null)},Box2D.Dynamics.b2Fixture.prototype.Synchronize=function(t,e,i){if(this.m_proxy){var o=Box2D.Collision.b2AABB.Get(),s=Box2D.Collision.b2AABB.Get();this.m_shape.ComputeAABB(o,e),this.m_shape.ComputeAABB(s,i),this.m_aabb.Combine(o,s),Box2D.Collision.b2AABB.Free(o),Box2D.Collision.b2AABB.Free(s);var n=Box2D.Common.Math.b2Math.SubtractVV(i.position,e.position);t.MoveProxy(this.m_proxy,this.m_aabb,n),Box2D.Common.Math.b2Vec2.Free(n)}},Box2D.Dynamics.b2Fixture.NEXT_ID=0,Box2D.Dynamics.b2FixtureDef=function(){this.filter=new Box2D.Dynamics.b2FilterData,this.filter.categoryBits=1,this.filter.maskBits=65535,this.filter.groupIndex=0,this.shape=null,this.friction=.2,this.restitution=0,this.density=0,this.isSensor=!1},Box2D.Dynamics.b2FixtureList=function(){this.fixtureFirstNode=null,this.fixtureLastNode=null,this.fixtureNodeLookup={},this.fixtureCount=0},Box2D.Dynamics.b2FixtureList.prototype.GetFirstNode=function(){return this.fixtureFirstNode},Box2D.Dynamics.b2FixtureList.prototype.AddFixture=function(t){var e=t.ID;if(null==this.fixtureNodeLookup[e]){var i=new Box2D.Dynamics.b2FixtureListNode(t),o=this.fixtureLastNode;null!=o?o.SetNextNode(i):this.fixtureFirstNode=i,i.SetPreviousNode(o),this.fixtureLastNode=i,this.fixtureNodeLookup[e]=i,this.fixtureCount++}},Box2D.Dynamics.b2FixtureList.prototype.RemoveFixture=function(t){var e=t.ID,i=this.fixtureNodeLookup[e];if(null!=i){var o=i.GetPreviousNode(),s=i.GetNextNode();null==o?this.fixtureFirstNode=s:o.SetNextNode(s),null==s?this.fixtureLastNode=o:s.SetPreviousNode(o),delete this.fixtureNodeLookup[e],this.fixtureCount--}},Box2D.Dynamics.b2FixtureList.prototype.GetFixtureCount=function(){return this.fixtureCount},Box2D.Dynamics.b2FixtureListNode=function(t){this.fixture=t,this.next=null,this.previous=null},Box2D.Dynamics.b2FixtureListNode.prototype.SetNextNode=function(t){this.next=t},Box2D.Dynamics.b2FixtureListNode.prototype.SetPreviousNode=function(t){this.previous=t},Box2D.Dynamics.b2FixtureListNode.prototype.GetNextNode=function(){return this.next},Box2D.Dynamics.b2FixtureListNode.prototype.GetPreviousNode=function(){return this.previous},Box2D.Dynamics.b2Island=function(t,e){this.m_listener=t,this.m_contactSolver=e,this.m_bodies=[],this.m_dynamicBodies=[],this.m_nonStaticBodies=[],this.m_contacts=[],this.m_joints=[]},Box2D.Dynamics.b2Island.prototype.Clear=function(){this.m_bodies=[],this.m_dynamicBodies=[],this.m_nonStaticBodies=[],this.m_contacts=[],this.m_joints=[]},Box2D.Dynamics.b2Island.prototype.Solve=function(t,e,i){this._InitializeVelocities(t,e),this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contacts.length),this._SolveVelocityConstraints(t),this._SolveBodies(t),this._SolvePositionConstraints(t),this.Report(this.m_contactSolver.m_constraints),i&&this._SleepIfTired(t)},Box2D.Dynamics.b2Island.prototype._InitializeVelocities=function(t,e){for(var i=0;i<this.m_dynamicBodies.length;i++){var o=this.m_dynamicBodies[i];o.m_linearVelocity.x+=t.dt*(e.x+o.m_invMass*o.m_force.x),o.m_linearVelocity.y+=t.dt*(e.y+o.m_invMass*o.m_force.y),o.m_angularVelocity+=t.dt*o.m_invI*o.m_torque,o.m_linearVelocity.Multiply(Box2D.Common.Math.b2Math.Clamp(1-t.dt*o.m_linearDamping,0,1)),o.m_angularVelocity*=Box2D.Common.Math.b2Math.Clamp(1-t.dt*o.m_angularDamping,0,1)}},Box2D.Dynamics.b2Island.prototype._SolveVelocityConstraints=function(t){this.m_contactSolver.InitVelocityConstraints(t);for(var e=0;e<this.m_joints.length;e++)this.m_joints[e].InitVelocityConstraints(t);for(var i=0;i<t.velocityIterations;i++){for(var o=0;o<this.m_joints.length;o++)this.m_joints[o].SolveVelocityConstraints(t);this.m_contactSolver.SolveVelocityConstraints()}for(var s=0;s<this.m_joints.length;s++)this.m_joints[s].FinalizeVelocityConstraints();this.m_contactSolver.FinalizeVelocityConstraints()},Box2D.Dynamics.b2Island.prototype._SolveBodies=function(t){for(var e=0;e<this.m_nonStaticBodies.length;++e){var i=this.m_nonStaticBodies[e],o=t.dt*i.m_linearVelocity.x,s=t.dt*i.m_linearVelocity.y;o*o+s*s>Box2D.Common.b2Settings.b2_maxTranslationSquared&&(i.m_linearVelocity.Normalize(),i.m_linearVelocity.x*=Box2D.Common.b2Settings.b2_maxTranslation*t.inv_dt,i.m_linearVelocity.y*=Box2D.Common.b2Settings.b2_maxTranslation*t.inv_dt);var n=t.dt*i.m_angularVelocity;n*n>Box2D.Common.b2Settings.b2_maxRotationSquared&&(i.m_angularVelocity<0?i.m_angularVelocity=-Box2D.Common.b2Settings.b2_maxRotation*t.inv_dt:i.m_angularVelocity=Box2D.Common.b2Settings.b2_maxRotation*t.inv_dt),i.m_sweep.c0.SetV(i.m_sweep.c),i.m_sweep.a0=i.m_sweep.a,i.m_sweep.c.x+=t.dt*i.m_linearVelocity.x,i.m_sweep.c.y+=t.dt*i.m_linearVelocity.y,i.m_sweep.a+=t.dt*i.m_angularVelocity,i.SynchronizeTransform()}},Box2D.Dynamics.b2Island.prototype._SolvePositionConstraints=function(t){for(var e=0;e<t.positionIterations;e++){for(var i=this.m_contactSolver.SolvePositionConstraints(Box2D.Common.b2Settings.b2_contactBaumgarte),o=!0,s=0;s<this.m_joints.length;s++){var n=this.m_joints[s].SolvePositionConstraints(Box2D.Common.b2Settings.b2_contactBaumgarte);o=o&&n}if(i&&o)break}},Box2D.Dynamics.b2Island.prototype._SleepIfTired=function(t){for(var e=Number.MAX_VALUE,i=0;i<this.m_nonStaticBodies.length;i++){var o=this.m_nonStaticBodies[i];!o.m_allowSleep||Math.abs(o.m_angularVelocity)>Box2D.Common.b2Settings.b2_angularSleepTolerance||Box2D.Common.Math.b2Math.Dot(o.m_linearVelocity,o.m_linearVelocity)>Box2D.Common.b2Settings.b2_linearSleepToleranceSquared?(o.m_sleepTime=0,e=0):(o.m_sleepTime+=t.dt,e=Math.min(e,o.m_sleepTime))}if(e>=Box2D.Common.b2Settings.b2_timeToSleep)for(var s=0;s<this.m_bodies.length;s++)this.m_bodies[s].SetAwake(!1)},Box2D.Dynamics.b2Island.prototype.SolveTOI=function(t){var e=0,i=0;this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contacts.length);var o=this.m_contactSolver;for(e=0;e<this.m_joints.length;++e)this.m_joints[e].InitVelocityConstraints(t);for(e=0;e<t.velocityIterations;++e)for(o.SolveVelocityConstraints(),i=0;i<this.m_joints.length;++i)this.m_joints[i].SolveVelocityConstraints(t);for(e=0;e<this.m_nonStaticBodies.length;++e){var s=this.m_nonStaticBodies[e],n=t.dt*s.m_linearVelocity.x,r=t.dt*s.m_linearVelocity.y;n*n+r*r>Box2D.Common.b2Settings.b2_maxTranslationSquared&&(s.m_linearVelocity.Normalize(),s.m_linearVelocity.x*=Box2D.Common.b2Settings.b2_maxTranslation*t.inv_dt,s.m_linearVelocity.y*=Box2D.Common.b2Settings.b2_maxTranslation*t.inv_dt);var a=t.dt*s.m_angularVelocity;a*a>Box2D.Common.b2Settings.b2_maxRotationSquared&&(s.m_angularVelocity<0?s.m_angularVelocity=-Box2D.Common.b2Settings.b2_maxRotation*t.inv_dt:s.m_angularVelocity=Box2D.Common.b2Settings.b2_maxRotation*t.inv_dt),s.m_sweep.c0.SetV(s.m_sweep.c),s.m_sweep.a0=s.m_sweep.a,s.m_sweep.c.x+=t.dt*s.m_linearVelocity.x,s.m_sweep.c.y+=t.dt*s.m_linearVelocity.y,s.m_sweep.a+=t.dt*s.m_angularVelocity,s.SynchronizeTransform()}for(e=0;e<t.positionIterations;++e){var h=o.SolvePositionConstraints(.75),c=!0;for(i=0;i<this.m_joints.length;++i){var l=this.m_joints[i].SolvePositionConstraints(Box2D.Common.b2Settings.b2_contactBaumgarte);c=c&&l}if(h&&c)break}this.Report(o.m_constraints)},Box2D.Dynamics.b2Island.prototype.Report=function(t){if(null!=this.m_listener)for(var e=0;e<this.m_contacts.length;++e){for(var i=this.m_contacts[e],o=t[e],s=new Box2D.Dynamics.b2ContactImpulse,n=0;n<o.pointCount;++n)s.normalImpulses[n]=o.points[n].normalImpulse,s.tangentImpulses[n]=o.points[n].tangentImpulse;this.m_listener.PostSolve(i,s)}},Box2D.Dynamics.b2Island.prototype.AddBody=function(t){this.m_bodies.push(t),t.GetType()!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&(this.m_nonStaticBodies.push(t),t.GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&this.m_dynamicBodies.push(t))},Box2D.Dynamics.b2Island.prototype.AddContact=function(t){this.m_contacts.push(t)},Box2D.Dynamics.b2Island.prototype.AddJoint=function(t){this.m_joints.push(t)},Box2D.Dynamics.b2TimeStep=function(t,e,i,o,s){this.dt=t;var n=0;t>0&&(n=1/t),this.inv_dt=n,this.dtRatio=e,this.positionIterations=i,this.velocityIterations=o,this.warmStarting=s},Box2D.Dynamics.b2World=function(t,e){this.m_contactManager=new Box2D.Dynamics.b2ContactManager(this),this.m_contactSolver=new Box2D.Dynamics.Contacts.b2ContactSolver,this.m_isLocked=!1,this.m_newFixture=!1,this.m_destructionListener=null,this.bodyList=new Box2D.Dynamics.b2BodyList,this.contactList=new Box2D.Dynamics.Contacts.b2ContactList,this.m_jointList=null,this.controllerList=new Box2D.Dynamics.Controllers.b2ControllerList,this.m_jointCount=0,this.m_warmStarting=!0,this.m_continuousPhysics=!0,this.m_allowSleep=e,this.m_gravity=t,this.m_inv_dt0=0,this.m_groundBody=this.CreateBody(new Box2D.Dynamics.b2BodyDef)},Box2D.Dynamics.b2World.MAX_TOI=1-100*Number.MIN_VALUE,Box2D.Dynamics.b2World.prototype.SetDestructionListener=function(t){this.m_destructionListener=t},Box2D.Dynamics.b2World.prototype.SetContactFilter=function(t){this.m_contactManager.m_contactFilter=t},Box2D.Dynamics.b2World.prototype.SetContactListener=function(t){this.m_contactManager.m_contactListener=t},Box2D.Dynamics.b2World.prototype.SetBroadPhase=function(t){var e=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=t;for(var i=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);i;i=i.GetNextNode())for(var o=i.body.GetFixtureList().GetFirstNode();o;o=o.GetNextNode()){var s=o.fixture;s.m_proxy=t.CreateProxy(e.GetFatAABB(s.m_proxy),s)}},Box2D.Dynamics.b2World.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},Box2D.Dynamics.b2World.prototype.CreateBody=function(t){var e=new Box2D.Dynamics.b2Body(t,this);return this.bodyList.AddBody(e),e},Box2D.Dynamics.b2World.prototype.DestroyBody=function(t){for(var e=t.m_jointList;e;){var i=e;e=e.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(i.joint),this.DestroyJoint(i.joint)}for(var o=t.GetControllerList().GetFirstNode();o;o=o.GetNextNode())o.controller.RemoveBody(t);for(var s=t.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);s;s=s.GetNextNode())this.m_contactManager.Destroy(s.contact);for(var n=t.GetFixtureList().GetFirstNode();n;n=n.GetNextNode())this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(n.fixture),t.DestroyFixture(n.fixture);t.Destroy(),this.bodyList.RemoveBody(t)},Box2D.Dynamics.b2World.prototype.CreateJoint=function(t){var e=Box2D.Dynamics.Joints.b2Joint.Create(t);e.m_prev=null,e.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=e),this.m_jointList=e,this.m_jointCount++,e.m_edgeA.joint=e,e.m_edgeA.other=e.m_bodyB,e.m_edgeA.prev=null,e.m_edgeA.next=e.m_bodyA.m_jointList,e.m_bodyA.m_jointList&&(e.m_bodyA.m_jointList.prev=e.m_edgeA),e.m_bodyA.m_jointList=e.m_edgeA,e.m_edgeB.joint=e,e.m_edgeB.other=e.m_bodyA,e.m_edgeB.prev=null,e.m_edgeB.next=e.m_bodyB.m_jointList,e.m_bodyB.m_jointList&&(e.m_bodyB.m_jointList.prev=e.m_edgeB),e.m_bodyB.m_jointList=e.m_edgeB;var i=t.bodyA,o=t.bodyB;if(!t.collideConnected)for(var s=o.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);s;s=s.GetNextNode())s.contact.GetOther(o)==i&&s.contact.FlagForFiltering();return e},Box2D.Dynamics.b2World.prototype.DestroyJoint=function(t){var e=t.m_collideConnected;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var i=t.m_bodyA,o=t.m_bodyB;if(i.SetAwake(!0),o.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA==i.m_jointList&&(i.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB==o.m_jointList&&(o.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,this.m_jointCount--,!e)for(var s=o.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);s;s=s.GetNextNode())s.contact.GetOther(o)==i&&s.contact.FlagForFiltering()},Box2D.Dynamics.b2World.prototype.GetControllerList=function(){return this.controllerList},Box2D.Dynamics.b2World.prototype.AddController=function(t){if(null!==t.m_world&&t.m_world!=this)throw new Error("Controller can only be a member of one world");return this.controllerList.AddController(t),t.m_world=this,t},Box2D.Dynamics.b2World.prototype.RemoveController=function(t){this.controllerList.RemoveController(t),t.m_world=null,t.Clear()},Box2D.Dynamics.b2World.prototype.CreateController=function(t){return this.AddController(t)},Box2D.Dynamics.b2World.prototype.DestroyController=function(t){this.RemoveController(t)},Box2D.Dynamics.b2World.prototype.SetWarmStarting=function(t){this.m_warmStarting=t},Box2D.Dynamics.b2World.prototype.SetContinuousPhysics=function(t){this.m_continuousPhysics=t},Box2D.Dynamics.b2World.prototype.GetBodyCount=function(){return this.bodyList.GetBodyCount()},Box2D.Dynamics.b2World.prototype.GetJointCount=function(){return this.m_jointCount},Box2D.Dynamics.b2World.prototype.GetContactCount=function(){return this.contactList.GetContactCount()},Box2D.Dynamics.b2World.prototype.SetGravity=function(t){this.m_gravity=t},Box2D.Dynamics.b2World.prototype.GetGravity=function(){return this.m_gravity},Box2D.Dynamics.b2World.prototype.GetGroundBody=function(){return this.m_groundBody},Box2D.Dynamics.b2World.prototype.Step=function(t,e,i){this.m_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_newFixture=!1),this.m_isLocked=!0;var o=new Box2D.Dynamics.b2TimeStep(t,this.m_inv_dt0*t,e,i,this.m_warmStarting);this.m_contactManager.Collide(),o.dt>0&&(this.Solve(o),this.m_continuousPhysics&&this.SolveTOI(o),this.m_inv_dt0=o.inv_dt),this.m_isLocked=!1},Box2D.Dynamics.b2World.prototype.ClearForces=function(){for(var t=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.dynamicBodies);t;t=t.GetNextNode())t.body.m_force.SetZero(),t.body.m_torque=0},Box2D.Dynamics.b2World.prototype.QueryAABB=function(t,e){this.m_contactManager.m_broadPhase.Query(t,e)},Box2D.Dynamics.b2World.prototype.QueryPoint=function(t,e){var i=Box2D.Collision.b2AABB.Get();i.lowerBound_.Set(e.x-Box2D.Common.b2Settings.b2_linearSlop,e.y-Box2D.Common.b2Settings.b2_linearSlop),i.upperBound_.Set(e.x+Box2D.Common.b2Settings.b2_linearSlop,e.y+Box2D.Common.b2Settings.b2_linearSlop),this.m_contactManager.m_broadPhase.Query(function(i){return!i.TestPoint(e)||t(i)},i),Box2D.Collision.b2AABB.Free(i)},Box2D.Dynamics.b2World.prototype.RayCast=function(t,e,i){var o=this.m_contactManager.m_broadPhase,s=new Box2D.Collision.b2RayCastOutput,n=new Box2D.Collision.b2RayCastInput(e,i,1);o.RayCast(function(o,n){if(n.RayCast(s,o)){var r=1-s.fraction,a=Box2D.Common.Math.b2Vec2.Get(r*e.x+s.fraction*i.x,r*e.y+s.fraction*i.y),h=t(n,a,s.normal,s.fraction);return Box2D.Common.Math.b2Vec2.Free(a),h}return o.maxFraction},n)},Box2D.Dynamics.b2World.prototype.RayCastOne=function(t,e){var i=null;return this.RayCast(function(t,e,o,s){return i=t,s},t,e),i},Box2D.Dynamics.b2World.prototype.RayCastAll=function(t,e){var i=[];return this.RayCast(function(t,e,o,s){return i.push(t),1},t,e),i},Box2D.Dynamics.b2World.prototype.GetBodyList=function(){return this.bodyList},Box2D.Dynamics.b2World.prototype.GetJointList=function(){return this.m_jointList},Box2D.Dynamics.b2World.prototype.GetContactList=function(){return this.contactList},Box2D.Dynamics.b2World.prototype.IsLocked=function(){return this.m_isLocked};var b2solvearray=[];Box2D.Dynamics.b2World.prototype.Solve=function(t){for(var e=this.controllerList.GetFirstNode();e;e=e.GetNextNode())e.controller.Step(t);for(var i=new Box2D.Dynamics.b2Island(this.m_contactManager.m_contactListener,this.m_contactSolver),o=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);o;o=o.GetNextNode())o.body.m_islandFlag=!1;for(var s=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);s;s=s.GetNextNode())s.contact.m_islandFlag=!1;for(var n=this.m_jointList;n;n=n.m_next)n.m_islandFlag=!1;for(o=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.nonStaticActiveAwakeBodies);o;o=o.GetNextNode()){var r=o.body;if(!r.m_islandFlag){i.Clear(),b2solvearray.length=0;var a=b2solvearray;for(a.push(r),r.m_islandFlag=!0;a.length>0;){var h=a.pop();if(i.AddBody(h),h.IsAwake()||h.SetAwake(!0),h.GetType()!=Box2D.Dynamics.b2BodyDef.b2_staticBody){for(s=h.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledTouchingContacts);s;s=s.GetNextNode()){var c=s.contact;if(!c.m_islandFlag){i.AddContact(c),c.m_islandFlag=!0;var l=c.GetOther(h);l.m_islandFlag||(a.push(l),l.m_islandFlag=!0)}}for(var m=h.m_jointList;m;m=m.next)!m.joint.m_islandFlag&&m.other.IsActive()&&(i.AddJoint(m.joint),m.joint.m_islandFlag=!0,m.other.m_islandFlag||(a.push(m.other),m.other.m_islandFlag=!0))}}i.Solve(t,this.m_gravity,this.m_allowSleep)}}for(o=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.nonStaticActiveAwakeBodies);o;o=o.GetNextNode())o.body.SynchronizeFixtures();this.m_contactManager.FindNewContacts()},Box2D.Dynamics.b2World.prototype.SolveTOI=function(t){for(var e=new Box2D.Dynamics.b2Island(this.m_contactManager.m_contactListener,this.m_contactSolver),i=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);i;i=i.GetNextNode()){(u=i.body).m_islandFlag=!1,u.m_sweep.t0=0}for(var o=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);o;o=o.GetNextNode())o.contact.m_islandFlag=!1,o.contact.m_toi=null;for(var s=this.m_jointList;s;s=s.m_next)s.m_islandFlag=!1;for(;;){var n=this._SolveTOI2(t),r=n.minContact,a=n.minTOI;if(null===r||Box2D.Dynamics.b2World.MAX_TOI<a)break;var h=r.m_fixtureA.GetBody(),c=r.m_fixtureB.GetBody();if(Box2D.Dynamics.b2World.s_backupA.Set(h.m_sweep),Box2D.Dynamics.b2World.s_backupB.Set(c.m_sweep),h.Advance(a),c.Advance(a),r.Update(this.m_contactManager.m_contactListener),r.m_toi=null,!r.sensor&&r.enabled){if(r.touching){var l=h;l.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&(l=c),e.Clear(),b2solvearray.length=0;var m=b2solvearray;for(m.push(l),l.m_islandFlag=!0;m.length>0;){var u=m.pop();if(e.AddBody(u),u.IsAwake()||u.SetAwake(!0),u.GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody){for(o=u.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledTouchingContacts);o&&e.m_contactCount!=Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland;o=o.GetNextNode()){var p=o.contact;if(!p.m_islandFlag){e.AddContact(p),p.m_islandFlag=!0;var d=p.GetOther(u);d.m_islandFlag||(d.GetType()!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&(d.Advance(a),d.SetAwake(!0),m.push(d)),d.m_islandFlag=!0)}}for(var y=u.m_jointList;y;y=y.next)e.m_jointCount!=Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland&&!y.joint.m_islandFlag&&y.other.IsActive()&&(e.AddJoint(y.joint),y.joint.m_islandFlag=!0,y.other.m_islandFlag||(y.other.GetType()!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&(y.other.Advance(a),y.other.SetAwake(!0),m.push(y.other)),y.other.m_islandFlag=!0))}}e.SolveTOI(new Box2D.Dynamics.b2TimeStep((1-a)*t.dt,0,t.velocityIterations,t.positionIterations,!1));for(var _=0;_<e.m_bodies.length;_++)if(e.m_bodies[_].m_islandFlag=!1,e.m_bodies[_].IsAwake()&&e.m_bodies[_].GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody){e.m_bodies[_].SynchronizeFixtures();for(o=e.m_bodies[_].contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);o;o=o.GetNextNode())o.contact.m_toi=null}for(_=0;_<e.m_contactCount;_++)e.m_contacts[_].m_islandFlag=!1,e.m_contacts[_].m_toi=null;for(_=0;_<e.m_jointCount;_++)e.m_joints[_].m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}else h.m_sweep.Set(Box2D.Dynamics.b2World.s_backupA),c.m_sweep.Set(Box2D.Dynamics.b2World.s_backupB),h.SynchronizeTransform(),c.SynchronizeTransform()}},Box2D.Dynamics.b2World.prototype._SolveTOI2=function(t){for(var e=null,i=1,o=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledContinuousContacts);o;o=o.GetNextNode()){var s=o.contact;if(!this._SolveTOI2SkipContact(t,s)){var n=1;if(null!=s.m_toi)n=s.m_toi;else if(s.touching)n=1,s.m_toi=n;else{var r=s.m_fixtureA.GetBody(),a=s.m_fixtureB.GetBody(),h=r.m_sweep.t0;r.m_sweep.t0<a.m_sweep.t0?(h=a.m_sweep.t0,r.m_sweep.Advance(h)):a.m_sweep.t0<r.m_sweep.t0&&(h=r.m_sweep.t0,a.m_sweep.Advance(h)),(n=s.ComputeTOI(r.m_sweep,a.m_sweep))>0&&n<1&&(n=(1-n)*h+n),s.m_toi=n}Number.MIN_VALUE<n&&n<i&&(e=s,i=n)}}return{minContact:e,minTOI:i}},Box2D.Dynamics.b2World.prototype._SolveTOI2SkipContact=function(t,e){var i=e.m_fixtureA.GetBody(),o=e.m_fixtureB.GetBody();return!(i.GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&i.IsAwake()||o.GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&o.IsAwake())},Box2D.Dynamics.Contacts.b2Contact=function(t,e){this.ID="Contact"+Box2D.Dynamics.Contacts.b2Contact.NEXT_ID++,this.m_manifold=new Box2D.Collision.b2Manifold,this.m_oldManifold=new Box2D.Collision.b2Manifold,this.touching=!1;var i=t.GetBody(),o=e.GetBody();this.continuous=i.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||i.IsBullet()||o.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||o.IsBullet(),this.sensor=t.IsSensor()||e.IsSensor(),this.filtering=!1,this.m_fixtureA=t,this.m_fixtureB=e,this.enabled=!0,this.bodyAList=i.GetContactList(),this.bodyBList=o.GetContactList(),this.worldList=o.GetWorld().GetContactList(),this.AddToLists()},Box2D.Dynamics.Contacts.b2Contact.prototype.Reset=function(t,e){this.m_manifold.Reset(),this.m_oldManifold.Reset(),this.touching=!1;var i=t.GetBody(),o=e.GetBody();this.continuous=i.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||i.IsBullet()||o.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||o.IsBullet(),this.sensor=t.IsSensor()||e.IsSensor(),this.filtering=!1,this.m_fixtureA=t,this.m_fixtureB=e,this.enabled=!0,this.bodyAList=i.GetContactList(),this.bodyBList=o.GetContactList(),this.worldList=o.GetWorld().GetContactList(),this.AddToLists()},Box2D.Dynamics.Contacts.b2Contact.prototype.AddToLists=function(){this.bodyAList.AddContact(this),this.bodyBList.AddContact(this),this.worldList.AddContact(this),this.UpdateLists()},Box2D.Dynamics.Contacts.b2Contact.prototype.UpdateLists=function(){var t=!1,e=!1;!this.IsSensor()&&this.IsEnabled()&&(this.IsTouching()&&(t=!0),this.IsContinuous()&&(e=!0)),this.bodyAList.UpdateContact(this,t,e),this.bodyBList.UpdateContact(this,t,e),this.worldList.UpdateContact(this,t,e)},Box2D.Dynamics.Contacts.b2Contact.prototype.RemoveFromLists=function(){this.bodyAList.RemoveContact(this),this.bodyBList.RemoveContact(this),this.worldList.RemoveContact(this)},Box2D.Dynamics.Contacts.b2Contact.prototype.GetManifold=function(){return this.m_manifold},Box2D.Dynamics.Contacts.b2Contact.prototype.GetWorldManifold=function(t){var e=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody(),o=this.m_fixtureA.GetShape(),s=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,e.GetTransform(),o.m_radius,i.GetTransform(),s.m_radius)},Box2D.Dynamics.Contacts.b2Contact.prototype.IsTouching=function(){return this.touching},Box2D.Dynamics.Contacts.b2Contact.prototype.IsContinuous=function(){return this.continuous},Box2D.Dynamics.Contacts.b2Contact.prototype.SetSensor=function(t){this.sensor=t,this.UpdateLists()},Box2D.Dynamics.Contacts.b2Contact.prototype.IsSensor=function(){return this.sensor},Box2D.Dynamics.Contacts.b2Contact.prototype.SetEnabled=function(t){this.enabled=t,this.UpdateLists()},Box2D.Dynamics.Contacts.b2Contact.prototype.IsEnabled=function(){return this.enabled},Box2D.Dynamics.Contacts.b2Contact.prototype.GetNext=function(){return this.m_next},Box2D.Dynamics.Contacts.b2Contact.prototype.GetFixtureA=function(){return this.m_fixtureA},Box2D.Dynamics.Contacts.b2Contact.prototype.GetFixtureB=function(){return this.m_fixtureB},Box2D.Dynamics.Contacts.b2Contact.prototype.GetOther=function(t){var e=this.m_fixtureA.GetBody();return e!=t?e:this.m_fixtureB.GetBody()},Box2D.Dynamics.Contacts.b2Contact.prototype.FlagForFiltering=function(){this.filtering=!0},Box2D.Dynamics.Contacts.b2Contact.prototype.ClearFiltering=function(){this.filtering=!1},Box2D.Dynamics.Contacts.b2Contact.prototype.IsFiltering=function(){return this.filtering},Box2D.Dynamics.Contacts.b2Contact.prototype.Update=function(t){var e=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=e,this.enabled=!0;var i=!1,o=this.IsTouching(),s=this.m_fixtureA.GetBody(),n=this.m_fixtureB.GetBody(),r=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.sensor)r&&(i=Box2D.Collision.Shapes.b2Shape.TestOverlap(this.m_fixtureA.GetShape(),s.GetTransform(),this.m_fixtureB.GetShape(),n.GetTransform())),this.m_manifold.m_pointCount=0;else{if(s.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||s.IsBullet()||n.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||n.IsBullet()?this.continuous=!0:this.continuous=!1,r){this.Evaluate(),i=this.m_manifold.m_pointCount>0;for(var a=0;a<this.m_manifold.m_pointCount;a++){var h=this.m_manifold.m_points[a];h.m_normalImpulse=0,h.m_tangentImpulse=0;for(var c=0;c<this.m_oldManifold.m_pointCount;c++){var l=this.m_oldManifold.m_points[c];if(l.m_id.GetKey()==h.m_id.GetKey()){h.m_normalImpulse=l.m_normalImpulse,h.m_tangentImpulse=l.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;i!=o&&(s.SetAwake(!0),n.SetAwake(!0))}this.touching=i,i!=o&&this.UpdateLists(),!o&&i&&t.BeginContact(this),o&&!i&&t.EndContact(this),this.sensor||t.PreSolve(this,this.m_oldManifold)},Box2D.Dynamics.Contacts.b2Contact.prototype.Evaluate=function(){},Box2D.Dynamics.Contacts.b2Contact.prototype.ComputeTOI=function(t,e){return Box2D.Dynamics.Contacts.b2Contact.s_input.proxyA.Set(this.m_fixtureA.GetShape()),Box2D.Dynamics.Contacts.b2Contact.s_input.proxyB.Set(this.m_fixtureB.GetShape()),Box2D.Dynamics.Contacts.b2Contact.s_input.sweepA=t,Box2D.Dynamics.Contacts.b2Contact.s_input.sweepB=e,Box2D.Dynamics.Contacts.b2Contact.s_input.tolerance=Box2D.Common.b2Settings.b2_linearSlop,Box2D.Collision.b2TimeOfImpact.TimeOfImpact(Box2D.Dynamics.Contacts.b2Contact.s_input)},Box2D.Dynamics.Contacts.b2Contact.s_input=new Box2D.Collision.b2TOIInput,Box2D.Dynamics.Contacts.b2Contact.NEXT_ID=0,Box2D.Dynamics.Contacts.b2CircleContact=function(t,e){Box2D.Dynamics.Contacts.b2Contact.call(this,t,e)},c2inherit(Box2D.Dynamics.Contacts.b2CircleContact,Box2D.Dynamics.Contacts.b2Contact),Box2D.Dynamics.Contacts.b2CircleContact.prototype.Reset=function(t,e){Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,t,e)},Box2D.Dynamics.Contacts.b2CircleContact.prototype.Evaluate=function(){Box2D.Collision.b2Collision.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape(),this.m_fixtureA.GetBody().m_xf,this.m_fixtureB.GetShape(),this.m_fixtureB.GetBody().m_xf)},Box2D.Dynamics.Contacts.b2ContactConstraint=function(){this.localPlaneNormal=Box2D.Common.Math.b2Vec2.Get(0,0),this.localPoint=Box2D.Common.Math.b2Vec2.Get(0,0),this.normal=Box2D.Common.Math.b2Vec2.Get(0,0),this.normalMass=new Box2D.Common.Math.b2Mat22,this.K=new Box2D.Common.Math.b2Mat22,this.points=[];for(var t=0;t<Box2D.Common.b2Settings.b2_maxManifoldPoints;t++)this.points[t]=new Box2D.Dynamics.Contacts.b2ContactConstraintPoint},Box2D.Dynamics.Contacts.b2ContactConstraintPoint=function(){this.localPoint=Box2D.Common.Math.b2Vec2.Get(0,0),this.rA=Box2D.Common.Math.b2Vec2.Get(0,0),this.rB=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Dynamics.Contacts.b2ContactConstraintPoint.prototype.Reset=function(){this.localPoint.Set(0,0),this.rA.Set(0,0),this.rB.Set(0,0)},Box2D.Dynamics.Contacts.b2ContactFactory=function(){this.m_registers={},this.m_freeContacts={},this.AddType(Box2D.Dynamics.Contacts.b2CircleContact,Box2D.Collision.Shapes.b2CircleShape.NAME,Box2D.Collision.Shapes.b2CircleShape.NAME),this.AddType(Box2D.Dynamics.Contacts.b2PolyAndCircleContact,Box2D.Collision.Shapes.b2PolygonShape.NAME,Box2D.Collision.Shapes.b2CircleShape.NAME),this.AddType(Box2D.Dynamics.Contacts.b2PolygonContact,Box2D.Collision.Shapes.b2PolygonShape.NAME,Box2D.Collision.Shapes.b2PolygonShape.NAME),this.AddType(Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,Box2D.Collision.Shapes.b2EdgeShape.NAME,Box2D.Collision.Shapes.b2CircleShape.NAME),this.AddType(Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,Box2D.Collision.Shapes.b2PolygonShape.NAME,Box2D.Collision.Shapes.b2EdgeShape.NAME)},Box2D.Dynamics.Contacts.b2ContactFactory.prototype.AddType=function(t,e,i){this.m_freeContacts[e]=this.m_freeContacts[e]||{},this.m_freeContacts[e][i]=this.m_freeContacts[e][i]||[],this.m_registers[e]=this.m_registers[e]||{},this.m_registers[e][i]=new Box2D.Dynamics.Contacts.b2ContactRegister,this.m_registers[e][i].ctor=t,this.m_registers[e][i].primary=!0,e!=i&&(this.m_registers[i]=this.m_registers[i]||{},this.m_registers[i][e]=new Box2D.Dynamics.Contacts.b2ContactRegister,this.m_registers[i][e].ctor=t,this.m_registers[i][e].primary=!1)},Box2D.Dynamics.Contacts.b2ContactFactory.prototype.Create=function(t,e){var i,o=t.GetShape().GetTypeName(),s=e.GetShape().GetTypeName(),n=this.m_registers[o][s],r=n.ctor;return null!=r?n.primary?this.m_freeContacts[o][s].length>0?((i=this.m_freeContacts[o][s].pop()).Reset(t,e),i):new r(t,e):this.m_freeContacts[s][o].length>0?((i=this.m_freeContacts[s][o].pop()).Reset(e,t),i):new r(e,t):null},Box2D.Dynamics.Contacts.b2ContactFactory.prototype.Destroy=function(t){var e=t.m_fixtureA.GetShape().GetTypeName(),i=t.m_fixtureB.GetShape().GetTypeName();this.m_freeContacts[e][i].push(t)},Box2D.Dynamics.Contacts.b2ContactList=function(){this.contactFirstNodes=[];for(var t=0;t<=Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts;t++)this.contactFirstNodes[t]=null;this.contactLastNodes=[];for(t=0;t<=Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts;t++)this.contactLastNodes[t]=null;this.contactNodeLookup={},this.contactCount=0},Box2D.Dynamics.Contacts.b2ContactList.prototype.GetFirstNode=function(t){return this.contactFirstNodes[t]},Box2D.Dynamics.Contacts.b2ContactList.prototype.AddContact=function(t){var e=t.ID;if(null==this.contactNodeLookup[e]){this.contactNodeLookup[e]=[];for(var i=0;i<=Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts;i++)this.contactNodeLookup[e][i]=null;this.CreateNode(t,e,Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts),this.contactCount++}},Box2D.Dynamics.Contacts.b2ContactList.prototype.UpdateContact=function(t,e,i){e?this.CreateNode(t,t.ID,Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledTouchingContacts):this.RemoveNode(t.ID,Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledTouchingContacts),i?this.CreateNode(t,t.ID,Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledContinuousContacts):this.RemoveNode(t.ID,Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledContinuousContacts)},Box2D.Dynamics.Contacts.b2ContactList.prototype.RemoveContact=function(t){var e=t.ID;if(null!=this.contactNodeLookup[e]){for(var i=0;i<=Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts;i++)this.RemoveNode(e,i);delete this.contactNodeLookup[e],this.contactCount--}},Box2D.Dynamics.Contacts.b2ContactList.prototype.RemoveNode=function(t,e){var i=this.contactNodeLookup[t];if(null!=i){var o=i[e];if(null!=o){i[e]=null;var s=o.GetPreviousNode(),n=o.GetNextNode();null==s?this.contactFirstNodes[e]=n:s.SetNextNode(n),null==n?this.contactLastNodes[e]=s:n.SetPreviousNode(s),Box2D.Dynamics.Contacts.b2ContactListNode.FreeNode(o)}}},Box2D.Dynamics.Contacts.b2ContactList.prototype.CreateNode=function(t,e,i){var o=this.contactNodeLookup[e];if(null==o[i]){o[i]=Box2D.Dynamics.Contacts.b2ContactListNode.GetNode(t);var s=this.contactLastNodes[i];null!=s?(s.SetNextNode(o[i]),o[i].SetPreviousNode(s)):this.contactFirstNodes[i]=o[i],this.contactLastNodes[i]=o[i]}},Box2D.Dynamics.Contacts.b2ContactList.prototype.GetContactCount=function(){return this.contactCount},Box2D.Dynamics.Contacts.b2ContactList.TYPES={nonSensorEnabledTouchingContacts:0,nonSensorEnabledContinuousContacts:1,allContacts:2},Box2D.Dynamics.Contacts.b2ContactListNode=function(t){this.contact=t,this.next=null,this.previous=null},Box2D.Dynamics.Contacts.b2ContactListNode.freeNodes=[],Box2D.Dynamics.Contacts.b2ContactListNode.GetNode=function(t){if(Box2D.Dynamics.Contacts.b2ContactListNode.freeNodes.length>0){var e=Box2D.Dynamics.Contacts.b2ContactListNode.freeNodes.pop();return e.next=null,e.previous=null,e.contact=t,e}return new Box2D.Dynamics.Contacts.b2ContactListNode(t)},Box2D.Dynamics.Contacts.b2ContactListNode.FreeNode=function(t){Box2D.Dynamics.Contacts.b2ContactListNode.freeNodes.push(t)},Box2D.Dynamics.Contacts.b2ContactListNode.prototype.SetNextNode=function(t){this.next=t},Box2D.Dynamics.Contacts.b2ContactListNode.prototype.SetPreviousNode=function(t){this.previous=t},Box2D.Dynamics.Contacts.b2ContactListNode.prototype.GetContact=function(){return this.contact},Box2D.Dynamics.Contacts.b2ContactListNode.prototype.GetNextNode=function(){return this.next},Box2D.Dynamics.Contacts.b2ContactListNode.prototype.GetPreviousNode=function(){return this.previous},Box2D.Dynamics.Contacts.b2ContactRegister=function(){this.pool=null,this.poolCount=0},Box2D.Dynamics.Contacts.b2PositionSolverManifold=function(){this.m_normal=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_separations=[],this.m_points=[];for(var t=0;t<Box2D.Common.b2Settings.b2_maxManifoldPoints;t++)this.m_points[t]=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Dynamics.Contacts.b2PositionSolverManifold.prototype.Initialize=function(t){switch(t.type){case Box2D.Collision.b2Manifold.e_circles:this._InitializeCircles(t);break;case Box2D.Collision.b2Manifold.e_faceA:this._InitializeFaceA(t);break;case Box2D.Collision.b2Manifold.e_faceB:this._InitializeFaceB(t)}},Box2D.Dynamics.Contacts.b2PositionSolverManifold.prototype._InitializeCircles=function(t){var e=t.bodyA.m_xf.R,i=t.localPoint,o=t.bodyA.m_xf.position.x+(e.col1.x*i.x+e.col2.x*i.y),s=t.bodyA.m_xf.position.y+(e.col1.y*i.x+e.col2.y*i.y);e=t.bodyB.m_xf.R,i=t.points[0].localPoint;var n=t.bodyB.m_xf.position.x+(e.col1.x*i.x+e.col2.x*i.y),r=t.bodyB.m_xf.position.y+(e.col1.y*i.x+e.col2.y*i.y),a=n-o,h=r-s,c=a*a+h*h;if(c>Box2D.Common.b2Settings.MIN_VALUE_SQUARED){var l=Math.sqrt(c);this.m_normal.x=a/l,this.m_normal.y=h/l}else this.m_normal.x=1,this.m_normal.y=0;this.m_points[0].x=.5*(o+n),this.m_points[0].y=.5*(s+r),this.m_separations[0]=a*this.m_normal.x+h*this.m_normal.y-t.radius},Box2D.Dynamics.Contacts.b2PositionSolverManifold.prototype._InitializeFaceA=function(t){this.m_normal.x=t.bodyA.m_xf.R.col1.x*t.localPlaneNormal.x+t.bodyA.m_xf.R.col2.x*t.localPlaneNormal.y,this.m_normal.y=t.bodyA.m_xf.R.col1.y*t.localPlaneNormal.x+t.bodyA.m_xf.R.col2.y*t.localPlaneNormal.y;for(var e=t.bodyA.m_xf.position.x+(t.bodyA.m_xf.R.col1.x*t.localPoint.x+t.bodyA.m_xf.R.col2.x*t.localPoint.y),i=t.bodyA.m_xf.position.y+(t.bodyA.m_xf.R.col1.y*t.localPoint.x+t.bodyA.m_xf.R.col2.y*t.localPoint.y),o=0;o<t.pointCount;o++){var s=t.bodyB.m_xf.position.x+(t.bodyB.m_xf.R.col1.x*t.points[o].localPoint.x+t.bodyB.m_xf.R.col2.x*t.points[o].localPoint.y),n=t.bodyB.m_xf.position.y+(t.bodyB.m_xf.R.col1.y*t.points[o].localPoint.x+t.bodyB.m_xf.R.col2.y*t.points[o].localPoint.y);this.m_separations[o]=(s-e)*this.m_normal.x+(n-i)*this.m_normal.y-t.radius,this.m_points[o].x=s,this.m_points[o].y=n}},Box2D.Dynamics.Contacts.b2PositionSolverManifold.prototype._InitializeFaceB=function(t){this.m_normal.x=t.bodyB.m_xf.R.col1.x*t.localPlaneNormal.x+t.bodyB.m_xf.R.col2.x*t.localPlaneNormal.y,this.m_normal.y=t.bodyB.m_xf.R.col1.y*t.localPlaneNormal.x+t.bodyB.m_xf.R.col2.y*t.localPlaneNormal.y;for(var e=t.bodyB.m_xf.position.x+(t.bodyB.m_xf.R.col1.x*t.localPoint.x+t.bodyB.m_xf.R.col2.x*t.localPoint.y),i=t.bodyB.m_xf.position.y+(t.bodyB.m_xf.R.col1.y*t.localPoint.x+t.bodyB.m_xf.R.col2.y*t.localPoint.y),o=0;o<t.pointCount;o++){var s=t.bodyA.m_xf.position.x+(t.bodyA.m_xf.R.col1.x*t.points[o].localPoint.x+t.bodyA.m_xf.R.col2.x*t.points[o].localPoint.y),n=t.bodyA.m_xf.position.y+(t.bodyA.m_xf.R.col1.y*t.points[o].localPoint.x+t.bodyA.m_xf.R.col2.y*t.points[o].localPoint.y);this.m_separations[o]=(s-e)*this.m_normal.x+(n-i)*this.m_normal.y-t.radius,this.m_points[o].Set(s,n)}this.m_normal.x*=-1,this.m_normal.y*=-1},Box2D.Dynamics.Contacts.b2ContactSolver=function(){this.m_constraints=[]},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.Initialize=function(t,e,i){for(this.m_constraintCount=i;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new Box2D.Dynamics.Contacts.b2ContactConstraint;for(var o=0;o<i;o++){var s=e[o],n=s.m_fixtureA,r=s.m_fixtureB,a=n.m_shape,h=r.m_shape,c=a.m_radius,l=h.m_radius,m=n.GetBody(),u=r.GetBody(),p=s.GetManifold(),d=Box2D.Common.b2Settings.b2MixFriction(n.GetFriction(),r.GetFriction()),y=Box2D.Common.b2Settings.b2MixRestitution(n.GetRestitution(),r.GetRestitution()),_=m.m_linearVelocity.x,f=m.m_linearVelocity.y,x=u.m_linearVelocity.x,g=u.m_linearVelocity.y,b=m.m_angularVelocity,v=u.m_angularVelocity;Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.Initialize(p,m.m_xf,c,u.m_xf,l);var B=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_normal.x,D=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_normal.y,w=this.m_constraints[o];w.bodyA=m,w.bodyB=u,w.manifold=p,w.normal.x=B,w.normal.y=D,w.pointCount=p.m_pointCount,w.friction=d,w.restitution=y,w.localPlaneNormal.x=p.m_localPlaneNormal.x,w.localPlaneNormal.y=p.m_localPlaneNormal.y,w.localPoint.x=p.m_localPoint.x,w.localPoint.y=p.m_localPoint.y,w.radius=c+l,w.type=p.m_type;for(var C=0;C<w.pointCount;++C){var S=p.m_points[C],A=w.points[C];A.normalImpulse=S.m_normalImpulse,A.tangentImpulse=S.m_tangentImpulse,A.localPoint.SetV(S.m_localPoint);var M=A.rA.x=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_points[C].x-m.m_sweep.c.x,T=A.rA.y=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_points[C].y-m.m_sweep.c.y,I=A.rB.x=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_points[C].x-u.m_sweep.c.x,P=A.rB.y=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_points[C].y-u.m_sweep.c.y,L=M*D-T*B,V=I*D-P*B;L*=L,V*=V;var R=m.m_invMass+u.m_invMass+m.m_invI*L+u.m_invI*V;A.normalMass=1/R;var O=m.m_mass*m.m_invMass+u.m_mass*u.m_invMass;O+=m.m_mass*m.m_invI*L+u.m_mass*u.m_invI*V,A.equalizedMass=1/O;var k=-B,E=M*k-T*D,N=I*k-P*D;E*=E,N*=N;var F=m.m_invMass+u.m_invMass+m.m_invI*E+u.m_invI*N;A.tangentMass=1/F,A.velocityBias=0;var G=x+-v*P-_- -b*T,J=g+v*I-f-b*M,j=w.normal.x*G+w.normal.y*J;j<-Box2D.Common.b2Settings.b2_velocityThreshold&&(A.velocityBias+=-w.restitution*j)}if(2==w.pointCount){var z=w.points[0],W=w.points[1],U=m.m_invMass,q=m.m_invI,X=u.m_invMass,Y=u.m_invI,K=z.rA.x*D-z.rA.y*B,H=z.rB.x*D-z.rB.y*B,Z=W.rA.x*D-W.rA.y*B,Q=W.rB.x*D-W.rB.y*B,$=U+X+q*K*K+Y*H*H,tt=U+X+q*Z*Z+Y*Q*Q,et=U+X+q*K*Z+Y*H*Q;$*$<100*($*tt-et*et)?(w.K.col1.Set($,et),w.K.col2.Set(et,tt),w.K.GetInverse(w.normalMass)):w.pointCount=1}}},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.InitVelocityConstraints=function(t){for(var e=0;e<this.m_constraintCount;++e){var i=this.m_constraints[e],o=i.bodyA,s=i.bodyB,n=o.m_invMass,r=o.m_invI,a=s.m_invMass,h=s.m_invI,c=i.normal.x,l=i.normal.y,m=l,u=-c,p=0,d=0;if(t.warmStarting)for(d=i.pointCount,p=0;p<d;++p){var y=i.points[p];y.normalImpulse*=t.dtRatio,y.tangentImpulse*=t.dtRatio;var _=y.normalImpulse*c+y.tangentImpulse*m,f=y.normalImpulse*l+y.tangentImpulse*u;o.m_angularVelocity-=r*(y.rA.x*f-y.rA.y*_),o.m_linearVelocity.x-=n*_,o.m_linearVelocity.y-=n*f,s.m_angularVelocity+=h*(y.rB.x*f-y.rB.y*_),s.m_linearVelocity.x+=a*_,s.m_linearVelocity.y+=a*f}else for(d=i.pointCount,p=0;p<d;++p){var x=i.points[p];x.normalImpulse=0,x.tangentImpulse=0}}},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints=function(){for(var t=0;t<this.m_constraintCount;t++)this.SolveVelocityConstraints_Constraint(this.m_constraints[t])},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints_Constraint=function(t){for(var e=t.normal.x,i=t.normal.y,o=0;o<t.pointCount;o++)Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints_ConstraintPoint(t,t.points[o]);if(1==t.pointCount){var s=t.points[0],n=(t.bodyB.m_linearVelocity.x-t.bodyB.m_angularVelocity*s.rB.y-t.bodyA.m_linearVelocity.x+t.bodyA.m_angularVelocity*s.rA.y)*e+(t.bodyB.m_linearVelocity.y+t.bodyB.m_angularVelocity*s.rB.x-t.bodyA.m_linearVelocity.y-t.bodyA.m_angularVelocity*s.rA.x)*i,r=s.normalImpulse-s.normalMass*(n-s.velocityBias),a=(r=r>0?r:0)-s.normalImpulse,h=a*e,c=a*i;t.bodyA.m_linearVelocity.x-=t.bodyA.m_invMass*h,t.bodyA.m_linearVelocity.y-=t.bodyA.m_invMass*c,t.bodyA.m_angularVelocity-=t.bodyA.m_invI*(s.rA.x*c-s.rA.y*h),t.bodyB.m_linearVelocity.x+=t.bodyB.m_invMass*h,t.bodyB.m_linearVelocity.y+=t.bodyB.m_invMass*c,t.bodyB.m_angularVelocity+=t.bodyB.m_invI*(s.rB.x*c-s.rB.y*h),s.normalImpulse=r}else{var l=t.points[0],m=t.points[1],u=l.normalImpulse,p=m.normalImpulse,d=t.bodyB.m_linearVelocity.x-t.bodyB.m_angularVelocity*l.rB.y-t.bodyA.m_linearVelocity.x+t.bodyA.m_angularVelocity*l.rA.y,y=t.bodyB.m_linearVelocity.y+t.bodyB.m_angularVelocity*l.rB.x-t.bodyA.m_linearVelocity.y-t.bodyA.m_angularVelocity*l.rA.x,_=t.bodyB.m_linearVelocity.x-t.bodyB.m_angularVelocity*m.rB.y-t.bodyA.m_linearVelocity.x+t.bodyA.m_angularVelocity*m.rA.y,f=t.bodyB.m_linearVelocity.y+t.bodyB.m_angularVelocity*m.rB.x-t.bodyA.m_linearVelocity.y-t.bodyA.m_angularVelocity*m.rA.x,x=d*e+y*i-l.velocityBias,g=_*e+f*i-m.velocityBias;for(x-=t.K.col1.x*u+t.K.col2.x*p,g-=t.K.col1.y*u+t.K.col2.y*p;;){var b=-(t.normalMass.col1.x*x+t.normalMass.col2.x*g);if(b>=0){var v=-(t.normalMass.col1.y*x+t.normalMass.col2.y*g);if(v>=0){this.SolveVelocityConstraints_ConstraintPointUpdate(t,l,m,b-u,v-p),l.normalImpulse=b,m.normalImpulse=v;break}}var B=-l.normalMass*x;if(B>=0&&t.K.col1.y*B+g>=0){this.SolveVelocityConstraints_ConstraintPointUpdate(t,l,m,B-u,-p),l.normalImpulse=B,m.normalImpulse=0;break}var D=-m.normalMass*g;if(D>=0&&t.K.col2.x*D+x>=0){this.SolveVelocityConstraints_ConstraintPointUpdate(t,l,m,-u,D-p),l.normalImpulse=0,m.normalImpulse=D;break}if(x>=0&&g>=0){this.SolveVelocityConstraints_ConstraintPointUpdate(t,l,m,-u,-p),l.normalImpulse=0,m.normalImpulse=0;break}break}}},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints_ConstraintPoint=function(t,e){var i=t.normal.y,o=-t.normal.x,s=(t.bodyB.m_linearVelocity.x-t.bodyB.m_angularVelocity*e.rB.y-t.bodyA.m_linearVelocity.x+t.bodyA.m_angularVelocity*e.rA.y)*i+(t.bodyB.m_linearVelocity.y+t.bodyB.m_angularVelocity*e.rB.x-t.bodyA.m_linearVelocity.y-t.bodyA.m_angularVelocity*e.rA.x)*o,n=t.friction*e.normalImpulse,r=Box2D.Common.Math.b2Math.Clamp(e.tangentImpulse-e.tangentMass*s,-n,n),a=r-e.tangentImpulse,h=a*i,c=a*o;t.bodyA.m_linearVelocity.x-=t.bodyA.m_invMass*h,t.bodyA.m_linearVelocity.y-=t.bodyA.m_invMass*c,t.bodyA.m_angularVelocity-=t.bodyA.m_invI*(e.rA.x*c-e.rA.y*h),t.bodyB.m_linearVelocity.x+=t.bodyB.m_invMass*h,t.bodyB.m_linearVelocity.y+=t.bodyB.m_invMass*c,t.bodyB.m_angularVelocity+=t.bodyB.m_invI*(e.rB.x*c-e.rB.y*h),e.tangentImpulse=r},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints_ConstraintPointUpdate=function(t,e,i,o,s){var n=o*t.normal.x,r=o*t.normal.y,a=s*t.normal.x,h=s*t.normal.y;t.bodyA.m_linearVelocity.x-=t.bodyA.m_invMass*(n+a),t.bodyA.m_linearVelocity.y-=t.bodyA.m_invMass*(r+h),t.bodyA.m_angularVelocity-=t.bodyA.m_invI*(e.rA.x*r-e.rA.y*n+i.rA.x*h-i.rA.y*a),t.bodyB.m_linearVelocity.x+=t.bodyB.m_invMass*(n+a),t.bodyB.m_linearVelocity.y+=t.bodyB.m_invMass*(r+h),t.bodyB.m_angularVelocity+=t.bodyB.m_invI*(e.rB.x*r-e.rB.y*n+i.rB.x*h-i.rB.y*a),e.normalImpulse=0,i.normalImpulse=0},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.FinalizeVelocityConstraints=function(){for(var t=0;t<this.m_constraintCount;++t)for(var e=this.m_constraints[t],i=e.manifold,o=0;o<e.pointCount;++o){var s=i.m_points[o],n=e.points[o];s.m_normalImpulse=n.normalImpulse,s.m_tangentImpulse=n.tangentImpulse}},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolvePositionConstraints=function(t){void 0===t&&(t=0);for(var e=0,i=0;i<this.m_constraintCount;i++){var o=this.m_constraints[i],s=o.bodyA,n=o.bodyB,r=s.m_mass*s.m_invMass,a=s.m_mass*s.m_invI,h=n.m_mass*n.m_invMass,c=n.m_mass*n.m_invI;Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.Initialize(o);for(var l=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_normal,m=0;m<o.pointCount;m++){var u=o.points[m],p=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_points[m],d=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_separations[m],y=p.x-s.m_sweep.c.x,_=p.y-s.m_sweep.c.y,f=p.x-n.m_sweep.c.x,x=p.y-n.m_sweep.c.y;e=e<d?e:d;var g=Box2D.Common.Math.b2Math.Clamp(t*(d+Box2D.Common.b2Settings.b2_linearSlop),-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),b=-u.equalizedMass*g,v=b*l.x,B=b*l.y;s.m_sweep.c.x-=r*v,s.m_sweep.c.y-=r*B,s.m_sweep.a-=a*(y*B-_*v),s.SynchronizeTransform(),n.m_sweep.c.x+=h*v,n.m_sweep.c.y+=h*B,n.m_sweep.a+=c*(f*B-x*v),n.SynchronizeTransform()}}return e>-1.5*Box2D.Common.b2Settings.b2_linearSlop},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolvePositionConstraints_NEW=function(t){void 0===t&&(t=0);for(var e=0,i=0;i<this.m_constraintCount;i++){var o=this.m_constraints[i],s=o.bodyA,n=o.bodyB,r=s.m_mass*s.m_invMass,a=s.m_mass*s.m_invI,h=n.m_mass*n.m_invMass,c=n.m_mass*n.m_invI;Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.Initialize(o);for(var l=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_normal,m=0;m<o.pointCount;m++){var u=o.points[m],p=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_points[m],d=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_separations[m],y=p.x-s.m_sweep.c.x,_=p.y-s.m_sweep.c.y,f=p.x-n.m_sweep.c.x,x=p.y-n.m_sweep.c.y;d<e&&(e=d);0!=t&&Box2D.Common.Math.b2Math.Clamp(t*(d+Box2D.Common.b2Settings.b2_linearSlop),-Box2D.Common.b2Settings.b2_maxLinearCorrection,0);var g=0*-u.equalizedMass,b=g*l.x,v=g*l.y;s.m_sweep.c.x-=r*b,s.m_sweep.c.y-=r*v,s.m_sweep.a-=a*(y*v-_*b),s.SynchronizeTransform(),n.m_sweep.c.x+=h*b,n.m_sweep.c.y+=h*v,n.m_sweep.a+=c*(f*v-x*b),n.SynchronizeTransform()}}return e>-1.5*Box2D.Common.b2Settings.b2_linearSlop},Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=function(t,e){Box2D.Dynamics.Contacts.b2Contact.call(this,t,e)},c2inherit(Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,Box2D.Dynamics.Contacts.b2Contact),Box2D.Dynamics.Contacts.b2EdgeAndCircleContact.prototype.Reset=function(t,e){Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,t,e)},Box2D.Dynamics.Contacts.b2EdgeAndCircleContact.prototype.Evaluate=function(){this.m_fixtureA.GetBody(),this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape(),this.m_fixtureA.GetBody().m_xf,this.m_fixtureB.GetShape(),this.m_fixtureB.GetBody().m_xf)},Box2D.Dynamics.Contacts.b2EdgeAndCircleContact.prototype.b2CollideEdgeAndCircle=function(t,e,i,o,s){},Box2D.Dynamics.Contacts.b2PolyAndCircleContact=function(t,e){Box2D.Dynamics.Contacts.b2Contact.call(this,t,e)},c2inherit(Box2D.Dynamics.Contacts.b2PolyAndCircleContact,Box2D.Dynamics.Contacts.b2Contact),Box2D.Dynamics.Contacts.b2PolyAndCircleContact.prototype.Reset=function(t,e){Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,t,e)},Box2D.Dynamics.Contacts.b2PolyAndCircleContact.prototype.Evaluate=function(){Box2D.Collision.b2Collision.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape(),this.m_fixtureA.GetBody().m_xf,this.m_fixtureB.GetShape(),this.m_fixtureB.GetBody().m_xf)},Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=function(t,e){Box2D.Dynamics.Contacts.b2Contact.call(this,t,e)},c2inherit(Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,Box2D.Dynamics.Contacts.b2Contact),Box2D.Dynamics.Contacts.b2PolyAndEdgeContact.prototype.Reset=function(t,e){Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,t,e)},Box2D.Dynamics.Contacts.b2PolyAndEdgeContact.prototype.Evaluate=function(){this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape(),this.m_fixtureA.GetBody().m_xf,this.m_fixtureB.GetShape(),this.m_fixtureB.GetBody().m_xf)},Box2D.Dynamics.Contacts.b2PolyAndEdgeContact.prototype.b2CollidePolyAndEdge=function(t,e,i,o,s){},Box2D.Dynamics.Contacts.b2PolygonContact=function(t,e){Box2D.Dynamics.Contacts.b2Contact.call(this,t,e)},c2inherit(Box2D.Dynamics.Contacts.b2PolygonContact,Box2D.Dynamics.Contacts.b2Contact),Box2D.Dynamics.Contacts.b2PolygonContact.prototype.Reset=function(t,e){Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,t,e)},Box2D.Dynamics.Contacts.b2PolygonContact.prototype.Evaluate=function(){Box2D.Collision.b2Collision.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape(),this.m_fixtureA.GetBody().m_xf,this.m_fixtureB.GetShape(),this.m_fixtureB.GetBody().m_xf)},Box2D.Dynamics.Controllers.b2Controller=function(){this.ID="Controller"+Box2D.Dynamics.Controllers.b2Controller.NEXT_ID++,this.m_world=null,this.bodyList=new Box2D.Dynamics.b2BodyList},Box2D.Dynamics.Controllers.b2Controller.prototype.Step=function(t){},Box2D.Dynamics.Controllers.b2Controller.prototype.AddBody=function(t){this.bodyList.AddBody(t),t.AddController(this)},Box2D.Dynamics.Controllers.b2Controller.prototype.RemoveBody=function(t){this.bodyList.RemoveBody(t),t.RemoveController(this)},Box2D.Dynamics.Controllers.b2Controller.prototype.Clear=function(){for(var t=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);t;t=t.GetNextNode())this.RemoveBody(t.body)},Box2D.Dynamics.Controllers.b2Controller.prototype.GetBodyList=function(){return this.bodyList},Box2D.Dynamics.Controllers.b2Controller.NEXT_ID=0,Box2D.Dynamics.Controllers.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this),this.normal=Box2D.Common.Math.b2Vec2.Get(0,-1),this.offset=0,this.density=0,this.velocity=Box2D.Common.Math.b2Vec2.Get(0,0),this.linearDrag=2,this.angularDrag=1,this.useDensity=!1,this.useWorldGravity=!0,this.gravity=null},c2inherit(Box2D.Dynamics.Controllers.b2BuoyancyController,Box2D.Dynamics.Controllers.b2Controller),Box2D.Dynamics.Controllers.b2BuoyancyController.prototype.Step=function(t){this.useWorldGravity&&(this.gravity=this.m_world.GetGravity().Copy());for(var e=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.awakeBodies);e;e=e.GetNextNode()){for(var i=e.body,o=Box2D.Common.Math.b2Vec2.Get(0,0),s=Box2D.Common.Math.b2Vec2.Get(0,0),n=0,r=0,a=i.GetFixtureList().GetFirstNode();a;a=a.GetNextNode()){var h=Box2D.Common.Math.b2Vec2.Get(0,0),c=a.fixture.GetShape().ComputeSubmergedArea(this.normal,this.offset,i.GetTransform(),h);n+=c,o.x+=c*h.x,o.y+=c*h.y;var l=0;r+=c*(l=(this.useDensity,1)),s.x+=c*h.x*l,s.y+=c*h.y*l}if(!(n<Number.MIN_VALUE)){o.x/=n,o.y/=n,s.x/=r,s.y/=r;var m=this.gravity.GetNegative();m.Multiply(this.density*n),i.ApplyForce(m,s);var u=i.GetLinearVelocityFromWorldPoint(o);u.Subtract(this.velocity),u.Multiply(-this.linearDrag*n),i.ApplyForce(u,o),i.ApplyTorque(-i.GetInertia()/i.GetMass()*n*i.GetAngularVelocity()*this.angularDrag),Box2D.Common.Math.b2Vec2.Free(o),Box2D.Common.Math.b2Vec2.Free(s)}}},Box2D.Dynamics.Controllers.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this),this.A=Box2D.Common.Math.b2Vec2.Get(0,0)},c2inherit(Box2D.Dynamics.Controllers.b2ConstantAccelController,Box2D.Dynamics.Controllers.b2Controller),Box2D.Dynamics.Controllers.b2ConstantAccelController.prototype.Step=function(t){for(var e=Box2D.Common.Math.b2Vec2.Get(this.A.x*t.dt,this.A.y*t.dt),i=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.awakeBodies);i;i=i.GetNextNode()){var o=i.body,s=o.GetLinearVelocity();o.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(s.x+e.x,s.y+e.y))}Box2D.Common.Math.b2Vec2.Free(e)},Box2D.Dynamics.Controllers.b2ConstantForceController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this),this.F=Box2D.Common.Math.b2Vec2.Get(0,0)},c2inherit(Box2D.Dynamics.Controllers.b2ConstantForceController,Box2D.Dynamics.Controllers.b2Controller),Box2D.Dynamics.Controllers.b2ConstantForceController.prototype.Step=function(t){for(var e=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.awakeBodies);e;e=e.GetNextNode()){var i=e.body;i.ApplyForce(this.F,i.GetWorldCenter())}},Box2D.Dynamics.Controllers.b2ControllerList=function(){this.controllerFirstNode=null,this.controllerLastNode=null,this.controllerNodeLookup={},this.controllerCount=0},Box2D.Dynamics.Controllers.b2ControllerList.prototype.GetFirstNode=function(){return this.controllerFirstNode},Box2D.Dynamics.Controllers.b2ControllerList.prototype.AddController=function(t){var e=t.ID;if(null==this.controllerNodeLookup[e]){var i=new Box2D.Dynamics.Controllers.b2ControllerListNode(t),o=this.controllerLastNode;null!=o?o.SetNextNode(i):this.controllerFirstNode=i,i.SetPreviousNode(o),this.controllerLastNode=i,this.controllerNodeLookup[e]=i,this.controllerCount++}},Box2D.Dynamics.Controllers.b2ControllerList.prototype.RemoveController=function(t){var e=t.ID,i=this.controllerNodeLookup[e];if(null!=i){var o=i.GetPreviousNode(),s=i.GetNextNode();null==o?this.controllerFirstNode=s:o.SetNextNode(s),null==s?this.controllerLastNode=o:s.SetPreviousNode(o),delete this.controllerNodeLookup[e],this.controllerCount--}},Box2D.Dynamics.Controllers.b2ControllerList.prototype.GetControllerCount=function(){return this.controllerCount},Box2D.Dynamics.Controllers.b2ControllerListNode=function(t){this.controller=t,this.next=null,this.previous=null},Box2D.Dynamics.Controllers.b2ControllerListNode.prototype.SetNextNode=function(t){this.next=t},Box2D.Dynamics.Controllers.b2ControllerListNode.prototype.SetPreviousNode=function(t){this.previous=t},Box2D.Dynamics.Controllers.b2ControllerListNode.prototype.GetNextNode=function(){return this.next},Box2D.Dynamics.Controllers.b2ControllerListNode.prototype.GetPreviousNode=function(){return this.previous},Box2D.Dynamics.Controllers.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this),this.G=1,this.invSqr=!0},c2inherit(Box2D.Dynamics.Controllers.b2GravityController,Box2D.Dynamics.Controllers.b2Controller),Box2D.Dynamics.Controllers.b2GravityController.prototype.Step=function(t){var e=null,i=null,o=0,s=null,n=null,r=0,a=0,h=0,c=null;if(this.invSqr)for(var l=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);l;l=l.GetNextNode()){i=(e=l.body).GetWorldCenter(),o=e.GetMass();for(var m=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);m;m=m.GetNextNode()){s=m.body;if(e.IsAwake()||s.IsAwake())if(!((h=(r=(n=s.GetWorldCenter()).x-i.x)*r+(a=n.y-i.y)*a)<Number.MIN_VALUE))(c=Box2D.Common.Math.b2Vec2.Get(r,a)).Multiply(this.G/h/Math.sqrt(h)*o*s.GetMass()),e.IsAwake()&&e.ApplyForce(c,i),c.Multiply(-1),s.IsAwake()&&s.ApplyForce(c,n),Box2D.Common.Math.b2Vec2.Free(c)}}else for(l=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);l;l=l.GetNextNode())for(i=(e=bodyNode.body).GetWorldCenter(),o=e.GetMass(),m=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);m;m=m.GetNextNode()){s=bodyNode.body;if(e.IsAwake()||s.IsAwake())if(!((h=(r=(n=s.GetWorldCenter()).x-i.x)*r+(a=n.y-i.y)*a)<Number.MIN_VALUE))(c=Box2D.Common.Math.b2Vec2.Get(r,a)).Multiply(this.G/h*o*s.GetMass()),e.IsAwake()&&e.ApplyForce(c,i),c.Multiply(-1),s.IsAwake()&&s.ApplyForce(c,n),Box2D.Common.Math.b2Vec2.Free(c)}},Box2D.Dynamics.Controllers.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this),this.T=new Box2D.Common.Math.b2Mat22,this.maxTimestep=0},c2inherit(Box2D.Dynamics.Controllers.b2TensorDampingController,Box2D.Dynamics.Controllers.b2Controller),Box2D.Dynamics.Controllers.b2TensorDampingController.prototype.SetAxisAligned=function(t,e){this.T.col1.x=-t,this.T.col1.y=0,this.T.col2.x=0,this.T.col2.y=-e,this.maxTimestep=t>0||e>0?1/Math.max(t,e):0},Box2D.Dynamics.Controllers.b2TensorDampingController.prototype.Step=function(t){var e=t.dt;if(!(e<=Number.MIN_VALUE)){e>this.maxTimestep&&this.maxTimestep>0&&(e=this.maxTimestep);for(var i=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.awakeBodies);i;i=i.GetNextNode()){var o=i.body,s=o.GetWorldVector(Box2D.Common.Math.b2Math.MulMV(this.T,o.GetLocalVector(o.GetLinearVelocity())));o.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(o.GetLinearVelocity().x+s.x*e,o.GetLinearVelocity().y+s.y*e))}}},Box2D.Dynamics.Joints.b2Joint=function(t){this.m_edgeA=new Box2D.Dynamics.Joints.b2JointEdge,this.m_edgeB=new Box2D.Dynamics.Joints.b2JointEdge,this.m_localCenterA=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localCenterB=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_type=t.type,this.m_prev=null,this.m_next=null,this.m_bodyA=t.bodyA,this.m_bodyB=t.bodyB,this.m_collideConnected=t.collideConnected},Box2D.Dynamics.Joints.b2Joint.prototype.GetType=function(){return this.m_type},Box2D.Dynamics.Joints.b2Joint.prototype.GetAnchorA=function(){return null},Box2D.Dynamics.Joints.b2Joint.prototype.GetAnchorB=function(){return null},Box2D.Dynamics.Joints.b2Joint.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),null},Box2D.Dynamics.Joints.b2Joint.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),0},Box2D.Dynamics.Joints.b2Joint.prototype.GetBodyA=function(){return this.m_bodyA},Box2D.Dynamics.Joints.b2Joint.prototype.GetBodyB=function(){return this.m_bodyB},Box2D.Dynamics.Joints.b2Joint.prototype.GetNext=function(){return this.m_next},Box2D.Dynamics.Joints.b2Joint.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},Box2D.Dynamics.Joints.b2Joint.Create=function(t){return t.Create()},Box2D.Dynamics.Joints.b2Joint.prototype.InitVelocityConstraints=function(t){},Box2D.Dynamics.Joints.b2Joint.prototype.SolveVelocityConstraints=function(t){},Box2D.Dynamics.Joints.b2Joint.prototype.FinalizeVelocityConstraints=function(){},Box2D.Dynamics.Joints.b2Joint.prototype.SolvePositionConstraints=function(t){return!1},Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0,Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1,Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2,Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3,Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4,Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5,Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6,Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7,Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8,Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9,Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0,Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1,Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2,Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3,Box2D.Dynamics.Joints.b2JointDef=function(){this.type=Box2D.Dynamics.Joints.b2Joint.e_unknownJoint,this.bodyA=null,this.bodyB=null,this.collideConnected=!1},Box2D.Dynamics.Joints.b2JointEdge=function(){},Box2D.Dynamics.Joints.b2DistanceJoint=function(t){Box2D.Dynamics.Joints.b2Joint.call(this,t),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_u=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_length=t.length,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_impulse=0,this.m_gamma=0,this.m_bias=0},c2inherit(Box2D.Dynamics.Joints.b2DistanceJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetReactionForce=function(t){return Box2D.Common.Math.b2Vec2.Get(t*this.m_impulse*this.m_u.x,t*this.m_impulse*this.m_u.y)},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetReactionTorque=function(t){return 0},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetLength=function(){return this.m_length},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SetLength=function(t){this.m_length=t},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SetFrequency=function(t){this.m_frequencyHz=t},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SetDampingRatio=function(t){this.m_dampingRatio=t},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.InitVelocityConstraints=function(t){var e,i=0,o=this.m_bodyA,s=this.m_bodyB;e=o.m_xf.R;var n=this.m_localAnchor1.x-o.m_sweep.localCenter.x,r=this.m_localAnchor1.y-o.m_sweep.localCenter.y;i=e.col1.x*n+e.col2.x*r,r=e.col1.y*n+e.col2.y*r,n=i,e=s.m_xf.R;var a=this.m_localAnchor2.x-s.m_sweep.localCenter.x,h=this.m_localAnchor2.y-s.m_sweep.localCenter.y;i=e.col1.x*a+e.col2.x*h,h=e.col1.y*a+e.col2.y*h,a=i,this.m_u.x=s.m_sweep.c.x+a-o.m_sweep.c.x-n,this.m_u.y=s.m_sweep.c.y+h-o.m_sweep.c.y-r;var c=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);c>Box2D.Common.b2Settings.b2_linearSlop?this.m_u.Multiply(1/c):this.m_u.SetZero();var l=n*this.m_u.y-r*this.m_u.x,m=a*this.m_u.y-h*this.m_u.x,u=o.m_invMass+o.m_invI*l*l+s.m_invMass+s.m_invI*m*m;if(this.m_mass=0!=u?1/u:0,this.m_frequencyHz>0){var p=c-this.m_length,d=2*Math.PI*this.m_frequencyHz,y=2*this.m_mass*this.m_dampingRatio*d,_=this.m_mass*d*d;this.m_gamma=t.dt*(y+t.dt*_),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=p*t.dt*_*this.m_gamma,this.m_mass=u+this.m_gamma,this.m_mass=0!=this.m_mass?1/this.m_mass:0}if(t.warmStarting){this.m_impulse*=t.dtRatio;var f=this.m_impulse*this.m_u.x,x=this.m_impulse*this.m_u.y;o.m_linearVelocity.x-=o.m_invMass*f,o.m_linearVelocity.y-=o.m_invMass*x,o.m_angularVelocity-=o.m_invI*(n*x-r*f),s.m_linearVelocity.x+=s.m_invMass*f,s.m_linearVelocity.y+=s.m_invMass*x,s.m_angularVelocity+=s.m_invI*(a*x-h*f)}else this.m_impulse=0},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SolveVelocityConstraints=function(t){var e=this.m_localAnchor1.x-this.m_bodyA.m_sweep.localCenter.x,i=this.m_localAnchor1.y-this.m_bodyA.m_sweep.localCenter.y,o=this.m_bodyA.m_xf.R.col1.x*e+this.m_bodyA.m_xf.R.col2.x*i;i=this.m_bodyA.m_xf.R.col1.y*e+this.m_bodyA.m_xf.R.col2.y*i,e=o;var s=this.m_localAnchor2.x-this.m_bodyB.m_sweep.localCenter.x,n=this.m_localAnchor2.y-this.m_bodyB.m_sweep.localCenter.y;o=this.m_bodyB.m_xf.R.col1.x*s+this.m_bodyB.m_xf.R.col2.x*n,n=this.m_bodyB.m_xf.R.col1.y*s+this.m_bodyB.m_xf.R.col2.y*n,s=o;var r=this.m_bodyA.m_linearVelocity.x-this.m_bodyA.m_angularVelocity*i,a=this.m_bodyA.m_linearVelocity.y+this.m_bodyA.m_angularVelocity*e,h=this.m_bodyB.m_linearVelocity.x-this.m_bodyB.m_angularVelocity*n,c=this.m_bodyB.m_linearVelocity.y+this.m_bodyB.m_angularVelocity*s,l=this.m_u.x*(h-r)+this.m_u.y*(c-a),m=-this.m_mass*(l+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=m;var u=m*this.m_u.x,p=m*this.m_u.y;this.m_bodyA.m_linearVelocity.x-=this.m_bodyA.m_invMass*u,this.m_bodyA.m_linearVelocity.y-=this.m_bodyA.m_invMass*p,this.m_bodyA.m_angularVelocity-=this.m_bodyA.m_invI*(e*p-i*u),this.m_bodyB.m_linearVelocity.x+=this.m_bodyB.m_invMass*u,this.m_bodyB.m_linearVelocity.y+=this.m_bodyB.m_invMass*p,this.m_bodyB.m_angularVelocity+=this.m_bodyB.m_invI*(s*p-n*u)},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SolvePositionConstraints=function(t){if(this.m_frequencyHz>0)return!0;var e=this.m_localAnchor1.x-this.m_bodyA.m_sweep.localCenter.x,i=this.m_localAnchor1.y-this.m_bodyA.m_sweep.localCenter.y,o=this.m_bodyA.m_xf.R.col1.x*e+this.m_bodyA.m_xf.R.col2.x*i;i=this.m_bodyA.m_xf.R.col1.y*e+this.m_bodyA.m_xf.R.col2.y*i,e=o;var s=this.m_localAnchor2.x-this.m_bodyB.m_sweep.localCenter.x,n=this.m_localAnchor2.y-this.m_bodyB.m_sweep.localCenter.y;o=this.m_bodyB.m_xf.R.col1.x*s+this.m_bodyB.m_xf.R.col2.x*n,n=this.m_bodyB.m_xf.R.col1.y*s+this.m_bodyB.m_xf.R.col2.y*n,s=o;var r=this.m_bodyB.m_sweep.c.x+s-this.m_bodyA.m_sweep.c.x-e,a=this.m_bodyB.m_sweep.c.y+n-this.m_bodyA.m_sweep.c.y-i,h=Math.sqrt(r*r+a*a);r/=h,a/=h;var c=Box2D.Common.Math.b2Math.Clamp(h-this.m_length,-Box2D.Common.b2Settings.b2_maxLinearCorrection,Box2D.Common.b2Settings.b2_maxLinearCorrection),l=-this.m_mass*c;this.m_u.Set(r,a);var m=l*this.m_u.x,u=l*this.m_u.y;return this.m_bodyA.m_sweep.c.x-=this.m_bodyA.m_invMass*m,this.m_bodyA.m_sweep.c.y-=this.m_bodyA.m_invMass*u,this.m_bodyA.m_sweep.a-=this.m_bodyA.m_invI*(e*u-i*m),this.m_bodyB.m_sweep.c.x+=this.m_bodyB.m_invMass*m,this.m_bodyB.m_sweep.c.y+=this.m_bodyB.m_invMass*u,this.m_bodyB.m_sweep.a+=this.m_bodyB.m_invI*(s*u-n*m),this.m_bodyA.SynchronizeTransform(),this.m_bodyB.SynchronizeTransform(),Math.abs(c)<Box2D.Common.b2Settings.b2_linearSlop},Box2D.Dynamics.Joints.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_distanceJoint,this.length=1,this.frequencyHz=0,this.dampingRatio=0},c2inherit(Box2D.Dynamics.Joints.b2DistanceJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2DistanceJointDef.prototype.Initialize=function(t,e,i,o){this.bodyA=t,this.bodyB=e,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(o));var s=o.x-i.x,n=o.y-i.y;this.length=Math.sqrt(s*s+n*n),this.frequencyHz=0,this.dampingRatio=0},Box2D.Dynamics.Joints.b2DistanceJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2DistanceJoint(this)},Box2D.Dynamics.Joints.b2FrictionJoint=function(t){Box2D.Dynamics.Joints.b2Joint.call(this,t),this.m_localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_linearMass=new Box2D.Common.Math.b2Mat22,this.m_linearImpulse=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchorA.SetV(t.localAnchorA),this.m_localAnchorB.SetV(t.localAnchorB),this.m_linearMass.SetZero(),this.m_angularMass=0,this.m_linearImpulse.SetZero(),this.m_angularImpulse=0,this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque},c2inherit(Box2D.Dynamics.Joints.b2FrictionJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new b2Vec2(t*this.m_linearImpulse.x,t*this.m_linearImpulse.y)},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_angularImpulse},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.SetMaxForce=function(t){void 0===t&&(t=0),this.m_maxForce=t},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetMaxForce=function(){return this.m_maxForce},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.SetMaxTorque=function(t){void 0===t&&(t=0),this.m_maxTorque=t},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetMaxTorque=function(){return this.m_maxTorque},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.InitVelocityConstraints=function(t){var e,i=0,o=this.m_bodyA,s=this.m_bodyB;e=o.m_xf.R;var n=this.m_localAnchorA.x-o.m_sweep.localCenter.x,r=this.m_localAnchorA.y-o.m_sweep.localCenter.y;i=e.col1.x*n+e.col2.x*r,r=e.col1.y*n+e.col2.y*r,n=i,e=s.m_xf.R;var a=this.m_localAnchorB.x-s.m_sweep.localCenter.x,h=this.m_localAnchorB.y-s.m_sweep.localCenter.y;i=e.col1.x*a+e.col2.x*h,h=e.col1.y*a+e.col2.y*h,a=i;var c=o.m_invMass,l=s.m_invMass,m=o.m_invI,u=s.m_invI,p=new Box2D.Common.Math.b2Mat22;if(p.col1.x=c+l,p.col2.x=0,p.col1.y=0,p.col2.y=c+l,p.col1.x+=m*r*r,p.col2.x+=-m*n*r,p.col1.y+=-m*n*r,p.col2.y+=m*n*n,p.col1.x+=u*h*h,p.col2.x+=-u*a*h,p.col1.y+=-u*a*h,p.col2.y+=u*a*a,p.GetInverse(this.m_linearMass),this.m_angularMass=m+u,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.warmStarting){this.m_linearImpulse.x*=t.dtRatio,this.m_linearImpulse.y*=t.dtRatio,this.m_angularImpulse*=t.dtRatio;var d=this.m_linearImpulse;o.m_linearVelocity.x-=c*d.x,o.m_linearVelocity.y-=c*d.y,o.m_angularVelocity-=m*(n*d.y-r*d.x+this.m_angularImpulse),s.m_linearVelocity.x+=l*d.x,s.m_linearVelocity.y+=l*d.y,s.m_angularVelocity+=u*(a*d.y-h*d.x+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.SolveVelocityConstraints=function(t){var e,i=0,o=this.m_bodyA,s=this.m_bodyB,n=o.m_linearVelocity,r=o.m_angularVelocity,a=s.m_linearVelocity,h=s.m_angularVelocity,c=o.m_invMass,l=s.m_invMass,m=o.m_invI,u=s.m_invI;e=o.m_xf.R;var p=this.m_localAnchorA.x-o.m_sweep.localCenter.x,d=this.m_localAnchorA.y-o.m_sweep.localCenter.y;i=e.col1.x*p+e.col2.x*d,d=e.col1.y*p+e.col2.y*d,p=i,e=s.m_xf.R;var y=this.m_localAnchorB.x-s.m_sweep.localCenter.x,_=this.m_localAnchorB.y-s.m_sweep.localCenter.y;i=e.col1.x*y+e.col2.x*_,_=e.col1.y*y+e.col2.y*_,y=i;var f=0,x=h-r,g=-this.m_angularMass*x,b=this.m_angularImpulse;f=t.dt*this.m_maxTorque,this.m_angularImpulse=Box2D.Common.Math.b2Math.Clamp(this.m_angularImpulse+g,-f,f),r-=m*(g=this.m_angularImpulse-b),h+=u*g;var v=a.x-h*_-n.x+r*d,B=a.y+h*y-n.y-r*p,D=Box2D.Common.Math.b2Math.MulMV(this.m_linearMass,Box2D.Common.Math.b2Vec2.Get(-v,-B)),w=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(D),f=t.dt*this.m_maxForce,this.m_linearImpulse.LengthSquared()>f*f&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(f)),D=Box2D.Common.Math.b2Math.SubtractVV(this.m_linearImpulse,w),n.x-=c*D.x,n.y-=c*D.y,r-=m*(p*D.y-d*D.x),a.x+=l*D.x,a.y+=l*D.y,h+=u*(y*D.y-_*D.x),o.m_angularVelocity=r,s.m_angularVelocity=h},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.SolvePositionConstraints=function(t){return!0},Box2D.Dynamics.Joints.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_frictionJoint,this.maxForce=0,this.maxTorque=0},c2inherit(Box2D.Dynamics.Joints.b2FrictionJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2FrictionJointDef.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(i))},Box2D.Dynamics.Joints.b2FrictionJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2FrictionJoint(this)},Box2D.Dynamics.Joints.b2GearJoint=function(t){Box2D.Dynamics.Joints.b2Joint.call(this,t),this.m_groundAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_groundAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_J=new Box2D.Dynamics.Joints.b2Jacobian;var e=t.joint1.m_type,i=t.joint2.m_type;this.m_revolute1=null,this.m_prismatic1=null,this.m_revolute2=null,this.m_prismatic2=null;var o=0,s=0;this.m_ground1=t.joint1.GetBodyA(),this.m_bodyA=t.joint1.GetBodyB(),e==Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint?(this.m_revolute1=t.joint1,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),o=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=t.joint1,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),o=this.m_prismatic1.GetJointTranslation()),this.m_ground2=t.joint2.GetBodyA(),this.m_bodyB=t.joint2.GetBodyB(),i==Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint?(this.m_revolute2=t.joint2,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),s=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=t.joint2,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),s=this.m_prismatic2.GetJointTranslation()),this.m_ratio=t.ratio,this.m_constant=o+this.m_ratio*s,this.m_impulse=0},c2inherit(Box2D.Dynamics.Joints.b2GearJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2GearJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2GearJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2GearJoint.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),Box2D.Common.Math.b2Vec2.Get(t*this.m_impulse*this.m_J.linearB.x,t*this.m_impulse*this.m_J.linearB.y)},Box2D.Dynamics.Joints.b2GearJoint.prototype.GetReactionTorque=function(t){void 0===t&&(t=0);var e=this.m_bodyB.m_xf.R,i=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,o=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,s=e.col1.x*i+e.col2.x*o;o=e.col1.y*i+e.col2.y*o,i=s;var n=this.m_impulse*this.m_J.linearB.x,r=this.m_impulse*this.m_J.linearB.y;return t*(this.m_impulse*this.m_J.angularB-i*r+o*n)},Box2D.Dynamics.Joints.b2GearJoint.prototype.GetRatio=function(){return this.m_ratio},Box2D.Dynamics.Joints.b2GearJoint.prototype.SetRatio=function(t){void 0===t&&(t=0),this.m_ratio=t},Box2D.Dynamics.Joints.b2GearJoint.prototype.InitVelocityConstraints=function(t){var e,i,o=this.m_ground1,s=this.m_ground2,n=this.m_bodyA,r=this.m_bodyB,a=0,h=0,c=0,l=0,m=0,u=0,p=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angularA=-1,p+=n.m_invI):(e=o.m_xf.R,i=this.m_prismatic1.m_localXAxis1,a=e.col1.x*i.x+e.col2.x*i.y,h=e.col1.y*i.x+e.col2.y*i.y,e=n.m_xf.R,c=this.m_localAnchor1.x-n.m_sweep.localCenter.x,l=this.m_localAnchor1.y-n.m_sweep.localCenter.y,u=e.col1.x*c+e.col2.x*l,l=e.col1.y*c+e.col2.y*l,m=(c=u)*h-l*a,this.m_J.linearA.Set(-a,-h),this.m_J.angularA=-m,p+=n.m_invMass+n.m_invI*m*m),this.m_revolute2?(this.m_J.angularB=-this.m_ratio,p+=this.m_ratio*this.m_ratio*r.m_invI):(e=s.m_xf.R,i=this.m_prismatic2.m_localXAxis1,a=e.col1.x*i.x+e.col2.x*i.y,h=e.col1.y*i.x+e.col2.y*i.y,e=r.m_xf.R,c=this.m_localAnchor2.x-r.m_sweep.localCenter.x,l=this.m_localAnchor2.y-r.m_sweep.localCenter.y,u=e.col1.x*c+e.col2.x*l,l=e.col1.y*c+e.col2.y*l,m=(c=u)*h-l*a,this.m_J.linearB.Set(-this.m_ratio*a,-this.m_ratio*h),this.m_J.angularB=-this.m_ratio*m,p+=this.m_ratio*this.m_ratio*(r.m_invMass+r.m_invI*m*m)),this.m_mass=p>0?1/p:0,t.warmStarting?(n.m_linearVelocity.x+=n.m_invMass*this.m_impulse*this.m_J.linearA.x,n.m_linearVelocity.y+=n.m_invMass*this.m_impulse*this.m_J.linearA.y,n.m_angularVelocity+=n.m_invI*this.m_impulse*this.m_J.angularA,r.m_linearVelocity.x+=r.m_invMass*this.m_impulse*this.m_J.linearB.x,r.m_linearVelocity.y+=r.m_invMass*this.m_impulse*this.m_J.linearB.y,r.m_angularVelocity+=r.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},Box2D.Dynamics.Joints.b2GearJoint.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA,i=this.m_bodyB,o=this.m_J.Compute(e.m_linearVelocity,e.m_angularVelocity,i.m_linearVelocity,i.m_angularVelocity),s=-this.m_mass*o;this.m_impulse+=s,e.m_linearVelocity.x+=e.m_invMass*s*this.m_J.linearA.x,e.m_linearVelocity.y+=e.m_invMass*s*this.m_J.linearA.y,e.m_angularVelocity+=e.m_invI*s*this.m_J.angularA,i.m_linearVelocity.x+=i.m_invMass*s*this.m_J.linearB.x,i.m_linearVelocity.y+=i.m_invMass*s*this.m_J.linearB.y,i.m_angularVelocity+=i.m_invI*s*this.m_J.angularB},Box2D.Dynamics.Joints.b2GearJoint.prototype.SolvePositionConstraints=function(t){void 0===t&&(t=0);var e=this.m_bodyA,i=this.m_bodyB,o=0,s=0;o=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),s=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation();var n=this.m_constant-(o+this.m_ratio*s),r=-this.m_mass*n;return e.m_sweep.c.x+=e.m_invMass*r*this.m_J.linearA.x,e.m_sweep.c.y+=e.m_invMass*r*this.m_J.linearA.y,e.m_sweep.a+=e.m_invI*r*this.m_J.angularA,i.m_sweep.c.x+=i.m_invMass*r*this.m_J.linearB.x,i.m_sweep.c.y+=i.m_invMass*r*this.m_J.linearB.y,i.m_sweep.a+=i.m_invI*r*this.m_J.angularB,e.SynchronizeTransform(),i.SynchronizeTransform(),0<Box2D.Common.b2Settings.b2_linearSlop},Box2D.Dynamics.Joints.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.type=Box2D.Dynamics.Joints.b2Joint.e_gearJoint,this.joint1=null,this.joint2=null,this.ratio=1},c2inherit(Box2D.Dynamics.Joints.b2GearJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2GearJointDef.prototype.Initialize=function(t,e,i){this.joint1=t,this.bodyA=t.GetBodyA(),this.joint2=e,this.bodyB=e.GetBodyA(),this.ratio=i},Box2D.Dynamics.Joints.b2GearJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2GearJoint(this)},Box2D.Dynamics.Joints.b2Jacobian=function(){this.linearA=Box2D.Common.Math.b2Vec2.Get(0,0),this.linearB=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Dynamics.Joints.b2Jacobian.prototype.SetZero=function(){this.linearA.SetZero(),this.angularA=0,this.linearB.SetZero(),this.angularB=0},Box2D.Dynamics.Joints.b2Jacobian.prototype.Set=function(t,e,i,o){void 0===e&&(e=0),void 0===o&&(o=0),this.linearA.SetV(t),this.angularA=e,this.linearB.SetV(i),this.angularB=o},Box2D.Dynamics.Joints.b2Jacobian.prototype.Compute=function(t,e,i,o){return void 0===e&&(e=0),void 0===o&&(o=0),this.linearA.x*t.x+this.linearA.y*t.y+this.angularA*e+(this.linearB.x*i.x+this.linearB.y*i.y)+this.angularB*o},Box2D.Dynamics.Joints.b2LineJoint=function(t){Box2D.Dynamics.Joints.b2Joint.call(this,t),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localXAxis1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localYAxis1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_axis=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_perp=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_K=new Box2D.Common.Math.b2Mat22,this.m_impulse=Box2D.Common.Math.b2Vec2.Get(0,0);this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_localXAxis1.SetV(t.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},c2inherit(Box2D.Dynamics.Joints.b2LineJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2LineJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),Box2D.Common.Math.b2Vec2.Get(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.y},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetJointTranslation=function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.GetWorldPoint(this.m_localAnchor1),o=e.GetWorldPoint(this.m_localAnchor2),s=o.x-i.x,n=o.y-i.y,r=t.GetWorldVector(this.m_localXAxis1);return r.x*s+r.y*n},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetJointSpeed=function(){var t,e=this.m_bodyA,i=this.m_bodyB;t=e.m_xf.R;var o=this.m_localAnchor1.x-e.m_sweep.localCenter.x,s=this.m_localAnchor1.y-e.m_sweep.localCenter.y,n=t.col1.x*o+t.col2.x*s;s=t.col1.y*o+t.col2.y*s,o=n,t=i.m_xf.R;var r=this.m_localAnchor2.x-i.m_sweep.localCenter.x,a=this.m_localAnchor2.y-i.m_sweep.localCenter.y;n=t.col1.x*r+t.col2.x*a,a=t.col1.y*r+t.col2.y*a,r=n;var h=e.m_sweep.c.x+o,c=e.m_sweep.c.y+s,l=i.m_sweep.c.x+r-h,m=i.m_sweep.c.y+a-c,u=e.GetWorldVector(this.m_localXAxis1),p=e.m_linearVelocity,d=i.m_linearVelocity,y=e.m_angularVelocity,_=i.m_angularVelocity;return l*(-y*u.y)+m*(y*u.x)+(u.x*(d.x+-_*a-p.x- -y*s)+u.y*(d.y+_*r-p.y-y*o))},Box2D.Dynamics.Joints.b2LineJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},Box2D.Dynamics.Joints.b2LineJoint.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation},Box2D.Dynamics.Joints.b2LineJoint.prototype.SetLimits=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e},Box2D.Dynamics.Joints.b2LineJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},Box2D.Dynamics.Joints.b2LineJoint.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},Box2D.Dynamics.Joints.b2LineJoint.prototype.SetMotorSpeed=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},Box2D.Dynamics.Joints.b2LineJoint.prototype.SetMaxMotorForce=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetMotorForce=function(){return this.m_motorImpulse},Box2D.Dynamics.Joints.b2LineJoint.prototype.InitVelocityConstraints=function(t){var e,i=this.m_bodyA,o=this.m_bodyB,s=0;this.m_localCenterA.SetV(i.GetLocalCenter()),this.m_localCenterB.SetV(o.GetLocalCenter());var n=i.GetTransform();o.GetTransform();e=i.m_xf.R;var r=this.m_localAnchor1.x-this.m_localCenterA.x,a=this.m_localAnchor1.y-this.m_localCenterA.y;s=e.col1.x*r+e.col2.x*a,a=e.col1.y*r+e.col2.y*a,r=s,e=o.m_xf.R;var h=this.m_localAnchor2.x-this.m_localCenterB.x,c=this.m_localAnchor2.y-this.m_localCenterB.y;s=e.col1.x*h+e.col2.x*c,c=e.col1.y*h+e.col2.y*c,h=s;var l=o.m_sweep.c.x+h-i.m_sweep.c.x-r,m=o.m_sweep.c.y+c-i.m_sweep.c.y-a;this.m_invMassA=i.m_invMass,this.m_invMassB=o.m_invMass,this.m_invIA=i.m_invI,this.m_invIB=o.m_invI,this.m_axis.SetV(Box2D.Common.Math.b2Math.MulMV(n.R,this.m_localXAxis1)),this.m_a1=(l+r)*this.m_axis.y-(m+a)*this.m_axis.x,this.m_a2=h*this.m_axis.y-c*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0,this.m_perp.SetV(Box2D.Common.Math.b2Math.MulMV(n.R,this.m_localYAxis1)),this.m_s1=(l+r)*this.m_perp.y-(m+a)*this.m_perp.x,this.m_s2=h*this.m_perp.y-c*this.m_perp.x;var u=this.m_invMassA,p=this.m_invMassB,d=this.m_invIA,y=this.m_invIB;if(this.m_K.col1.x=u+p+d*this.m_s1*this.m_s1+y*this.m_s2*this.m_s2,this.m_K.col1.y=d*this.m_s1*this.m_a1+y*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=u+p+d*this.m_a1*this.m_a1+y*this.m_a2*this.m_a2,this.m_enableLimit){var _=this.m_axis.x*l+this.m_axis.y*m;Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Box2D.Common.b2Settings.b2_linearSlop?this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_equalLimits:_<=this.m_lowerTranslation?this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit&&(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit,this.m_impulse.y=0):_>=this.m_upperTranslation?this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_impulse.y=0)}else this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),t.warmStarting){this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_motorImpulse*=t.dtRatio;var f=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,x=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,g=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,b=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2;i.m_linearVelocity.x-=this.m_invMassA*f,i.m_linearVelocity.y-=this.m_invMassA*x,i.m_angularVelocity-=this.m_invIA*g,o.m_linearVelocity.x+=this.m_invMassB*f,o.m_linearVelocity.y+=this.m_invMassB*x,o.m_angularVelocity+=this.m_invIB*b}else this.m_impulse.SetZero(),this.m_motorImpulse=0},Box2D.Dynamics.Joints.b2LineJoint.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA,i=this.m_bodyB,o=e.m_linearVelocity,s=e.m_angularVelocity,n=i.m_linearVelocity,r=i.m_angularVelocity,a=0,h=0,c=0,l=0;if(this.m_enableMotor&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_equalLimits){var m=this.m_axis.x*(n.x-o.x)+this.m_axis.y*(n.y-o.y)+this.m_a2*r-this.m_a1*s,u=this.m_motorMass*(this.m_motorSpeed-m),p=this.m_motorImpulse,d=t.dt*this.m_maxMotorForce;this.m_motorImpulse=Box2D.Common.Math.b2Math.Clamp(this.m_motorImpulse+u,-d,d),a=(u=this.m_motorImpulse-p)*this.m_axis.x,h=u*this.m_axis.y,c=u*this.m_a1,l=u*this.m_a2,o.x-=this.m_invMassA*a,o.y-=this.m_invMassA*h,s-=this.m_invIA*c,n.x+=this.m_invMassB*a,n.y+=this.m_invMassB*h,r+=this.m_invIB*l}var y=this.m_perp.x*(n.x-o.x)+this.m_perp.y*(n.y-o.y)+this.m_s2*r-this.m_s1*s;if(this.m_enableLimit&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit){var _=this.m_axis.x*(n.x-o.x)+this.m_axis.y*(n.y-o.y)+this.m_a2*r-this.m_a1*s,f=this.m_impulse.Copy(),x=this.m_K.Solve(Box2D.Common.Math.b2Vec2.Get(0,0),-y,-_);this.m_impulse.Add(x),this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit?this.m_impulse.y=Math.max(this.m_impulse.y,0):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_impulse.y=Math.min(this.m_impulse.y,0));var g=-y-(this.m_impulse.y-f.y)*this.m_K.col2.x,b=0;b=0!=this.m_K.col1.x?g/this.m_K.col1.x+f.x:f.x,this.m_impulse.x=b,x.x=this.m_impulse.x-f.x,x.y=this.m_impulse.y-f.y,a=x.x*this.m_perp.x+x.y*this.m_axis.x,h=x.x*this.m_perp.y+x.y*this.m_axis.y,c=x.x*this.m_s1+x.y*this.m_a1,l=x.x*this.m_s2+x.y*this.m_a2,o.x-=this.m_invMassA*a,o.y-=this.m_invMassA*h,s-=this.m_invIA*c,n.x+=this.m_invMassB*a,n.y+=this.m_invMassB*h,r+=this.m_invIB*l}else{var v=0;v=0!=this.m_K.col1.x?-y/this.m_K.col1.x:0,this.m_impulse.x+=v,a=v*this.m_perp.x,h=v*this.m_perp.y,c=v*this.m_s1,l=v*this.m_s2,o.x-=this.m_invMassA*a,o.y-=this.m_invMassA*h,s-=this.m_invIA*c,n.x+=this.m_invMassB*a,n.y+=this.m_invMassB*h,r+=this.m_invIB*l}e.m_linearVelocity.SetV(o),e.m_angularVelocity=s,i.m_linearVelocity.SetV(n),i.m_angularVelocity=r},Box2D.Dynamics.Joints.b2LineJoint.prototype.SolvePositionConstraints=function(t){void 0===t&&(t=0);var e,i=this.m_bodyA,o=this.m_bodyB,s=i.m_sweep.c,n=i.m_sweep.a,r=o.m_sweep.c,a=o.m_sweep.a,h=0,c=0,l=0,m=0,u=0,p=0,d=!1,y=0,_=Box2D.Common.Math.b2Mat22.FromAngle(n),f=Box2D.Common.Math.b2Mat22.FromAngle(a);e=_;var x=this.m_localAnchor1.x-this.m_localCenterA.x,g=this.m_localAnchor1.y-this.m_localCenterA.y;h=e.col1.x*x+e.col2.x*g,g=e.col1.y*x+e.col2.y*g,x=h,e=f;var b=this.m_localAnchor2.x-this.m_localCenterB.x,v=this.m_localAnchor2.y-this.m_localCenterB.y;h=e.col1.x*b+e.col2.x*v,v=e.col1.y*b+e.col2.y*v,b=h;var B=r.x+b-s.x-x,D=r.y+v-s.y-g;if(this.m_enableLimit){this.m_axis=Box2D.Common.Math.b2Math.MulMV(_,this.m_localXAxis1),this.m_a1=(B+x)*this.m_axis.y-(D+g)*this.m_axis.x,this.m_a2=b*this.m_axis.y-v*this.m_axis.x;var w=this.m_axis.x*B+this.m_axis.y*D;Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Box2D.Common.b2Settings.b2_linearSlop?(y=Box2D.Common.Math.b2Math.Clamp(w,-Box2D.Common.b2Settings.b2_maxLinearCorrection,Box2D.Common.b2Settings.b2_maxLinearCorrection),p=Math.abs(w),d=!0):w<=this.m_lowerTranslation?(y=Box2D.Common.Math.b2Math.Clamp(w-this.m_lowerTranslation+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),p=this.m_lowerTranslation-w,d=!0):w>=this.m_upperTranslation&&(y=Box2D.Common.Math.b2Math.Clamp(w-this.m_upperTranslation+Box2D.Common.b2Settings.b2_linearSlop,0,Box2D.Common.b2Settings.b2_maxLinearCorrection),p=w-this.m_upperTranslation,d=!0)}this.m_perp=Box2D.Common.Math.b2Math.MulMV(_,this.m_localYAxis1),this.m_s1=(B+x)*this.m_perp.y-(D+g)*this.m_perp.x,this.m_s2=b*this.m_perp.y-v*this.m_perp.x;var C=Box2D.Common.Math.b2Vec2.Get(0,0),S=this.m_perp.x*B+this.m_perp.y*D;if(p=Math.max(p,Math.abs(S)),0,d)c=this.m_invMassA,l=this.m_invMassB,m=this.m_invIA,u=this.m_invIB,this.m_K.col1.x=c+l+m*this.m_s1*this.m_s1+u*this.m_s2*this.m_s2,this.m_K.col1.y=m*this.m_s1*this.m_a1+u*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=c+l+m*this.m_a1*this.m_a1+u*this.m_a2*this.m_a2,this.m_K.Solve(C,-S,-y);else{c=this.m_invMassA,l=this.m_invMassB,m=this.m_invIA,u=this.m_invIB;var A=c+l+m*this.m_s1*this.m_s1+u*this.m_s2*this.m_s2,M=0;M=0!=A?-S/A:0,C.x=M,C.y=0}var T=C.x*this.m_perp.x+C.y*this.m_axis.x,I=C.x*this.m_perp.y+C.y*this.m_axis.y,P=C.x*this.m_s1+C.y*this.m_a1,L=C.x*this.m_s2+C.y*this.m_a2;return s.x-=this.m_invMassA*T,s.y-=this.m_invMassA*I,n-=this.m_invIA*P,r.x+=this.m_invMassB*T,r.y+=this.m_invMassB*I,a+=this.m_invIB*L,i.m_sweep.a=n,o.m_sweep.a=a,i.SynchronizeTransform(),o.SynchronizeTransform(),p<=Box2D.Common.b2Settings.b2_linearSlop&&0<=Box2D.Common.b2Settings.b2_angularSlop},Box2D.Dynamics.Joints.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAxisA=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_lineJoint,this.localAxisA.Set(1,0),this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},c2inherit(Box2D.Dynamics.Joints.b2LineJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2LineJointDef.prototype.Initialize=function(t,e,i,o){this.bodyA=t,this.bodyB=e,this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(i),this.localAxisA=this.bodyA.GetLocalVector(o)},Box2D.Dynamics.Joints.b2LineJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2LineJoint(this)},Box2D.Dynamics.Joints.b2PrismaticJoint=function(t){Box2D.Dynamics.Joints.b2Joint.call(this,t),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localXAxis1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localYAxis1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_axis=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_perp=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_K=new Box2D.Common.Math.b2Mat33,this.m_impulse=new Box2D.Common.Math.b2Vec3(0,0,0),this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_localXAxis1.SetV(t.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},c2inherit(Box2D.Dynamics.Joints.b2PrismaticJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),Box2D.Common.Math.b2Vec2.Get(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.y},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetJointTranslation=function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.GetWorldPoint(this.m_localAnchor1),o=e.GetWorldPoint(this.m_localAnchor2),s=o.x-i.x,n=o.y-i.y,r=t.GetWorldVector(this.m_localXAxis1);return r.x*s+r.y*n},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetJointSpeed=function(){var t,e=this.m_bodyA,i=this.m_bodyB;t=e.m_xf.R;var o=this.m_localAnchor1.x-e.m_sweep.localCenter.x,s=this.m_localAnchor1.y-e.m_sweep.localCenter.y,n=t.col1.x*o+t.col2.x*s;s=t.col1.y*o+t.col2.y*s,o=n,t=i.m_xf.R;var r=this.m_localAnchor2.x-i.m_sweep.localCenter.x,a=this.m_localAnchor2.y-i.m_sweep.localCenter.y;n=t.col1.x*r+t.col2.x*a,a=t.col1.y*r+t.col2.y*a,r=n;var h=e.m_sweep.c.x+o,c=e.m_sweep.c.y+s,l=i.m_sweep.c.x+r-h,m=i.m_sweep.c.y+a-c,u=e.GetWorldVector(this.m_localXAxis1),p=e.m_linearVelocity,d=i.m_linearVelocity,y=e.m_angularVelocity,_=i.m_angularVelocity;return l*(-y*u.y)+m*(y*u.x)+(u.x*(d.x+-_*a-p.x- -y*s)+u.y*(d.y+_*r-p.y-y*o))},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SetLimits=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SetMotorSpeed=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SetMaxMotorForce=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetMotorForce=function(){return this.m_motorImpulse},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.InitVelocityConstraints=function(t){var e,i=this.m_bodyA,o=this.m_bodyB,s=0;this.m_localCenterA.SetV(i.GetLocalCenter()),this.m_localCenterB.SetV(o.GetLocalCenter());var n=i.GetTransform();o.GetTransform();e=i.m_xf.R;var r=this.m_localAnchor1.x-this.m_localCenterA.x,a=this.m_localAnchor1.y-this.m_localCenterA.y;s=e.col1.x*r+e.col2.x*a,a=e.col1.y*r+e.col2.y*a,r=s,e=o.m_xf.R;var h=this.m_localAnchor2.x-this.m_localCenterB.x,c=this.m_localAnchor2.y-this.m_localCenterB.y;s=e.col1.x*h+e.col2.x*c,c=e.col1.y*h+e.col2.y*c,h=s;var l=o.m_sweep.c.x+h-i.m_sweep.c.x-r,m=o.m_sweep.c.y+c-i.m_sweep.c.y-a;this.m_invMassA=i.m_invMass,this.m_invMassB=o.m_invMass,this.m_invIA=i.m_invI,this.m_invIB=o.m_invI,this.m_axis.SetV(Box2D.Common.Math.b2Math.MulMV(n.R,this.m_localXAxis1)),this.m_a1=(l+r)*this.m_axis.y-(m+a)*this.m_axis.x,this.m_a2=h*this.m_axis.y-c*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass),this.m_perp.SetV(Box2D.Common.Math.b2Math.MulMV(n.R,this.m_localYAxis1)),this.m_s1=(l+r)*this.m_perp.y-(m+a)*this.m_perp.x,this.m_s2=h*this.m_perp.y-c*this.m_perp.x;var u=this.m_invMassA,p=this.m_invMassB,d=this.m_invIA,y=this.m_invIB;if(this.m_K.col1.x=u+p+d*this.m_s1*this.m_s1+y*this.m_s2*this.m_s2,this.m_K.col1.y=d*this.m_s1+y*this.m_s2,this.m_K.col1.z=d*this.m_s1*this.m_a1+y*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=d+y,this.m_K.col2.z=d*this.m_a1+y*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=u+p+d*this.m_a1*this.m_a1+y*this.m_a2*this.m_a2,this.m_enableLimit){var _=this.m_axis.x*l+this.m_axis.y*m;Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Box2D.Common.b2Settings.b2_linearSlop?this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_equalLimits:_<=this.m_lowerTranslation?this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit&&(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit,this.m_impulse.z=0):_>=this.m_upperTranslation?this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),t.warmStarting){this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_motorImpulse*=t.dtRatio;var f=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,x=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,g=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,b=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;i.m_linearVelocity.x-=this.m_invMassA*f,i.m_linearVelocity.y-=this.m_invMassA*x,i.m_angularVelocity-=this.m_invIA*g,o.m_linearVelocity.x+=this.m_invMassB*f,o.m_linearVelocity.y+=this.m_invMassB*x,o.m_angularVelocity+=this.m_invIB*b}else this.m_impulse.SetZero(),this.m_motorImpulse=0},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA,i=this.m_bodyB,o=e.m_linearVelocity,s=e.m_angularVelocity,n=i.m_linearVelocity,r=i.m_angularVelocity,a=0,h=0,c=0,l=0;if(this.m_enableMotor&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_equalLimits){var m=this.m_axis.x*(n.x-o.x)+this.m_axis.y*(n.y-o.y)+this.m_a2*r-this.m_a1*s,u=this.m_motorMass*(this.m_motorSpeed-m),p=this.m_motorImpulse,d=t.dt*this.m_maxMotorForce;this.m_motorImpulse=Box2D.Common.Math.b2Math.Clamp(this.m_motorImpulse+u,-d,d),a=(u=this.m_motorImpulse-p)*this.m_axis.x,h=u*this.m_axis.y,c=u*this.m_a1,l=u*this.m_a2,o.x-=this.m_invMassA*a,o.y-=this.m_invMassA*h,s-=this.m_invIA*c,n.x+=this.m_invMassB*a,n.y+=this.m_invMassB*h,r+=this.m_invIB*l}var y=this.m_perp.x*(n.x-o.x)+this.m_perp.y*(n.y-o.y)+this.m_s2*r-this.m_s1*s,_=r-s;if(this.m_enableLimit&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit){var f=this.m_axis.x*(n.x-o.x)+this.m_axis.y*(n.y-o.y)+this.m_a2*r-this.m_a1*s,x=this.m_impulse.Copy(),g=this.m_K.Solve33(new Box2D.Common.Math.b2Vec3(0,0,0),-y,-_,-f);this.m_impulse.Add(g),this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit?this.m_impulse.z=Math.max(this.m_impulse.z,0):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_impulse.z=Math.min(this.m_impulse.z,0));var b=-y-(this.m_impulse.z-x.z)*this.m_K.col3.x,v=-_-(this.m_impulse.z-x.z)*this.m_K.col3.y,B=this.m_K.Solve22(Box2D.Common.Math.b2Vec2.Get(0,0),b,v);B.x+=x.x,B.y+=x.y,this.m_impulse.x=B.x,this.m_impulse.y=B.y,g.x=this.m_impulse.x-x.x,g.y=this.m_impulse.y-x.y,g.z=this.m_impulse.z-x.z,a=g.x*this.m_perp.x+g.z*this.m_axis.x,h=g.x*this.m_perp.y+g.z*this.m_axis.y,c=g.x*this.m_s1+g.y+g.z*this.m_a1,l=g.x*this.m_s2+g.y+g.z*this.m_a2,o.x-=this.m_invMassA*a,o.y-=this.m_invMassA*h,s-=this.m_invIA*c,n.x+=this.m_invMassB*a,n.y+=this.m_invMassB*h,r+=this.m_invIB*l}else{var D=this.m_K.Solve22(Box2D.Common.Math.b2Vec2.Get(0,0),-y,-_);this.m_impulse.x+=D.x,this.m_impulse.y+=D.y,a=D.x*this.m_perp.x,h=D.x*this.m_perp.y,c=D.x*this.m_s1+D.y,l=D.x*this.m_s2+D.y,o.x-=this.m_invMassA*a,o.y-=this.m_invMassA*h,s-=this.m_invIA*c,n.x+=this.m_invMassB*a,n.y+=this.m_invMassB*h,r+=this.m_invIB*l}e.m_linearVelocity.SetV(o),e.m_angularVelocity=s,i.m_linearVelocity.SetV(n),i.m_angularVelocity=r},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SolvePositionConstraints=function(t){void 0===t&&(t=0);var e,i,o=this.m_bodyA,s=this.m_bodyB,n=o.m_sweep.c,r=o.m_sweep.a,a=s.m_sweep.c,h=s.m_sweep.a,c=0,l=0,m=0,u=0,p=0,d=0,y=!1,_=0,f=Box2D.Common.Math.b2Mat22.FromAngle(r),x=Box2D.Common.Math.b2Mat22.FromAngle(h);e=f;var g=this.m_localAnchor1.x-this.m_localCenterA.x,b=this.m_localAnchor1.y-this.m_localCenterA.y;c=e.col1.x*g+e.col2.x*b,b=e.col1.y*g+e.col2.y*b,g=c,e=x;var v=this.m_localAnchor2.x-this.m_localCenterB.x,B=this.m_localAnchor2.y-this.m_localCenterB.y;c=e.col1.x*v+e.col2.x*B,B=e.col1.y*v+e.col2.y*B,v=c;var D=a.x+v-n.x-g,w=a.y+B-n.y-b;if(this.m_enableLimit){this.m_axis=Box2D.Common.Math.b2Math.MulMV(f,this.m_localXAxis1),this.m_a1=(D+g)*this.m_axis.y-(w+b)*this.m_axis.x,this.m_a2=v*this.m_axis.y-B*this.m_axis.x;var C=this.m_axis.x*D+this.m_axis.y*w;Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Box2D.Common.b2Settings.b2_linearSlop?(_=Box2D.Common.Math.b2Math.Clamp(C,-Box2D.Common.b2Settings.b2_maxLinearCorrection,Box2D.Common.b2Settings.b2_maxLinearCorrection),d=Math.abs(C),y=!0):C<=this.m_lowerTranslation?(_=Box2D.Common.Math.b2Math.Clamp(C-this.m_lowerTranslation+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),d=this.m_lowerTranslation-C,y=!0):C>=this.m_upperTranslation&&(_=Box2D.Common.Math.b2Math.Clamp(C-this.m_upperTranslation+Box2D.Common.b2Settings.b2_linearSlop,0,Box2D.Common.b2Settings.b2_maxLinearCorrection),d=C-this.m_upperTranslation,y=!0)}this.m_perp=Box2D.Common.Math.b2Math.MulMV(f,this.m_localYAxis1),this.m_s1=(D+g)*this.m_perp.y-(w+b)*this.m_perp.x,this.m_s2=v*this.m_perp.y-B*this.m_perp.x;var S=new Box2D.Common.Math.b2Vec3(0,0,0),A=this.m_perp.x*D+this.m_perp.y*w,M=h-r-this.m_refAngle;if(d=Math.max(d,Math.abs(A)),i=Math.abs(M),y)l=this.m_invMassA,m=this.m_invMassB,u=this.m_invIA,p=this.m_invIB,this.m_K.col1.x=l+m+u*this.m_s1*this.m_s1+p*this.m_s2*this.m_s2,this.m_K.col1.y=u*this.m_s1+p*this.m_s2,this.m_K.col1.z=u*this.m_s1*this.m_a1+p*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=u+p,this.m_K.col2.z=u*this.m_a1+p*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=l+m+u*this.m_a1*this.m_a1+p*this.m_a2*this.m_a2,this.m_K.Solve33(S,-A,-M,-_);else{l=this.m_invMassA,m=this.m_invMassB,u=this.m_invIA,p=this.m_invIB;var T=l+m+u*this.m_s1*this.m_s1+p*this.m_s2*this.m_s2,I=u*this.m_s1+p*this.m_s2,P=u+p;this.m_K.col1.Set(T,I,0),this.m_K.col2.Set(I,P,0);var L=this.m_K.Solve22(Box2D.Common.Math.b2Vec2.Get(0,0),-A,-M);S.x=L.x,S.y=L.y,S.z=0}var V=S.x*this.m_perp.x+S.z*this.m_axis.x,R=S.x*this.m_perp.y+S.z*this.m_axis.y,O=S.x*this.m_s1+S.y+S.z*this.m_a1,k=S.x*this.m_s2+S.y+S.z*this.m_a2;return n.x-=this.m_invMassA*V,n.y-=this.m_invMassA*R,r-=this.m_invIA*O,a.x+=this.m_invMassB*V,a.y+=this.m_invMassB*R,h+=this.m_invIB*k,o.m_sweep.a=r,s.m_sweep.a=h,o.SynchronizeTransform(),s.SynchronizeTransform(),d<=Box2D.Common.b2Settings.b2_linearSlop&&i<=Box2D.Common.b2Settings.b2_angularSlop},Box2D.Dynamics.Joints.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAxisA=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint,this.localAxisA.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},c2inherit(Box2D.Dynamics.Joints.b2PrismaticJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2PrismaticJointDef.prototype.Initialize=function(t,e,i,o){this.bodyA=t,this.bodyB=e,this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(i),this.localAxisA=this.bodyA.GetLocalVector(o),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.Dynamics.Joints.b2PrismaticJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2PrismaticJoint(this)},Box2D.Dynamics.Joints.b2PulleyJoint=function(t){Box2D.Dynamics.Joints.b2Joint.call(this,t),this.m_groundAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_groundAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_u1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_u2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=t.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=t.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=t.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=t.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_ratio=t.ratio,this.m_constant=t.lengthA+this.m_ratio*t.lengthB,this.m_maxLength1=Math.min(t.maxLengthA,this.m_constant-this.m_ratio*Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength),this.m_maxLength2=Math.min(t.maxLengthB,(this.m_constant-Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength)/this.m_ratio),this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},c2inherit(Box2D.Dynamics.Joints.b2PulleyJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),Box2D.Common.Math.b2Vec2.Get(t*this.m_impulse*this.m_u2.x,t*this.m_impulse*this.m_u2.y)},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),0},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetGroundAnchorA=function(){var t=this.m_ground.m_xf.position.Copy();return t.Add(this.m_groundAnchor1),t},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetGroundAnchorB=function(){var t=this.m_ground.m_xf.position.Copy();return t.Add(this.m_groundAnchor2),t},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetLength1=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),e=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,i=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,o=t.x-e,s=t.y-i;return Math.sqrt(o*o+s*s)},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetLength2=function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),e=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,i=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,o=t.x-e,s=t.y-i;return Math.sqrt(o*o+s*s)},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetRatio=function(){return this.m_ratio},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.InitVelocityConstraints=function(t){var e,i=this.m_bodyA,o=this.m_bodyB;e=i.m_xf.R;var s=this.m_localAnchor1.x-i.m_sweep.localCenter.x,n=this.m_localAnchor1.y-i.m_sweep.localCenter.y,r=e.col1.x*s+e.col2.x*n;n=e.col1.y*s+e.col2.y*n,s=r,e=o.m_xf.R;var a=this.m_localAnchor2.x-o.m_sweep.localCenter.x,h=this.m_localAnchor2.y-o.m_sweep.localCenter.y;r=e.col1.x*a+e.col2.x*h,h=e.col1.y*a+e.col2.y*h,a=r;var c=i.m_sweep.c.x+s,l=i.m_sweep.c.y+n,m=o.m_sweep.c.x+a,u=o.m_sweep.c.y+h,p=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,d=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,y=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,_=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(c-p,l-d),this.m_u2.Set(m-y,u-_);var f=this.m_u1.Length(),x=this.m_u2.Length();f>Box2D.Common.b2Settings.b2_linearSlop?this.m_u1.Multiply(1/f):this.m_u1.SetZero(),x>Box2D.Common.b2Settings.b2_linearSlop?this.m_u2.Multiply(1/x):this.m_u2.SetZero(),this.m_constant-f-this.m_ratio*x>0?(this.m_state=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_impulse=0):this.m_state=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit,f<this.m_maxLength1?(this.m_limitState1=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit,x<this.m_maxLength2?(this.m_limitState2=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit;var g=s*this.m_u1.y-n*this.m_u1.x,b=a*this.m_u2.y-h*this.m_u2.x;if(this.m_limitMass1=i.m_invMass+i.m_invI*g*g,this.m_limitMass2=o.m_invMass+o.m_invI*b*b,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,t.warmStarting){this.m_impulse*=t.dtRatio,this.m_limitImpulse1*=t.dtRatio,this.m_limitImpulse2*=t.dtRatio;var v=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,B=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,D=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,w=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y;i.m_linearVelocity.x+=i.m_invMass*v,i.m_linearVelocity.y+=i.m_invMass*B,i.m_angularVelocity+=i.m_invI*(s*B-n*v),o.m_linearVelocity.x+=o.m_invMass*D,o.m_linearVelocity.y+=o.m_invMass*w,o.m_angularVelocity+=o.m_invI*(a*w-h*D)}else this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.SolveVelocityConstraints=function(t){var e,i=this.m_bodyA,o=this.m_bodyB;e=i.m_xf.R;var s=this.m_localAnchor1.x-i.m_sweep.localCenter.x,n=this.m_localAnchor1.y-i.m_sweep.localCenter.y,r=e.col1.x*s+e.col2.x*n;n=e.col1.y*s+e.col2.y*n,s=r,e=o.m_xf.R;var a=this.m_localAnchor2.x-o.m_sweep.localCenter.x,h=this.m_localAnchor2.y-o.m_sweep.localCenter.y;r=e.col1.x*a+e.col2.x*h,h=e.col1.y*a+e.col2.y*h,a=r;var c=0,l=0,m=0,u=0,p=0,d=0,y=0,_=0,f=0,x=0,g=0;this.m_state==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(c=i.m_linearVelocity.x+-i.m_angularVelocity*n,l=i.m_linearVelocity.y+i.m_angularVelocity*s,m=o.m_linearVelocity.x+-o.m_angularVelocity*h,u=o.m_linearVelocity.y+o.m_angularVelocity*a,f=-(this.m_u1.x*c+this.m_u1.y*l)-this.m_ratio*(this.m_u2.x*m+this.m_u2.y*u),x=this.m_pulleyMass*-f,g=this.m_impulse,this.m_impulse=Math.max(0,this.m_impulse+x),p=-(x=this.m_impulse-g)*this.m_u1.x,d=-x*this.m_u1.y,y=-this.m_ratio*x*this.m_u2.x,_=-this.m_ratio*x*this.m_u2.y,i.m_linearVelocity.x+=i.m_invMass*p,i.m_linearVelocity.y+=i.m_invMass*d,i.m_angularVelocity+=i.m_invI*(s*d-n*p),o.m_linearVelocity.x+=o.m_invMass*y,o.m_linearVelocity.y+=o.m_invMass*_,o.m_angularVelocity+=o.m_invI*(a*_-h*y)),this.m_limitState1==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(c=i.m_linearVelocity.x+-i.m_angularVelocity*n,l=i.m_linearVelocity.y+i.m_angularVelocity*s,f=-(this.m_u1.x*c+this.m_u1.y*l),x=-this.m_limitMass1*f,g=this.m_limitImpulse1,this.m_limitImpulse1=Math.max(0,this.m_limitImpulse1+x),p=-(x=this.m_limitImpulse1-g)*this.m_u1.x,d=-x*this.m_u1.y,i.m_linearVelocity.x+=i.m_invMass*p,i.m_linearVelocity.y+=i.m_invMass*d,i.m_angularVelocity+=i.m_invI*(s*d-n*p)),this.m_limitState2==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(m=o.m_linearVelocity.x+-o.m_angularVelocity*h,u=o.m_linearVelocity.y+o.m_angularVelocity*a,f=-(this.m_u2.x*m+this.m_u2.y*u),x=-this.m_limitMass2*f,g=this.m_limitImpulse2,this.m_limitImpulse2=Math.max(0,this.m_limitImpulse2+x),y=-(x=this.m_limitImpulse2-g)*this.m_u2.x,_=-x*this.m_u2.y,o.m_linearVelocity.x+=o.m_invMass*y,o.m_linearVelocity.y+=o.m_invMass*_,o.m_angularVelocity+=o.m_invI*(a*_-h*y))},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.SolvePositionConstraints=function(t){void 0===t&&(t=0);var e,i=this.m_bodyA,o=this.m_bodyB,s=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,n=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,r=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,a=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,h=0,c=0,l=0,m=0,u=0,p=0,d=0,y=0,_=0,f=0,x=0,g=0,b=0,v=0;return this.m_state==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(e=i.m_xf.R,h=this.m_localAnchor1.x-i.m_sweep.localCenter.x,c=this.m_localAnchor1.y-i.m_sweep.localCenter.y,b=e.col1.x*h+e.col2.x*c,c=e.col1.y*h+e.col2.y*c,h=b,e=o.m_xf.R,l=this.m_localAnchor2.x-o.m_sweep.localCenter.x,m=this.m_localAnchor2.y-o.m_sweep.localCenter.y,b=e.col1.x*l+e.col2.x*m,m=e.col1.y*l+e.col2.y*m,l=b,u=i.m_sweep.c.x+h,p=i.m_sweep.c.y+c,d=o.m_sweep.c.x+l,y=o.m_sweep.c.y+m,this.m_u1.Set(u-s,p-n),this.m_u2.Set(d-r,y-a),_=this.m_u1.Length(),f=this.m_u2.Length(),_>Box2D.Common.b2Settings.b2_linearSlop?this.m_u1.Multiply(1/_):this.m_u1.SetZero(),f>Box2D.Common.b2Settings.b2_linearSlop?this.m_u2.Multiply(1/f):this.m_u2.SetZero(),x=this.m_constant-_-this.m_ratio*f,v=Math.max(v,-x),x=Box2D.Common.Math.b2Math.Clamp(x+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),u=-(g=-this.m_pulleyMass*x)*this.m_u1.x,p=-g*this.m_u1.y,d=-this.m_ratio*g*this.m_u2.x,y=-this.m_ratio*g*this.m_u2.y,i.m_sweep.c.x+=i.m_invMass*u,i.m_sweep.c.y+=i.m_invMass*p,i.m_sweep.a+=i.m_invI*(h*p-c*u),o.m_sweep.c.x+=o.m_invMass*d,o.m_sweep.c.y+=o.m_invMass*y,o.m_sweep.a+=o.m_invI*(l*y-m*d),i.SynchronizeTransform(),o.SynchronizeTransform()),this.m_limitState1==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(e=i.m_xf.R,h=this.m_localAnchor1.x-i.m_sweep.localCenter.x,c=this.m_localAnchor1.y-i.m_sweep.localCenter.y,b=e.col1.x*h+e.col2.x*c,c=e.col1.y*h+e.col2.y*c,h=b,u=i.m_sweep.c.x+h,p=i.m_sweep.c.y+c,this.m_u1.Set(u-s,p-n),(_=this.m_u1.Length())>Box2D.Common.b2Settings.b2_linearSlop?(this.m_u1.x*=1/_,this.m_u1.y*=1/_):this.m_u1.SetZero(),x=this.m_maxLength1-_,v=Math.max(v,-x),x=Box2D.Common.Math.b2Math.Clamp(x+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),u=-(g=-this.m_limitMass1*x)*this.m_u1.x,p=-g*this.m_u1.y,i.m_sweep.c.x+=i.m_invMass*u,i.m_sweep.c.y+=i.m_invMass*p,i.m_sweep.a+=i.m_invI*(h*p-c*u),i.SynchronizeTransform()),this.m_limitState2==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(e=o.m_xf.R,l=this.m_localAnchor2.x-o.m_sweep.localCenter.x,m=this.m_localAnchor2.y-o.m_sweep.localCenter.y,b=e.col1.x*l+e.col2.x*m,m=e.col1.y*l+e.col2.y*m,l=b,d=o.m_sweep.c.x+l,y=o.m_sweep.c.y+m,this.m_u2.Set(d-r,y-a),(f=this.m_u2.Length())>Box2D.Common.b2Settings.b2_linearSlop?(this.m_u2.x*=1/f,this.m_u2.y*=1/f):this.m_u2.SetZero(),x=this.m_maxLength2-f,v=Math.max(v,-x),x=Box2D.Common.Math.b2Math.Clamp(x+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),d=-(g=-this.m_limitMass2*x)*this.m_u2.x,y=-g*this.m_u2.y,o.m_sweep.c.x+=o.m_invMass*d,o.m_sweep.c.y+=o.m_invMass*y,o.m_sweep.a+=o.m_invI*(l*y-m*d),o.SynchronizeTransform()),v<Box2D.Common.b2Settings.b2_linearSlop},Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=1,Box2D.Dynamics.Joints.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.groundAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.groundAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint,this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.lengthA=0,this.maxLengthA=0,this.lengthB=0,this.maxLengthB=0,this.ratio=1,this.collideConnected=!0},c2inherit(Box2D.Dynamics.Joints.b2PulleyJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2PulleyJointDef.prototype.Initialize=function(t,e,i,o,s,n,r){void 0===r&&(r=0),this.bodyA=t,this.bodyB=e,this.groundAnchorA.SetV(i),this.groundAnchorB.SetV(o),this.localAnchorA=this.bodyA.GetLocalPoint(s),this.localAnchorB=this.bodyB.GetLocalPoint(n);var a=s.x-i.x,h=s.y-i.y;this.lengthA=Math.sqrt(a*a+h*h);var c=n.x-o.x,l=n.y-o.y;this.lengthB=Math.sqrt(c*c+l*l),this.ratio=r;var m=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=m-this.ratio*Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength,this.maxLengthB=(m-Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength)/this.ratio},Box2D.Dynamics.Joints.b2PulleyJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2PulleyJoint(this)},Box2D.Dynamics.Joints.b2RevoluteJoint=function(t){Box2D.Dynamics.Joints.b2Joint.call(this,t),this.K=new Box2D.Common.Math.b2Mat22,this.K1=new Box2D.Common.Math.b2Mat22,this.K2=new Box2D.Common.Math.b2Mat22,this.K3=new Box2D.Common.Math.b2Mat22,this.impulse3=new Box2D.Common.Math.b2Vec3(0,0,0),this.impulse2=Box2D.Common.Math.b2Vec2.Get(0,0),this.reduced=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_impulse=new Box2D.Common.Math.b2Vec3(0,0,0),this.m_mass=new Box2D.Common.Math.b2Mat33,this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_referenceAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=t.lowerAngle,this.m_upperAngle=t.upperAngle,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit},c2inherit(Box2D.Dynamics.Joints.b2RevoluteJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),Box2D.Common.Math.b2Vec2.Get(t*this.m_impulse.x,t*this.m_impulse.y)},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.z},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.EnableLimit=function(t){this.m_enableLimit=t},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetLowerLimit=function(){return this.m_lowerAngle},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetUpperLimit=function(){return this.m_upperAngle},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SetLimits=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.m_lowerAngle=t,this.m_upperAngle=e},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.EnableMotor=function(t){this.m_enableMotor=t},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SetMotorSpeed=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SetMaxMotorTorque=function(t){void 0===t&&(t=0),this.m_maxMotorTorque=t},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.InitVelocityConstraints=function(t){var e,i=this.m_bodyA,o=this.m_bodyB,s=0;e=i.m_xf.R;var n=this.m_localAnchor1.x-i.m_sweep.localCenter.x,r=this.m_localAnchor1.y-i.m_sweep.localCenter.y;s=e.col1.x*n+e.col2.x*r,r=e.col1.y*n+e.col2.y*r,n=s,e=o.m_xf.R;var a=this.m_localAnchor2.x-o.m_sweep.localCenter.x,h=this.m_localAnchor2.y-o.m_sweep.localCenter.y;s=e.col1.x*a+e.col2.x*h,h=e.col1.y*a+e.col2.y*h,a=s;var c=i.m_invMass,l=o.m_invMass,m=i.m_invI,u=o.m_invI;if(this.m_mass.col1.x=c+l+r*r*m+h*h*u,this.m_mass.col2.x=-r*n*m-h*a*u,this.m_mass.col3.x=-r*m-h*u,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=c+l+n*n*m+a*a*u,this.m_mass.col3.y=n*m+a*u,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=m+u,this.m_motorMass=1/(m+u),this.m_enableMotor||(this.m_motorImpulse=0),this.m_enableLimit){var p=o.m_sweep.a-i.m_sweep.a-this.m_referenceAngle;Math.abs(this.m_upperAngle-this.m_lowerAngle)<2*Box2D.Common.b2Settings.b2_angularSlop?this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_equalLimits:p<=this.m_lowerAngle?(this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit):p>=this.m_upperAngle?(this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit):(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit;if(t.warmStarting){this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_motorImpulse*=t.dtRatio;var d=this.m_impulse.x,y=this.m_impulse.y;i.m_linearVelocity.x-=c*d,i.m_linearVelocity.y-=c*y,i.m_angularVelocity-=m*(n*y-r*d+this.m_motorImpulse+this.m_impulse.z),o.m_linearVelocity.x+=l*d,o.m_linearVelocity.y+=l*y,o.m_angularVelocity+=u*(a*y-h*d+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SolveVelocityConstraints=function(t){var e,i=this.m_bodyA,o=this.m_bodyB,s=0,n=0,r=0,a=0,h=0,c=i.m_linearVelocity,l=i.m_angularVelocity,m=o.m_linearVelocity,u=o.m_angularVelocity,p=i.m_invMass,d=o.m_invMass,y=i.m_invI,_=o.m_invI;if(this.m_enableMotor&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_equalLimits){var f=u-l-this.m_motorSpeed,x=this.m_motorMass*-f,g=this.m_motorImpulse,b=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=Box2D.Common.Math.b2Math.Clamp(this.m_motorImpulse+x,-b,b),l-=y*(x=this.m_motorImpulse-g),u+=_*x}if(this.m_enableLimit&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit){e=i.m_xf.R,n=this.m_localAnchor1.x-i.m_sweep.localCenter.x,r=this.m_localAnchor1.y-i.m_sweep.localCenter.y,s=e.col1.x*n+e.col2.x*r,r=e.col1.y*n+e.col2.y*r,n=s,e=o.m_xf.R,a=this.m_localAnchor2.x-o.m_sweep.localCenter.x,h=this.m_localAnchor2.y-o.m_sweep.localCenter.y,s=e.col1.x*a+e.col2.x*h,h=e.col1.y*a+e.col2.y*h,a=s;var v=m.x+-u*h-c.x- -l*r,B=m.y+u*a-c.y-l*n,D=u-l;this.m_mass.Solve33(this.impulse3,-v,-B,-D),this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit?this.m_impulse.z+this.impulse3.z<0&&(this.m_mass.Solve22(this.reduced,-v,-B),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&this.m_impulse.z+this.impulse3.z>0&&(this.m_mass.Solve22(this.reduced,-v,-B),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0),c.x-=p*this.impulse3.x,c.y-=p*this.impulse3.y,l-=y*(n*this.impulse3.y-r*this.impulse3.x+this.impulse3.z),m.x+=d*this.impulse3.x,m.y+=d*this.impulse3.y,u+=_*(a*this.impulse3.y-h*this.impulse3.x+this.impulse3.z)}else{e=i.m_xf.R,n=this.m_localAnchor1.x-i.m_sweep.localCenter.x,r=this.m_localAnchor1.y-i.m_sweep.localCenter.y,s=e.col1.x*n+e.col2.x*r,r=e.col1.y*n+e.col2.y*r,n=s,e=o.m_xf.R,a=this.m_localAnchor2.x-o.m_sweep.localCenter.x,h=this.m_localAnchor2.y-o.m_sweep.localCenter.y,s=e.col1.x*a+e.col2.x*h,h=e.col1.y*a+e.col2.y*h,a=s;var w=m.x+-u*h-c.x- -l*r,C=m.y+u*a-c.y-l*n;this.m_mass.Solve22(this.impulse2,-w,-C),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,c.x-=p*this.impulse2.x,c.y-=p*this.impulse2.y,l-=y*(n*this.impulse2.y-r*this.impulse2.x),m.x+=d*this.impulse2.x,m.y+=d*this.impulse2.y,u+=_*(a*this.impulse2.y-h*this.impulse2.x)}i.m_linearVelocity.SetV(c),i.m_angularVelocity=l,o.m_linearVelocity.SetV(m),o.m_angularVelocity=u},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SolvePositionConstraints=function(t){void 0===t&&(t=0);var e,i,o=0,s=this.m_bodyA,n=this.m_bodyB,r=0,a=0,h=0,c=0;if(this.m_enableLimit&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit){var l=n.m_sweep.a-s.m_sweep.a-this.m_referenceAngle,m=0;this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_equalLimits?(o=Box2D.Common.Math.b2Math.Clamp(l-this.m_lowerAngle,-Box2D.Common.b2Settings.b2_maxAngularCorrection,Box2D.Common.b2Settings.b2_maxAngularCorrection),m=-this.m_motorMass*o,r=Math.abs(o)):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit?(r=-(o=l-this.m_lowerAngle),o=Box2D.Common.Math.b2Math.Clamp(o+Box2D.Common.b2Settings.b2_angularSlop,-Box2D.Common.b2Settings.b2_maxAngularCorrection,0),m=-this.m_motorMass*o):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(r=o=l-this.m_upperAngle,o=Box2D.Common.Math.b2Math.Clamp(o-Box2D.Common.b2Settings.b2_angularSlop,0,Box2D.Common.b2Settings.b2_maxAngularCorrection),m=-this.m_motorMass*o),s.m_sweep.a-=s.m_invI*m,n.m_sweep.a+=n.m_invI*m,s.SynchronizeTransform(),n.SynchronizeTransform()}e=s.m_xf.R;var u=this.m_localAnchor1.x-s.m_sweep.localCenter.x,p=this.m_localAnchor1.y-s.m_sweep.localCenter.y;a=e.col1.x*u+e.col2.x*p,p=e.col1.y*u+e.col2.y*p,u=a,e=n.m_xf.R;var d=this.m_localAnchor2.x-n.m_sweep.localCenter.x,y=this.m_localAnchor2.y-n.m_sweep.localCenter.y;a=e.col1.x*d+e.col2.x*y,y=e.col1.y*d+e.col2.y*y,d=a;var _=n.m_sweep.c.x+d-s.m_sweep.c.x-u,f=n.m_sweep.c.y+y-s.m_sweep.c.y-p,x=_*_+f*f,g=Math.sqrt(x);i=g;var b=s.m_invMass,v=n.m_invMass,B=s.m_invI,D=n.m_invI,w=10*Box2D.Common.b2Settings.b2_linearSlop;if(x>w*w){var C=1/(b+v);h=C*-_,c=C*-f;s.m_sweep.c.x-=.5*b*h,s.m_sweep.c.y-=.5*b*c,n.m_sweep.c.x+=.5*v*h,n.m_sweep.c.y+=.5*v*c,_=n.m_sweep.c.x+d-s.m_sweep.c.x-u,f=n.m_sweep.c.y+y-s.m_sweep.c.y-p}return this.K1.col1.x=b+v,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=b+v,this.K2.col1.x=B*p*p,this.K2.col2.x=-B*u*p,this.K2.col1.y=-B*u*p,this.K2.col2.y=B*u*u,this.K3.col1.x=D*y*y,this.K3.col2.x=-D*d*y,this.K3.col1.y=-D*d*y,this.K3.col2.y=D*d*d,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse,-_,-f),h=Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse.x,c=Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse.y,s.m_sweep.c.x-=s.m_invMass*h,s.m_sweep.c.y-=s.m_invMass*c,s.m_sweep.a-=s.m_invI*(u*c-p*h),n.m_sweep.c.x+=n.m_invMass*h,n.m_sweep.c.y+=n.m_invMass*c,n.m_sweep.a+=n.m_invI*(d*c-y*h),s.SynchronizeTransform(),n.SynchronizeTransform(),i<=Box2D.Common.b2Settings.b2_linearSlop&&r<=Box2D.Common.b2Settings.b2_angularSlop},Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Dynamics.Joints.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint,this.localAnchorA.SetZero(),this.localAnchorB.SetZero(),this.referenceAngle=0,this.lowerAngle=0,this.upperAngle=0,this.maxMotorTorque=0,this.motorSpeed=0,this.enableLimit=!1,this.enableMotor=!1},c2inherit(Box2D.Dynamics.Joints.b2RevoluteJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2RevoluteJointDef.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(i),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.Dynamics.Joints.b2RevoluteJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2RevoluteJoint(this)},Box2D.Dynamics.Joints.b2WeldJoint=function(t){Box2D.Dynamics.Joints.b2Joint.call(this,t),this.m_localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_impulse=new Box2D.Common.Math.b2Vec3(0,0,0),this.m_mass=new Box2D.Common.Math.b2Mat33,this.m_localAnchorA.SetV(t.localAnchorA),this.m_localAnchorB.SetV(t.localAnchorB),this.m_referenceAngle=t.referenceAngle},c2inherit(Box2D.Dynamics.Joints.b2WeldJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2WeldJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},Box2D.Dynamics.Joints.b2WeldJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},Box2D.Dynamics.Joints.b2WeldJoint.prototype.GetReactionForce=function(t){return Box2D.Common.Math.b2Vec2.Get(t*this.m_impulse.x,t*this.m_impulse.y)},Box2D.Dynamics.Joints.b2WeldJoint.prototype.GetReactionTorque=function(t){return t*this.m_impulse.z},Box2D.Dynamics.Joints.b2WeldJoint.prototype.InitVelocityConstraints=function(t){var e,i=0,o=this.m_bodyA,s=this.m_bodyB;e=o.m_xf.R;var n=this.m_localAnchorA.x-o.m_sweep.localCenter.x,r=this.m_localAnchorA.y-o.m_sweep.localCenter.y;i=e.col1.x*n+e.col2.x*r,r=e.col1.y*n+e.col2.y*r,n=i,e=s.m_xf.R;var a=this.m_localAnchorB.x-s.m_sweep.localCenter.x,h=this.m_localAnchorB.y-s.m_sweep.localCenter.y;i=e.col1.x*a+e.col2.x*h,h=e.col1.y*a+e.col2.y*h,a=i;var c=o.m_invMass,l=s.m_invMass,m=o.m_invI,u=s.m_invI;this.m_mass.col1.x=c+l+r*r*m+h*h*u,this.m_mass.col2.x=-r*n*m-h*a*u,this.m_mass.col3.x=-r*m-h*u,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=c+l+n*n*m+a*a*u,this.m_mass.col3.y=n*m+a*u,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=m+u,t.warmStarting?(this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_impulse.z*=t.dtRatio,o.m_linearVelocity.x-=c*this.m_impulse.x,o.m_linearVelocity.y-=c*this.m_impulse.y,o.m_angularVelocity-=m*(n*this.m_impulse.y-r*this.m_impulse.x+this.m_impulse.z),s.m_linearVelocity.x+=l*this.m_impulse.x,s.m_linearVelocity.y+=l*this.m_impulse.y,s.m_angularVelocity+=u*(a*this.m_impulse.y-h*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()},Box2D.Dynamics.Joints.b2WeldJoint.prototype.SolveVelocityConstraints=function(t){var e,i=0,o=this.m_bodyA,s=this.m_bodyB,n=o.m_linearVelocity,r=o.m_angularVelocity,a=s.m_linearVelocity,h=s.m_angularVelocity,c=o.m_invMass,l=s.m_invMass,m=o.m_invI,u=s.m_invI;e=o.m_xf.R;var p=this.m_localAnchorA.x-o.m_sweep.localCenter.x,d=this.m_localAnchorA.y-o.m_sweep.localCenter.y;i=e.col1.x*p+e.col2.x*d,d=e.col1.y*p+e.col2.y*d,p=i,e=s.m_xf.R;var y=this.m_localAnchorB.x-s.m_sweep.localCenter.x,_=this.m_localAnchorB.y-s.m_sweep.localCenter.y;i=e.col1.x*y+e.col2.x*_,_=e.col1.y*y+e.col2.y*_,y=i;var f=a.x-h*_-n.x+r*d,x=a.y+h*y-n.y-r*p,g=h-r,b=new Box2D.Common.Math.b2Vec3(0,0,0);this.m_mass.Solve33(b,-f,-x,-g),this.m_impulse.Add(b),n.x-=c*b.x,n.y-=c*b.y,r-=m*(p*b.y-d*b.x+b.z),a.x+=l*b.x,a.y+=l*b.y,h+=u*(y*b.y-_*b.x+b.z),o.m_angularVelocity=r,s.m_angularVelocity=h},Box2D.Dynamics.Joints.b2WeldJoint.prototype.SolvePositionConstraints=function(t){var e;void 0===t&&(t=0);var i=0,o=this.m_bodyA,s=this.m_bodyB;e=o.m_xf.R;var n=this.m_localAnchorA.x-o.m_sweep.localCenter.x,r=this.m_localAnchorA.y-o.m_sweep.localCenter.y;i=e.col1.x*n+e.col2.x*r,r=e.col1.y*n+e.col2.y*r,n=i,e=s.m_xf.R;var a=this.m_localAnchorB.x-s.m_sweep.localCenter.x,h=this.m_localAnchorB.y-s.m_sweep.localCenter.y;i=e.col1.x*a+e.col2.x*h,h=e.col1.y*a+e.col2.y*h,a=i;var c=o.m_invMass,l=s.m_invMass,m=o.m_invI,u=s.m_invI,p=s.m_sweep.c.x+a-o.m_sweep.c.x-n,d=s.m_sweep.c.y+h-o.m_sweep.c.y-r,y=s.m_sweep.a-o.m_sweep.a-this.m_referenceAngle,_=10*Box2D.Common.b2Settings.b2_linearSlop,f=Math.sqrt(p*p+d*d),x=Math.abs(y);f>_&&(m*=1,u*=1),this.m_mass.col1.x=c+l+r*r*m+h*h*u,this.m_mass.col2.x=-r*n*m-h*a*u,this.m_mass.col3.x=-r*m-h*u,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=c+l+n*n*m+a*a*u,this.m_mass.col3.y=n*m+a*u,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=m+u;var g=new Box2D.Common.Math.b2Vec3(0,0,0);return this.m_mass.Solve33(g,-p,-d,-y),o.m_sweep.c.x-=c*g.x,o.m_sweep.c.y-=c*g.y,o.m_sweep.a-=m*(n*g.y-r*g.x+g.z),s.m_sweep.c.x+=l*g.x,s.m_sweep.c.y+=l*g.y,s.m_sweep.a+=u*(a*g.y-h*g.x+g.z),o.SynchronizeTransform(),s.SynchronizeTransform(),f<=Box2D.Common.b2Settings.b2_linearSlop&&x<=Box2D.Common.b2Settings.b2_angularSlop},Box2D.Dynamics.Joints.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_weldJoint,this.referenceAngle=0},c2inherit(Box2D.Dynamics.Joints.b2WeldJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2WeldJointDef.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(i)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(i)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.Dynamics.Joints.b2WeldJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2WeldJoint(this)},Box2D.Collision.b2Collision.s_incidentEdge=Box2D.Collision.b2Collision.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints1=Box2D.Collision.b2Collision.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints2=Box2D.Collision.b2Collision.MakeClipPointVector(),Box2D.Collision.b2Collision.s_localTangent=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_localNormal=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_planePoint=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_normal=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_tangent=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_tangent2=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_v11=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_v12=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0,Box2D.Collision.b2TimeOfImpact.b2_toiIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0,Box2D.Collision.b2TimeOfImpact.s_cache=new Box2D.Collision.b2SimplexCache,Box2D.Collision.b2TimeOfImpact.s_distanceInput=new Box2D.Collision.b2DistanceInput,Box2D.Collision.b2TimeOfImpact.s_xfA=new Box2D.Common.Math.b2Transform,Box2D.Collision.b2TimeOfImpact.s_xfB=new Box2D.Common.Math.b2Transform,Box2D.Collision.b2TimeOfImpact.s_fcn=new Box2D.Collision.b2SeparationFunction,Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new Box2D.Collision.b2DistanceOutput,Box2D.Dynamics.b2Body.s_xf1=new Box2D.Common.Math.b2Transform,Box2D.Dynamics.b2ContactListener.b2_defaultListener=new Box2D.Dynamics.b2ContactListener,Box2D.Dynamics.b2ContactManager.s_evalCP=new Box2D.Collision.b2ContactPoint,Box2D.Dynamics.b2World.s_xf=new Box2D.Common.Math.b2Transform,Box2D.Dynamics.b2World.s_backupA=new Box2D.Common.Math.b2Sweep,Box2D.Dynamics.b2World.s_backupB=new Box2D.Common.Math.b2Sweep,Box2D.Dynamics.Contacts.b2Contact.s_input=new Box2D.Collision.b2TOIInput,Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new Box2D.Collision.b2WorldManifold,Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new Box2D.Dynamics.Contacts.b2PositionSolverManifold,cr.b2Separator=function(){},cr.b2Separator.det=function(t,e,i,o,s,n){return t*o+i*n+s*e-e*i-o*s-n*t},cr.b2Separator.hitRay=function(t,e,i,o,s,n,r,a){var h=i-t,c=o-e,l=r-s,m=a-n,u=(l*(n-e)-m*(s-t))/(c*l-h*m),p=t+u*h,d=e+u*c,y=cr.b2Separator.isOnSegment(i,o,t,e,p,d),_=cr.b2Separator.isOnSegment(p,d,s,n,r,a);return y&&_?Box2D.Common.Math.b2Vec2.Get(p,d):null},cr.b2Separator.isOnSegment=function(t,e,i,o,s,n){return(i+.1>=t&&t>=s-.1||i-.1<=t&&t<=s+.1)&&(o+.1>=e&&e>=n-.1||o-.1<=e&&e<=n+.1)&&cr.b2Separator.isOnLine(t,e,i,o,s,n)},cr.b2Separator.isOnLine=function(t,e,i,o,s,n){if(Math.abs(s-i)>.1){var r=(n-o)/(s-i)*(t-i)+o;return Math.abs(r-e)<.1}return Math.abs(t-i)<.1},cr.b2Separator.pointsMatch=function(t,e,i,o){return Math.abs(i-t)<.1&&Math.abs(o-e)<.1},cr.b2Separator.Separate=function(t,e){var i,o,s,n,r,a,h,c,l,m=Box2D.Common.Math.b2Vec2,u=cr.b2Separator.calcShapes(t),p=[];for(r=0,a=u.length;r<a;r++){for(o=u[r],(i=[]).length=o.length,l=0,h=0,c=o.length;h<c;h++)s=o[h],n=o[(h+1)%c],l+=s.x*n.y-s.y*n.x,i[h]=m.Get(s.x,s.y);(l=Math.abs(l/2))>=.001*e&&p.push(i)}return p},cr.b2Separator.calcShapes=function(t){var e,i,o,s,n,r,a,h=[],c=0,l=0,m=0,u=0,p=0,d=0,y=0,_=0,f=0,x=0,g=0,b=0,v=0,B=0,D=[],w=[],C=!1,S=[],A=[];for(A.push(t);A.length;){for(l=(h=A[0]).length,C=!0,c=0;c<l;c++)if(f=c<l-1?c+1:c+1-l,x=c<l-2?c+2:c+2-l,e=h[_=c],i=h[f],o=h[x],cr.b2Separator.det(e.x,e.y,i.x,i.y,o.x,o.y)<0){for(C=!1,y=1e9,m=0;m<l;m++)m!==_&&m!==f&&(b=m<l-1?m+1:0,s=h[g=m],n=h[b],(r=cr.b2Separator.hitRay(e.x,e.y,i.x,i.y,s.x,s.y,n.x,n.y))&&(u=(p=i.x-r.x)*p+(d=i.y-r.y)*d)<y&&(B=g,v=b,a=r,y=u));if(1e9===y)return[];for(D=[],w=[],b=v,s=h[g=B],n=h[b],cr.b2Separator.pointsMatch(a.x,a.y,n.x,n.y)||D.push(a),cr.b2Separator.pointsMatch(a.x,a.y,s.x,s.y)||w.push(a),B=-1,v=_;;){if(v===b){if(B<0||B>=l)return[];cr.b2Separator.isOnSegment(n.x,n.y,h[B].x,h[B].y,e.x,e.y)||D.push(h[v]);break}D.push(h[v]),B=v,v-1<0?v=l-1:v--}for(D.reverse(),B=-1,v=f;;){if(v===g){if(B<0||B>=l)return[];v!==g||cr.b2Separator.isOnSegment(s.x,s.y,h[B].x,h[B].y,i.x,i.y)||w.push(h[v]);break}w.push(h[v]),B=v,v+1>l-1?v=0:v++}A.push(D,w),A.shift();break}C&&S.push(A.shift())}return S},cr.behaviors.Physics=function(t){for(var e=0;e<4e3;e++)Box2D.Common.Math.b2Vec2._freeCache.push(new Box2D.Common.Math.b2Vec2(0,0));this.runtime=t,this.world=new Box2D.Dynamics.b2World(Box2D.Common.Math.b2Vec2.Get(0,10),!0),this.worldG=10,this.lastUpdateTick=-1;var i=new Box2D.Dynamics.b2ContactListener;i.behavior=this,i.BeginContact=function(t){var e=t.m_fixtureA.GetBody().c2userdata,i=t.m_fixtureB.GetBody().c2userdata;this.behavior.runtime.registerCollision(e.inst,i.inst)},this.world.SetContactListener(i);var o=new Box2D.Dynamics.b2ContactFilter;o.behavior=this,o.ShouldCollide=function(t,e){if(this.behavior.allCollisionsEnabled)return!0;var i=t.GetBody().c2userdata.inst.type,o=e.GetBody().c2userdata.inst.type,s=i.extra.Physics_DisabledCollisions;return(!s||!s.contains(o))&&(!(s=o.extra.Physics_DisabledCollisions)||!s.contains(i))},this.world.SetContactFilter(o),this.steppingMode=0,this.velocityIterations=8,this.positionIterations=3,this.allCollisionsEnabled=!0},function(){var t=Box2D.Common.Math.b2Vec2,e=Box2D.Dynamics.b2BodyDef,i=(Box2D.Dynamics.b2Body,Box2D.Dynamics.b2FixtureDef),o=(Box2D.Dynamics.b2Fixture,Box2D.Dynamics.b2World,Box2D.Collision.Shapes.b2PolygonShape),s=Box2D.Collision.Shapes.b2CircleShape,n=Box2D.Dynamics.Joints.b2DistanceJointDef,r=Box2D.Dynamics.Joints.b2RevoluteJointDef,a=(Box2D.Common.Math.b2Transform,Box2D.Common.Math.b2Mat22,cr.behaviors.Physics.prototype);a.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},a.Type.prototype.onCreate=function(){},a.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime,this.world=this.behavior.world};var h=a.Instance.prototype;h.onCreate=function(){this.immovable=0!==this.properties[0],this.collisionmask=this.properties[1],this.preventRotation=0!==this.properties[2],this.density=this.properties[3],this.friction=this.properties[4],this.restitution=this.properties[5],this.linearDamping=this.properties[6],this.angularDamping=this.properties[7],this.bullet=0!==this.properties[8],this.enabled=0!==this.properties[9],this.body=null,this.inst.update_bbox(),this.lastKnownX=this.inst.x,this.lastKnownY=this.inst.y,this.lastKnownAngle=this.inst.angle,this.lastWidth=0,this.lastHeight=0,this.lastTickOverride=!1,this.recreateBody=!1,this.lastAnimation=null,this.lastAnimationFrame=-1,this.myJoints?(this.myJoints.length=0,this.myCreatedJoints.length=0,this.joiningMe.clear()):(this.myJoints=[],this.myCreatedJoints=[],this.joiningMe=new cr.ObjectSet);var t=this;this.recycled||(this.myDestroyCallback=function(e){t.onInstanceDestroyed(e)}),this.runtime.addDestroyCallback(this.myDestroyCallback)},h.postCreate=function(){this.inst.update_bbox(),this.createBody(),this.lastAnimation=this.inst.cur_animation,this.lastAnimationFrame=this.inst.cur_frame},h.onDestroy=function(){this.destroyMyJoints(),this.myCreatedJoints.length=0,this.joiningMe.clear(),this.body&&(this.world.DestroyBody(this.body),this.body=null),this.runtime.removeDestroyCallback(this.myDestroyCallback)},h.saveToJSON=function(){var e={e:this.enabled,im:this.immovable,pr:this.preventRotation,d:this.density,fr:this.friction,re:this.restitution,ld:this.linearDamping,ad:this.angularDamping,b:this.bullet,mcj:this.myCreatedJoints};if(this.enabled){var i=t.Get(0,0);i.SetV(this.body.GetLinearVelocity()),e.vx=i.x,e.vy=i.y,e.om=this.body.GetAngularVelocity()}return e},h.loadFromJSON=function(e){this.destroyMyJoints(),this.myCreatedJoints.length=0,this.joiningMe.clear(),this.body&&(this.world.DestroyBody(this.body),this.body=null),this.enabled=e.e,this.immovable=e.im,this.preventRotation=e.pr,this.density=e.d,this.friction=e.fr,this.restitution=e.re,this.linearDamping=e.ld,this.angularDamping=e.ad,this.bullet=e.b,this.lastKnownX=this.inst.x,this.lastKnownY=this.inst.y,this.lastKnownAngle=this.inst.angle,this.lastWidth=this.inst.width,this.lastHeight=this.inst.height,this.enabled&&(this.createBody(),this.body.SetLinearVelocity(t.Get(e.vx,e.vy)),this.body.SetAngularVelocity(e.om),0===e.vx&&0===e.vy&&0===e.om||this.body.SetAwake(!0),this.myCreatedJoints=e.mcj)},h.afterLoad=function(){this.enabled&&this.recreateMyJoints(),this.behavior.lastUpdateTick=this.runtime.tickcount-1},h.onInstanceDestroyed=function(t){var e,i,o,s=t.uid;for(e=0,o=0,i=this.myCreatedJoints.length;e<i;e++)this.myCreatedJoints[o]=this.myCreatedJoints[e],o<this.myJoints.length&&(this.myJoints[o]=this.myJoints[e]),this.myCreatedJoints[e].params[1]==s?this.world.DestroyJoint(this.myJoints[e]):o++;this.myCreatedJoints.length=o,o<this.myJoints.length&&(this.myJoints.length=o),this.joiningMe.remove(t)},h.destroyMyJoints=function(){var t,e;for(t=0,e=this.myJoints.length;t<e;t++)this.world.DestroyJoint(this.myJoints[t]);this.myJoints.length=0},h.recreateMyJoints=function(){var t,e,i;for(t=0,e=this.myCreatedJoints.length;t<e;t++)switch((i=this.myCreatedJoints[t]).type){case 0:this.doCreateDistanceJoint(i.params[0],i.params[1],i.params[2],i.params[3],i.params[4]);break;case 1:this.doCreateRevoluteJoint(i.params[0],i.params[1]);break;case 2:this.doCreateLimitedRevoluteJoint(i.params[0],i.params[1],i.params[2],i.params[3])}},h.destroyBody=function(){this.body&&(this.destroyMyJoints(),this.world.DestroyBody(this.body),this.body=null,this.inst.extra.box2dbody=null)};var c=[];function l(){}function m(){}function u(t,e,i){var o;i?((o=t.extra.Physics_DisabledCollisions)&&o.remove(e),(o=e.extra.Physics_DisabledCollisions)&&o.remove(t)):(t.extra.Physics_DisabledCollisions||(t.extra.Physics_DisabledCollisions=new cr.ObjectSet),t.extra.Physics_DisabledCollisions.add(e),e.extra.Physics_DisabledCollisions||(e.extra.Physics_DisabledCollisions=new cr.ObjectSet),e.extra.Physics_DisabledCollisions.add(t))}function p(){}h.createBody=function(){if(this.enabled){var n,r,a,h,l,m,u,p,d,y,_,f,x,g,b,v,B,D=this.inst,w=!1,C=null,S=null;if(this.body){for(w=!0,(C=t.Get(0,0)).SetV(this.body.GetLinearVelocity()),S=this.body.GetAngularVelocity(),n=0,r=(p=this.joiningMe.valuesRef()).length;n<r;n++)p[n].extra.box2dbody.c2userdata.destroyMyJoints();this.destroyBody()}var A=new i;A.density=this.density,A.friction=this.friction,A.restitution=this.restitution;var M=new e;this.immovable?M.type=0:M.type=2,D.update_bbox(),M.position.x=.02*D.bquad.midX(),M.position.y=.02*D.bquad.midY(),M.angle=D.angle,M.fixedRotation=this.preventRotation,M.linearDamping=this.linearDamping,M.angularDamping=this.angularDamping,M.bullet=this.bullet;var T=this.inst.collision_poly&&!this.inst.collision_poly.is_empty();this.body=this.world.CreateBody(M),this.body.c2userdata=this;var I=this.collisionmask;T||this.inst.tilemap_exists||0!==this.collisionmask||(I=1);var P=Math.max(Math.abs(D.width),1),L=Math.max(Math.abs(D.height),1),V=D.width<0,R=D.height<0;if(0===I)if(D.tilemap_exists)for(b=D.bquad.midX()-D.x,v=D.bquad.midY()-D.y,D.getAllCollisionRects(c),p=[],n=0,r=c.length;n<r;++n){if(y=(d=c[n]).rc,d.poly){if(!d.poly.convexpolys){for(_=d.poly.pts_cache,f=d.poly.pts_count,a=0;a<f;++a)p.push(t.Get(_[2*a],_[2*a+1]));var O=3758096384&d.id;for((-2147483648===O||1073741824===O||536870912===O||-2147483648&O&&1073741824&O&&536870912&O)&&p.reverse(),d.poly.convexpolys=cr.b2Separator.Separate(p,(y.right-y.left)*(y.bottom-y.top)),a=0,h=p.length;a<h;++a)t.Free(p[a]);p.length=0}for(a=0,h=d.poly.convexpolys.length;a<h;++a){for(l=0,m=(g=d.poly.convexpolys[a]).length;l<m;++l)p.push(t.Get(.02*(y.left+g[l].x-b),.02*(y.top+g[l].y-v)));for(A.shape=new o,A.shape.SetAsArray(p,p.length),this.body.CreateFixture(A),l=0,m=p.length;l<m;++l)t.Free(p[l]);p.length=0}}else p.push(t.Get(.02*(y.left-b),.02*(y.top-v))),p.push(t.Get(.02*(y.right-b),.02*(y.top-v))),p.push(t.Get(.02*(y.right-b),.02*(y.bottom-v))),p.push(t.Get(.02*(y.left-b),.02*(y.bottom-v))),A.shape=new o,A.shape.SetAsArray(p,p.length),this.body.CreateFixture(A);for(a=0,h=p.length;a<h;++a)t.Free(p[a]);p.length=0}else{for(B=D.angle,D.angle=0,D.set_bbox_changed(),D.update_bbox(),b=D.bquad.midX()-D.x,v=D.bquad.midY()-D.y,D.angle=B,D.set_bbox_changed(),D.collision_poly.cache_poly(V?-P:P,R?-L:L,0),_=D.collision_poly.pts_cache,f=D.collision_poly.pts_count,(p=[]).length=f,n=0;n<f;n++)p[n]=t.Get(_[2*n]-b,_[2*n+1]-v);for(V!==R&&p.reverse(),x=cr.b2Separator.Separate(p,P*L),n=0;n<f;n++)t.Free(p[n]);if(x.length)for(n=0,r=x.length;n<r;n++){for(a=0,h=(p=x[n]).length;a<h;a++)(u=p[a]).x*=.02,u.y*=.02;for(A.shape=new o,A.shape.SetAsArray(p,p.length),this.body.CreateFixture(A),a=0,h=p.length;a<h;a++)t.Free(p[a])}else A.shape=new o,A.shape.SetAsBox(.02*P*.5,.02*L*.5),this.body.CreateFixture(A)}else 1===I?(A.shape=new o,A.shape.SetAsBox(.02*P*.5,.02*L*.5),this.body.CreateFixture(A)):(A.shape=new s(.02*Math.min(P,L)*.5),this.body.CreateFixture(A));if(D.extra.box2dbody=this.body,this.lastWidth=D.width,this.lastHeight=D.height,w)for(this.body.SetLinearVelocity(C),this.body.SetAngularVelocity(S),t.Free(C),this.recreateMyJoints(),n=0,r=(p=this.joiningMe.valuesRef()).length;n<r;n++)p[n].extra.box2dbody.c2userdata.recreateMyJoints();c.length=0}},h.tick=function(){if(this.enabled){var e,i=this.inst;0===this.behavior.steppingMode?e=this.runtime.timescale/60:(e=this.runtime.getDt(this.inst))>1/30&&(e=1/30),this.runtime.tickcount>this.behavior.lastUpdateTick&&this.runtime.timescale>0&&(this.world.Step(e,this.behavior.velocityIterations,this.behavior.positionIterations),this.world.ClearForces(),this.behavior.lastUpdateTick=this.runtime.tickcount),(this.recreateBody||i.width!==this.lastWidth||i.height!==this.lastHeight||i.cur_animation!==this.lastAnimation||i.cur_frame!==this.lastAnimationFrame||i.tilemap_exists&&i.physics_changed)&&(this.createBody(),this.recreateBody=!1,this.lastAnimation=i.cur_animation,this.lastAnimationFrame=i.cur_frame,i.tilemap_exists&&i.physics_changed&&(i.physics_changed=!1));var o=i.x!==this.lastKnownX||i.y!==this.lastKnownY,s=i.angle!==this.lastKnownAngle;if(o){i.update_bbox();var n=i.bquad.midX(),r=i.bquad.midY(),a=n-this.lastKnownX,h=r-this.lastKnownY;this.body.SetPosition(t.Get(.02*n,.02*r)),this.body.SetLinearVelocity(t.Get(a,h)),this.lastTickOverride=!0,this.body.SetAwake(!0)}else this.lastTickOverride&&(this.lastTickOverride=!1,this.body.SetLinearVelocity(t.Get(0,0)),this.body.SetPosition(t.Get(.02*i.bquad.midX(),.02*i.bquad.midY())));s&&(this.body.SetAngle(i.angle),this.body.SetAwake(!0));var c=this.body.GetPosition(),l=c.x/.02,m=c.y/.02,u=this.body.GetAngle();if(l!==i.x||m!==i.y||u!==i.angle){i.x=l,i.y=m,i.angle=u,i.set_bbox_changed(),i.update_bbox();var p=i.bquad.midX()-i.x,d=i.bquad.midY()-i.y;0===p&&0===d||(i.x-=p,i.y-=d,i.set_bbox_changed())}this.lastKnownX=i.x,this.lastKnownY=i.y,this.lastKnownAngle=i.angle}},h.getInstImgPointX=function(t){return-1!==t&&this.inst.getImagePoint?0===t&&this.body?(this.body.GetPosition().x+this.body.GetLocalCenter().x)/.02:this.inst.getImagePoint(t,!0):this.inst.x},h.getInstImgPointY=function(t){return-1!==t&&this.inst.getImagePoint?0===t&&this.body?(this.body.GetPosition().y+this.body.GetLocalCenter().y)/.02:this.inst.getImagePoint(t,!1):this.inst.y},l.prototype.IsSleeping=function(){return!!this.enabled&&!this.body.IsAwake()},l.prototype.CompareVelocity=function(t,e,i){if(!this.enabled)return!1;var o,s,n,r=this.body.GetLinearVelocity();return 0===t?o=r.x/.02:1===t?o=r.y/.02:(s=r.x/.02,n=r.y/.02,o=cr.distanceTo(0,0,s,n)),cr.do_cmp(o,e,i)},l.prototype.CompareAngularVelocity=function(t,e){if(!this.enabled)return!1;var i=cr.to_degrees(this.body.GetAngularVelocity());return cr.do_cmp(i,t,e)},l.prototype.CompareMass=function(t,e){if(!this.enabled)return!1;var i=this.body.GetMass()/.02;return cr.do_cmp(i,t,e)},l.prototype.IsEnabled=function(){return this.enabled},a.cnds=new l,m.prototype.ApplyForce=function(e,i,o){if(this.enabled){var s=this.getInstImgPointX(o),n=this.getInstImgPointY(o);this.body.ApplyForce(t.Get(e,i),t.Get(.02*s,.02*n))}},m.prototype.ApplyForceToward=function(e,i,o,s){if(this.enabled){var n=this.getInstImgPointX(s),r=this.getInstImgPointY(s),a=cr.angleTo(n,r,i,o);this.body.ApplyForce(t.Get(Math.cos(a)*e,Math.sin(a)*e),t.Get(.02*n,.02*r))}},m.prototype.ApplyForceAtAngle=function(e,i,o){if(this.enabled){i=cr.to_radians(i);var s=this.getInstImgPointX(o),n=this.getInstImgPointY(o);this.body.ApplyForce(t.Get(Math.cos(i)*e,Math.sin(i)*e),t.Get(.02*s,.02*n))}},m.prototype.ApplyImpulse=function(e,i,o){if(this.enabled){var s=this.getInstImgPointX(o),n=this.getInstImgPointY(o);this.body.ApplyImpulse(t.Get(e,i),t.Get(.02*s,.02*n)),this.lastTickOverride=!1,this.lastKnownX=this.inst.x,this.lastKnownY=this.inst.y}},m.prototype.ApplyImpulseToward=function(e,i,o,s){if(this.enabled){var n=this.getInstImgPointX(s),r=this.getInstImgPointY(s),a=cr.angleTo(n,r,i,o);this.body.ApplyImpulse(t.Get(Math.cos(a)*e,Math.sin(a)*e),t.Get(.02*n,.02*r)),this.lastTickOverride=!1,this.lastKnownX=this.inst.x,this.lastKnownY=this.inst.y}},m.prototype.ApplyImpulseAtAngle=function(e,i,o){if(this.enabled){i=cr.to_radians(i);var s=this.getInstImgPointX(o),n=this.getInstImgPointY(o);this.body.ApplyImpulse(t.Get(Math.cos(i)*e,Math.sin(i)*e),t.Get(.02*s,.02*n)),this.lastTickOverride=!1,this.lastKnownX=this.inst.x,this.lastKnownY=this.inst.y}},m.prototype.ApplyTorque=function(t){this.enabled&&this.body.ApplyTorque(cr.to_radians(t))},m.prototype.ApplyTorqueToAngle=function(t,e){this.enabled&&(t=cr.to_radians(t),e=cr.to_radians(e),cr.angleClockwise(this.inst.angle,e)?this.body.ApplyTorque(-t):this.body.ApplyTorque(t))},m.prototype.ApplyTorqueToPosition=function(t,e,i){if(this.enabled){t=cr.to_radians(t);var o=cr.angleTo(this.inst.x,this.inst.y,e,i);cr.angleClockwise(this.inst.angle,o)?this.body.ApplyTorque(-t):this.body.ApplyTorque(t)}},m.prototype.SetAngularVelocity=function(t){this.enabled&&(this.body.SetAngularVelocity(cr.to_radians(t)),this.body.SetAwake(!0))},m.prototype.CreateDistanceJoint=function(t,e,i,o,s){if(e&&this.enabled){var n=e.getFirstPicked(this.inst);n&&n!=this.inst&&n.extra.box2dbody&&(this.myCreatedJoints.push({type:0,params:[t,n.uid,i,o,s]}),this.doCreateDistanceJoint(t,n.uid,i,o,s))}},h.doCreateDistanceJoint=function(e,i,o,s,r){if(this.enabled){var a=this.runtime.getObjectByUID(i);if(a&&a!=this.inst&&a.extra.box2dbody){a.extra.box2dbody.c2userdata.joiningMe.add(this.inst);var h,c,l=this.getInstImgPointX(e),m=this.getInstImgPointY(e);a.getImagePoint?(h=a.getImagePoint(o,!0),c=a.getImagePoint(o,!1)):(h=a.x,c=a.y);var u=l-h,p=m-c,d=new n;d.Initialize(this.body,a.extra.box2dbody,t.Get(.02*l,.02*m),t.Get(.02*h,.02*c)),d.length=.02*Math.sqrt(u*u+p*p),d.dampingRatio=s,d.frequencyHz=r,this.myJoints.push(this.world.CreateJoint(d))}}},m.prototype.CreateRevoluteJoint=function(t,e){if(e&&this.enabled){var i=e.getFirstPicked(this.inst);i&&i!=this.inst&&i.extra.box2dbody&&(this.myCreatedJoints.push({type:1,params:[t,i.uid]}),this.doCreateRevoluteJoint(t,i.uid))}},h.doCreateRevoluteJoint=function(e,i){if(this.enabled){var o=this.runtime.getObjectByUID(i);if(o&&o!=this.inst&&o.extra.box2dbody){o.extra.box2dbody.c2userdata.joiningMe.add(this.inst);var s=this.getInstImgPointX(e),n=this.getInstImgPointY(e),a=new r;a.Initialize(this.body,o.extra.box2dbody,t.Get(.02*s,.02*n)),this.myJoints.push(this.world.CreateJoint(a))}}},m.prototype.CreateLimitedRevoluteJoint=function(t,e,i,o){if(e&&this.enabled){var s=e.getFirstPicked(this.inst);s&&s!=this.inst&&s.extra.box2dbody&&(this.myCreatedJoints.push({type:2,params:[t,s.uid,i,o]}),this.doCreateLimitedRevoluteJoint(t,s.uid,i,o))}},h.doCreateLimitedRevoluteJoint=function(e,i,o,s){if(this.enabled){var n=this.runtime.getObjectByUID(i);if(n&&n!=this.inst&&n.extra.box2dbody){n.extra.box2dbody.c2userdata.joiningMe.add(this.inst);var a=this.getInstImgPointX(e),h=this.getInstImgPointY(e),c=new r;c.Initialize(this.body,n.extra.box2dbody,t.Get(.02*a,.02*h)),c.enableLimit=!0,c.lowerAngle=cr.to_radians(o),c.upperAngle=cr.to_radians(s),this.myJoints.push(this.world.CreateJoint(c))}}},m.prototype.SetWorldGravity=function(e){if(e!==this.behavior.worldG){this.world.SetGravity(t.Get(0,e)),this.behavior.worldG=e;var i,o,s=this.behavior.my_instances.valuesRef();for(i=0,o=s.length;i<o;i++)s[i].extra.box2dbody&&s[i].extra.box2dbody.SetAwake(!0)}},m.prototype.SetSteppingMode=function(t){this.behavior.steppingMode=t},m.prototype.SetIterations=function(t,e){t<1&&(t=1),e<1&&(e=1),this.behavior.velocityIterations=t,this.behavior.positionIterations=e},m.prototype.SetVelocity=function(e,i){this.enabled&&(this.body.SetLinearVelocity(t.Get(.02*e,.02*i)),this.body.SetAwake(!0),this.lastTickOverride=!1,this.lastKnownX=this.inst.x,this.lastKnownY=this.inst.y)},m.prototype.SetDensity=function(t){this.enabled&&this.density!==t&&(this.density=t,this.recreateBody=!0)},m.prototype.SetFriction=function(t){this.enabled&&this.friction!==t&&(this.friction=t,this.recreateBody=!0)},m.prototype.SetElasticity=function(t){this.enabled&&this.restitution!==t&&(this.restitution=t,this.recreateBody=!0)},m.prototype.SetLinearDamping=function(t){this.enabled&&this.linearDamping!==t&&(this.linearDamping=t,this.body.SetLinearDamping(t))},m.prototype.SetAngularDamping=function(t){this.enabled&&this.angularDamping!==t&&(this.angularDamping=t,this.body.SetAngularDamping(t))},m.prototype.SetImmovable=function(t){this.enabled&&this.immovable!==(0!==t)&&(this.immovable=0!==t,this.body.SetType(this.immovable?0:2),this.body.SetAwake(!0))},m.prototype.EnableCollisions=function(t,e){if(t&&this.enabled){var i,o;if(t.is_family)for(i=0,o=t.members.length;i<o;i++)u(this.inst.type,t.members[i],0!==e);else u(this.inst.type,t,0!==e);this.behavior.allCollisionsEnabled=!1}},m.prototype.SetPreventRotate=function(t){this.enabled&&this.preventRotation!==(0!==t)&&(this.preventRotation=0!==t,this.body.SetFixedRotation(this.preventRotation),this.body.m_torque=0,this.body.SetAngularVelocity(0),this.body.SetAwake(!0))},m.prototype.SetBullet=function(t){this.enabled&&this.bullet!==(0!==t)&&(this.bullet=0!==t,this.body.SetBullet(this.bullet),this.body.SetAwake(!0))},m.prototype.RemoveJoints=function(){this.enabled&&(this.destroyMyJoints(),this.myCreatedJoints.length=0,this.joiningMe.clear())},m.prototype.SetEnabled=function(t){this.enabled&&0===t?(this.destroyBody(),this.enabled=!1):this.enabled||1!==t||(this.enabled=!0,this.createBody())},a.acts=new m,p.prototype.VelocityX=function(t){t.set_float(this.enabled?this.body.GetLinearVelocity().x/.02:0)},p.prototype.VelocityY=function(t){t.set_float(this.enabled?this.body.GetLinearVelocity().y/.02:0)},p.prototype.AngularVelocity=function(t){t.set_float(this.enabled?cr.to_degrees(this.body.GetAngularVelocity()):0)},p.prototype.Mass=function(t){t.set_float(this.enabled?this.body.GetMass()/.02:0)},p.prototype.CenterOfMassX=function(t){t.set_float(this.enabled?(this.body.GetPosition().x+this.body.GetLocalCenter().x)/.02:0)},p.prototype.CenterOfMassY=function(t){t.set_float(this.enabled?(this.body.GetPosition().y+this.body.GetLocalCenter().y)/.02:0)},p.prototype.Density=function(t){t.set_float(this.enabled?this.density:0)},p.prototype.Friction=function(t){t.set_float(this.enabled?this.friction:0)},p.prototype.Elasticity=function(t){t.set_float(this.enabled?this.restitution:0)},p.prototype.LinearDamping=function(t){t.set_float(this.enabled?this.linearDamping:0)},p.prototype.AngularDamping=function(t){t.set_float(this.enabled?this.angularDamping:0)},a.exps=new p}(),cr.behaviors.Pin=function(t){this.runtime=t},function(){var t=cr.behaviors.Pin.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var e=t.Instance.prototype;function i(){}function o(){}function s(){}e.onCreate=function(){this.pinObject=null,this.pinObjectUid=-1,this.pinAngle=0,this.pinDist=0,this.myStartAngle=0,this.theirStartAngle=0,this.lastKnownAngle=0,this.mode=0;var t=this;this.recycled||(this.myDestroyCallback=function(e){t.onInstanceDestroyed(e)}),this.runtime.addDestroyCallback(this.myDestroyCallback)},e.saveToJSON=function(){return{uid:this.pinObject?this.pinObject.uid:-1,pa:this.pinAngle,pd:this.pinDist,msa:this.myStartAngle,tsa:this.theirStartAngle,lka:this.lastKnownAngle,m:this.mode}},e.loadFromJSON=function(t){this.pinObjectUid=t.uid,this.pinAngle=t.pa,this.pinDist=t.pd,this.myStartAngle=t.msa,this.theirStartAngle=t.tsa,this.lastKnownAngle=t.lka,this.mode=t.m},e.afterLoad=function(){-1===this.pinObjectUid?this.pinObject=null:this.pinObject=this.runtime.getObjectByUID(this.pinObjectUid),this.pinObjectUid=-1},e.onInstanceDestroyed=function(t){this.pinObject==t&&(this.pinObject=null)},e.onDestroy=function(){this.pinObject=null,this.runtime.removeDestroyCallback(this.myDestroyCallback)},e.tick=function(){},e.tick2=function(){if(this.pinObject){this.lastKnownAngle!==this.inst.angle&&(this.myStartAngle=cr.clamp_angle(this.myStartAngle+(this.inst.angle-this.lastKnownAngle)));var t=this.inst.x,e=this.inst.y;if(3===this.mode||4===this.mode){var i=cr.distanceTo(this.inst.x,this.inst.y,this.pinObject.x,this.pinObject.y);if(i>this.pinDist||4===this.mode&&i<this.pinDist){var o=cr.angleTo(this.pinObject.x,this.pinObject.y,this.inst.x,this.inst.y);t=this.pinObject.x+Math.cos(o)*this.pinDist,e=this.pinObject.y+Math.sin(o)*this.pinDist}}else t=this.pinObject.x+Math.cos(this.pinObject.angle+this.pinAngle)*this.pinDist,e=this.pinObject.y+Math.sin(this.pinObject.angle+this.pinAngle)*this.pinDist;var s=cr.clamp_angle(this.myStartAngle+(this.pinObject.angle-this.theirStartAngle));this.lastKnownAngle=s,0!==this.mode&&1!==this.mode&&3!==this.mode&&4!==this.mode||this.inst.x===t&&this.inst.y===e||(this.inst.x=t,this.inst.y=e,this.inst.set_bbox_changed()),0!==this.mode&&2!==this.mode||this.inst.angle===s||(this.inst.angle=s,this.inst.set_bbox_changed())}},i.prototype.IsPinned=function(){return!!this.pinObject},t.cnds=new i,o.prototype.Pin=function(t,e){if(t){var i=t.getFirstPicked(this.inst);i&&(this.pinObject=i,this.pinAngle=cr.angleTo(i.x,i.y,this.inst.x,this.inst.y)-i.angle,this.pinDist=cr.distanceTo(i.x,i.y,this.inst.x,this.inst.y),this.myStartAngle=this.inst.angle,this.lastKnownAngle=this.inst.angle,this.theirStartAngle=i.angle,this.mode=e)}},o.prototype.Unpin=function(){this.pinObject=null},t.acts=new o,s.prototype.PinnedUID=function(t){t.set_int(this.pinObject?this.pinObject.uid:-1)},t.exps=new s}(),cr.behaviors.Platform=function(t){this.runtime=t},function(){var t=cr.behaviors.Platform.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){};t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime,this.leftkey=!1,this.rightkey=!1,this.jumpkey=!1,this.jumped=!1,this.doubleJumped=!1,this.canDoubleJump=!1,this.ignoreInput=!1,this.simleft=!1,this.simright=!1,this.simjump=!1,this.lastFloorObject=null,this.loadFloorObject=-1,this.lastFloorX=0,this.lastFloorY=0,this.floorIsJumpthru=!1,this.animMode=0,this.fallthrough=0,this.firstTick=!0,this.dx=0,this.dy=0};var e=t.Instance.prototype;function i(){}function o(){}function s(){}e.updateGravity=function(){this.downx=Math.cos(this.ga),this.downy=Math.sin(this.ga),this.rightx=Math.cos(this.ga-Math.PI/2),this.righty=Math.sin(this.ga-Math.PI/2),this.downx=cr.round6dp(this.downx),this.downy=cr.round6dp(this.downy),this.rightx=cr.round6dp(this.rightx),this.righty=cr.round6dp(this.righty),this.g1=this.g,this.g<0&&(this.downx*=-1,this.downy*=-1,this.g=Math.abs(this.g))},e.onCreate=function(){this.maxspeed=this.properties[0],this.acc=this.properties[1],this.dec=this.properties[2],this.jumpStrength=this.properties[3],this.g=this.properties[4],this.g1=this.g,this.maxFall=this.properties[5],this.enableDoubleJump=0!==this.properties[6],this.jumpSustain=this.properties[7]/1e3,this.defaultControls=1===this.properties[8],this.enabled=0!==this.properties[9],this.wasOnFloor=!1,this.wasOverJumpthru=this.runtime.testOverlapJumpThru(this.inst),this.loadOverJumpthru=-1,this.sustainTime=0,this.ga=cr.to_radians(90),this.updateGravity();var t=this;this.defaultControls&&!this.runtime.isDomFree&&(jQuery(document).keydown(function(e){t.onKeyDown(e)}),jQuery(document).keyup(function(e){t.onKeyUp(e)})),this.recycled||(this.myDestroyCallback=function(e){t.onInstanceDestroyed(e)}),this.runtime.addDestroyCallback(this.myDestroyCallback),this.inst.extra.isPlatformBehavior=!0},e.saveToJSON=function(){return{ii:this.ignoreInput,lfx:this.lastFloorX,lfy:this.lastFloorY,lfo:this.lastFloorObject?this.lastFloorObject.uid:-1,am:this.animMode,en:this.enabled,fall:this.fallthrough,ft:this.firstTick,dx:this.dx,dy:this.dy,ms:this.maxspeed,acc:this.acc,dec:this.dec,js:this.jumpStrength,g:this.g,g1:this.g1,mf:this.maxFall,wof:this.wasOnFloor,woj:this.wasOverJumpthru?this.wasOverJumpthru.uid:-1,ga:this.ga,edj:this.enableDoubleJump,cdj:this.canDoubleJump,dj:this.doubleJumped,sus:this.jumpSustain}},e.loadFromJSON=function(t){this.ignoreInput=t.ii,this.lastFloorX=t.lfx,this.lastFloorY=t.lfy,this.loadFloorObject=t.lfo,this.animMode=t.am,this.enabled=t.en,this.fallthrough=t.fall,this.firstTick=t.ft,this.dx=t.dx,this.dy=t.dy,this.maxspeed=t.ms,this.acc=t.acc,this.dec=t.dec,this.jumpStrength=t.js,this.g=t.g,this.g1=t.g1,this.maxFall=t.mf,this.wasOnFloor=t.wof,this.loadOverJumpthru=t.woj,this.ga=t.ga,this.enableDoubleJump=t.edj,this.canDoubleJump=t.cdj,this.doubleJumped=t.dj,this.jumpSustain=t.sus,this.leftkey=!1,this.rightkey=!1,this.jumpkey=!1,this.jumped=!1,this.simleft=!1,this.simright=!1,this.simjump=!1,this.sustainTime=0,this.updateGravity()},e.afterLoad=function(){-1===this.loadFloorObject?this.lastFloorObject=null:this.lastFloorObject=this.runtime.getObjectByUID(this.loadFloorObject),-1===this.loadOverJumpthru?this.wasOverJumpthru=null:this.wasOverJumpthru=this.runtime.getObjectByUID(this.loadOverJumpthru)},e.onInstanceDestroyed=function(t){this.lastFloorObject==t&&(this.lastFloorObject=null)},e.onDestroy=function(){this.lastFloorObject=null,this.runtime.removeDestroyCallback(this.myDestroyCallback)},e.onKeyDown=function(t){switch(t.which){case 38:t.preventDefault(),this.jumpkey=!0;break;case 37:t.preventDefault(),this.leftkey=!0;break;case 39:t.preventDefault(),this.rightkey=!0}},e.onKeyUp=function(t){switch(t.which){case 38:t.preventDefault(),this.jumpkey=!1,this.jumped=!1;break;case 37:t.preventDefault(),this.leftkey=!1;break;case 39:t.preventDefault(),this.rightkey=!1}},e.onWindowBlur=function(){this.leftkey=!1,this.rightkey=!1,this.jumpkey=!1},e.getGDir=function(){return this.g<0?-1:1},e.isOnFloor=function(){var t,e,i,o=null,s=null,n=this.inst.x,r=this.inst.y;if(this.inst.x+=this.downx,this.inst.y+=this.downy,this.inst.set_bbox_changed(),this.lastFloorObject&&this.runtime.testOverlap(this.inst,this.lastFloorObject)&&(!this.runtime.typeHasBehavior(this.lastFloorObject.type,cr.behaviors.solid)||this.lastFloorObject.extra.solidEnabled))return this.inst.x=n,this.inst.y=r,this.inst.set_bbox_changed(),this.lastFloorObject;if((o=this.runtime.testOverlapSolid(this.inst))||0!==this.fallthrough||(s=this.runtime.testOverlapJumpThru(this.inst,!0)),this.inst.x=n,this.inst.y=r,this.inst.set_bbox_changed(),o)return this.runtime.testOverlap(this.inst,o)?null:(this.floorIsJumpthru=!1,o);if(s&&s.length){for(t=0,i=0,e=s.length;t<e;t++)s[i]=s[t],this.runtime.testOverlap(this.inst,s[t])||i++;if(i>=1)return this.floorIsJumpthru=!0,s[0]}return null},e.tick=function(){},e.posttick=function(){var t,e,i,o,s,n,r,a,h,c,l=this.runtime.getDt(this.inst);this.jumpkey||this.simjump||(this.jumped=!1);var m=this.leftkey||this.simleft,u=this.rightkey||this.simright,p=this.jumpkey||this.simjump,d=p&&!this.jumped;if(this.simleft=!1,this.simright=!1,this.simjump=!1,this.enabled){this.ignoreInput&&(m=!1,u=!1,p=!1,d=!1),p||(this.sustainTime=0);var y=this.lastFloorObject,_=!1;this.firstTick&&((this.runtime.testOverlapSolid(this.inst)||this.runtime.testOverlapJumpThru(this.inst))&&this.runtime.pushOutSolid(this.inst,-this.downx,-this.downy,4,!0),this.firstTick=!1),!y||0!==this.dy||y.y===this.lastFloorY&&y.x===this.lastFloorX||(t=y.x-this.lastFloorX,e=y.y-this.lastFloorY,this.inst.x+=t,this.inst.y+=e,this.inst.set_bbox_changed(),this.lastFloorX=y.x,this.lastFloorY=y.y,_=!0,this.runtime.testOverlapSolid(this.inst)&&this.runtime.pushOutSolid(this.inst,-t,-e,2.5*Math.sqrt(t*t+e*e)));var f=this.isOnFloor(),x=this.runtime.testOverlapSolid(this.inst);if(x)if(this.inst.extra.inputPredicted)this.runtime.pushOutSolid(this.inst,-this.downx,-this.downy,10,!1);else if(this.runtime.pushOutSolidAxis(this.inst,-this.downx,-this.downy,this.inst.height/8))this.runtime.registerCollision(this.inst,x);else if(this.runtime.pushOutSolidAxis(this.inst,this.rightx,this.righty,this.inst.width/2))this.runtime.registerCollision(this.inst,x);else if(this.runtime.pushOutSolidAxis(this.inst,this.downx,this.downy,this.inst.height/2))this.runtime.registerCollision(this.inst,x);else{if(!this.runtime.pushOutSolidNearest(this.inst,Math.max(this.inst.width,this.inst.height)/2))return;this.runtime.registerCollision(this.inst,x)}f?(this.doubleJumped=!1,this.canDoubleJump=!1,this.dy>0&&(this.wasOnFloor||(this.runtime.pushInFractional(this.inst,-this.downx,-this.downy,f,16),this.wasOnFloor=!0),this.dy=0),y!=f?(this.lastFloorObject=f,this.lastFloorX=f.x,this.lastFloorY=f.y,this.runtime.registerCollision(this.inst,f)):_&&(x=this.runtime.testOverlapSolid(this.inst))&&(this.runtime.registerCollision(this.inst,x),0!==t&&(t>0?this.runtime.pushOutSolid(this.inst,-this.rightx,-this.righty):this.runtime.pushOutSolid(this.inst,this.rightx,this.righty)),this.runtime.pushOutSolid(this.inst,-this.downx,-this.downy))):p||(this.canDoubleJump=!0),(f&&d||!f&&this.enableDoubleJump&&p&&this.canDoubleJump&&!this.doubleJumped)&&(h=this.inst.x,c=this.inst.y,this.inst.x-=this.downx,this.inst.y-=this.downy,this.inst.set_bbox_changed(),this.runtime.testOverlapSolid(this.inst)?d=!1:(this.sustainTime=this.jumpSustain,this.runtime.trigger(cr.behaviors.Platform.prototype.cnds.OnJump,this.inst),this.animMode=2,this.dy=-this.jumpStrength,d=!0,f?this.jumped=!0:this.doubleJumped=!0),this.inst.x=h,this.inst.y=c,this.inst.set_bbox_changed()),f||(p&&this.sustainTime>0?(this.dy=-this.jumpStrength,this.sustainTime-=l):(this.lastFloorObject=null,this.dy+=this.g*l,this.dy>this.maxFall&&(this.dy=this.maxFall)),d&&(this.jumped=!0)),this.wasOnFloor=!!f,m==u&&(this.dx<0?(this.dx+=this.dec*l,this.dx>0&&(this.dx=0)):this.dx>0&&(this.dx-=this.dec*l,this.dx<0&&(this.dx=0))),m&&!u&&(this.dx>0?this.dx-=(this.acc+this.dec)*l:this.dx-=this.acc*l),u&&!m&&(this.dx<0?this.dx+=(this.acc+this.dec)*l:this.dx+=this.acc*l),this.dx>this.maxspeed?this.dx=this.maxspeed:this.dx<-this.maxspeed&&(this.dx=-this.maxspeed);var g=!1;if(0!==this.dx){h=this.inst.x,c=this.inst.y,t=this.dx*l*this.rightx,e=this.dx*l*this.righty,this.inst.x+=this.rightx*(this.dx>1?1:-1)-this.downx,this.inst.y+=this.righty*(this.dx>1?1:-1)-this.downy,this.inst.set_bbox_changed();var b=!1,v=this.runtime.testOverlapSolid(this.inst);if(this.inst.x=h+t,this.inst.y=c+e,this.inst.set_bbox_changed(),!(i=this.runtime.testOverlapSolid(this.inst))&&f&&(i=this.runtime.testOverlapJumpThru(this.inst))&&(this.inst.x=h,this.inst.y=c,this.inst.set_bbox_changed(),this.runtime.testOverlap(this.inst,i)?(i=null,b=!1):b=!0,this.inst.x=h+t,this.inst.y=c+e,this.inst.set_bbox_changed()),i){var B=Math.abs(this.dx*l)+2;v||!this.runtime.pushOutSolid(this.inst,-this.downx,-this.downy,B,b,i)?(this.runtime.registerCollision(this.inst,i),B=Math.max(Math.abs(this.dx*l*2.5),30),this.runtime.pushOutSolid(this.inst,this.rightx*(this.dx<0?1:-1),this.righty*(this.dx<0?1:-1),B,!1)?!f||b||this.floorIsJumpthru||(h=this.inst.x,c=this.inst.y,this.inst.x+=this.downx,this.inst.y+=this.downy,this.runtime.testOverlapSolid(this.inst)&&this.runtime.pushOutSolid(this.inst,-this.downx,-this.downy,3,!1)||(this.inst.x=h,this.inst.y=c,this.inst.set_bbox_changed())):(this.inst.x=h,this.inst.y=c,this.inst.set_bbox_changed()),b||(this.dx=0)):!v&&!d&&Math.abs(this.dy)<Math.abs(this.jumpStrength/4)&&(this.dy=0,f||(g=!0))}else{var D=this.isOnFloor();f&&!D?(o=Math.ceil(Math.abs(this.dx*l))+2,h=this.inst.x,c=this.inst.y,this.inst.x+=this.downx*o,this.inst.y+=this.downy*o,this.inst.set_bbox_changed(),this.runtime.testOverlapSolid(this.inst)||this.runtime.testOverlapJumpThru(this.inst)?this.runtime.pushOutSolid(this.inst,-this.downx,-this.downy,o+2,!0):(this.inst.x=h,this.inst.y=c,this.inst.set_bbox_changed())):D&&(!f&&this.floorIsJumpthru&&(this.lastFloorObject=D,this.lastFloorX=D.x,this.lastFloorY=D.y,this.dy=0,g=!0),0===this.dy&&this.runtime.pushInFractional(this.inst,-this.downx,-this.downy,D,16))}}if(0!==this.dy){h=this.inst.x,c=this.inst.y,this.inst.x+=this.dy*l*this.downx,this.inst.y+=this.dy*l*this.downy;var w=this.inst.x,C=this.inst.y;this.inst.set_bbox_changed();var S=!1;if(!(x=this.runtime.testOverlapSolid(this.inst))&&this.dy>0&&!f){if((s=this.fallthrough>0?null:this.runtime.testOverlapJumpThru(this.inst,!0))&&s.length){if(this.wasOverJumpthru){for(this.inst.x=h,this.inst.y=c,this.inst.set_bbox_changed(),n=0,a=0,r=s.length;n<r;n++)s[a]=s[n],this.runtime.testOverlap(this.inst,s[n])||a++;s.length=a,this.inst.x=w,this.inst.y=C,this.inst.set_bbox_changed()}s.length>=1&&(x=s[0])}S=!!x}if(x){this.runtime.registerCollision(this.inst,x),this.sustainTime=0;B=S?Math.abs(this.dy*l*2.5+10):Math.max(Math.abs(this.dy*l*2.5+10),30);this.runtime.pushOutSolid(this.inst,this.downx*(this.dy<0?1:-1),this.downy*(this.dy<0?1:-1),B,S,x)?(this.lastFloorObject=x,this.lastFloorX=x.x,this.lastFloorY=x.y,this.floorIsJumpthru=S,S&&(g=!0),this.dy=0):(this.inst.x=h,this.inst.y=c,this.inst.set_bbox_changed(),this.wasOnFloor=!0,S||(this.dy=0))}}3!==this.animMode&&this.dy>0&&!f&&(this.runtime.trigger(cr.behaviors.Platform.prototype.cnds.OnFall,this.inst),this.animMode=3),(f||g)&&this.dy>=0&&(3===this.animMode||g||d&&0===this.dy?(this.runtime.trigger(cr.behaviors.Platform.prototype.cnds.OnLand,this.inst),0===this.dx&&0===this.dy?this.animMode=0:this.animMode=1):(0!==this.animMode&&0===this.dx&&0===this.dy&&(this.runtime.trigger(cr.behaviors.Platform.prototype.cnds.OnStop,this.inst),this.animMode=0),1===this.animMode||0===this.dx&&0===this.dy||d||(this.runtime.trigger(cr.behaviors.Platform.prototype.cnds.OnMove,this.inst),this.animMode=1))),this.fallthrough>0&&this.fallthrough--,this.wasOverJumpthru=this.runtime.testOverlapJumpThru(this.inst)}},i.prototype.IsMoving=function(){return 0!==this.dx||0!==this.dy},i.prototype.CompareSpeed=function(t,e){var i=Math.sqrt(this.dx*this.dx+this.dy*this.dy);return cr.do_cmp(i,t,e)},i.prototype.IsOnFloor=function(){if(0!==this.dy)return!1;var t,e,i,o,s=null,n=this.inst.x,r=this.inst.y;if(this.inst.x+=this.downx,this.inst.y+=this.downy,this.inst.set_bbox_changed(),(t=this.runtime.testOverlapSolid(this.inst))||0!==this.fallthrough||(s=this.runtime.testOverlapJumpThru(this.inst,!0)),this.inst.x=n,this.inst.y=r,this.inst.set_bbox_changed(),t)return!this.runtime.testOverlap(this.inst,t);if(s&&s.length){for(e=0,o=0,i=s.length;e<i;e++)s[o]=s[e],this.runtime.testOverlap(this.inst,s[e])||o++;if(o>=1)return!0}return!1},i.prototype.IsByWall=function(t){var e,i=this.inst.x,o=this.inst.y;return 0===t?(this.inst.x-=2*this.rightx,this.inst.y-=2*this.righty):(this.inst.x+=2*this.rightx,this.inst.y+=2*this.righty),this.inst.set_bbox_changed(),this.runtime.testOverlapSolid(this.inst)?(this.inst.x-=3*this.downx,this.inst.y-=3*this.downy,this.inst.set_bbox_changed(),e=this.runtime.testOverlapSolid(this.inst),this.inst.x=i,this.inst.y=o,this.inst.set_bbox_changed(),e):(this.inst.x=i,this.inst.y=o,this.inst.set_bbox_changed(),!1)},i.prototype.IsJumping=function(){return this.dy<0},i.prototype.IsFalling=function(){return this.dy>0},i.prototype.OnJump=function(){return!0},i.prototype.OnFall=function(){return!0},i.prototype.OnStop=function(){return!0},i.prototype.OnMove=function(){return!0},i.prototype.OnLand=function(){return!0},i.prototype.IsDoubleJumpEnabled=function(){return this.enableDoubleJump},t.cnds=new i,o.prototype.SetIgnoreInput=function(t){this.ignoreInput=t},o.prototype.SetMaxSpeed=function(t){this.maxspeed=t,this.maxspeed<0&&(this.maxspeed=0)},o.prototype.SetAcceleration=function(t){this.acc=t,this.acc<0&&(this.acc=0)},o.prototype.SetDeceleration=function(t){this.dec=t,this.dec<0&&(this.dec=0)},o.prototype.SetJumpStrength=function(t){this.jumpStrength=t,this.jumpStrength<0&&(this.jumpStrength=0)},o.prototype.SetGravity=function(t){this.g1!==t&&(this.g=t,this.updateGravity(),this.runtime.testOverlapSolid(this.inst)&&(this.runtime.pushOutSolid(this.inst,this.downx,this.downy,10),this.inst.x+=2*this.downx,this.inst.y+=2*this.downy,this.inst.set_bbox_changed()),this.lastFloorObject=null)},o.prototype.SetMaxFallSpeed=function(t){this.maxFall=t,this.maxFall<0&&(this.maxFall=0)},o.prototype.SimulateControl=function(t){switch(t){case 0:this.simleft=!0;break;case 1:this.simright=!0;break;case 2:this.simjump=!0}},o.prototype.SetVectorX=function(t){this.dx=t},o.prototype.SetVectorY=function(t){this.dy=t},o.prototype.SetGravityAngle=function(t){t=cr.to_radians(t),t=cr.clamp_angle(t),this.ga!==t&&(this.ga=t,this.updateGravity(),this.lastFloorObject=null)},o.prototype.SetEnabled=function(t){this.enabled!==(1===t)&&(this.enabled=1===t,this.enabled||(this.lastFloorObject=null))},o.prototype.FallThrough=function(){var t=this.inst.x,e=this.inst.y;this.inst.x+=this.downx,this.inst.y+=this.downy,this.inst.set_bbox_changed();var i=this.runtime.testOverlapJumpThru(this.inst,!1);this.inst.x=t,this.inst.y=e,this.inst.set_bbox_changed(),i&&(this.fallthrough=3,this.lastFloorObject=null)},o.prototype.SetDoubleJumpEnabled=function(t){this.enableDoubleJump=0!==t},o.prototype.SetJumpSustain=function(t){this.jumpSustain=t/1e3},t.acts=new o,s.prototype.Speed=function(t){t.set_float(Math.sqrt(this.dx*this.dx+this.dy*this.dy))},s.prototype.MaxSpeed=function(t){t.set_float(this.maxspeed)},s.prototype.Acceleration=function(t){t.set_float(this.acc)},s.prototype.Deceleration=function(t){t.set_float(this.dec)},s.prototype.JumpStrength=function(t){t.set_float(this.jumpStrength)},s.prototype.Gravity=function(t){t.set_float(this.g)},s.prototype.GravityAngle=function(t){t.set_float(cr.to_degrees(this.ga))},s.prototype.MaxFallSpeed=function(t){t.set_float(this.maxFall)},s.prototype.MovingAngle=function(t){t.set_float(cr.to_degrees(Math.atan2(this.dy,this.dx)))},s.prototype.VectorX=function(t){t.set_float(this.dx)},s.prototype.VectorY=function(t){t.set_float(this.dy)},s.prototype.JumpSustain=function(t){t.set_float(1e3*this.jumpSustain)},t.exps=new s}(),cr.behaviors.Rotate=function(t){this.runtime=t},function(){var t=cr.behaviors.Rotate.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var e=t.Instance.prototype;function i(){}function o(){}e.onCreate=function(){this.speed=cr.to_radians(this.properties[0]),this.acc=cr.to_radians(this.properties[1])},e.saveToJSON=function(){return{speed:this.speed,acc:this.acc}},e.loadFromJSON=function(t){this.speed=t.speed,this.acc=t.acc},e.tick=function(){var t=this.runtime.getDt(this.inst);0!==t&&(0!==this.acc&&(this.speed+=this.acc*t),0!==this.speed&&(this.inst.angle=cr.clamp_angle(this.inst.angle+this.speed*t),this.inst.set_bbox_changed()))},t.cnds=new function(){},i.prototype.SetSpeed=function(t){this.speed=cr.to_radians(t)},i.prototype.SetAcceleration=function(t){this.acc=cr.to_radians(t)},t.acts=new i,o.prototype.Speed=function(t){t.set_float(cr.to_degrees(this.speed))},o.prototype.Acceleration=function(t){t.set_float(cr.to_degrees(this.acc))},t.exps=new o}(),cr.behaviors.Sin=function(t){this.runtime=t},function(){var t=cr.behaviors.Sin.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime,this.i=0};var e=t.Instance.prototype,i=2*Math.PI,o=Math.PI/2,s=3*Math.PI/2;function n(){}function r(){}function a(){}e.onCreate=function(){this.active=1===this.properties[0],this.movement=this.properties[1],this.wave=this.properties[2],this.period=this.properties[3],this.period+=Math.random()*this.properties[4],0===this.period?this.i=0:(this.i=this.properties[5]/this.period*i,this.i+=Math.random()*this.properties[6]/this.period*i),this.mag=this.properties[7],this.mag+=Math.random()*this.properties[8],this.initialValue=0,this.initialValue2=0,this.ratio=0,5===this.movement&&(this.mag=cr.to_radians(this.mag)),this.init()},e.saveToJSON=function(){return{i:this.i,a:this.active,mv:this.movement,w:this.wave,p:this.period,mag:this.mag,iv:this.initialValue,iv2:this.initialValue2,r:this.ratio,lkv:this.lastKnownValue,lkv2:this.lastKnownValue2}},e.loadFromJSON=function(t){this.i=t.i,this.active=t.a,this.movement=t.mv,this.wave=t.w,this.period=t.p,this.mag=t.mag,this.initialValue=t.iv,this.initialValue2=t.iv2||0,this.ratio=t.r,this.lastKnownValue=t.lkv,this.lastKnownValue2=t.lkv2||0},e.init=function(){switch(this.movement){case 0:this.initialValue=this.inst.x;break;case 1:this.initialValue=this.inst.y;break;case 2:this.initialValue=this.inst.width,this.ratio=this.inst.height/this.inst.width;break;case 3:this.initialValue=this.inst.width;break;case 4:this.initialValue=this.inst.height;break;case 5:this.initialValue=this.inst.angle;break;case 6:this.initialValue=this.inst.opacity;break;case 7:this.initialValue=0;break;case 8:this.initialValue=this.inst.x,this.initialValue2=this.inst.y}this.lastKnownValue=this.initialValue,this.lastKnownValue2=this.initialValue2},e.waveFunc=function(t){switch(t%=i,this.wave){case 0:return Math.sin(t);case 1:return t<=o?t/o:t<=s?1-2*(t-o)/Math.PI:(t-s)/o-1;case 2:return 2*t/i-1;case 3:return-2*t/i+1;case 4:return t<Math.PI?-1:1}return 0},e.tick=function(){var t=this.runtime.getDt(this.inst);this.active&&0!==t&&(0===this.period?this.i=0:(this.i+=t/this.period*i,this.i=this.i%i),this.updateFromPhase())},e.updateFromPhase=function(){switch(this.movement){case 0:this.inst.x!==this.lastKnownValue&&(this.initialValue+=this.inst.x-this.lastKnownValue),this.inst.x=this.initialValue+this.waveFunc(this.i)*this.mag,this.lastKnownValue=this.inst.x;break;case 1:this.inst.y!==this.lastKnownValue&&(this.initialValue+=this.inst.y-this.lastKnownValue),this.inst.y=this.initialValue+this.waveFunc(this.i)*this.mag,this.lastKnownValue=this.inst.y;break;case 2:this.inst.width=this.initialValue+this.waveFunc(this.i)*this.mag,this.inst.height=this.inst.width*this.ratio;break;case 3:this.inst.width=this.initialValue+this.waveFunc(this.i)*this.mag;break;case 4:this.inst.height=this.initialValue+this.waveFunc(this.i)*this.mag;break;case 5:this.inst.angle!==this.lastKnownValue&&(this.initialValue=cr.clamp_angle(this.initialValue+(this.inst.angle-this.lastKnownValue))),this.inst.angle=cr.clamp_angle(this.initialValue+this.waveFunc(this.i)*this.mag),this.lastKnownValue=this.inst.angle;break;case 6:this.inst.opacity=this.initialValue+this.waveFunc(this.i)*this.mag/100,this.inst.opacity<0?this.inst.opacity=0:this.inst.opacity>1&&(this.inst.opacity=1);break;case 8:this.inst.x!==this.lastKnownValue&&(this.initialValue+=this.inst.x-this.lastKnownValue),this.inst.y!==this.lastKnownValue2&&(this.initialValue2+=this.inst.y-this.lastKnownValue2),this.inst.x=this.initialValue+Math.cos(this.inst.angle)*this.waveFunc(this.i)*this.mag,this.inst.y=this.initialValue2+Math.sin(this.inst.angle)*this.waveFunc(this.i)*this.mag,this.lastKnownValue=this.inst.x,this.lastKnownValue2=this.inst.y}this.inst.set_bbox_changed()},e.onSpriteFrameChanged=function(t,e){switch(this.movement){case 2:this.initialValue*=e.width/t.width,this.ratio=e.height/e.width;break;case 3:this.initialValue*=e.width/t.width;break;case 4:this.initialValue*=e.height/t.height}},n.prototype.IsActive=function(){return this.active},n.prototype.CompareMovement=function(t){return this.movement===t},n.prototype.ComparePeriod=function(t,e){return cr.do_cmp(this.period,t,e)},n.prototype.CompareMagnitude=function(t,e){return 5===this.movement?cr.do_cmp(this.mag,t,cr.to_radians(e)):cr.do_cmp(this.mag,t,e)},n.prototype.CompareWave=function(t){return this.wave===t},t.cnds=new n,r.prototype.SetActive=function(t){this.active=1===t},r.prototype.SetPeriod=function(t){this.period=t},r.prototype.SetMagnitude=function(t){this.mag=t,5===this.movement&&(this.mag=cr.to_radians(this.mag))},r.prototype.SetMovement=function(t){5===this.movement&&5!==t&&(this.mag=cr.to_degrees(this.mag)),this.movement=t,this.init()},r.prototype.SetWave=function(t){this.wave=t},r.prototype.SetPhase=function(t){this.i=t*i%i,this.updateFromPhase()},r.prototype.UpdateInitialState=function(){this.init()},t.acts=new r,a.prototype.CyclePosition=function(t){t.set_float(this.i/i)},a.prototype.Period=function(t){t.set_float(this.period)},a.prototype.Magnitude=function(t){5===this.movement?t.set_float(cr.to_degrees(this.mag)):t.set_float(this.mag)},a.prototype.Value=function(t){t.set_float(this.waveFunc(this.i)*this.mag)},t.exps=new a}(),cr.behaviors.destroy=function(t){this.runtime=t},function(){var t=cr.behaviors.destroy.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var e=t.Instance.prototype;e.onCreate=function(){},e.tick=function(){this.inst.update_bbox();var t=this.inst.bbox,e=this.inst.layer.layout;(t.right<0||t.bottom<0||t.left>e.width||t.top>e.height)&&this.runtime.DestroyInstance(this.inst)}}();var easeOutBounceArray=[],easeInElasticArray=[],easeOutElasticArray=[],easeInOutElasticArray=[],easeInCircle=[],easeOutCircle=[],easeInOutCircle=[],easeInBack=[],easeOutBack=[],easeInOutBack=[],litetween_precision=1e4,updateLimit=0;function easeOutBouncefunc(t){return(t/=1)<1/2.75?result=7.5625*t*t*1+0:result=t<2/2.75?1*(7.5625*(t-=1.5/2.75)*t+.75)+0:t<2.5/2.75?1*(7.5625*(t-=2.25/2.75)*t+.9375)+0:1*(7.5625*(t-=2.625/2.75)*t+.984375)+0,result}function integerize(t,e){return Math.round(t/e*litetween_precision)}function easeFunc(t,e,i,o,s,n,r){var a=0;switch(t){case 0:a=o*e/s+i;break;case 1:a=o*(e/=s)*e+i;break;case 2:a=-o*(e/=s)*(e-2)+i;break;case 3:a=(e/=s/2)<1?o/2*e*e+i:-o/2*(--e*(e-2)-1)+i;break;case 4:a=o*(e/=s)*e*e+i;break;case 5:a=o*((e=e/s-1)*e*e+1)+i;break;case 6:a=(e/=s/2)<1?o/2*e*e*e+i:o/2*((e-=2)*e*e+2)+i;break;case 7:a=o*(e/=s)*e*e*e+i;break;case 8:a=-o*((e=e/s-1)*e*e*e-1)+i;break;case 9:a=(e/=s/2)<1?o/2*e*e*e*e+i:-o/2*((e-=2)*e*e*e-2)+i;break;case 10:a=o*(e/=s)*e*e*e*e+i;break;case 11:a=o*((e=e/s-1)*e*e*e*e+1)+i;break;case 12:a=(e/=s/2)<1?o/2*e*e*e*e*e+i:o/2*((e-=2)*e*e*e*e+2)+i;break;case 13:a=r.optimized?easeInCircle[integerize(e,s)]:-(Math.sqrt(1-e*e)-1);break;case 14:a=r.optimized?easeOutCircle[integerize(e,s)]:Math.sqrt(1-(e-1)*(e-1));break;case 15:a=r.optimized?easeInOutCircle[integerize(e,s)]:(e/=s/2)<1?-o/2*(Math.sqrt(1-e*e)-1)+i:o/2*(Math.sqrt(1-(e-=2)*e)+1)+i;break;case 16:if(r.optimized)a=easeInBack[integerize(e,s)];else a=o*(e/=s)*e*(((h=r.s)+1)*e-h)+i;break;case 17:if(r.optimized)a=easeOutBack[integerize(e,s)];else a=o*((e=e/s-1)*e*(((h=r.s)+1)*e+h)+1)+i;break;case 18:if(r.optimized)a=easeInOutBack[integerize(e,s)];else{var h=r.s;a=(e/=s/2)<1?o/2*(e*e*((1+(h*=1.525))*e-h))+i:o/2*((e-=2)*e*((1+(h*=1.525))*e+h)+2)+i}break;case 19:if(r.optimized)a=easeInElasticArray[integerize(e,s)];else{var c=r.a;h=0;if(0==e&&(a=i),1==(e/=s)&&(a=i+o),0==(l=r.p)&&(l=.3*s),0==c||c<Math.abs(o))c=o,h=l/4;else h=l/(2*Math.PI)*Math.asin(o/c);a=-c*Math.pow(2,10*(e-=1))*Math.sin((e*s-h)*(2*Math.PI)/l)+i}break;case 20:if(r.optimized)a=easeOutElasticArray[integerize(e,s)];else{c=r.a,h=0;if(0==e&&(a=i),1==(e/=s)&&(a=i+o),0==(l=r.p)&&(l=.3*s),0==c||c<Math.abs(o)){c=o;h=l/4}else h=l/(2*Math.PI)*Math.asin(o/c);a=c*Math.pow(2,-10*e)*Math.sin((e*s-h)*(2*Math.PI)/l)+o+i}break;case 21:if(r.optimized)a=easeInOutElasticArray[integerize(e,s)];else{var l;c=r.a,h=0;if(0==e&&(a=i),2==(e/=s/2)&&(a=i+o),0==(l=r.p)&&(l=s*(.3*1.5)),0==c||c<Math.abs(o)){c=o;h=l/4}else h=l/(2*Math.PI)*Math.asin(o/c);a=e<1?c*Math.pow(2,10*(e-=1))*Math.sin((e*s-h)*(2*Math.PI)/l)*-.5+i:c*Math.pow(2,-10*(e-=1))*Math.sin((e*s-h)*(2*Math.PI)/l)*.5+o+i}break;case 22:a=r.optimized?o-easeOutBounceArray[integerize(s-e,s)]+i:o-easeOutBouncefunc(s-e/s)+i;break;case 23:a=r.optimized?easeOutBounceArray[integerize(e,s)]:easeOutBouncefunc(e/s);break;case 24:a=r.optimized?e<s/2?.5*(o-easeOutBounceArray[integerize(s-2*e,s)]+i)+i:.5*easeOutBounceArray[integerize(2*e-s,s)]+.5*o+i:e<s/2?.5*(o-easeOutBouncefunc(s-2*e)+i)+i:.5*easeOutBouncefunc((2*e-s)/s)+.5*o+i;break;case 25:a=(m=e/s/2)*m*(3-2*m)*2;break;case 26:a=(m=(e/s+1)/2)*m*(3-2*m)*2-1;break;case 27:var m;a=(m=e/s)*m*(3-2*m)}return n?o-i-a:a}!function(){for(var t=0,e=0,i=0,o=0,s=0,n=0;n<=litetween_precision;n++){if(o=n/litetween_precision,t=(o/=1)<1/2.75?7.5625*o*o*1+0:o<2/2.75?1*(7.5625*(o-=1.5/2.75)*o+.75)+0:o<2.5/2.75?1*(7.5625*(o-=2.25/2.75)*o+.9375)+0:1*(7.5625*(o-=2.625/2.75)*o+.984375)+0,easeOutBounceArray[n]=t,0==(o=n/litetween_precision)&&(t=0),1==(o/=1)&&(t=1),0==(i=0)&&(i=.3),0==(e=0)||e<Math.abs(1)){e=1;s=i/4}else s=i/(2*Math.PI)*Math.asin(1/e);if(t=-e*Math.pow(2,10*(o-=1))*Math.sin((1*o-s)*(2*Math.PI)/i)+0,easeInElasticArray[n]=t,0==(o=n/litetween_precision)&&(t=0),1==(o/=1)&&(t=1),0==(i=0)&&(i=.3),0==(e=0)||e<Math.abs(1)){e=1;s=i/4}else s=i/(2*Math.PI)*Math.asin(1/e);if(t=e*Math.pow(2,-10*o)*Math.sin((1*o-s)*(2*Math.PI)/i)+1+0,easeOutElasticArray[n]=t,0==(o=n/litetween_precision)&&(t=0),2==(o/=.5)&&(t=1),0==(i=0)&&(i=.3*1.5*1),0==(e=0)||e<Math.abs(1)){e=1;s=i/4}else s=i/(2*Math.PI)*Math.asin(1/e);t=o<1?e*Math.pow(2,10*(o-=1))*Math.sin((1*o-s)*(2*Math.PI)/i)*-.5+0:e*Math.pow(2,-10*(o-=1))*Math.sin((1*o-s)*(2*Math.PI)/i)*.5+1+0,easeInOutElasticArray[n]=t,o=n/litetween_precision,easeInCircle[n]=-(Math.sqrt(1-o*o)-1),o=n/litetween_precision,easeOutCircle[n]=Math.sqrt(1-(o-1)*(o-1)),o=n/litetween_precision,t=(o/=.5)<1?-.5*(Math.sqrt(1-o*o)-1)+0:.5*(Math.sqrt(1-(o-=2)*o)+1)+0,easeInOutCircle[n]=t,o=n/litetween_precision,0==(s=0)&&(s=1.70158),t=1*(o/=1)*o*((s+1)*o-s)+0,easeInBack[n]=t,0==(s=0)&&(s=1.70158),t=1*((o=(o=n/litetween_precision)/1-1)*o*((s+1)*o+s)+1)+0,easeOutBack[n]=t,o=n/litetween_precision,0==(s=0)&&(s=1.70158),t=(o/=.5)<1?o*o*((1+(s*=1.525))*o-s)*.5+0:.5*((o-=2)*o*((1+(s*=1.525))*o+s)+2)+0,easeInOutBack[n]=t}}();var TweenObject=function(t,e,i,o,s,n,r){this.name=t,this.value=0,this.setInitial(o),this.setTarget(s),this.easefunc=i,this.tweened=e,this.duration=n,this.progress=0,this.state=0,this.onStart=!1,this.onEnd=!1,this.onReverseStart=!1,this.onReverseEnd=!1,this.lastKnownValue=0,this.lastKnownValue2=0,this.enforce=r,this.pingpong=1,this.flipEase=!1,this.easingparam=[],this.lastState=1;for(var a=0;a<28;a++)this.easingparam[a]={},this.easingparam[a].a=0,this.easingparam[a].p=0,this.easingparam[a].t=0,this.easingparam[a].s=0,this.easingparam[a].optimized=!0};function trim(t){return t.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}TweenObject.prototype={},TweenObject.prototype.flipTarget=function(){var t=this.initialparam1,e=this.initialparam2;this.initialparam1=this.targetparam1,this.initialparam2=this.targetparam2,this.targetparam1=t,this.targetparam2=e,this.lastKnownValue=0,this.lastKnownValue2=0},TweenObject.prototype.setInitial=function(t){this.initialparam1=parseFloat(t.split(",")[0]),this.initialparam2=parseFloat(t.split(",")[1]),this.lastKnownValue=0,this.lastKnownValue2=0},TweenObject.prototype.setTarget=function(t){this.targetparam1=parseFloat(t.split(",")[0]),this.targetparam2=parseFloat(t.split(",")[1]),isNaN(this.targetparam2)&&(this.targetparam2=this.targetparam1)},TweenObject.prototype.OnTick=function(t){if(0===this.state)return-1;if(1===this.state&&(this.progress+=t),2===this.state&&(this.progress-=t),3===this.state&&(this.state=0),4!==this.state&&6!==this.state||(this.progress+=t*this.pingpong),5===this.state&&(this.progress+=t*this.pingpong),this.progress<0)return this.progress=0,4===this.state?this.pingpong=1:6===this.state?(this.pingpong=1,this.flipEase=!1):this.state=0,this.onReverseEnd=!0,0;if(this.progress>this.duration)return this.progress=this.duration,4===this.state?this.pingpong=-1:6===this.state?(this.pingpong=-1,this.flipEase=!0):5===this.state?this.progress=0:this.state=0,this.onEnd=!0,1;if(this.flipEase)var e=easeFunc(this.easefunc,this.duration-this.progress,0,1,this.duration,this.flipEase,this.easingparam[this.easefunc]);else e=easeFunc(this.easefunc,this.progress,0,1,this.duration,this.flipEase,this.easingparam[this.easefunc]);return e},cr.behaviors.lunarray_LiteTween=function(t){this.runtime=t},function(){var t=cr.behaviors.lunarray_LiteTween.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime,this.i=0};var e=t.Instance.prototype;e.onCreate=function(){this.playmode=this.properties[0],this.active=1==this.playmode||2==this.playmode||3==this.playmode||4==this.playmode,this.tweened=this.properties[1],this.easing=this.properties[2],this.target=this.properties[3],this.targetmode=this.properties[4],this.useCurrent=!1,1===this.targetmode&&(this.target="relative("+this.target+")"),this.duration=this.properties[5],this.enforce=1===this.properties[6],this.value=0,this.tween_list={},this.addToTweenList("default",this.tweened,this.easing,"current",this.target,this.duration,this.enforce),1===this.properties[0]&&this.startTween(0),2===this.properties[0]&&this.startTween(2),3===this.properties[0]&&this.startTween(3),4===this.properties[0]&&this.startTween(4)},e.parseCurrent=function(t,e){void 0===e&&(e="current");var i=trim(e);e=trim(e);var o=this.value;if("current"===e)switch(t){case 0:i=this.inst.x+","+this.inst.y;break;case 1:case 2:case 3:i=this.inst.width+","+this.inst.height;break;case 4:i=cr.to_degrees(this.inst.angle)+","+cr.to_degrees(this.inst.angle);break;case 5:i=100*this.inst.opacity+","+100*this.inst.opacity;break;case 6:i=o+","+o;break;case 7:case 8:i=this.inst.x+","+this.inst.y;break;case 9:i=void 0!==this.inst.curFrame?this.inst.width/this.inst.curFrame.width+","+this.inst.height/this.inst.curFrame.height:"1,1"}if("relative"===e.substring(0,8)){var s=e.match(/\((.*?)\)/);if(s)var n=parseFloat(s[1].split(",")[0]),r=parseFloat(s[1].split(",")[1]);switch(isNaN(n)&&(n=0),isNaN(r)&&(r=0),t){case 0:i=this.inst.x+n+","+(this.inst.y+r);break;case 1:case 2:case 3:i=this.inst.width+n+","+(this.inst.height+r);break;case 4:i=cr.to_degrees(this.inst.angle)+n+","+(cr.to_degrees(this.inst.angle)+r);break;case 5:i=100*this.inst.opacity+n+","+(100*this.inst.opacity+r);break;case 6:i=o+n+","+o+n;break;case 7:i=this.inst.x+n+","+this.inst.y;break;case 8:i=this.inst.x+","+(this.inst.y+n);break;case 9:i=n+","+r}}return i},e.addToTweenList=function(t,e,i,o,s,n,r){o=this.parseCurrent(e,o),s=this.parseCurrent(e,s),void 0!==this.tween_list[t]&&delete this.tween_list[t],this.tween_list[t]=new TweenObject(t,e,i,o,s,n,r),this.tween_list[t].dt=0},e.saveToJSON=function(){JSON.stringify(this.tween_list.default);return{playmode:this.playmode,active:this.active,tweened:this.tweened,easing:this.easing,target:this.target,targetmode:this.targetmode,useCurrent:this.useCurrent,duration:this.duration,enforce:this.enforce,value:this.value,tweenlist:JSON.stringify(this.tween_list.default)}},TweenObject.Load=function(t,e,i,o,s,n,r,a){var h=new TweenObject(e,i,o,s,n,r,a);for(var c in t)h[c]=t[c];return h},e.loadFromJSON=function(t){var e=JSON.parse(t.tweenlist),i=TweenObject.Load(e,e.name,e.tweened,e.easefunc,e.initialparam1+","+e.initialparam2,e.targetparam1+","+e.targetparam2,e.duration,e.enforce);this.tween_list.default=i,this.playmode=t.playmode,this.active=t.active,this.movement=t.tweened,this.easing=t.easing,this.target=t.target,this.targetmode=t.targetmode,this.useCurrent=t.useCurrent,this.duration=t.duration,this.enforce=t.enforce,this.value=t.value},e.setProgressTo=function(t){for(var e in t>1&&(t=1),t<0&&(t=0),this.tween_list){var i=this.tween_list[e];i.lastKnownValue=0,i.lastKnownValue2=0,i.state=3,i.progress=t*i.duration;var o=i.OnTick(0);this.updateTween(i,o)}},e.startTween=function(t){for(var e in this.tween_list){var i=this.tween_list[e];if(this.useCurrent){var o=this.parseCurrent(i.tweened,"current"),s=this.parseCurrent(i.tweened,this.target);i.setInitial(o),i.setTarget(s)}0===t&&(i.progress=1e-6,i.lastKnownValue=0,i.lastKnownValue2=0,i.onStart=!0,i.state=1),1===t&&(i.state=i.lastState),2!==t&&4!==t||(i.progress=1e-6,i.lastKnownValue=0,i.lastKnownValue2=0,i.onStart=!0,2==t&&(i.state=4),4==t&&(i.state=6)),3===t&&(i.progress=1e-6,i.lastKnownValue=0,i.lastKnownValue2=0,i.onStart=!0,i.state=5)}},e.stopTween=function(t){for(var e in this.tween_list){var i=this.tween_list[e];3!=i.state&&0!=i.state&&(i.lastState=i.state),1===t&&(i.progress=0),2===t&&(i.progress=i.duration),i.state=3;var o=i.OnTick(0);this.updateTween(i,o)}},e.reverseTween=function(t){for(var e in this.tween_list){var i=this.tween_list[e];1===t&&(i.progress=i.duration,i.lastKnownValue=0,i.lastKnownValue2=0,i.onReverseStart=!0),i.state=2}},e.updateTween=function(t,e){if(0===t.tweened)t.enforce?(this.inst.x=t.initialparam1+(t.targetparam1-t.initialparam1)*e,this.inst.y=t.initialparam2+(t.targetparam2-t.initialparam2)*e):(this.inst.x+=(t.targetparam1-t.initialparam1)*e-t.lastKnownValue,this.inst.y+=(t.targetparam2-t.initialparam2)*e-t.lastKnownValue2,t.lastKnownValue=(t.targetparam1-t.initialparam1)*e,t.lastKnownValue2=(t.targetparam2-t.initialparam2)*e);else if(1===t.tweened)t.enforce?(this.inst.width=t.initialparam1+(t.targetparam1-t.initialparam1)*e,this.inst.height=t.initialparam2+(t.targetparam2-t.initialparam2)*e):(this.inst.width+=(t.targetparam1-t.initialparam1)*e-t.lastKnownValue,this.inst.height+=(t.targetparam2-t.initialparam2)*e-t.lastKnownValue2,t.lastKnownValue=(t.targetparam1-t.initialparam1)*e,t.lastKnownValue2=(t.targetparam2-t.initialparam2)*e);else if(2===t.tweened)t.enforce?this.inst.width=t.initialparam1+(t.targetparam1-t.initialparam1)*e:(this.inst.width+=(t.targetparam1-t.initialparam1)*e-t.lastKnownValue,t.lastKnownValue=(t.targetparam1-t.initialparam1)*e);else if(3===t.tweened)t.enforce?this.inst.height=t.initialparam2+(t.targetparam2-t.initialparam2)*e:(this.inst.height+=(t.targetparam2-t.initialparam2)*e-t.lastKnownValue2,t.lastKnownValue2=(t.targetparam2-t.initialparam2)*e);else if(4===t.tweened)if(t.enforce){var i=t.initialparam1+(t.targetparam1-t.initialparam1)*e;this.inst.angle=cr.clamp_angle(cr.to_radians(i))}else{i=(t.targetparam1-t.initialparam1)*e-t.lastKnownValue;this.inst.angle=cr.clamp_angle(this.inst.angle+cr.to_radians(i)),t.lastKnownValue=(t.targetparam1-t.initialparam1)*e}else if(5===t.tweened)t.enforce?this.inst.opacity=(t.initialparam1+(t.targetparam1-t.initialparam1)*e)/100:(this.inst.opacity+=((t.targetparam1-t.initialparam1)*e-t.lastKnownValue)/100,t.lastKnownValue=(t.targetparam1-t.initialparam1)*e);else if(6===t.tweened)t.enforce?this.value=t.initialparam1+(t.targetparam1-t.initialparam1)*e:(this.value+=(t.targetparam1-t.initialparam1)*e-t.lastKnownValue,t.lastKnownValue=(t.targetparam1-t.initialparam1)*e);else if(7===t.tweened)t.enforce?this.inst.x=t.initialparam1+(t.targetparam1-t.initialparam1)*e:(this.inst.x+=(t.targetparam1-t.initialparam1)*e-t.lastKnownValue,t.lastKnownValue=(t.targetparam1-t.initialparam1)*e);else if(8===t.tweened)t.enforce?this.inst.y=t.initialparam2+(t.targetparam2-t.initialparam2)*e:(this.inst.y+=(t.targetparam2-t.initialparam2)*e-t.lastKnownValue2,t.lastKnownValue2=(t.targetparam2-t.initialparam2)*e);else if(9===t.tweened){var o=t.initialparam1+(t.targetparam1-t.initialparam1)*e,s=t.initialparam2+(t.targetparam2-t.initialparam2)*e;this.inst.width<0&&(o=t.initialparam1+(t.targetparam1+t.initialparam1)*-e),this.inst.height<0&&(s=t.initialparam2+(t.targetparam2+t.initialparam2)*-e),t.enforce?(this.inst.width=this.inst.curFrame.width*o,this.inst.height=this.inst.curFrame.height*s):(this.inst.width<0?(this.inst.width=o*(this.inst.width/(-1+t.lastKnownValue)),t.lastKnownValue=o+1):(this.inst.width=o*(this.inst.width/(1+t.lastKnownValue)),t.lastKnownValue=o-1),this.inst.height<0?(this.inst.height=s*(this.inst.height/(-1+t.lastKnownValue2)),t.lastKnownValue2=s+1):(this.inst.height=s*(this.inst.height/(1+t.lastKnownValue2)),t.lastKnownValue2=s-1))}this.inst.set_bbox_changed()},e.tick=function(){var t=this.runtime.getDt(this.inst),e=this.tween_list.default;if(0!==e.state){e.onStart&&(this.runtime.trigger(cr.behaviors.lunarray_LiteTween.prototype.cnds.OnStart,this.inst),e.onStart=!1),e.onReverseStart&&(this.runtime.trigger(cr.behaviors.lunarray_LiteTween.prototype.cnds.OnReverseStart,this.inst),e.onReverseStart=!1),this.active=1==e.state||2==e.state||4==e.state||5==e.state||6==e.state;var i=e.OnTick(t);this.updateTween(e,i),e.onEnd&&(this.runtime.trigger(cr.behaviors.lunarray_LiteTween.prototype.cnds.OnEnd,this.inst),e.onEnd=!1),e.onReverseEnd&&(this.runtime.trigger(cr.behaviors.lunarray_LiteTween.prototype.cnds.OnReverseEnd,this.inst),e.onReverseEnd=!1)}},t.cnds={};var i=t.cnds;i.IsActive=function(){return 0!==this.tween_list.default.state},i.IsReversing=function(){return 2==this.tween_list.default.state},i.CompareProgress=function(t,e){var i=this.tween_list.default;return cr.do_cmp(i.progress/i.duration,t,e)},i.OnThreshold=function(t,e){var i=this.tween_list.default;this.threshold=cr.do_cmp(i.progress/i.duration,t,e);var o=this.oldthreshold!=this.threshold&&this.threshold;return o&&(this.oldthreshold=this.threshold),o},i.OnStart=function(){return void 0!==this.tween_list.default&&this.tween_list.default.onStart},i.OnReverseStart=function(){return void 0!==this.tween_list.default&&this.tween_list.default.onReverseStart},i.OnEnd=function(){return void 0!==this.tween_list.default&&this.tween_list.default.onEnd},i.OnReverseEnd=function(){return void 0!==this.tween_list.default&&this.tween_list.default.onReverseEnd},t.acts={};var o=t.acts;o.Start=function(t,e){this.threshold=!1,this.oldthreshold=!1,this.useCurrent=1==e,this.startTween(t)},o.Stop=function(t){this.stopTween(t)},o.Reverse=function(t){this.threshold=!1,this.oldthreshold=!1,this.reverseTween(t)},o.ProgressTo=function(t){this.setProgressTo(t)},o.SetDuration=function(t){isNaN(t)||t<0||void 0!==this.tween_list.default&&(this.tween_list.default.duration=t)},o.SetEnforce=function(t){void 0!==this.tween_list.default&&(this.tween_list.default.enforce=1===t)},o.SetInitial=function(t){if(void 0!==this.tween_list.default){var e=this.parseCurrent(this.tween_list.default.tweened,t);this.tween_list.default.setInitial(e)}},o.SetTarget=function(t,e,i){if(void 0!==this.tween_list.default&&!isNaN(i)){var o=this.tween_list.default,s=i+"";this.targetmode=e;var n="",r="";if(1===e){switch(this.target="relative("+s+")",t){case 0:n=this.inst.x+i,r=o.targetparam2;break;case 1:n=o.targetparam1,r=this.inst.y+i;break;case 2:r=n=""+cr.to_degrees(this.inst.angle+cr.to_radians(i));break;case 3:r=n=""+100*this.inst.opacity+i;break;case 4:n=this.inst.width+i,r=o.targetparam2;break;case 5:n=o.targetparam1,r=this.inst.height+i;break;case 6:n=i,r=i}s=n+","+r}else{switch(t){case 0:n=i,r=o.targetparam2;break;case 1:n=o.targetparam1,r=i;break;case 2:case 3:n=i,r=i;break;case 4:n=i,r=o.targetparam2;break;case 5:n=o.targetparam1,r=i;break;case 6:n=i,r=i}s=n+","+r,this.target=s}var a=this.parseCurrent(this.tween_list.default.tweened,"current"),h=this.parseCurrent(this.tween_list.default.tweened,s);o.setInitial(a),o.setTarget(h)}},o.SetTweenedProperty=function(t){void 0!==this.tween_list.default&&(this.tween_list.default.tweened=t)},o.SetEasing=function(t){void 0!==this.tween_list.default&&(this.tween_list.default.easefunc=t)},o.SetEasingParam=function(t,e,i,o,s){void 0!==this.tween_list.default&&(this.tween_list.default.easingparam[t].optimized=!1,this.tween_list.default.easingparam[t].a=e,this.tween_list.default.easingparam[t].p=i,this.tween_list.default.easingparam[t].t=o,this.tween_list.default.easingparam[t].s=s)},o.ResetEasingParam=function(){void 0!==this.tween_list.default&&(this.tween_list.default.optimized=!0)},o.SetValue=function(t){var e=this.tween_list.default;this.value=t,6===e.tweened&&e.setInitial(this.parseCurrent(e.tweened,"current"))},o.SetParameter=function(t,e,i,o,s){if(void 0===this.tween_list.default)this.addToTweenList("default",t,e,initial,i,o,s,0);else{var n=this.tween_list.default;n.tweened=t,n.easefunc=e,n.setInitial(this.parseCurrent(t,"current")),n.setTarget(this.parseCurrent(t,i)),n.duration=o,n.enforce=1===s}},t.exps={};var s=t.exps;s.State=function(t){var e="N/A";switch(this.tween_list.default.state){case 0:e="paused";break;case 1:e="playing";break;case 2:e="reversing";break;case 3:e="seeking"}t.set_string(e)},s.Progress=function(t){var e=this.tween_list.default.progress/this.tween_list.default.duration;t.set_float(e)},s.Duration=function(t){t.set_float(this.tween_list.default.duration)},s.Target=function(t){var e=this.tween_list.default,i="N/A";switch(e.tweened){case 0:i=e.targetparam1;break;case 1:i=e.targetparam2;break;case 2:case 3:case 4:i=e.targetparam1;break;case 5:i=e.targetparam2;break;case 6:i=e.targetparam1}t.set_float(i)},s.Value=function(t){var e=this.value;t.set_float(e)},s.Tween=function(t,e,i,o,s){var n=o>1?1:o,r=easeFunc(s,n<0?0:n,0,1,1,!1,!1);t.set_float(e+r*(i-e))}}(),cr.behaviors.scrollto=function(t){this.runtime=t,this.shakeMag=0,this.shakeStart=0,this.shakeEnd=0,this.shakeMode=0},function(){var t=cr.behaviors.scrollto.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var e=t.Instance.prototype;function i(t){var e,i,o;for(e=0,i=t.behavior_insts.length;e<i;++e)if((o=t.behavior_insts[e]).behavior instanceof cr.behaviors.scrollto)return o;return null}function o(){}e.onCreate=function(){this.enabled=0!==this.properties[0]},e.saveToJSON=function(){return{smg:this.behavior.shakeMag,ss:this.behavior.shakeStart,se:this.behavior.shakeEnd,smd:this.behavior.shakeMode}},e.loadFromJSON=function(t){this.behavior.shakeMag=t.smg,this.behavior.shakeStart=t.ss,this.behavior.shakeEnd=t.se,this.behavior.shakeMode=t.smd},e.tick=function(){},e.tick2=function(){if(this.enabled){var t,e,o,s=this.behavior.my_instances.valuesRef(),n=0,r=0,a=0;for(t=0,e=s.length;t<e;t++)(o=i(s[t]))&&o.enabled&&(n+=s[t].x,r+=s[t].y,++a);var h=this.inst.layer.layout,c=this.runtime.kahanTime.sum,l=0,m=0;if(c>=this.behavior.shakeStart&&c<this.behavior.shakeEnd){var u=this.behavior.shakeMag*Math.min(this.runtime.timescale,1);0===this.behavior.shakeMode&&(u*=1-(c-this.behavior.shakeStart)/(this.behavior.shakeEnd-this.behavior.shakeStart));var p=Math.random()*Math.PI*2,d=Math.random()*u;l=Math.cos(p)*d,m=Math.sin(p)*d}h.scrollToX(n/a+l),h.scrollToY(r/a+m)}},o.prototype.Shake=function(t,e,i){this.behavior.shakeMag=t,this.behavior.shakeStart=this.runtime.kahanTime.sum,this.behavior.shakeEnd=this.behavior.shakeStart+e,this.behavior.shakeMode=i},o.prototype.SetEnabled=function(t){this.enabled=0!==t},t.acts=new o}(),cr.behaviors.solid=function(t){this.runtime=t},function(){var t=cr.behaviors.solid.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var e=t.Instance.prototype;function i(){}function o(){}e.onCreate=function(){this.inst.extra.solidEnabled=0!==this.properties[0]},e.tick=function(){},i.prototype.IsEnabled=function(){return this.inst.extra.solidEnabled},t.cnds=new i,o.prototype.SetEnabled=function(t){this.inst.extra.solidEnabled=!!t},t.acts=new o}(),cr.behaviors.wrap=function(t){this.runtime=t},function(){var t=cr.behaviors.wrap.prototype;t.Type=function(t,e){this.behavior=t,this.objtype=e,this.runtime=t.runtime},t.Type.prototype.onCreate=function(){},t.Instance=function(t,e){this.type=t,this.behavior=t.behavior,this.inst=e,this.runtime=t.runtime};var e=t.Instance.prototype;e.onCreate=function(){this.mode=this.properties[0]},e.tick=function(){var t=this.inst;t.update_bbox();var e=t.bbox,i=t.layer,o=i.layout,s=0,n=0,r=0,a=0;0===this.mode?(n=o.width,a=o.height):(s=i.viewLeft,n=i.viewRight,r=i.viewTop,a=i.viewBottom),e.right<s?(t.x=n-1+(t.x-e.left),t.set_bbox_changed()):e.left>n?(t.x=s+1-(e.right-t.x),t.set_bbox_changed()):e.bottom<r?(t.y=a-1+(t.y-e.top),t.set_bbox_changed()):e.top>a&&(t.y=r+1-(e.bottom-t.y),t.set_bbox_changed())}}(),cr.getObjectRefTable=function(){return[cr.plugins_.Audio,cr.plugins_.Browser,cr.plugins_.Function,cr.plugins_.Mouse,cr.plugins_.GD_SDK,cr.plugins_.Keyboard,cr.plugins_.Particles,cr.plugins_.Spritefont2,cr.plugins_.TiledBg,cr.plugins_.Sprite,cr.plugins_.sirg_kiz,cr.plugins_.Touch,cr.plugins_.WebStorage,cr.behaviors.Sin,cr.behaviors.Pin,cr.behaviors.Fade,cr.behaviors.solid,cr.behaviors.Bullet,cr.behaviors.Physics,cr.behaviors.scrollto,cr.behaviors.Rotate,cr.behaviors.Platform,cr.behaviors.Flash,cr.behaviors.wrap,cr.behaviors.lunarray_LiteTween,cr.behaviors.destroy,cr.plugins_.Touch.prototype.cnds.OnTapGestureObject,cr.plugins_.Browser.prototype.acts.GoToURLWindow,cr.plugins_.Sprite.prototype.cnds.IsAnimPlaying,cr.plugins_.Audio.prototype.acts.SetSilent,cr.system_object.prototype.acts.Wait,cr.plugins_.Sprite.prototype.acts.SetAnim,cr.plugins_.Keyboard.prototype.cnds.OnKeyReleased,cr.system_object.prototype.acts.ResetGlobals,cr.system_object.prototype.cnds.OnLayoutStart,cr.plugins_.WebStorage.prototype.cnds.LocalStorageExists,cr.system_object.prototype.acts.SetVar,cr.plugins_.WebStorage.prototype.exps.LocalValue,cr.plugins_.Touch.prototype.cnds.OnTouchObject,cr.plugins_.GD_SDK.prototype.acts.ShowAd,cr.system_object.prototype.acts.GoToLayout,cr.system_object.prototype.cnds.EveryTick,cr.system_object.prototype.acts.SetFullscreenQuality,cr.plugins_.Audio.prototype.acts.StopAll,cr.plugins_.Audio.prototype.acts.Play,cr.system_object.prototype.cnds.IsMobile,cr.plugins_.Browser.prototype.cnds.IsPortraitLandscape,cr.system_object.prototype.cnds.TriggerOnce,cr.system_object.prototype.acts.SetLayerVisible,cr.system_object.prototype.acts.SetTimescale,cr.plugins_.GD_SDK.prototype.cnds.onPauseGame,cr.plugins_.Audio.prototype.acts.SetMasterVolume,cr.plugins_.GD_SDK.prototype.cnds.onResumeGame,cr.behaviors.Bullet.prototype.acts.SetSpeed,cr.behaviors.Bullet.prototype.acts.SetAngleOfMotion,cr.plugins_.TiledBg.prototype.cnds.CompareX,cr.plugins_.TiledBg.prototype.acts.SetX,cr.system_object.prototype.cnds.CompareVar,cr.system_object.prototype.cnds.Else,cr.plugins_.WebStorage.prototype.acts.StoreLocal,cr.plugins_.Spritefont2.prototype.acts.SetText,cr.plugins_.Sprite.prototype.acts.SetVisible,cr.plugins_.Sprite.prototype.acts.Destroy,cr.system_object.prototype.acts.AddVar,cr.plugins_.Spritefont2.prototype.acts.SetY,cr.plugins_.Spritefont2.prototype.exps.Y,cr.plugins_.Sprite.prototype.acts.SetY,cr.plugins_.Sprite.prototype.exps.Y,cr.system_object.prototype.cnds.Compare,cr.system_object.prototype.exps.layoutname,cr.plugins_.Touch.prototype.cnds.OnTouchEnd,cr.plugins_.Touch.prototype.cnds.IsTouchingObject,cr.system_object.prototype.acts.CreateObject,cr.plugins_.Particles.prototype.acts.SetSpraying,cr.plugins_.Sprite.prototype.acts.Spawn,cr.system_object.prototype.exps.choose,cr.plugins_.Touch.prototype.cnds.OnTouchStart,cr.plugins_.Touch.prototype.exps.AbsoluteX,cr.plugins_.Touch.prototype.exps.AbsoluteY,cr.plugins_.Touch.prototype.cnds.IsInTouch,cr.plugins_.Audio.prototype.acts.PlayByName,cr.plugins_.Sprite.prototype.cnds.OnAnimFinished,cr.system_object.prototype.cnds.Every,cr.plugins_.Keyboard.prototype.cnds.OnKey,cr.plugins_.Sprite.prototype.acts.SetPos,cr.plugins_.GD_SDK.prototype.acts.InitAds,cr.plugins_.sirg_kiz.prototype.acts.UnlockAchievement,cr.plugins_.Sprite.prototype.acts.SetOpacity,cr.plugins_.sirg_kiz.prototype.acts.SubmitScore,cr.behaviors.Pin.prototype.acts.Pin,cr.plugins_.Sprite.prototype.exps.X,cr.behaviors.Platform.prototype.acts.SimulateControl,cr.plugins_.Sprite.prototype.cnds.OnCreated,cr.behaviors.Platform.prototype.cnds.IsOnFloor,cr.behaviors.Platform.prototype.acts.SetMaxSpeed,cr.plugins_.Sprite.prototype.cnds.IsOverlapping,cr.plugins_.Sprite.prototype.cnds.IsVisible,cr.behaviors.Platform.prototype.cnds.IsJumping,cr.behaviors.Platform.prototype.acts.SetGravity,cr.system_object.prototype.cnds.IsGroupActive,cr.plugins_.Sprite.prototype.acts.SetX,cr.system_object.prototype.acts.SubVar,cr.plugins_.Sprite.prototype.acts.SetAngle,cr.system_object.prototype.exps.random,cr.plugins_.Sprite.prototype.cnds.CompareX,cr.plugins_.Sprite.prototype.acts.SetInstanceVar,cr.plugins_.Sprite.prototype.cnds.OnCollision,cr.plugins_.Sprite.prototype.acts.AddInstanceVar,cr.plugins_.Sprite.prototype.cnds.CompareInstanceVar,cr.plugins_.Function.prototype.cnds.OnFunction,cr.plugins_.Function.prototype.acts.CallFunction,cr.plugins_.Sprite.prototype.acts.SetTowardPosition,cr.behaviors.lunarray_LiteTween.prototype.acts.Start,cr.behaviors.lunarray_LiteTween.prototype.cnds.OnEnd,cr.behaviors.lunarray_LiteTween.prototype.acts.Reverse,cr.behaviors.lunarray_LiteTween.prototype.cnds.OnReverseEnd,cr.plugins_.Touch.prototype.exps.X,cr.plugins_.Touch.prototype.exps.Y,cr.plugins_.Sprite.prototype.cnds.IsOnScreen,cr.plugins_.Particles.prototype.acts.Destroy,cr.plugins_.Sprite.prototype.cnds.CompareY,cr.system_object.prototype.acts.GoToLayoutByName]};